{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:mentions-flextab/server/publications/mentionedMessages.js"],"names":["Meteor","publish","rid","limit","userId","ready","publication","user","RocketChat","models","Users","findOneById","cursorHandle","Messages","findVisibleByMentionAndRoomId","username","sort","ts","observeChanges","added","_id","record","mentionedList","changed","removed","onStop","stop"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAAA,OAAOC,OAAP,CAAe,mBAAf,EAAoC,UAASC,GAAT,EAA0B;AAAA,KAAZC,KAAY,uEAAJ,EAAI;;AAC7D,KAAI,CAAC,KAAKC,MAAV,EAAkB;AACjB,SAAO,KAAKC,KAAL,EAAP;AACA;;AACD,KAAMC,cAAc,IAApB;AACA,KAAMC,OAAOC,WAAWC,MAAX,CAAkBC,KAAlB,CAAwBC,WAAxB,CAAoC,KAAKP,MAAzC,CAAb;;AACA,KAAI,CAACG,IAAL,EAAW;AACV,SAAO,KAAKF,KAAL,EAAP;AACA;;AACD,KAAMO,eAAeJ,WAAWC,MAAX,CAAkBI,QAAlB,CAA2BC,6BAA3B,CAAyDP,KAAKQ,QAA9D,EAAwEb,GAAxE,EAA6E;AACjGc,QAAM;AACLC,OAAI,CAAC;AADA,GAD2F;AAIjGd;AAJiG,EAA7E,EAKlBe,cALkB,CAKH;AACjBC,OADiB,YACXC,GADW,EACNC,MADM,EACE;AAClBA,UAAOC,aAAP,GAAuB,IAAvB;AACA,UAAOhB,YAAYa,KAAZ,CAAkB,8BAAlB,EAAkDC,GAAlD,EAAuDC,MAAvD,CAAP;AACA,GAJgB;AAKjBE,SALiB,YAKTH,GALS,EAKJC,MALI,EAKI;AACpBA,UAAOC,aAAP,GAAuB,IAAvB;AACA,UAAOhB,YAAYiB,OAAZ,CAAoB,8BAApB,EAAoDH,GAApD,EAAyDC,MAAzD,CAAP;AACA,GARgB;AASjBG,SATiB,YASTJ,GATS,EASJ;AACZ,UAAOd,YAAYkB,OAAZ,CAAoB,8BAApB,EAAoDJ,GAApD,CAAP;AACA;AAXgB,EALG,CAArB;AAkBA,MAAKf,KAAL;AACA,QAAO,KAAKoB,MAAL,CAAY,YAAW;AAC7B,SAAOb,aAAac,IAAb,EAAP;AACA,EAFM,CAAP;AAGA,CA/BD,uG","file":"/packages/rocketchat_mentions-flextab.js","sourcesContent":["Meteor.publish('mentionedMessages', function(rid, limit = 50) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\tconst publication = this;\n\tconst user = RocketChat.models.Users.findOneById(this.userId);\n\tif (!user) {\n\t\treturn this.ready();\n\t}\n\tconst cursorHandle = RocketChat.models.Messages.findVisibleByMentionAndRoomId(user.username, rid, {\n\t\tsort: {\n\t\t\tts: -1\n\t\t},\n\t\tlimit\n\t}).observeChanges({\n\t\tadded(_id, record) {\n\t\t\trecord.mentionedList = true;\n\t\t\treturn publication.added('rocketchat_mentioned_message', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\trecord.mentionedList = true;\n\t\t\treturn publication.changed('rocketchat_mentioned_message', _id, record);\n\t\t},\n\t\tremoved(_id) {\n\t\t\treturn publication.removed('rocketchat_mentioned_message', _id);\n\t\t}\n\t});\n\tthis.ready();\n\treturn this.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n"]}