{"version":3,"sources":["meteor://💻app/packages/rocketchat:ui/getAvatarUrlFromUsername.js","meteor://💻app/packages/rocketchat:ui/client/lib/accountBox.js","meteor://💻app/packages/rocketchat:ui/client/lib/accounts.js","meteor://💻app/packages/rocketchat:ui/client/lib/avatar.js","meteor://💻app/packages/rocketchat_ui/client/lib/chatMessages.coffee","meteor://💻app/client/lib/chatMessages.coffee.js","meteor://💻app/packages/rocketchat:ui/client/lib/collections.js","meteor://💻app/packages/rocketchat:ui/client/lib/customEventPolyfill.js","meteor://💻app/packages/rocketchat_ui/client/lib/fileUpload.coffee","meteor://💻app/client/lib/fileUpload.coffee.js","meteor://💻app/packages/rocketchat:ui/client/lib/fireEvent.js","meteor://💻app/packages/rocketchat:ui/client/lib/iframeCommands.js","meteor://💻app/packages/rocketchat:ui/client/lib/menu.js","meteor://💻app/packages/rocketchat_ui/client/lib/modal.coffee","meteor://💻app/client/lib/modal.coffee.js","meteor://💻app/packages/rocketchat:ui/client/lib/Modernizr.js","meteor://💻app/packages/rocketchat_ui/client/lib/msgTyping.coffee","meteor://💻app/client/lib/msgTyping.coffee.js","meteor://💻app/packages/rocketchat_ui/client/lib/notification.coffee","meteor://💻app/client/lib/notification.coffee.js","meteor://💻app/packages/rocketchat:ui/client/lib/parentTemplate.js","meteor://💻app/packages/rocketchat_ui/client/lib/readMessages.coffee","meteor://💻app/client/lib/readMessages.coffee.js","meteor://💻app/packages/rocketchat_ui/client/lib/rocket.coffee","meteor://💻app/client/lib/rocket.coffee.js","meteor://💻app/packages/rocketchat_ui/client/lib/RoomHistoryManager.coffee","meteor://💻app/client/lib/RoomHistoryManager.coffee.js","meteor://💻app/packages/rocketchat_ui/client/lib/RoomManager.coffee","meteor://💻app/client/lib/RoomManager.coffee.js","meteor://💻app/packages/rocketchat:ui/client/lib/sideNav.js","meteor://💻app/packages/rocketchat:ui/client/lib/tapi18n.js","meteor://💻app/packages/rocketchat:ui/client/lib/textarea-autogrow.js","meteor://💻app/packages/rocketchat:ui/client/lib/codeMirror/codeMirror.js","meteor://💻app/packages/rocketchat:ui/client/lib/codeMirror/codeMirrorComponent.js","meteor://💻app/packages/rocketchat:ui/client/lib/cordova/facebook-login.js","meteor://💻app/packages/rocketchat:ui/client/lib/cordova/keyboard-fix.js","meteor://💻app/packages/rocketchat_ui/client/lib/cordova/push.coffee","meteor://💻app/client/lib/cordova/push.coffee.js","meteor://💻app/packages/rocketchat_ui/client/lib/cordova/urls.coffee","meteor://💻app/client/lib/cordova/urls.coffee.js","meteor://💻app/packages/rocketchat:ui/client/lib/cordova/user-state.js","meteor://💻app/packages/rocketchat_ui/client/lib/recorderjs/audioRecorder.coffee","meteor://💻app/client/lib/recorderjs/audioRecorder.coffee.js","meteor://💻app/packages/rocketchat_ui/client/lib/recorderjs/videoRecorder.coffee","meteor://💻app/client/lib/recorderjs/videoRecorder.coffee.js","meteor://💻app/packages/rocketchat:ui/client/lib/recorderjs/recorder.js","meteor://💻app/packages/rocketchat:ui/client/lib/textarea-cursor/set-cursor-position.js","meteor://💻app/packages/rocketchat:ui/client/lib/esc.js","meteor://💻app/packages/rocketchat:ui/client/views/404/roomNotFound.js","meteor://💻app/packages/rocketchat:ui/client/views/app/videoCall/videoButtons.js","meteor://💻app/packages/rocketchat:ui/client/views/app/videoCall/videoCall.js","meteor://💻app/packages/rocketchat:ui/client/views/app/burger.js","meteor://💻app/packages/rocketchat:ui/client/views/app/home.js","meteor://💻app/packages/rocketchat:ui/client/views/app/mobileMessageMenu.js","meteor://💻app/packages/rocketchat:ui/client/views/app/privateHistory.js","meteor://💻app/packages/rocketchat_ui/client/views/app/room.coffee","meteor://💻app/client/views/app/room.coffee.js","meteor://💻app/packages/rocketchat:ui/client/views/app/roomSearch.js","meteor://💻app/packages/rocketchat:ui/client/views/app/secretURL.js","meteor://💻app/packages/rocketchat:ui/client/views/app/photoswipe.js","meteor://💻app/packages/rocketchat:ui/client/views/cmsPage.js","meteor://💻app/packages/rocketchat:ui/client/views/fxos.js","meteor://💻app/packages/rocketchat:ui/client/views/modal.js"],"names":["getAvatarUrlFromUsername","username","key","random","Session","keys","cdnPrefix","RocketChat","settings","get","trim","replace","pathPrefix","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","path","Meteor","isCordova","absoluteUrl","encodeURIComponent","AccountBox","status","self","items","ReactiveVar","setStatus","call","open","SideNav","flexStatus","closeFlex","options","removeClass","box","addClass","toggleArrow","close","toggle","openFlex","init","$","find","addItem","newItem","Tracker","nonreactive","actual","push","set","checkCondition","item","condition","getItems","_","filter","addRoute","newRoute","router","FlowRouter","routeConfig","center","pageTemplate","i18nPageTitle","pageTitle","route","name","action","BlazeLayout","render","triggersEnter","sideNav","setFlex","toastr","module","watch","require","v","Accounts","onEmailVerificationLink","token","done","verifyEmail","error","success","t","Blaze","registerHelper","getAvatarAsPng","cb","image","Image","src","onload","canvas","document","createElement","width","height","context","getContext","drawImage","toDataURL","onerror","updateAvatarOfUsername","Math","round","Object","RoomManager","openedRooms","forEach","room","url","dom","css","moment","import","indexOf","i","l","length","ChatMessages","prototype","node","editing","records","messageMaxSize","wrapper","input","$input","hasValue","bindEvents","resize","dif","Layout","isEmbedded","outerHeight","getEditingIndex","element","index","j","len","msg","msgs","querySelectorAll","recordInputAsDraft","draft","id","message","record","getMessageById","value","clearCurrentDraft","getMessageDraft","clearMessageDraft","resetToDraft","old_value","ChatMessage","findOne","toPrevMessage","editByIndex","toNextMessage","clearEditing","edit","blockEditInMinutes","currentTsDiff","cursor_pos","editAllowed","editOwn","editingNext","hasPermission","msgTs","old_input","ref","ref1","getAttribute","authz","hasAtLeastOnePermission","rid","u","_id","userId","classList","contains","ts","diff","add","closest","focus","attachments","description","setCursorPosition","remove","saved","savedCursor","selectionEnd","send","msgObject","readMessage","enable","readNow","Random","promises","run","then","_this","command","commandOptions","invalidCommandMsg","match","param","isMessageTooLong","update","KonchatNotification","removeRoomNotification","updateAutogrow","stopTyping","slashCommands","commands","clientOnly","callback","cmd","params","err","result","Date","TAPi18n","__","upsert","confirmDeleteMsg","MessageTypes","isSystemMessage","swal","title","text","type","showCancelButton","confirmButtonColor","confirmButtonText","cancelButtonText","closeOnConfirm","html","timer","showConfirmButton","deleteMsg","blockDeleteInMinutes","handleError","pinMsg","pinned","unpinMsg","isDescription","startTyping","MsgTyping","start","stop","autogrow","postGrowCallback","tryCompletion","re","user","RegExp","users","keyup","event","k","keyCodes","currentTarget","which","keydown","ref2","ref3","ref4","sendOnEnter","preferences","Device","isDesktop","shiftKey","ctrlKey","altKey","metaKey","preventDefault","stopPropagation","navigator","platform","RoomHistoryManager","clear","valueChanged","determineInputDirection","dir","isMessageRtl","ltrChars","rtlChars","rtlDirCheck","test","isEmpty","Mongo","Collection","CachedChatRoom","CachedCollection","ChatRoom","collection","CachedChatSubscription","ChatSubscription","UserRoles","RoomRoles","UserAndRoom","CachedChannelList","CachedUserList","models","Users","extend","Subscriptions","Rooms","Messages","startup","autorun","ready","CustomEvent","bubbles","cancelable","detail","undefined","evt","createEvent","initCustomEvent","window","Event","formatBytes","getUploadPreview","readAsArrayBuffer","readAsDataURL","file","reader","FileReader","ev","target","size","split","content","bytes","decimals","dm","sizes","floor","log","parseFloat","pow","toFixed","fileUpload","files","consume","roomId","concat","pop","fileUploadIsValidContentType","s","strRightBack","preview","fileSize","Handlebars","_escape","closeOnCancel","isConfirm","upload","uploading","getElementById","fileUploadHandler","getFileName","percentage","onProgress","progress","findWhere","c","cancel","setTimeout","without","fireGlobalEvent","_fireGlobalEvent","eventName","dispatchEvent","computation","enabled","parent","postMessage","data","go","console","current","queryParams","customOAuthCallback","response","source","origin","siteUrl","Site_Url","redirectUrl","startsWith","service","ServiceConfiguration","customOauth","configurations","customLoginWith","capitalize","customRedirectUri","loginWithToken","arguments","logout","callbacks","addEventListener","e","externalCommand","origins","menu","updateUnreadBars","throttle","list","listOffset","offset","listHeight","showTop","showBottom","each","top","mainContent","isOpen","isRtl","localStorage","getItem","Modal","check","checkFooter","setContent","startListening","stopListening","win","$modal","stopImmediatePropagation","$window","hasClass","template","animeBack","opened","listening","unbind","$main","empty","renderWithData","buttons","$footer","btn","click","interval","setInterval","clearInterval","initialized","$close","bind","Modernizr","a","b","z","cssText","A","m","join","B","C","D","d","E","f","F","charAt","toUpperCase","slice","o","p","g","documentElement","h","style","toString","n","toLowerCase","q","r","w","body","parseInt","appendChild","innerHTML","background","overflow","parentNode","removeChild","x","hasOwnProperty","y","constructor","Function","TypeError","apply","touch","DocumentTouch","offsetTop","cssanimations","csstransitions","G","addTest","className","getElementsByTagName","insertBefore","lastChild","firstChild","elements","cache","cloneNode","createElem","canHaveChildren","tagUrn","frag","createDocumentFragment","createFrag","shivMethods","shivCSS","hasCSS","html5","childNodes","version","supportsUnknownElements","shivDocument","_version","_prefixes","_domPrefixes","_cssomPrefixes","testProp","testAllProps","testStyles","prefixed","shift","injectCss","injectJs","readyState","onreadystatechange","errorTimeout","splice","loader","load","createRange","compareNode","opera","attachEvent","Array","isArray","timeout","origUrl","prefixes","autoCallback","bypass","instead","noexec","forceCSS","forceJS","attrs","both","complete","yep","nope","yepnope","addPrefix","addFilter","removeEventListener","executeStack","setAttribute","href","rel","addStream","dep","renew","renewTimeout","selfTyping","timeouts","usersTyping","Dependency","Notifications","onRoom","typing","changed","notifyRoom","clearTimeout","depend","notificationStatus","getDesktopPermission","Notification","permission","sandstorm","requestPermission","notify","notification","payload","notificationDuration","icon","sender","stripTags","tag","silent","canReply","duration","desktopNotificationDuration","arg","onclick","showDesktop","base","hasFocus","avatarAsPng","newMessage","newMessageNotification","ref5","ref6","sub","equals","fields","audioNotification","play","newRoom","withSound","newRoomSound","union","newRoomNotification","ref7","pause","currentTime","TemplateInstance","parentTemplate","levels","view","currentView","substring","templateInstance","parentView","_Class","debug","canReadMessage","force","position","subscription","unreadMark","visible","refreshUnreadMark","getRoom","unreadNotLoaded","fireRead","alert","unread","getOpenedRoomByRid","unreadSince","read","debounce","disable","isEnable","onRead","results","$roomDom","firstUnreadRecord","lastReadRecord","reactive","$lt","ls","sort","$gt","$ne","unreadFirstId","on","Login","onBlur","onClick","el","$el","parents","form","$form","inputs","Button","loading","reset","time","next","attr","animationSupport","animeEnd","prefixA","prefixB","support","transEndEventNames","WebkitAnimation","OAnimation","msAnimation","animation","WebkitTransition","MozTransition","OTransition","msTransition","transition","one","preLoadImgs","urls","L_","ended","im","loaded","preLoader","imgs","children","appendTo","defaultLimit","getMore","getMoreIfIsEmpty","getMoreNext","getSurroundingMessages","hasMore","hasMoreNext","histories","isLoading","firstUnread","limit","curRoomDoc","lastMessage","typeName","curValue","heightDiff","previousHeight","scrollHeight","messages","roles","scrollTop","defer","updateMentionsMarksOfRoom","instance","getView","atBottom","msgElement","pos","animate","clientHeight","moreAfter","moreBefore","connectionWasOnline","currentUsername","loadMissedMessages","onDeleteMessageStream","connected","connection","closeAllRooms","_current","callAction","observe","removed","recordAfter","recordBefore","$set","tick","onUser","Dep","closeOlderRooms","existsDomOfRoom","getDomOfRoom","msgStream","onlineUsers","updateUserStatus","Streamer","removeAllListeners","unRoom","active","substr","roomTypes","findRoom","streamActive","maxRoomsOpen","roomToClose","roomsToClose","sortBy","values","reverse","openedRoom","lastSeen","invalidate","contentAsFunc","_TemplateWith","Template","utcOffset","onlineUsersValue","ticksBar","totalHeight","percent","topOffset","append","priority","MEDIUM","initiated","flexNav","arrow","animating","openQueue","toggleFlex","getTypes","map","includes","openRouteLink","getFlex","toggleCurrent","overArrow","leaveArrow","arrowBindHover","focusInput","sideNavDivs","ele","tagName","highestZidx","highestZidxElem","zIndex","Number","getComputedStyle","querySelector","validate","invalid","prev","config","getSideNav","replaces","isObject","postProcess","sprintf","tr","language","fn","$self","minHeight","noFlickerPad","preGrowCallback","shadow","fontSize","fontFamily","fontWeight","lineHeight","wordWrap","times","string","number","val","space","keyCode","newHeight","max","change","jQuery","CodeMirror","CodeMirrors","rendered","lineNumbers","textarea","editor","fromTextArea","doc","getValue","reactiveVar","setValue","refresh","destroyed","helpers","editorId","editorName","loginWithFacebookCordova","credentialRequestCompleteCallback","oauth","credentialRequestCompleteHandler","fbLoginSuccess","cordova","callLoginMethod","methodArguments","userCallback","facebookConnectPlugin","getLoginStatus","login","JSON","stringify","Facebook","requestCredential","device","plugins","Keyboard","hideKeyboardAccessoryBar","disableScroll","innerHeight","Push","addListener","host","Servers","serverExists","startServer","Configure","android","senderID","ANDROID_SENDER_ID","sound","vibrate","ios","badge","clearBadge","$link","UserPresence","setAway","disconnect","isUndefined","reconnect","setOnline","AudioRecorder","ok","AudioContext","webkitAudioContext","getUserMedia","webkitGetUserMedia","URL","webkitURL","audioContext","stream","startUserMedia","audio","createMediaStreamSource","recorder","Recorder","workerPath","getBlob","getAudioTracks","exportWAV","VideoRecorder","started","cameraStarted","recording","recordingAvailable","videoel","mozGetUserMedia","video","chunks","mediaRecorder","MediaRecorder","mimeType","ondataavailable","blobev","createObjectURL","onloadedmetadata","atrack","atracks","blob","len1","vtrack","vtracks","stopRecording","getVideoTracks","Blob","WORKER_PATH","cfg","bufferLen","numChannels","createScriptProcessor","createJavaScriptNode","worker","Worker","sampleRate","currCallback","onaudioprocess","buffer","channel","inputBuffer","getChannelData","configure","prop","getBuffer","Error","onmessage","connect","destination","forceDownload","filename","link","download","initEvent","elem","setSelectionRange","createTextRange","range","collapse","moveEnd","moveStart","select","escapify","that","keyName","sideNavIcon","flextTabButton","videoDialog","sweetAlerts","getClickEvent","MouseEvent","sideNavArrow","vrecDialog","opacity","VRecDialog","sweetAlert","roomNotFound","videoButtons","videoAvaliable","WebRTC","getInstanceByRoomId","videoActive","localUrl","remoteItems","callInProgress","events","startCall","joinCall","videoCall","onCreated","mainVideo","webrtc","overlay","overlayEnabled","audioEnabled","videoEnabled","audioAndVideoEnabled","screenShareAvailable","screenShareEnabled","remoteVideoItems","selfVideoUrl","mainVideoUrl","remoteItemsById","mainVideoUsername","usernameByUserId","disableAudio","enableAudio","disableVideo","enableVideo","disableScreenShare","enableScreenShare","muted","volume","burger","isMenuOpen","home","mobileMessageMenu","show","scope","actionsheet","ANDROID_THEMES","THEME_HOLO_LIGHT","androidEnableCancelButton","addCancelButtonWithLabel","buttonActions","reportAbuse","MessageAction","getButtons","customClass","addDestructiveButtonWithLabel","i18nLabel","unshift","buttonLabels","buttonIndex","inputPlaceholder","inputValue","showInputError","privateHistory","history","$regex","$options","$in","archived","count","archivedHistory","roomOf","creation","format","lm","mime","ChartDialog","favoritesEnabled","isSocialSharingOpen","isSubscribed","socialSharing","touchMoved","userCanDrop","socialsharing","share","subject","readOnly","isTranslated","autoTranslate","autoTranslateLanguage","embeddedVersion","favorite","favoriteLabel","subscribed","messagesHistory","hideMessagesOfType","query","types","$nin","windowId","roomName","roomData","getRoomName","secondaryName","getSecondaryRoomName","roomTopic","topic","showAnnouncement","chatMessages","announcement","roomAnnouncement","roomIcon","getIcon","userStatus","getUserStatus","maxMessageLength","unreadData","unreadCount","since","containerBarsShow","formatUnreadSince","calendar","sameDay","flexData","tabBar","userDetail","clearUserDetail","adminClass","hasRole","showToggleFavorite","viewMode","cssClass","selectable","hideUsername","hideUsernames","hideAvatar","hideAvatars","canPreview","hasAllPermission","sendToBottomIfNecessaryDebounced","getState","hideFlexTab","doLongTouch","originalEvent","touches","nodeName","_arguments","attachment","innerText","touchtime","InAppBrowser","fetch","setUserDetail","setTemplate","actions","dropDown","hideDropDown","toHTMLWithData","messageDropdown","button","getButtonById","collapsed","obj","obj1","dataTransfer","every","effectAllowed","dropEffect","filesToUpload","defineProperty","lookup","sendToBottomIfNecessary","results1","selectedMessages","selection","getSelection","removeAllRanges","getData","selectablePointer","getSelectedMessages","selectedRange","selectMessages","difference","showUsersOffline","getQueryParam","flexTemplate","getParam","RocketChatTabBar","showGroup","resetSelection","to","maxTs","message1","message2","minTs","min","pluck","$gte","$lte","addMessages","previewMessages","compact","uniq","added","role","$addToSet","multi","oldRole","$inc","rerender","$pull","onDestroyed","onWindowResize","onRendered","messageBox","observer","rtl","updateUnreadCount","wrapperUl","firstNode","Highcharts","chart","isAtBottom","scrollThreshold","sendToBottom","checkIfScrollIsAtBottom","MutationObserver","mutations","mutation","childList","lastInvisibleMessageOnScreen","messageBoxOffset","elementFromPoint","left","roomSearch","secretURL","registrationAllowed","hashIsValid","subscriptionsReady","hashReady","PhotoSwipe","PhotoSwipeUI_Default","initGallery","selector","gallery","imageSrc","naturalWidth","naturalHeight","dataset","galleryOptions","bgOpacity","showHideOpacity","counterEl","shareEl","images","addCaptionHTMLFn","captionEl","img","cmsPage","page","fxOsInstallPrompt","showPrompt","request","mozApps","install","location","onsuccess","installError","fxOsInstallDone","fxOsInstallError","modal"],"mappings":"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","file":"/packages/rocketchat_ui.js","sourcesContent":["// TODO: remove global\nthis.getAvatarUrlFromUsername = function(username) {\n\tconst key = `avatar_random_${ username }`;\n\tconst random = typeof Session !== 'undefined' ? Session.keys[key] : 0;\n\tif (username == null) {\n\t\treturn;\n\t}\n\tconst cdnPrefix = (RocketChat.settings.get('CDN_PREFIX') || '').trim().replace(/\\/$/, '');\n\tconst pathPrefix = (__meteor_runtime_config__.ROOT_URL_PATH_PREFIX || '').trim().replace(/\\/$/, '');\n\tlet path = pathPrefix;\n\tif (cdnPrefix) {\n\t\tpath = cdnPrefix + pathPrefix;\n\t} else if (Meteor.isCordova) {\n\t\tpath = Meteor.absoluteUrl().replace(/\\/$/, '');\n\t}\n\treturn `${ path }/avatar/${ encodeURIComponent(username) }?_dc=${ random }`;\n};\n","this.AccountBox = (function() {\n\tlet status = 0;\n\tconst self = {};\n\tconst items = new ReactiveVar([]);\n\tfunction setStatus(status) {\n\t\treturn Meteor.call('UserPresence:setDefaultStatus', status);\n\t}\n\tfunction open() {\n\t\tif (SideNav.flexStatus()) {\n\t\t\tSideNav.closeFlex();\n\t\t\treturn;\n\t\t}\n\t\tstatus = 1;\n\t\tself.options.removeClass('animated-hidden');\n\t\tself.box.addClass('active');\n\t\treturn SideNav.toggleArrow(1);\n\t}\n\tfunction close() {\n\t\tstatus = 0;\n\t\tself.options.addClass('animated-hidden');\n\t\tself.box.removeClass('active');\n\t\treturn SideNav.toggleArrow(-1);\n\t}\n\tfunction toggle() {\n\t\tif (status) {\n\t\t\treturn close();\n\t\t} else {\n\t\t\treturn open();\n\t\t}\n\t}\n\tfunction openFlex() {\n\t\tstatus = 0;\n\t\tself.options.addClass('animated-hidden');\n\t\treturn self.box.removeClass('active');\n\t}\n\tfunction init() {\n\t\tself.box = $('.account-box');\n\t\treturn self.options = self.box.find('.options');\n\t}\n\n\t/*\n\t* @param newOption:\n\t*   name: Button label\n\t*   icon: Button icon\n\t*   class: Class of the item\n\t*   permissions: Which permissions a user should have (all of them) to see this item\n\t*/\n\tfunction addItem(newItem) {\n\t\treturn Tracker.nonreactive(function() {\n\t\t\tconst actual = items.get();\n\t\t\tactual.push(newItem);\n\t\t\treturn items.set(actual);\n\t\t});\n\t}\n\tfunction checkCondition(item) {\n\t\treturn (item.condition == null) || item.condition();\n\t}\n\tfunction getItems() {\n\t\treturn _.filter(items.get(), function(item) {\n\t\t\tif (checkCondition(item)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t}\n\tfunction addRoute(newRoute, router) {\n\t\tif (router == null) {\n\t\t\trouter = FlowRouter;\n\t\t}\n\t\tconst routeConfig = {\n\t\t\tcenter: 'pageContainer',\n\t\t\tpageTemplate: newRoute.pageTemplate\n\t\t};\n\t\tif (newRoute.i18nPageTitle != null) {\n\t\t\trouteConfig.i18nPageTitle = newRoute.i18nPageTitle;\n\t\t}\n\t\tif (newRoute.pageTitle != null) {\n\t\t\trouteConfig.pageTitle = newRoute.pageTitle;\n\t\t}\n\t\treturn router.route(newRoute.path, {\n\t\t\tname: newRoute.name,\n\t\t\taction() {\n\t\t\t\tSession.set('openedRoom');\n\t\t\t\treturn BlazeLayout.render('main', routeConfig);\n\t\t\t},\n\t\t\ttriggersEnter: [\n\t\t\t\tfunction() {\n\t\t\t\t\tif (newRoute.sideNav != null) {\n\t\t\t\t\t\tSideNav.setFlex(newRoute.sideNav);\n\t\t\t\t\t\treturn SideNav.openFlex();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\t}\n\treturn {\n\t\tsetStatus,\n\t\ttoggle,\n\t\topen,\n\t\tclose,\n\t\topenFlex,\n\t\tinit,\n\t\taddRoute,\n\t\taddItem,\n\t\tgetItems\n\t};\n}());\n","import toastr from 'toastr';\nAccounts.onEmailVerificationLink(function(token, done) {\n\tAccounts.verifyEmail(token, function(error) {\n\t\tif (error == null) {\n\t\t\ttoastr.success(t('Email_verified'));\n\t\t\tMeteor.call('afterVerifyEmail');\n\t\t}\n\t\treturn done();\n\t});\n});\n","Blaze.registerHelper('avatarUrlFromUsername', getAvatarUrlFromUsername);\n\nthis.getAvatarAsPng = function(username, cb) {\n\tconst image = new Image;\n\timage.src = getAvatarUrlFromUsername(username);\n\timage.onload = function() {\n\n\t\tconst canvas = document.createElement('canvas');\n\t\tcanvas.width = image.width;\n\t\tcanvas.height = image.height;\n\t\tconst context = canvas.getContext('2d');\n\t\tcontext.drawImage(image, 0, 0);\n\t\treturn cb(canvas.toDataURL('image/png'));\n\t};\n\treturn image.onerror = function() {\n\t\treturn cb('');\n\t};\n};\n\nthis.updateAvatarOfUsername = function(username) {\n\n\tconst key = `avatar_random_${ username }`;\n\tSession.set(key, Math.round(Math.random() * 1000));\n\n\tObject.keys(RoomManager.openedRooms).forEach((key) => {\n\t\tconst room = RoomManager.openedRooms[key];\n\t\tconst url = getAvatarUrlFromUsername(username);\n\t\t$(room.dom).find(`.message[data-username='${ username }'] .avatar-image`).css('background-image', `url(${ url })`);\n\t});\n\treturn true;\n};\n","import moment from 'moment'\nimport toastr from 'toastr'\n\nclass @ChatMessages\n\tinit: (node) ->\n\t\tthis.editing = {}\n\t\tthis.records  = {}\n\t\tthis.messageMaxSize = RocketChat.settings.get('Message_MaxAllowedSize')\n\t\tthis.wrapper = $(node).find(\".wrapper\")\n\t\tthis.input = $(node).find(\".input-message\").get(0)\n\t\tthis.$input = $(this.input)\n\t\tthis.hasValue = new ReactiveVar false\n\t\tthis.bindEvents()\n\t\treturn\n\n\tresize: ->\n\t\tdif = (if RocketChat.Layout.isEmbedded() then 0 else 60) + $(\".messages-container\").find(\"footer\").outerHeight()\n\t\tdif += if $(\".announcement\").length > 0 then 40 else 0\n\t\t$(\".messages-box\").css\n\t\t\theight: \"calc(100% - #{dif}px)\"\n\n\tgetEditingIndex: (element) ->\n\t\tmsgs = this.wrapper.get(0).querySelectorAll(\".own:not(.system)\")\n\t\tindex = 0\n\t\tfor msg in msgs\n\t\t\tif msg is element\n\t\t\t\treturn index\n\t\t\tindex++\n\t\treturn -1\n\n\trecordInputAsDraft: () ->\n\t\tid = this.editing.id\n\n\t\tmessage = this.getMessageById id\n\t\trecord = this.records[id] || {}\n\t\tdraft = this.input.value\n\n\t\tif(draft is message.msg)\n\t\t\tthis.clearCurrentDraft()\n\t\telse\n\t\t\trecord.draft = draft\n\t\t\tthis.records[id] = record\n\n\tgetMessageDraft: (id) ->\n\t\treturn this.records[id]\n\n\tclearMessageDraft: (id) ->\n\t\tdelete this.records[id]\n\n\tclearCurrentDraft: () ->\n\t\tthis.clearMessageDraft this.editing.id\n\n\tresetToDraft: (id) ->\n\t\tmessage = this.getMessageById id\n\n\t\told_value = this.input.value\n\t\tthis.input.value = message.msg\n\n\t\treturn old_value isnt message.msg\n\n\tgetMessageById: (id) ->\n\t\treturn ChatMessage.findOne(id)\n\n\ttoPrevMessage: ->\n\t\tindex = this.editing.index\n\t\tthis.editByIndex if index? then index - 1 else undefined\n\n\ttoNextMessage: ->\n\t\tindex = this.editing.index\n\t\tthis.clearEditing() unless this.editByIndex index + 1\n\n\teditByIndex: (index) ->\n\t\treturn false if not this.editing.element and index?\n\n\t\tmsgs = this.wrapper.get(0).querySelectorAll(\".own:not(.system)\")\n\t\tindex = msgs.length - 1 if not index?\n\n\t\treturn false unless msgs[index]\n\n\t\telement = msgs[index]\n\t\tthis.edit element, index\n\n\t\treturn true\n\n\tedit: (element, index) ->\n\t\tindex = this.getEditingIndex(element) if not index?\n\n\t\tmessage = this.getMessageById element.getAttribute(\"id\")\n\n\t\thasPermission = RocketChat.authz.hasAtLeastOnePermission('edit-message', message.rid)\n\t\teditAllowed = RocketChat.settings.get 'Message_AllowEditing'\n\t\teditOwn = message?.u?._id is Meteor.userId()\n\n\t\treturn unless hasPermission or (editAllowed and editOwn)\n\t\treturn if element.classList.contains(\"system\")\n\n\t\tblockEditInMinutes = RocketChat.settings.get 'Message_AllowEditing_BlockEditInMinutes'\n\t\tif blockEditInMinutes? and blockEditInMinutes isnt 0\n\t\t\tmsgTs = moment(message.ts) if message.ts?\n\t\t\tcurrentTsDiff = moment().diff(msgTs, 'minutes') if msgTs?\n\t\t\tif currentTsDiff > blockEditInMinutes\n\t\t\t\treturn\n\n\t\tmsg = this.getMessageDraft(message._id)?.draft\n\t\tmsg = message.msg unless msg?\n\n\t\teditingNext = this.editing.index < index\n\n\t\told_input = this.input.value\n\n\t\tthis.clearEditing()\n\n\t\tthis.hasValue.set true\n\t\tthis.editing.element = element\n\t\tthis.editing.index = index\n\t\tthis.editing.id = message._id\n\t\telement.classList.add(\"editing\")\n\t\tthis.input.classList.add(\"editing\")\n\t\tthis.$input.closest('.message-form').addClass('editing')\n\n\t\tthis.input.focus()\n\t\tif message.attachments? and message.attachments[0].description?\n\t\t\tthis.input.value = message.attachments[0].description\n\t\telse\n\t\t\tthis.input.value = msg\n\n\t\tcursor_pos = if editingNext then 0 else -1\n\t\tthis.$input.setCursorPosition(cursor_pos)\n\n\tclearEditing: ->\n\t\tif this.editing.element\n\t\t\tthis.recordInputAsDraft()\n\n\t\t\tthis.editing.element.classList.remove(\"editing\")\n\t\t\tthis.input.classList.remove(\"editing\")\n\t\t\tthis.$input.closest('.message-form').removeClass('editing')\n\t\t\tdelete this.editing.id\n\t\t\tdelete this.editing.element\n\t\t\tdelete this.editing.index\n\n\t\t\tthis.input.value = this.editing.saved or \"\"\n\t\t\tcursor_pos = this.editing.savedCursor ? -1\n\t\t\tthis.$input.setCursorPosition(cursor_pos)\n\n\t\t\tthis.hasValue.set this.input.value isnt ''\n\t\telse\n\t\t\tthis.editing.saved = this.input.value\n\t\t\tthis.editing.savedCursor = this.input.selectionEnd\n\n\t###*\n\t# * @param {string} rim room ID\n\t# * @param {Element} input DOM element\n\t# * @param {function?} done callback\n\t###\n\tsend: (rid, input, done = ->) ->\n\t\tif _.trim(input.value) isnt ''\n\t\t\treadMessage.enable()\n\t\t\treadMessage.readNow()\n\t\t\t$('.message.first-unread').removeClass('first-unread')\n\n\t\t\tmsg = input.value\n\t\t\tmsgObject = { _id: Random.id(), rid: rid, msg: msg}\n\n\t\t\t# Run to allow local encryption, and maybe other client specific actions to be run before send\n\t\t\tRocketChat.promises.run('onClientBeforeSendMessage', msgObject).then (msgObject) =>\n\n\t\t\t\t# checks for the final msgObject.msg size before actually sending the message\n\t\t\t\tif this.isMessageTooLong(msgObject.msg)\n\t\t\t\t\treturn toastr.error t('Message_too_long')\n\n\t\t\t\tthis.clearCurrentDraft()\n\t\t\t\tif this.editing.id\n\t\t\t\t\tthis.update(this.editing.id, rid, msgObject.msg)\n\t\t\t\t\treturn\n\n\t\t\t\tKonchatNotification.removeRoomNotification(rid)\n\t\t\t\tinput.value = ''\n\t\t\t\tinput.updateAutogrow?()\n\t\t\t\tthis.hasValue.set false\n\t\t\t\tthis.stopTyping(rid)\n\n\t\t\t\t#Check if message starts with /command\n\t\t\t\tif msg[0] is '/'\n\t\t\t\t\tmatch = msg.match(/^\\/([^\\s]+)(?:\\s+(.*))?$/m)\n\t\t\t\t\tif match?\n\t\t\t\t\t\tif RocketChat.slashCommands.commands[match[1]]\n\t\t\t\t\t\t\tcommandOptions = RocketChat.slashCommands.commands[match[1]]\n\t\t\t\t\t\t\tcommand = match[1]\n\t\t\t\t\t\t\tparam = if match[2]? then match[2] else ''\n\t\t\t\t\t\t\tif commandOptions.clientOnly\n\t\t\t\t\t\t\t\tcommandOptions.callback(command, param, msgObject)\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tMeteor.call 'slashCommand', {cmd: command, params: param, msg: msgObject }, (err, result) -> commandOptions.result?(err, result, {cmd: command, params: param, msg: msgObject })\n\t\t\t\t\t\t\treturn\n\n\t\t\t\t\t\tif !RocketChat.settings.get('Message_AllowUnrecognizedSlashCommand')\n\t\t\t\t\t\t\tinvalidCommandMsg =\n\t\t\t\t\t\t\t\t_id: Random.id()\n\t\t\t\t\t\t\t\trid: rid\n\t\t\t\t\t\t\t\tts: new Date\n\t\t\t\t\t\t\t\tmsg: TAPi18n.__('No_such_command', { command: match[1] })\n\t\t\t\t\t\t\t\tu:\n\t\t\t\t\t\t\t\t\tusername: \"rocketbot\"\n\t\t\t\t\t\t\t\tprivate: true\n\t\t\t\t\t\t\tChatMessage.upsert { _id: invalidCommandMsg._id }, invalidCommandMsg\n\t\t\t\t\t\t\treturn\n\n\t\t\t\tMeteor.call 'sendMessage', msgObject\n\t\t\t\tdone()\n\n\t\t# If edited message was emptied we ask for deletion\n\t\telse if this.editing.element\n\t\t\tmessage = this.getMessageById this.editing.id\n\t\t\tif message.attachments? and message.attachments[0].description?\n\t\t\t\tthis.update(this.editing.id, rid, '', true)\n\t\t\t\treturn\n\t\t\t# Restore original message in textbox in case delete is canceled\n\t\t\tthis.resetToDraft this.editing.id\n\n\t\t\tthis.confirmDeleteMsg message, done\n\n\tconfirmDeleteMsg: (message, done = ->) ->\n\t\treturn if RocketChat.MessageTypes.isSystemMessage(message)\n\t\tswal {\n\t\t\ttitle: t('Are_you_sure')\n\t\t\ttext: t('You_will_not_be_able_to_recover')\n\t\t\ttype: 'warning'\n\t\t\tshowCancelButton: true\n\t\t\tconfirmButtonColor: '#DD6B55'\n\t\t\tconfirmButtonText: t('Yes_delete_it')\n\t\t\tcancelButtonText: t('Cancel')\n\t\t\tcloseOnConfirm: false\n\t\t\thtml: false\n\t\t}, =>\n\t\t\tswal\n\t\t\t\ttitle: t('Deleted')\n\t\t\t\ttext: t('Your_entry_has_been_deleted')\n\t\t\t\ttype: 'success'\n\t\t\t\ttimer: 1000\n\t\t\t\tshowConfirmButton: false\n\n\t\t\tif this.editing.id is message._id\n\t\t\t\tthis.clearEditing message\n\t\t\tthis.deleteMsg message\n\n\t\t\tthis.$input.focus()\n\t\t\tdone()\n\n\t\t# In order to avoid issue \"[Callback not called when still animating](https://github.com/t4t5/sweetalert/issues/528)\"\n\t\t$('.sweet-alert').addClass 'visible'\n\n\tdeleteMsg: (message) ->\n\t\tblockDeleteInMinutes = RocketChat.settings.get 'Message_AllowDeleting_BlockDeleteInMinutes'\n\t\tif blockDeleteInMinutes? and blockDeleteInMinutes isnt 0\n\t\t\tmsgTs = moment(message.ts) if message.ts?\n\t\t\tcurrentTsDiff = moment().diff(msgTs, 'minutes') if msgTs?\n\t\t\tif currentTsDiff > blockDeleteInMinutes\n\t\t\t\ttoastr.error(t('Message_deleting_blocked'))\n\t\t\t\treturn\n\n\t\tMeteor.call 'deleteMessage', { _id: message._id }, (error, result) ->\n\t\t\tif error\n\t\t\t\treturn handleError(error)\n\n\tpinMsg: (message) ->\n\t\tmessage.pinned = true\n\t\tMeteor.call 'pinMessage', message, (error, result) ->\n\t\t\tif error\n\t\t\t\treturn handleError(error)\n\n\tunpinMsg: (message) ->\n\t\tmessage.pinned = false\n\t\tMeteor.call 'unpinMessage', message, (error, result) ->\n\t\t\tif error\n\t\t\t\treturn handleError(error)\n\n\tupdate: (id, rid, msg, isDescription) ->\n\t\tif _.trim(msg) isnt '' or isDescription is true\n\t\t\tMeteor.call 'updateMessage', { _id: id, msg: msg, rid: rid }\n\t\t\tthis.clearEditing()\n\t\t\tthis.stopTyping(rid)\n\n\tstartTyping: (rid, input) ->\n\t\tif _.trim(input.value) isnt ''\n\t\t\tMsgTyping.start(rid)\n\t\telse\n\t\t\tMsgTyping.stop(rid)\n\n\tstopTyping: (rid) ->\n\t\tMsgTyping.stop(rid)\n\n\tbindEvents: ->\n\t\tif this.wrapper?.length\n\t\t\t$(\".input-message\").autogrow\n\t\t\t\tpostGrowCallback: =>\n\t\t\t\t\tthis.resize()\n\n\ttryCompletion: (input) ->\n\t\tvalue = input.value.match(/[^\\s]+$/)\n\t\tif value?.length > 0\n\t\t\tvalue = value[0]\n\n\t\t\tre = new RegExp value, 'i'\n\n\t\t\tuser = Meteor.users.findOne username: re\n\t\t\tif user?\n\t\t\t\tinput.value = input.value.replace value, \"@#{user.username} \"\n\n\tkeyup: (rid, event) ->\n\t\tinput = event.currentTarget\n\t\tk = event.which\n\t\tkeyCodes = [\n\t\t\t13, # Enter\n\t\t\t20, # Caps lock\n\t\t\t16, # Shift\n\t\t\t9,  # Tab\n\t\t\t27, # Escape Key\n\t\t\t17, # Control Key\n\t\t\t91, # Windows Command Key\n\t\t\t19, # Pause Break\n\t\t\t18, # Alt Key\n\t\t\t93, # Right Click Point Key\n\t\t\t45, # Insert Key\n\t\t\t34, # Page Down\n\t\t\t35, # Page Up\n\t\t\t144, # Num Lock\n\t\t\t145 # Scroll Lock\n\t\t]\n\t\tkeyCodes.push i for i in [35..40] # Home, End, Arrow Keys\n\t\tkeyCodes.push i for i in [112..123] # F1 - F12\n\n\t\tunless k in keyCodes\n\t\t\tthis.startTyping(rid, input)\n\n\t\tthis.hasValue.set input.value isnt ''\n\n\tkeydown: (rid, event) ->\n\t\tsendOnEnter = Meteor.user()?.settings?.preferences?.sendOnEnter\n\t\tinput = event.currentTarget\n\t\t$input = $(input)\n\t\tk = event.which\n\t\tthis.resize(input)\n\n\t\tif k is 13\n\t\t\tif not sendOnEnter? || sendOnEnter is 'normal' || (sendOnEnter is 'desktop' and Meteor.Device.isDesktop())\n\t\t\t\tif not event.shiftKey and not event.ctrlKey and not event.altKey and not event.metaKey # Enter without shift/ctrl/alt\n\t\t\t\t\tevent.preventDefault()\n\t\t\t\t\tevent.stopPropagation()\n\t\t\t\t\tthis.send(rid, input)\n\t\t\t\t\treturn\n\t\t\t\telse if not event.shiftKey\n\t\t\t\t\treturn input.value +='\\n'\n\t\t\telse if sendOnEnter is 'alternative'\n\t\t\t\tif event.shiftKey or event.ctrlKey or event.altKey or event.metaKey # Enter with shift/ctrl/alt\n\t\t\t\t\tevent.preventDefault()\n\t\t\t\t\tevent.stopPropagation()\n\t\t\t\t\tthis.send(rid, input)\n\t\t\t\t\treturn\n\n\n\n\t\tif k is 9 # Tab\n\t\t\tevent.preventDefault()\n\t\t\tevent.stopPropagation()\n\t\t\t@tryCompletion input\n\n\t\tif k is 27 # Escape\n\t\t\tif this.editing.index?\n\t\t\t\trecord = this.getMessageDraft(this.editing.id)\n\n\t\t\t\t# If resetting did nothing then edited message is same as original\n\t\t\t\tunless this.resetToDraft this.editing.id\n\t\t\t\t\tthis.clearCurrentDraft()\n\t\t\t\t\tthis.clearEditing()\n\n\t\t\t\tevent.preventDefault()\n\t\t\t\tevent.stopPropagation()\n\t\t\t\treturn\n\t\telse if k is 38 or k is 40 # Arrow Up or down\n\t\t\treturn true if event.shiftKey\n\n\t\t\tcursor_pos = input.selectionEnd\n\n\t\t\tif k is 38 # Arrow Up\n\t\t\t\tif cursor_pos is 0\n\t\t\t\t\tthis.toPrevMessage()\n\t\t\t\telse if not event.altKey\n\t\t\t\t\treturn true\n\n\t\t\t\tthis.$input.setCursorPosition(0) if event.altKey\n\n\t\t\telse # Arrow Down\n\t\t\t\tif cursor_pos is input.value.length\n\t\t\t\t\tthis.toNextMessage()\n\t\t\t\telse if not event.altKey\n\t\t\t\t\treturn true\n\n\t\t\t\tthis.$input.setCursorPosition(-1) if event.altKey\n\n\t\t\treturn false\n\n\t\t# ctrl (command) + shift + k -> clear room messages\n\t\telse if k is 75 and ((navigator?.platform?.indexOf('Mac') isnt -1 and event.metaKey and event.shiftKey) or (navigator?.platform?.indexOf('Mac') is -1 and event.ctrlKey and event.shiftKey))\n\t\t\tRoomHistoryManager.clear rid\n\n\tvalueChanged: (rid, event) ->\n\t\tif this.input.value.length is 1\n\t\t\tthis.determineInputDirection()\n\n\tdetermineInputDirection: () ->\n\t\tthis.input.dir = if this.isMessageRtl(this.input.value) then 'rtl' else 'ltr'\n\n\t# http://stackoverflow.com/a/14824756\n\tisMessageRtl: (message) ->\n\t\tltrChars    = 'A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02B8\\u0300-\\u0590\\u0800-\\u1FFF'+'\\u2C00-\\uFB1C\\uFDFE-\\uFE6F\\uFEFD-\\uFFFF'\n\t\trtlChars    = '\\u0591-\\u07FF\\uFB1D-\\uFDFD\\uFE70-\\uFEFC'\n\t\trtlDirCheck = new RegExp \"^[^#{ltrChars}]*[#{rtlChars}]\"\n\n\t\treturn rtlDirCheck.test message\n\n\tisMessageTooLong: (message) ->\n\t\tmessage?.length > this.messageMaxSize\n\n\tisEmpty: ->\n\t\treturn !this.hasValue.get()\n","var indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\nimport moment from 'moment';\n\nimport toastr from 'toastr';\n\nthis.ChatMessages = (function() {\n  function ChatMessages() {}\n\n  ChatMessages.prototype.init = function(node) {\n    this.editing = {};\n    this.records = {};\n    this.messageMaxSize = RocketChat.settings.get('Message_MaxAllowedSize');\n    this.wrapper = $(node).find(\".wrapper\");\n    this.input = $(node).find(\".input-message\").get(0);\n    this.$input = $(this.input);\n    this.hasValue = new ReactiveVar(false);\n    this.bindEvents();\n  };\n\n  ChatMessages.prototype.resize = function() {\n    var dif;\n    dif = (RocketChat.Layout.isEmbedded() ? 0 : 60) + $(\".messages-container\").find(\"footer\").outerHeight();\n    dif += $(\".announcement\").length > 0 ? 40 : 0;\n    return $(\".messages-box\").css({\n      height: \"calc(100% - \" + dif + \"px)\"\n    });\n  };\n\n  ChatMessages.prototype.getEditingIndex = function(element) {\n    var index, j, len, msg, msgs;\n    msgs = this.wrapper.get(0).querySelectorAll(\".own:not(.system)\");\n    index = 0;\n    for (j = 0, len = msgs.length; j < len; j++) {\n      msg = msgs[j];\n      if (msg === element) {\n        return index;\n      }\n      index++;\n    }\n    return -1;\n  };\n\n  ChatMessages.prototype.recordInputAsDraft = function() {\n    var draft, id, message, record;\n    id = this.editing.id;\n    message = this.getMessageById(id);\n    record = this.records[id] || {};\n    draft = this.input.value;\n    if (draft === message.msg) {\n      return this.clearCurrentDraft();\n    } else {\n      record.draft = draft;\n      return this.records[id] = record;\n    }\n  };\n\n  ChatMessages.prototype.getMessageDraft = function(id) {\n    return this.records[id];\n  };\n\n  ChatMessages.prototype.clearMessageDraft = function(id) {\n    return delete this.records[id];\n  };\n\n  ChatMessages.prototype.clearCurrentDraft = function() {\n    return this.clearMessageDraft(this.editing.id);\n  };\n\n  ChatMessages.prototype.resetToDraft = function(id) {\n    var message, old_value;\n    message = this.getMessageById(id);\n    old_value = this.input.value;\n    this.input.value = message.msg;\n    return old_value !== message.msg;\n  };\n\n  ChatMessages.prototype.getMessageById = function(id) {\n    return ChatMessage.findOne(id);\n  };\n\n  ChatMessages.prototype.toPrevMessage = function() {\n    var index;\n    index = this.editing.index;\n    return this.editByIndex(index != null ? index - 1 : void 0);\n  };\n\n  ChatMessages.prototype.toNextMessage = function() {\n    var index;\n    index = this.editing.index;\n    if (!this.editByIndex(index + 1)) {\n      return this.clearEditing();\n    }\n  };\n\n  ChatMessages.prototype.editByIndex = function(index) {\n    var element, msgs;\n    if (!this.editing.element && (index != null)) {\n      return false;\n    }\n    msgs = this.wrapper.get(0).querySelectorAll(\".own:not(.system)\");\n    if (index == null) {\n      index = msgs.length - 1;\n    }\n    if (!msgs[index]) {\n      return false;\n    }\n    element = msgs[index];\n    this.edit(element, index);\n    return true;\n  };\n\n  ChatMessages.prototype.edit = function(element, index) {\n    var blockEditInMinutes, currentTsDiff, cursor_pos, editAllowed, editOwn, editingNext, hasPermission, message, msg, msgTs, old_input, ref, ref1;\n    if (index == null) {\n      index = this.getEditingIndex(element);\n    }\n    message = this.getMessageById(element.getAttribute(\"id\"));\n    hasPermission = RocketChat.authz.hasAtLeastOnePermission('edit-message', message.rid);\n    editAllowed = RocketChat.settings.get('Message_AllowEditing');\n    editOwn = (message != null ? (ref = message.u) != null ? ref._id : void 0 : void 0) === Meteor.userId();\n    if (!(hasPermission || (editAllowed && editOwn))) {\n      return;\n    }\n    if (element.classList.contains(\"system\")) {\n      return;\n    }\n    blockEditInMinutes = RocketChat.settings.get('Message_AllowEditing_BlockEditInMinutes');\n    if ((blockEditInMinutes != null) && blockEditInMinutes !== 0) {\n      if (message.ts != null) {\n        msgTs = moment(message.ts);\n      }\n      if (msgTs != null) {\n        currentTsDiff = moment().diff(msgTs, 'minutes');\n      }\n      if (currentTsDiff > blockEditInMinutes) {\n        return;\n      }\n    }\n    msg = (ref1 = this.getMessageDraft(message._id)) != null ? ref1.draft : void 0;\n    if (msg == null) {\n      msg = message.msg;\n    }\n    editingNext = this.editing.index < index;\n    old_input = this.input.value;\n    this.clearEditing();\n    this.hasValue.set(true);\n    this.editing.element = element;\n    this.editing.index = index;\n    this.editing.id = message._id;\n    element.classList.add(\"editing\");\n    this.input.classList.add(\"editing\");\n    this.$input.closest('.message-form').addClass('editing');\n    this.input.focus();\n    if ((message.attachments != null) && (message.attachments[0].description != null)) {\n      this.input.value = message.attachments[0].description;\n    } else {\n      this.input.value = msg;\n    }\n    cursor_pos = editingNext ? 0 : -1;\n    return this.$input.setCursorPosition(cursor_pos);\n  };\n\n  ChatMessages.prototype.clearEditing = function() {\n    var cursor_pos, ref;\n    if (this.editing.element) {\n      this.recordInputAsDraft();\n      this.editing.element.classList.remove(\"editing\");\n      this.input.classList.remove(\"editing\");\n      this.$input.closest('.message-form').removeClass('editing');\n      delete this.editing.id;\n      delete this.editing.element;\n      delete this.editing.index;\n      this.input.value = this.editing.saved || \"\";\n      cursor_pos = (ref = this.editing.savedCursor) != null ? ref : -1;\n      this.$input.setCursorPosition(cursor_pos);\n      return this.hasValue.set(this.input.value !== '');\n    } else {\n      this.editing.saved = this.input.value;\n      return this.editing.savedCursor = this.input.selectionEnd;\n    }\n  };\n\n\n  /**\n  \t * * @param {string} rim room ID\n  \t * * @param {Element} input DOM element\n  \t * * @param {function?} done callback\n   */\n\n  ChatMessages.prototype.send = function(rid, input, done) {\n    var message, msg, msgObject;\n    if (done == null) {\n      done = function() {};\n    }\n    if (_.trim(input.value) !== '') {\n      readMessage.enable();\n      readMessage.readNow();\n      $('.message.first-unread').removeClass('first-unread');\n      msg = input.value;\n      msgObject = {\n        _id: Random.id(),\n        rid: rid,\n        msg: msg\n      };\n      return RocketChat.promises.run('onClientBeforeSendMessage', msgObject).then((function(_this) {\n        return function(msgObject) {\n          var command, commandOptions, invalidCommandMsg, match, param;\n          if (_this.isMessageTooLong(msgObject.msg)) {\n            return toastr.error(t('Message_too_long'));\n          }\n          _this.clearCurrentDraft();\n          if (_this.editing.id) {\n            _this.update(_this.editing.id, rid, msgObject.msg);\n            return;\n          }\n          KonchatNotification.removeRoomNotification(rid);\n          input.value = '';\n          if (typeof input.updateAutogrow === \"function\") {\n            input.updateAutogrow();\n          }\n          _this.hasValue.set(false);\n          _this.stopTyping(rid);\n          if (msg[0] === '/') {\n            match = msg.match(/^\\/([^\\s]+)(?:\\s+(.*))?$/m);\n            if (match != null) {\n              if (RocketChat.slashCommands.commands[match[1]]) {\n                commandOptions = RocketChat.slashCommands.commands[match[1]];\n                command = match[1];\n                param = match[2] != null ? match[2] : '';\n                if (commandOptions.clientOnly) {\n                  commandOptions.callback(command, param, msgObject);\n                } else {\n                  Meteor.call('slashCommand', {\n                    cmd: command,\n                    params: param,\n                    msg: msgObject\n                  }, function(err, result) {\n                    return typeof commandOptions.result === \"function\" ? commandOptions.result(err, result, {\n                      cmd: command,\n                      params: param,\n                      msg: msgObject\n                    }) : void 0;\n                  });\n                }\n                return;\n              }\n              if (!RocketChat.settings.get('Message_AllowUnrecognizedSlashCommand')) {\n                invalidCommandMsg = {\n                  _id: Random.id(),\n                  rid: rid,\n                  ts: new Date,\n                  msg: TAPi18n.__('No_such_command', {\n                    command: match[1]\n                  }),\n                  u: {\n                    username: \"rocketbot\"\n                  },\n                  \"private\": true\n                };\n                ChatMessage.upsert({\n                  _id: invalidCommandMsg._id\n                }, invalidCommandMsg);\n                return;\n              }\n            }\n          }\n          Meteor.call('sendMessage', msgObject);\n          return done();\n        };\n      })(this));\n    } else if (this.editing.element) {\n      message = this.getMessageById(this.editing.id);\n      if ((message.attachments != null) && (message.attachments[0].description != null)) {\n        this.update(this.editing.id, rid, '', true);\n        return;\n      }\n      this.resetToDraft(this.editing.id);\n      return this.confirmDeleteMsg(message, done);\n    }\n  };\n\n  ChatMessages.prototype.confirmDeleteMsg = function(message, done) {\n    if (done == null) {\n      done = function() {};\n    }\n    if (RocketChat.MessageTypes.isSystemMessage(message)) {\n      return;\n    }\n    swal({\n      title: t('Are_you_sure'),\n      text: t('You_will_not_be_able_to_recover'),\n      type: 'warning',\n      showCancelButton: true,\n      confirmButtonColor: '#DD6B55',\n      confirmButtonText: t('Yes_delete_it'),\n      cancelButtonText: t('Cancel'),\n      closeOnConfirm: false,\n      html: false\n    }, (function(_this) {\n      return function() {\n        swal({\n          title: t('Deleted'),\n          text: t('Your_entry_has_been_deleted'),\n          type: 'success',\n          timer: 1000,\n          showConfirmButton: false\n        });\n        if (_this.editing.id === message._id) {\n          _this.clearEditing(message);\n        }\n        _this.deleteMsg(message);\n        _this.$input.focus();\n        return done();\n      };\n    })(this));\n    return $('.sweet-alert').addClass('visible');\n  };\n\n  ChatMessages.prototype.deleteMsg = function(message) {\n    var blockDeleteInMinutes, currentTsDiff, msgTs;\n    blockDeleteInMinutes = RocketChat.settings.get('Message_AllowDeleting_BlockDeleteInMinutes');\n    if ((blockDeleteInMinutes != null) && blockDeleteInMinutes !== 0) {\n      if (message.ts != null) {\n        msgTs = moment(message.ts);\n      }\n      if (msgTs != null) {\n        currentTsDiff = moment().diff(msgTs, 'minutes');\n      }\n      if (currentTsDiff > blockDeleteInMinutes) {\n        toastr.error(t('Message_deleting_blocked'));\n        return;\n      }\n    }\n    return Meteor.call('deleteMessage', {\n      _id: message._id\n    }, function(error, result) {\n      if (error) {\n        return handleError(error);\n      }\n    });\n  };\n\n  ChatMessages.prototype.pinMsg = function(message) {\n    message.pinned = true;\n    return Meteor.call('pinMessage', message, function(error, result) {\n      if (error) {\n        return handleError(error);\n      }\n    });\n  };\n\n  ChatMessages.prototype.unpinMsg = function(message) {\n    message.pinned = false;\n    return Meteor.call('unpinMessage', message, function(error, result) {\n      if (error) {\n        return handleError(error);\n      }\n    });\n  };\n\n  ChatMessages.prototype.update = function(id, rid, msg, isDescription) {\n    if (_.trim(msg) !== '' || isDescription === true) {\n      Meteor.call('updateMessage', {\n        _id: id,\n        msg: msg,\n        rid: rid\n      });\n      this.clearEditing();\n      return this.stopTyping(rid);\n    }\n  };\n\n  ChatMessages.prototype.startTyping = function(rid, input) {\n    if (_.trim(input.value) !== '') {\n      return MsgTyping.start(rid);\n    } else {\n      return MsgTyping.stop(rid);\n    }\n  };\n\n  ChatMessages.prototype.stopTyping = function(rid) {\n    return MsgTyping.stop(rid);\n  };\n\n  ChatMessages.prototype.bindEvents = function() {\n    var ref;\n    if ((ref = this.wrapper) != null ? ref.length : void 0) {\n      return $(\".input-message\").autogrow({\n        postGrowCallback: (function(_this) {\n          return function() {\n            return _this.resize();\n          };\n        })(this)\n      });\n    }\n  };\n\n  ChatMessages.prototype.tryCompletion = function(input) {\n    var re, user, value;\n    value = input.value.match(/[^\\s]+$/);\n    if ((value != null ? value.length : void 0) > 0) {\n      value = value[0];\n      re = new RegExp(value, 'i');\n      user = Meteor.users.findOne({\n        username: re\n      });\n      if (user != null) {\n        return input.value = input.value.replace(value, \"@\" + user.username + \" \");\n      }\n    }\n  };\n\n  ChatMessages.prototype.keyup = function(rid, event) {\n    var i, input, j, k, keyCodes, l;\n    input = event.currentTarget;\n    k = event.which;\n    keyCodes = [13, 20, 16, 9, 27, 17, 91, 19, 18, 93, 45, 34, 35, 144, 145];\n    for (i = j = 35; j <= 40; i = ++j) {\n      keyCodes.push(i);\n    }\n    for (i = l = 112; l <= 123; i = ++l) {\n      keyCodes.push(i);\n    }\n    if (indexOf.call(keyCodes, k) < 0) {\n      this.startTyping(rid, input);\n    }\n    return this.hasValue.set(input.value !== '');\n  };\n\n  ChatMessages.prototype.keydown = function(rid, event) {\n    var $input, cursor_pos, input, k, record, ref, ref1, ref2, ref3, ref4, sendOnEnter;\n    sendOnEnter = (ref = Meteor.user()) != null ? (ref1 = ref.settings) != null ? (ref2 = ref1.preferences) != null ? ref2.sendOnEnter : void 0 : void 0 : void 0;\n    input = event.currentTarget;\n    $input = $(input);\n    k = event.which;\n    this.resize(input);\n    if (k === 13) {\n      if ((sendOnEnter == null) || sendOnEnter === 'normal' || (sendOnEnter === 'desktop' && Meteor.Device.isDesktop())) {\n        if (!event.shiftKey && !event.ctrlKey && !event.altKey && !event.metaKey) {\n          event.preventDefault();\n          event.stopPropagation();\n          this.send(rid, input);\n          return;\n        } else if (!event.shiftKey) {\n          return input.value += '\\n';\n        }\n      } else if (sendOnEnter === 'alternative') {\n        if (event.shiftKey || event.ctrlKey || event.altKey || event.metaKey) {\n          event.preventDefault();\n          event.stopPropagation();\n          this.send(rid, input);\n          return;\n        }\n      }\n    }\n    if (k === 9) {\n      event.preventDefault();\n      event.stopPropagation();\n      this.tryCompletion(input);\n    }\n    if (k === 27) {\n      if (this.editing.index != null) {\n        record = this.getMessageDraft(this.editing.id);\n        if (!this.resetToDraft(this.editing.id)) {\n          this.clearCurrentDraft();\n          this.clearEditing();\n        }\n        event.preventDefault();\n        event.stopPropagation();\n      }\n    } else if (k === 38 || k === 40) {\n      if (event.shiftKey) {\n        return true;\n      }\n      cursor_pos = input.selectionEnd;\n      if (k === 38) {\n        if (cursor_pos === 0) {\n          this.toPrevMessage();\n        } else if (!event.altKey) {\n          return true;\n        }\n        if (event.altKey) {\n          this.$input.setCursorPosition(0);\n        }\n      } else {\n        if (cursor_pos === input.value.length) {\n          this.toNextMessage();\n        } else if (!event.altKey) {\n          return true;\n        }\n        if (event.altKey) {\n          this.$input.setCursorPosition(-1);\n        }\n      }\n      return false;\n    } else if (k === 75 && (((typeof navigator !== \"undefined\" && navigator !== null ? (ref3 = navigator.platform) != null ? ref3.indexOf('Mac') : void 0 : void 0) !== -1 && event.metaKey && event.shiftKey) || ((typeof navigator !== \"undefined\" && navigator !== null ? (ref4 = navigator.platform) != null ? ref4.indexOf('Mac') : void 0 : void 0) === -1 && event.ctrlKey && event.shiftKey))) {\n      return RoomHistoryManager.clear(rid);\n    }\n  };\n\n  ChatMessages.prototype.valueChanged = function(rid, event) {\n    if (this.input.value.length === 1) {\n      return this.determineInputDirection();\n    }\n  };\n\n  ChatMessages.prototype.determineInputDirection = function() {\n    return this.input.dir = this.isMessageRtl(this.input.value) ? 'rtl' : 'ltr';\n  };\n\n  ChatMessages.prototype.isMessageRtl = function(message) {\n    var ltrChars, rtlChars, rtlDirCheck;\n    ltrChars = 'A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02B8\\u0300-\\u0590\\u0800-\\u1FFF' + '\\u2C00-\\uFB1C\\uFDFE-\\uFE6F\\uFEFD-\\uFFFF';\n    rtlChars = '\\u0591-\\u07FF\\uFB1D-\\uFDFD\\uFE70-\\uFEFC';\n    rtlDirCheck = new RegExp(\"^[^\" + ltrChars + \"]*[\" + rtlChars + \"]\");\n    return rtlDirCheck.test(message);\n  };\n\n  ChatMessages.prototype.isMessageTooLong = function(message) {\n    return (message != null ? message.length : void 0) > this.messageMaxSize;\n  };\n\n  ChatMessages.prototype.isEmpty = function() {\n    return !this.hasValue.get();\n  };\n\n  return ChatMessages;\n\n})();\n","this.ChatMessage = new Mongo.Collection(null);\nthis.CachedChatRoom = new RocketChat.CachedCollection({ name: 'rooms' });\nthis.ChatRoom = this.CachedChatRoom.collection;\n\nthis.CachedChatSubscription = new RocketChat.CachedCollection({ name: 'subscriptions' });\nthis.ChatSubscription = this.CachedChatSubscription.collection;\nthis.UserRoles = new Mongo.Collection(null);\nthis.RoomRoles = new Mongo.Collection(null);\nthis.UserAndRoom = new Mongo.Collection(null);\nthis.CachedChannelList = new Mongo.Collection(null);\nthis.CachedUserList = new Mongo.Collection(null);\n\nRocketChat.models.Users = _.extend({}, RocketChat.models.Users, Meteor.users);\nRocketChat.models.Subscriptions = _.extend({}, RocketChat.models.Subscriptions, this.ChatSubscription);\nRocketChat.models.Rooms = _.extend({}, RocketChat.models.Rooms, this.ChatRoom);\nRocketChat.models.Messages = _.extend({}, RocketChat.models.Messages, this.ChatMessage);\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tif (!Meteor.userId() && RocketChat.settings.get('Accounts_AllowAnonymousRead') === true) {\n\t\t\tthis.CachedChatRoom.init();\n\t\t\tthis.CachedChatSubscription.ready.set(true);\n\t\t}\n\t});\n});\n","(function () {\r\n  function CustomEvent ( event, params ) {\r\n    params = params || { bubbles: false, cancelable: false, detail: undefined };\r\n    var evt = document.createEvent( 'CustomEvent' );\r\n    evt.initCustomEvent( event, params.bubbles, params.cancelable, params.detail );\r\n    return evt;\r\n   }\r\n\r\n  CustomEvent.prototype = window.Event.prototype;\r\n\r\n  window.CustomEvent = CustomEvent;\r\n})();","readAsDataURL = (file, callback) ->\n\treader = new FileReader()\n\treader.onload = (ev) ->\n\t\tcallback ev.target.result, file\n\n\treader.readAsDataURL file\n\ngetUploadPreview = (file, callback) ->\n\t# If greater then 10MB don't try and show a preview\n\tif file.file.size > 10 * 1000000\n\t\tcallback(file, null)\n\telse if not file.file.type?\n\t\tcallback(file, null)\n\telse\n\t\tif file.file.type.indexOf('audio') > -1 or file.file.type.indexOf('video') > -1 or file.file.type.indexOf('image') > -1\n\t\t\tfile.type = file.file.type.split('/')[0]\n\n\t\t\treadAsDataURL file.file, (content) ->\n\t\t\t\tcallback(file, content)\n\t\telse\n\t\t\tcallback(file, null)\n\nformatBytes = (bytes, decimals) ->\n\tif bytes == 0\n\t\treturn '0 Bytes'\n\n\tk = 1000\n\tdm = decimals + 1 or 3\n\n\tsizes = [\n\t\t'Bytes'\n\t\t'KB'\n\t\t'MB'\n\t\t'GB'\n\t\t'TB'\n\t\t'PB'\n\t]\n\n\ti = Math.floor(Math.log(bytes) / Math.log(k))\n\n\tparseFloat((bytes / k ** i).toFixed(dm)) + ' ' + sizes[i]\n\nreadAsArrayBuffer = (file, callback) ->\n\treader = new FileReader()\n\treader.onload = (ev) ->\n\t\tcallback ev.target.result, file\n\n\treader.readAsArrayBuffer file\n\n\n@fileUpload = (files) ->\n\troomId = Session.get('openedRoom')\n\tfiles = [].concat files\n\n\tconsume = ->\n\t\tfile = files.pop()\n\t\tif not file?\n\t\t\tswal.close()\n\t\t\treturn\n\n\t\tif not RocketChat.fileUploadIsValidContentType file.file.type\n\t\t\tswal\n\t\t\t\ttitle: t('FileUpload_MediaType_NotAccepted')\n\t\t\t\ttext: file.file.type || \"*.#{s.strRightBack(file.file.name, '.')}\"\n\t\t\t\ttype: 'error'\n\t\t\t\ttimer: 3000\n\t\t\treturn\n\n\t\tif file.file.size is 0\n\t\t\tswal\n\t\t\t\ttitle: t('FileUpload_File_Empty')\n\t\t\t\ttype: 'error'\n\t\t\t\ttimer: 1000\n\t\t\treturn\n\n\t\tgetUploadPreview file, (file, preview) ->\n\t\t\ttext = ''\n\n\t\t\tif file.type is 'audio'\n\t\t\t\ttext = \"\"\"\n\t\t\t\t\t<div class='upload-preview'>\n\t\t\t\t\t\t<audio  style=\"width: 100%;\" controls=\"controls\">\n\t\t\t\t\t\t\t<source src=\"#{preview}\" type=\"audio/wav\">\n\t\t\t\t\t\t\tYour browser does not support the audio element.\n\t\t\t\t\t\t</audio>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class='upload-preview-title'>\n\t\t\t\t\t\t<input id='file-name' style='display: inherit;' value='#{Handlebars._escape(file.name)}' placeholder='#{t(\"Upload_file_name\")}'>\n\t\t\t\t\t\t<input id='file-description' style='display: inherit;' value='' placeholder='#{t(\"Upload_file_description\")}'>\n\t\t\t\t\t</div>\n\t\t\t\t\"\"\"\n\t\t\telse if file.type is 'video'\n\t\t\t\ttext = \"\"\"\n\t\t\t\t\t<div class='upload-preview'>\n\t\t\t\t\t\t<video  style=\"width: 100%;\" controls=\"controls\">\n\t\t\t\t\t\t\t<source src=\"#{preview}\" type=\"video/webm\">\n\t\t\t\t\t\t\tYour browser does not support the video element.\n\t\t\t\t\t\t</video>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class='upload-preview-title'>\n\t\t\t\t\t\t<input id='file-name' style='display: inherit;' value='#{Handlebars._escape(file.name)}' placeholder='#{t(\"Upload_file_name\")}'>\n\t\t\t\t\t\t<input id='file-description' style='display: inherit;' value='' placeholder='#{t(\"Upload_file_description\")}'>\n\t\t\t\t\t</div>\n\t\t\t\t\"\"\"\n\t\t\telse if file.type is 'image'\n\t\t\t\ttext = \"\"\"\n\t\t\t\t\t<div class='upload-preview'>\n\t\t\t\t\t\t<div class='upload-preview-file' style='background-image: url(#{preview})'></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class='upload-preview-title'>\n\t\t\t\t\t\t<input id='file-name' style='display: inherit;' value='#{Handlebars._escape(file.name)}' placeholder='#{t(\"Upload_file_name\")}'>\n\t\t\t\t\t\t<input id='file-description' style='display: inherit;' value='' placeholder='#{t(\"Upload_file_description\")}'>\n\t\t\t\t\t</div>\n\t\t\t\t\"\"\"\n\t\t\telse\n\t\t\t\tfileSize = formatBytes(file.file.size)\n\n\t\t\t\ttext = \"\"\"\n\t\t\t\t\t<div class='upload-preview'>\n\t\t\t\t\t\t<div>#{Handlebars._escape(file.name)} - #{fileSize}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class='upload-preview-title'>\n\t\t\t\t\t\t<input id='file-name' style='display: inherit;' value='#{Handlebars._escape(file.name)}' placeholder='#{t(\"Upload_file_name\")}'>\n\t\t\t\t\t\t<input id='file-description' style='display: inherit;' value='' placeholder='#{t(\"Upload_file_description\")}'>\n\t\t\t\t\t</div>\n\t\t\t\t\"\"\"\n\n\t\t\tswal\n\t\t\t\ttitle: t('Upload_file_question')\n\t\t\t\ttext: text\n\t\t\t\tshowCancelButton: true\n\t\t\t\tcloseOnConfirm: false\n\t\t\t\tcloseOnCancel: false\n\t\t\t\tconfirmButtonText: t('Send')\n\t\t\t\tcancelButtonText: t('Cancel')\n\t\t\t\thtml: true\n\t\t\t, (isConfirm) ->\n\t\t\t\tconsume()\n\t\t\t\tif isConfirm isnt true\n\t\t\t\t\treturn\n\n\t\t\t\trecord =\n\t\t\t\t\tname: document.getElementById('file-name').value or file.name or file.file.name\n\t\t\t\t\tsize: file.file.size\n\t\t\t\t\ttype: file.file.type\n\t\t\t\t\trid: roomId\n\t\t\t\t\tdescription: document.getElementById('file-description').value\n\n\t\t\t\tupload = fileUploadHandler record, file.file\n\n\t\t\t\tuploading = Session.get('uploading') or []\n\t\t\t\tuploading.push\n\t\t\t\t\tid: upload.id\n\t\t\t\t\tname: upload.getFileName()\n\t\t\t\t\tpercentage: 0\n\n\t\t\t\tSession.set 'uploading', uploading\n\n\t\t\t\tupload.onProgress = (progress) ->\n\t\t\t\t\tuploading = Session.get('uploading')\n\n\t\t\t\t\titem = _.findWhere(uploading, {id: upload.id})\n\t\t\t\t\tif item?\n\t\t\t\t\t\titem.percentage = Math.round(progress * 100) or 0\n\t\t\t\t\t\tSession.set 'uploading', uploading\n\n\t\t\t\tupload.start()\n\n\t\t\t\tTracker.autorun (c) ->\n\t\t\t\t\tcancel = Session.get \"uploading-cancel-#{upload.id}\"\n\t\t\t\t\tif cancel\n\t\t\t\t\t\tupload.stop()\n\t\t\t\t\t\tc.stop()\n\n\t\t\t\t\t\tuploading = Session.get 'uploading'\n\t\t\t\t\t\tif uploading?\n\t\t\t\t\t\t\titem = _.findWhere(uploading, {id: upload.id})\n\t\t\t\t\t\t\tif item?\n\t\t\t\t\t\t\t\titem.percentage = 0\n\t\t\t\t\t\t\tSession.set 'uploading', uploading\n\n\t\t\t\t\t\tMeteor.setTimeout ->\n\t\t\t\t\t\t\tuploading = Session.get 'uploading'\n\t\t\t\t\t\t\tif uploading?\n\t\t\t\t\t\t\t\titem = _.findWhere(uploading, {id: upload.id})\n\t\t\t\t\t\t\t\tSession.set 'uploading', _.without(uploading, item)\n\t\t\t\t\t\t, 1000\n\n\tconsume()\n","var formatBytes, getUploadPreview, readAsArrayBuffer, readAsDataURL;\n\nreadAsDataURL = function(file, callback) {\n  var reader;\n  reader = new FileReader();\n  reader.onload = function(ev) {\n    return callback(ev.target.result, file);\n  };\n  return reader.readAsDataURL(file);\n};\n\ngetUploadPreview = function(file, callback) {\n  if (file.file.size > 10 * 1000000) {\n    return callback(file, null);\n  } else if (file.file.type == null) {\n    return callback(file, null);\n  } else {\n    if (file.file.type.indexOf('audio') > -1 || file.file.type.indexOf('video') > -1 || file.file.type.indexOf('image') > -1) {\n      file.type = file.file.type.split('/')[0];\n      return readAsDataURL(file.file, function(content) {\n        return callback(file, content);\n      });\n    } else {\n      return callback(file, null);\n    }\n  }\n};\n\nformatBytes = function(bytes, decimals) {\n  var dm, i, k, sizes;\n  if (bytes === 0) {\n    return '0 Bytes';\n  }\n  k = 1000;\n  dm = decimals + 1 || 3;\n  sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB'];\n  i = Math.floor(Math.log(bytes) / Math.log(k));\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n};\n\nreadAsArrayBuffer = function(file, callback) {\n  var reader;\n  reader = new FileReader();\n  reader.onload = function(ev) {\n    return callback(ev.target.result, file);\n  };\n  return reader.readAsArrayBuffer(file);\n};\n\nthis.fileUpload = function(files) {\n  var consume, roomId;\n  roomId = Session.get('openedRoom');\n  files = [].concat(files);\n  consume = function() {\n    var file;\n    file = files.pop();\n    if (file == null) {\n      swal.close();\n      return;\n    }\n    if (!RocketChat.fileUploadIsValidContentType(file.file.type)) {\n      swal({\n        title: t('FileUpload_MediaType_NotAccepted'),\n        text: file.file.type || (\"*.\" + (s.strRightBack(file.file.name, '.'))),\n        type: 'error',\n        timer: 3000\n      });\n      return;\n    }\n    if (file.file.size === 0) {\n      swal({\n        title: t('FileUpload_File_Empty'),\n        type: 'error',\n        timer: 1000\n      });\n      return;\n    }\n    return getUploadPreview(file, function(file, preview) {\n      var fileSize, text;\n      text = '';\n      if (file.type === 'audio') {\n        text = \"<div class='upload-preview'>\\n\t<audio  style=\\\"width: 100%;\\\" controls=\\\"controls\\\">\\n\t\t<source src=\\\"\" + preview + \"\\\" type=\\\"audio/wav\\\">\\n\t\tYour browser does not support the audio element.\\n\t</audio>\\n</div>\\n<div class='upload-preview-title'>\\n\t<input id='file-name' style='display: inherit;' value='\" + (Handlebars._escape(file.name)) + \"' placeholder='\" + (t(\"Upload_file_name\")) + \"'>\\n\t<input id='file-description' style='display: inherit;' value='' placeholder='\" + (t(\"Upload_file_description\")) + \"'>\\n</div>\";\n      } else if (file.type === 'video') {\n        text = \"<div class='upload-preview'>\\n\t<video  style=\\\"width: 100%;\\\" controls=\\\"controls\\\">\\n\t\t<source src=\\\"\" + preview + \"\\\" type=\\\"video/webm\\\">\\n\t\tYour browser does not support the video element.\\n\t</video>\\n</div>\\n<div class='upload-preview-title'>\\n\t<input id='file-name' style='display: inherit;' value='\" + (Handlebars._escape(file.name)) + \"' placeholder='\" + (t(\"Upload_file_name\")) + \"'>\\n\t<input id='file-description' style='display: inherit;' value='' placeholder='\" + (t(\"Upload_file_description\")) + \"'>\\n</div>\";\n      } else if (file.type === 'image') {\n        text = \"<div class='upload-preview'>\\n\t<div class='upload-preview-file' style='background-image: url(\" + preview + \")'></div>\\n</div>\\n<div class='upload-preview-title'>\\n\t<input id='file-name' style='display: inherit;' value='\" + (Handlebars._escape(file.name)) + \"' placeholder='\" + (t(\"Upload_file_name\")) + \"'>\\n\t<input id='file-description' style='display: inherit;' value='' placeholder='\" + (t(\"Upload_file_description\")) + \"'>\\n</div>\";\n      } else {\n        fileSize = formatBytes(file.file.size);\n        text = \"<div class='upload-preview'>\\n\t<div>\" + (Handlebars._escape(file.name)) + \" - \" + fileSize + \"</div>\\n</div>\\n<div class='upload-preview-title'>\\n\t<input id='file-name' style='display: inherit;' value='\" + (Handlebars._escape(file.name)) + \"' placeholder='\" + (t(\"Upload_file_name\")) + \"'>\\n\t<input id='file-description' style='display: inherit;' value='' placeholder='\" + (t(\"Upload_file_description\")) + \"'>\\n</div>\";\n      }\n      return swal({\n        title: t('Upload_file_question'),\n        text: text,\n        showCancelButton: true,\n        closeOnConfirm: false,\n        closeOnCancel: false,\n        confirmButtonText: t('Send'),\n        cancelButtonText: t('Cancel'),\n        html: true\n      }, function(isConfirm) {\n        var record, upload, uploading;\n        consume();\n        if (isConfirm !== true) {\n          return;\n        }\n        record = {\n          name: document.getElementById('file-name').value || file.name || file.file.name,\n          size: file.file.size,\n          type: file.file.type,\n          rid: roomId,\n          description: document.getElementById('file-description').value\n        };\n        upload = fileUploadHandler(record, file.file);\n        uploading = Session.get('uploading') || [];\n        uploading.push({\n          id: upload.id,\n          name: upload.getFileName(),\n          percentage: 0\n        });\n        Session.set('uploading', uploading);\n        upload.onProgress = function(progress) {\n          var item;\n          uploading = Session.get('uploading');\n          item = _.findWhere(uploading, {\n            id: upload.id\n          });\n          if (item != null) {\n            item.percentage = Math.round(progress * 100) || 0;\n            return Session.set('uploading', uploading);\n          }\n        };\n        upload.start();\n        return Tracker.autorun(function(c) {\n          var cancel, item;\n          cancel = Session.get(\"uploading-cancel-\" + upload.id);\n          if (cancel) {\n            upload.stop();\n            c.stop();\n            uploading = Session.get('uploading');\n            if (uploading != null) {\n              item = _.findWhere(uploading, {\n                id: upload.id\n              });\n              if (item != null) {\n                item.percentage = 0;\n              }\n              Session.set('uploading', uploading);\n            }\n            return Meteor.setTimeout(function() {\n              uploading = Session.get('uploading');\n              if (uploading != null) {\n                item = _.findWhere(uploading, {\n                  id: upload.id\n                });\n                return Session.set('uploading', _.without(uploading, item));\n              }\n            }, 1000);\n          }\n        });\n      });\n    });\n  };\n  return consume();\n};\n","window.fireGlobalEvent = function _fireGlobalEvent(eventName, params) {\n\twindow.dispatchEvent(new CustomEvent(eventName, {detail: params}));\n\n\tTracker.autorun((computation) => {\n\t\tconst enabled = RocketChat.settings.get('Iframe_Integration_send_enable');\n\t\tif (enabled === undefined) {\n\t\t\treturn;\n\t\t}\n\t\tcomputation.stop();\n\t\tif (enabled) {\n\t\t\tparent.postMessage({\n\t\t\t\teventName,\n\t\t\t\tdata: params\n\t\t\t}, RocketChat.settings.get('Iframe_Integration_send_target_origin'));\n\t\t}\n\t});\n};\n\n","const commands = {\n\tgo(data) {\n\t\tif (typeof data.path !== 'string' || data.path.trim().length === 0) {\n\t\t\treturn console.error('`path` not defined');\n\t\t}\n\t\tFlowRouter.go(data.path, null, FlowRouter.current().queryParams);\n\t},\n\n\n\t'set-user-status'(data) {\n\t\tAccountBox.setStatus(data.status);\n\t},\n\n\t'call-custom-oauth-login'(data, event) {\n\t\tconst customOAuthCallback = (response) => {\n\t\t\tevent.source.postMessage({\n\t\t\t\tevent: 'custom-oauth-callback',\n\t\t\t\tresponse\n\t\t\t}, event.origin);\n\t\t};\n\n\t\tconst siteUrl = `${ Meteor.settings.Site_Url }/`;\n\t\tif (typeof data.redirectUrl !== 'string' || !data.redirectUrl.startsWith(siteUrl)) {\n\t\t\tdata.redirectUrl = null;\n\t\t}\n\n\t\tif (typeof data.service === 'string' && window.ServiceConfiguration) {\n\t\t\tconst customOauth = ServiceConfiguration.configurations.findOne({service: data.service});\n\n\t\t\tif (customOauth) {\n\t\t\t\tconst customLoginWith = Meteor[`loginWith${ _.capitalize(customOauth.service, true) }`];\n\t\t\t\tconst customRedirectUri = data.redirectUrl || siteUrl;\n\t\t\t\tcustomLoginWith.call(Meteor, {'redirectUrl': customRedirectUri}, customOAuthCallback);\n\t\t\t}\n\t\t}\n\t},\n\n\t'login-with-token'(data) {\n\t\tif (typeof data.token === 'string') {\n\t\t\tMeteor.loginWithToken(data.token, function() {\n\t\t\t\tconsole.log('Iframe command [login-with-token]: result', arguments);\n\t\t\t});\n\t\t}\n\t},\n\n\t'logout'() {\n\t\tconst user = Meteor.user();\n\t\tMeteor.logout(() => {\n\t\t\tRocketChat.callbacks.run('afterLogoutCleanUp', user);\n\t\t\tMeteor.call('logoutCleanUp', user);\n\t\t\treturn FlowRouter.go('home');\n\t\t});\n\t}\n};\n\nwindow.addEventListener('message', (e) => {\n\tif (RocketChat.settings.get('Iframe_Integration_receive_enable') !== true) {\n\t\treturn;\n\t}\n\n\tif (typeof e.data !== 'object' || typeof e.data.externalCommand !== 'string') {\n\t\treturn;\n\t}\n\n\tconst origins = RocketChat.settings.get('Iframe_Integration_receive_origin');\n\n\tif (origins !== '*' && origins.split(',').indexOf(e.origin) === -1) {\n\t\treturn console.error('Origin not allowed', e.origin);\n\t}\n\n\tconst command = commands[e.data.externalCommand];\n\tif (command) {\n\t\tcommand(e.data, e);\n\t}\n});\n","/* globals isRtl */\nthis.menu = new class {\n\tconstructor() {\n\t\tthis.updateUnreadBars = _.throttle(() => {\n\t\t\tif (this.list == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst listOffset = this.list.offset();\n\t\t\tconst listHeight = this.list.height();\n\t\t\tlet showTop = false;\n\t\t\tlet showBottom = false;\n\t\t\t$('li.has-alert').each(function() {\n\t\t\t\tif ($(this).offset().top < listOffset.top - $(this).height()) {\n\t\t\t\t\tshowTop = true;\n\t\t\t\t}\n\t\t\t\tif ($(this).offset().top > listOffset.top + listHeight) {\n\t\t\t\t\treturn showBottom = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (showTop === true) {\n\t\t\t\t$('.top-unread-rooms').removeClass('hidden');\n\t\t\t} else {\n\t\t\t\t$('.top-unread-rooms').addClass('hidden');\n\t\t\t}\n\t\t\tif (showBottom === true) {\n\t\t\t\treturn $('.bottom-unread-rooms').removeClass('hidden');\n\t\t\t} else {\n\t\t\t\treturn $('.bottom-unread-rooms').addClass('hidden');\n\t\t\t}\n\t\t}, 200);\n\t}\n\tinit() {\n\t\tthis.mainContent = $('.main-content');\n\t\tthis.list = $('.rooms-list');\n\t\tSession.set('isMenuOpen', false);\n\t}\n\n\tisOpen() {\n\t\treturn Session.get('isMenuOpen');\n\t}\n\n\topen() {\n\t\tSession.set('isMenuOpen', true);\n\t\tthis.mainContent && this.mainContent.css('transform', `translateX(${ isRtl(localStorage.getItem('userLanguage'))?'-':'' }260px)`);\n\t}\n\n\tclose() {\n\t\tSession.set('isMenuOpen', false);\n\t\tthis.mainContent && this.mainContent .css('transform', 'translateX(0)');\n\t}\n\n\ttoggle() {\n\t\treturn this.isOpen() ? this.close() : this.open();\n\t}\n};\n","@Modal = (->\n\n\tself = {}\n\twin = $(window)\n\n\t#mistérios da vida c.483: Pq a self.$window diz ter 100% da janela via css mas na verdade ocupa menos de 100% da tela?\n\t#isso impede que o retorno da janela ao normal quando não mais necessária a classe fluid. (comportamento dançante)\n\n\tfocus = ->\n\t\tif self.$modal\n\t\t\tinput = self.$modal.find \"input[type='text']\"\n\t\t\tinput.get(0).focus() if input.length\n\tkeydown = (e) ->\n\t\tk = e.which\n\t\tif k is 27\n\t\t\te.preventDefault()\n\t\t\te.stopImmediatePropagation()\n\t\t\tclose()\n\n\tcheck = ->\n\t\tif self.$modal and self.$modal.length\n\t\t\tif win.height() < self.$window.outerHeight() + (win.height() * 0.10)\n\t\t\t\tunless self.$modal.hasClass(\"fluid\")\n\t\t\t\t\tself.$modal.addClass(\"fluid\")\n\t\t\t#else\n\t\t\t\t#if self.$modal.hasClass(\"fluid\")\n\t\t\t\t\t#self.$modal.removeClass(\"fluid\")\n\n\topen = (template, params) ->\n\t\tparams = params or {}\n\t\tRocketChat.animeBack self.$modal, ->\n\t\t\tfocus()\n\t\tself.opened = 1\n\t\tstartListening() if params.listening\n\t\tsetContent template, params.data if template?\n\t\tself.$modal.addClass \"opened\"\n\t\tself.$modal.removeClass \"fluid\"\n\t\tsetTimeout ->\n\t\t\tfocus()\n\t\t,200\n\n\tclose = ->\n\t\tself.$modal.addClass \"closed\"\n\t\twin.unbind(\"keydown.modal\")\n\t\t# acionar no on-complete da animação\n\t\tsetTimeout ->\n\t\t\tself.opened = 0\n\t\t\tstopListening()\n\t\t\tself.$modal.removeClass \"opened closed\"\n\t\t, 300\n\n\tsetContent = (template, data) ->\n\t\tself.$main.empty()\n\t\tif template\n\t\t\tif data\n\t\t\t\tBlaze.renderWithData template, data, self.$main.get(0)\n\t\t\telse\n\t\t\t\tBlaze.render template, self.$main.get(0)\n\t\t\tcheckFooter()\n\t\t\tcheck()\n\n\tcheckFooter = ->\n\t\tif self.$footer and self.$footer.length\n\t\t\tbuttons = self.$footer.find \"button\"\n\t\t\tbuttons.each ->\n\t\t\t\tbtn = $(@)\n\t\t\t\tif btn.html().match /fechar/ig\n\t\t\t\t\tbtn.click (e) ->\n\t\t\t\t\t\te.preventDefault()\n\t\t\t\t\t\tclose()\n\n\tstartListening = ->\n\t\tstopListening()\n\t\tself.interval = setInterval ->\n\t\t\tcheck()\n\t\t, 100\n\n\tstopListening = ->\n\t\tclearInterval self.interval if self.interval\n\n\tinit = ($modal, params) ->\n\t\tself.params = params or {}\n\t\tself.opened = 0\n\t\tself.initialized = 0\n\t\tself.$modal = if $modal.length then $modal else $(\".rocket-modal\")\n\t\tif self.$modal.length\n\t\t\tself.initialized = 0\n\t\t\tself.$window = self.$modal.find \".modal\"\n\t\t\tself.$main = self.$modal.find \"main\"\n\t\t\tself.$close = self.$modal.find \"header > .close\"\n\t\t\tself.$footer = self.$modal.find \"footer\"\n\t\t\tself.$close.unbind(\"click\").click close\n\t\t\twin.unbind(\"resize.modal\").bind \"resize.modal\", check\n\t\t\twin.unbind(\"keydown.modal\").bind \"keydown.modal\", (e) ->\n\t\t\t\tkeydown(e)\n\n\tinit: init\n\topen: open\n\tclose: close\n\tfocus: focus\n\tsetContent: setContent\n)()\n","this.Modal = (function() {\n  var check, checkFooter, close, focus, init, keydown, open, self, setContent, startListening, stopListening, win;\n  self = {};\n  win = $(window);\n  focus = function() {\n    var input;\n    if (self.$modal) {\n      input = self.$modal.find(\"input[type='text']\");\n      if (input.length) {\n        return input.get(0).focus();\n      }\n    }\n  };\n  keydown = function(e) {\n    var k;\n    k = e.which;\n    if (k === 27) {\n      e.preventDefault();\n      e.stopImmediatePropagation();\n      return close();\n    }\n  };\n  check = function() {\n    if (self.$modal && self.$modal.length) {\n      if (win.height() < self.$window.outerHeight() + (win.height() * 0.10)) {\n        if (!self.$modal.hasClass(\"fluid\")) {\n          return self.$modal.addClass(\"fluid\");\n        }\n      }\n    }\n  };\n  open = function(template, params) {\n    params = params || {};\n    RocketChat.animeBack(self.$modal, function() {\n      return focus();\n    });\n    self.opened = 1;\n    if (params.listening) {\n      startListening();\n    }\n    if (template != null) {\n      setContent(template, params.data);\n    }\n    self.$modal.addClass(\"opened\");\n    self.$modal.removeClass(\"fluid\");\n    return setTimeout(function() {\n      return focus();\n    }, 200);\n  };\n  close = function() {\n    self.$modal.addClass(\"closed\");\n    win.unbind(\"keydown.modal\");\n    return setTimeout(function() {\n      self.opened = 0;\n      stopListening();\n      return self.$modal.removeClass(\"opened closed\");\n    }, 300);\n  };\n  setContent = function(template, data) {\n    self.$main.empty();\n    if (template) {\n      if (data) {\n        Blaze.renderWithData(template, data, self.$main.get(0));\n      } else {\n        Blaze.render(template, self.$main.get(0));\n      }\n      checkFooter();\n      return check();\n    }\n  };\n  checkFooter = function() {\n    var buttons;\n    if (self.$footer && self.$footer.length) {\n      buttons = self.$footer.find(\"button\");\n      return buttons.each(function() {\n        var btn;\n        btn = $(this);\n        if (btn.html().match(/fechar/ig)) {\n          return btn.click(function(e) {\n            e.preventDefault();\n            return close();\n          });\n        }\n      });\n    }\n  };\n  startListening = function() {\n    stopListening();\n    return self.interval = setInterval(function() {\n      return check();\n    }, 100);\n  };\n  stopListening = function() {\n    if (self.interval) {\n      return clearInterval(self.interval);\n    }\n  };\n  init = function($modal, params) {\n    self.params = params || {};\n    self.opened = 0;\n    self.initialized = 0;\n    self.$modal = $modal.length ? $modal : $(\".rocket-modal\");\n    if (self.$modal.length) {\n      self.initialized = 0;\n      self.$window = self.$modal.find(\".modal\");\n      self.$main = self.$modal.find(\"main\");\n      self.$close = self.$modal.find(\"header > .close\");\n      self.$footer = self.$modal.find(\"footer\");\n      self.$close.unbind(\"click\").click(close);\n      win.unbind(\"resize.modal\").bind(\"resize.modal\", check);\n      return win.unbind(\"keydown.modal\").bind(\"keydown.modal\", function(e) {\n        return keydown(e);\n      });\n    }\n  };\n  return {\n    init: init,\n    open: open,\n    close: close,\n    focus: focus,\n    setContent: setContent\n  };\n})();\n","/* Modernizr 2.8.3 (Custom Build) | MIT & BSD\n* Build: http://modernizr.com/download/#-cssanimations-csstransitions-touch-shiv-cssclasses-prefixed-teststyles-testprop-testallprops-prefixes-domprefixes-css_calc-load\n*/\n;window.Modernizr=function(a,b,c){function z(a){j.cssText=a}function A(a,b){return z(m.join(a+\";\")+(b||\"\"))}function B(a,b){return typeof a===b}function C(a,b){return!!~(\"\"+a).indexOf(b)}function D(a,b){for(var d in a){var e=a[d];if(!C(e,\"-\")&&j[e]!==c)return b==\"pfx\"?e:!0}return!1}function E(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:B(f,\"function\")?f.bind(d||b):f}return!1}function F(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+\" \"+o.join(d+\" \")+d).split(\" \");return B(b,\"string\")||B(b,\"undefined\")?D(e,b):(e=(a+\" \"+p.join(d+\" \")+d).split(\" \"),E(e,b,c))}var d=\"2.8.3\",e={},f=!0,g=b.documentElement,h=\"modernizr\",i=b.createElement(h),j=i.style,k,l={}.toString,m=\" -webkit- -moz- -o- -ms- \".split(\" \"),n=\"Webkit Moz O ms\",o=n.split(\" \"),p=n.toLowerCase().split(\" \"),q={},r={},s={},t=[],u=t.slice,v,w=function(a,c,d,e){var f,i,j,k,l=b.createElement(\"div\"),m=b.body,n=m||b.createElement(\"body\");if(parseInt(d,10))while(d--)j=b.createElement(\"div\"),j.id=e?e[d]:h+(d+1),l.appendChild(j);return f=[\"&#173;\",'<style id=\"s',h,'\">',a,\"</style>\"].join(\"\"),l.id=h,(m?l:n).innerHTML+=f,n.appendChild(l),m||(n.style.background=\"\",n.style.overflow=\"hidden\",k=g.style.overflow,g.style.overflow=\"hidden\",g.appendChild(n)),i=c(l,a),m?l.parentNode.removeChild(l):(n.parentNode.removeChild(n),g.style.overflow=k),!!i},x={}.hasOwnProperty,y;!B(x,\"undefined\")&&!B(x.call,\"undefined\")?y=function(a,b){return x.call(a,b)}:y=function(a,b){return b in a&&B(a.constructor.prototype[b],\"undefined\")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!=\"function\")throw new TypeError;var d=u.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(u.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(u.call(arguments)))};return e}),q.touch=function(){var c;return\"ontouchstart\"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:w([\"@media (\",m.join(\"touch-enabled),(\"),h,\")\",\"{#modernizr{top:9px;position:absolute}}\"].join(\"\"),function(a){c=a.offsetTop===9}),c},q.cssanimations=function(){return F(\"animationName\")},q.csstransitions=function(){return F(\"transition\")};for(var G in q)y(q,G)&&(v=G.toLowerCase(),e[v]=q[G](),t.push((e[v]?\"\":\"no-\")+v));return e.addTest=function(a,b){if(typeof a==\"object\")for(var d in a)y(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b==\"function\"?b():b,typeof f!=\"undefined\"&&f&&(g.className+=\" \"+(b?\"\":\"no-\")+a),e[a]=b}return e},z(\"\"),i=k=null,function(a,b){function l(a,b){var c=a.createElement(\"p\"),d=a.getElementsByTagName(\"head\")[0]||a.documentElement;return c.innerHTML=\"x<style>\"+b+\"</style>\",d.insertBefore(c.lastChild,d.firstChild)}function m(){var a=s.elements;return typeof a==\"string\"?a.split(\" \"):a}function n(a){var b=j[a[h]];return b||(b={},i++,a[h]=i,j[i]=b),b}function o(a,c,d){c||(c=b);if(k)return c.createElement(a);d||(d=n(c));var g;return d.cache[a]?g=d.cache[a].cloneNode():f.test(a)?g=(d.cache[a]=d.createElem(a)).cloneNode():g=d.createElem(a),g.canHaveChildren&&!e.test(a)&&!g.tagUrn?d.frag.appendChild(g):g}function p(a,c){a||(a=b);if(k)return a.createDocumentFragment();c=c||n(a);var d=c.frag.cloneNode(),e=0,f=m(),g=f.length;for(;e<g;e++)d.createElement(f[e]);return d}function q(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return s.shivMethods?o(c,a,b):b.createElem(c)},a.createDocumentFragment=Function(\"h,f\",\"return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&(\"+m().join().replace(/[\\w\\-]+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c(\"'+a+'\")'})+\");return n}\")(s,b.frag)}function r(a){a||(a=b);var c=n(a);return s.shivCSS&&!g&&!c.hasCSS&&(c.hasCSS=!!l(a,\"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}\")),k||q(a,c),a}var c=\"3.7.0\",d=a.html5||{},e=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,f=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,g,h=\"_html5shiv\",i=0,j={},k;(function(){try{var a=b.createElement(\"a\");a.innerHTML=\"<xyz></xyz>\",g=\"hidden\"in a,k=a.childNodes.length==1||function(){b.createElement(\"a\");var a=b.createDocumentFragment();return typeof a.cloneNode==\"undefined\"||typeof a.createDocumentFragment==\"undefined\"||typeof a.createElement==\"undefined\"}()}catch(c){g=!0,k=!0}})();var s={elements:d.elements||\"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video\",version:c,shivCSS:d.shivCSS!==!1,supportsUnknownElements:k,shivMethods:d.shivMethods!==!1,type:\"default\",shivDocument:r,createElement:o,createDocumentFragment:p};a.html5=s,r(b)}(this,b),e._version=d,e._prefixes=m,e._domPrefixes=p,e._cssomPrefixes=o,e.testProp=function(a){return D([a])},e.testAllProps=F,e.testStyles=w,e.prefixed=function(a,b,c){return b?F(a,b,c):F(a,\"pfx\")},g.className=g.className.replace(/(^|\\s)no-js(\\s|$)/,\"$1$2\")+(f?\" js \"+t.join(\" \"):\"\"),e}(this,this.document),function(a,b,c){function d(a){return\"[object Function]\"==o.call(a)}function e(a){return\"string\"==typeof a}function f(){}function g(a){return!a||\"loaded\"==a||\"complete\"==a||\"uninitialized\"==a}function h(){var a=p.shift();q=1,a?a.t?m(function(){(\"c\"==a.t?B.injectCss:B.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):q=0}function i(a,c,d,e,f,i,j){function k(b){if(!o&&g(l.readyState)&&(u.r=o=1,!q&&h(),l.onload=l.onreadystatechange=null,b)){\"img\"!=a&&m(function(){t.removeChild(l)},50);for(var d in y[c])y[c].hasOwnProperty(d)&&y[c][d].onload()}}var j=j||B.errorTimeout,l=b.createElement(a),o=0,r=0,u={t:d,s:c,e:f,a:i,x:j};1===y[c]&&(r=1,y[c]=[]),\"object\"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height=\"0\",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,r)},p.splice(e,0,u),\"img\"!=a&&(r||2===y[c]?(t.insertBefore(l,s?null:n),m(k,j)):y[c].push(l))}function j(a,b,c,d,f){return q=0,b=b||\"j\",e(a)?i(\"c\"==b?v:u,a,b,this.i++,c,d,f):(p.splice(this.i++,0,a),1==p.length&&h()),this}function k(){var a=B;return a.loader={load:j,i:0},a}var l=b.documentElement,m=a.setTimeout,n=b.getElementsByTagName(\"script\")[0],o={}.toString,p=[],q=0,r=\"MozAppearance\"in l.style,s=r&&!!b.createRange().compareNode,t=s?l:n.parentNode,l=a.opera&&\"[object Opera]\"==o.call(a.opera),l=!!b.attachEvent&&!l,u=r?\"object\":l?\"script\":\"img\",v=l?\"script\":u,w=Array.isArray||function(a){return\"[object Array]\"==o.call(a)},x=[],y={},z={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}},A,B;B=function(a){function b(a){var a=a.split(\"!\"),b=x.length,c=a.pop(),d=a.length,c={url:c,origUrl:c,prefixes:a},e,f,g;for(f=0;f<d;f++)g=a[f].split(\"=\"),(e=z[g.shift()])&&(c=e(c,g));for(f=0;f<b;f++)c=x[f](c);return c}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(\".\").pop().split(\"?\").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split(\"/\").pop().split(\"?\")[0]]),i.instead?i.instead(a,e,f,g,h):(y[i.url]?i.noexec=!0:y[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&\"css\"==i.url.split(\".\").pop().split(\"?\").shift()?\"c\":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load(function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),y[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}),g(a,j,b,0,h);else if(Object(a)===a)for(n in m=function(){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b}(),a)a.hasOwnProperty(n)&&(!c&&!--m&&(d(j)?j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}:j[n]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),l()}}(k[n])),g(a[n],j,b,n,h))}else!c&&l()}var h=!!a.test,i=a.load||a.both,j=a.callback||f,k=j,l=a.complete||f,m,n;c(h?a.yep:a.nope,!!i),i&&c(i)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(w(a))for(i=0;i<a.length;i++)j=a[i],e(j)?g(j,0,l,0):w(j)?B(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},B.addPrefix=function(a,b){z[a]=b},B.addFilter=function(a){x.push(a)},B.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState=\"loading\",b.addEventListener(\"DOMContentLoaded\",A=function(){b.removeEventListener(\"DOMContentLoaded\",A,0),b.readyState=\"complete\"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k=b.createElement(\"script\"),l,o,e=e||B.errorTimeout;k.src=a;for(o in d)k.setAttribute(o,d[o]);c=j?h:c||f,k.onreadystatechange=k.onload=function(){!l&&g(k.readyState)&&(l=1,c(),k.onload=k.onreadystatechange=null)},m(function(){l||(l=1,c(1))},e),i?k.onload():n.parentNode.insertBefore(k,n)},a.yepnope.injectCss=function(a,c,d,e,g,i){var e=b.createElement(\"link\"),j,c=i?h:c||f;e.href=a,e.rel=\"stylesheet\",e.type=\"text/css\";for(j in d)e.setAttribute(j,d[j]);g||(n.parentNode.insertBefore(e,n),m(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},Modernizr.addTest(\"csscalc\",function(){var a=\"width:\",b=\"calc(10px);\",c=document.createElement(\"div\");return c.style.cssText=a+Modernizr._prefixes.join(b+a),!!c.style.length});\n","@MsgTyping = do ->\n\ttimeout = 15000\n\ttimeouts = {}\n\trenew = true\n\trenewTimeout = 10000\n\tselfTyping = new ReactiveVar false\n\tusersTyping = {}\n\tdep = new Tracker.Dependency\n\n\taddStream = (room) ->\n\t\tif _.isEmpty usersTyping[room]?.users\n\t\t\tusersTyping[room] = { users: {} }\n\t\t\tRocketChat.Notifications.onRoom room, 'typing', (username, typing) ->\n\t\t\t\tunless username is Meteor.user()?.username\n\t\t\t\t\tif typing is true\n\t\t\t\t\t\tusers = usersTyping[room].users\n\t\t\t\t\t\tusers[username] = Meteor.setTimeout ->\n\t\t\t\t\t\t\tdelete users[username]\n\t\t\t\t\t\t\tusersTyping[room].users = users\n\t\t\t\t\t\t\tdep.changed()\n\t\t\t\t\t\t, timeout\n\t\t\t\t\t\tusersTyping[room].users = users\n\t\t\t\t\t\tdep.changed()\n\t\t\t\t\telse\n\t\t\t\t\t\tusers = usersTyping[room].users\n\t\t\t\t\t\tdelete users[username]\n\t\t\t\t\t\tusersTyping[room].users = users\n\t\t\t\t\t\tdep.changed()\n\n\tTracker.autorun ->\n\t\tif Session.get 'openedRoom'\n\t\t\taddStream Session.get 'openedRoom'\n\n\tstart = (room) ->\n\t\treturn unless renew\n\n\t\tsetTimeout ->\n\t\t\trenew = true\n\t\t, renewTimeout\n\n\t\trenew = false\n\t\tselfTyping.set true\n\t\tRocketChat.Notifications.notifyRoom room, 'typing', Meteor.user()?.username, true\n\t\tclearTimeout timeouts[room]\n\t\ttimeouts[room] = Meteor.setTimeout ->\n\t\t\tstop(room)\n\t\t, timeout\n\n\tstop = (room) ->\n\t\trenew = true\n\t\tselfTyping.set false\n\t\tif timeouts?[room]?\n\t\t\tclearTimeout(timeouts[room])\n\t\t\ttimeouts[room] = null\n\t\tRocketChat.Notifications.notifyRoom room, 'typing', Meteor.user()?.username, false\n\n\tget = (room) ->\n\t\tdep.depend()\n\t\tunless usersTyping[room]\n\t\t\tusersTyping[room] = { users: {} }\n\t\tusers = usersTyping[room].users\n\t\treturn _.keys(users) or []\n\n\treturn {\n\t\tstart: start\n\t\tstop: stop\n\t\tget: get\n\t\tselfTyping: selfTyping\n\t}\n","this.MsgTyping = (function() {\n  var addStream, dep, get, renew, renewTimeout, selfTyping, start, stop, timeout, timeouts, usersTyping;\n  timeout = 15000;\n  timeouts = {};\n  renew = true;\n  renewTimeout = 10000;\n  selfTyping = new ReactiveVar(false);\n  usersTyping = {};\n  dep = new Tracker.Dependency;\n  addStream = function(room) {\n    var ref;\n    if (_.isEmpty((ref = usersTyping[room]) != null ? ref.users : void 0)) {\n      usersTyping[room] = {\n        users: {}\n      };\n      return RocketChat.Notifications.onRoom(room, 'typing', function(username, typing) {\n        var ref1, users;\n        if (username !== ((ref1 = Meteor.user()) != null ? ref1.username : void 0)) {\n          if (typing === true) {\n            users = usersTyping[room].users;\n            users[username] = Meteor.setTimeout(function() {\n              delete users[username];\n              usersTyping[room].users = users;\n              return dep.changed();\n            }, timeout);\n            usersTyping[room].users = users;\n            return dep.changed();\n          } else {\n            users = usersTyping[room].users;\n            delete users[username];\n            usersTyping[room].users = users;\n            return dep.changed();\n          }\n        }\n      });\n    }\n  };\n  Tracker.autorun(function() {\n    if (Session.get('openedRoom')) {\n      return addStream(Session.get('openedRoom'));\n    }\n  });\n  start = function(room) {\n    var ref;\n    if (!renew) {\n      return;\n    }\n    setTimeout(function() {\n      return renew = true;\n    }, renewTimeout);\n    renew = false;\n    selfTyping.set(true);\n    RocketChat.Notifications.notifyRoom(room, 'typing', (ref = Meteor.user()) != null ? ref.username : void 0, true);\n    clearTimeout(timeouts[room]);\n    return timeouts[room] = Meteor.setTimeout(function() {\n      return stop(room);\n    }, timeout);\n  };\n  stop = function(room) {\n    var ref;\n    renew = true;\n    selfTyping.set(false);\n    if ((timeouts != null ? timeouts[room] : void 0) != null) {\n      clearTimeout(timeouts[room]);\n      timeouts[room] = null;\n    }\n    return RocketChat.Notifications.notifyRoom(room, 'typing', (ref = Meteor.user()) != null ? ref.username : void 0, false);\n  };\n  get = function(room) {\n    var users;\n    dep.depend();\n    if (!usersTyping[room]) {\n      usersTyping[room] = {\n        users: {}\n      };\n    }\n    users = usersTyping[room].users;\n    return _.keys(users) || [];\n  };\n  return {\n    start: start,\n    stop: stop,\n    get: get,\n    selfTyping: selfTyping\n  };\n})();\n","# @TODO implementar 'clicar na notificacao' abre a janela do chat\n@KonchatNotification =\n\tnotificationStatus: new ReactiveVar\n\n\t# notificacoes HTML5\n\tgetDesktopPermission: ->\n\t\tif window.Notification && Notification.permission != \"granted\" && !Meteor.settings.public.sandstorm\n\t\t\tNotification.requestPermission (status) ->\n\t\t\t\tKonchatNotification.notificationStatus.set status\n\t\t\t\tif Notification.permission != status\n\t\t\t\t\tNotification.permission = status\n\n\tnotify: (notification) ->\n\t\tif window.Notification && Notification.permission == \"granted\"\n\t\t\tmessage = { rid: notification.payload?.rid, msg: notification.text, notification: true }\n\t\t\tRocketChat.promises.run('onClientMessageReceived', message).then (message) ->\n\t\t\t\tn = new Notification notification.title,\n\t\t\t\t\ticon: notification.icon or getAvatarUrlFromUsername notification.payload.sender.username\n\t\t\t\t\tbody: _.stripTags(message.msg)\n\t\t\t\t\ttag: notification.payload._id,\n\t\t\t\t\tsilent: true\n\t\t\t\t\tcanReply: true\n\n\t\t\t\tnotificationDuration = (notification.duration - 0) or (Meteor.user()?.settings?.preferences?.desktopNotificationDuration - 0) or RocketChat.settings.get('Desktop_Notifications_Duration')\n\t\t\t\tif notificationDuration > 0\n\t\t\t\t\tsetTimeout ( -> n.close() ), notificationDuration * 1000\n\n\t\t\t\tif notification.payload?.rid?\n\t\t\t\t\tif n.addEventListener?\n\t\t\t\t\t\tn.addEventListener 'reply', ({response}) ->\n\t\t\t\t\t\t\tMeteor.call 'sendMessage',\n\t\t\t\t\t\t\t\t_id: Random.id()\n\t\t\t\t\t\t\t\trid: notification.payload.rid\n\t\t\t\t\t\t\t\tmsg: response\n\n\t\t\t\t\tn.onclick = ->\n\t\t\t\t\t\tthis.close()\n\t\t\t\t\t\twindow.focus()\n\t\t\t\t\t\tswitch notification.payload.type\n\t\t\t\t\t\t\twhen 'd'\n\t\t\t\t\t\t\t\tFlowRouter.go 'direct', { username: notification.payload.sender.username }, FlowRouter.current().queryParams\n\t\t\t\t\t\t\twhen 'c'\n\t\t\t\t\t\t\t\tFlowRouter.go 'channel', { name: notification.payload.name }, FlowRouter.current().queryParams\n\t\t\t\t\t\t\twhen 'p'\n\t\t\t\t\t\t\t\tFlowRouter.go 'group', { name: notification.payload.name }, FlowRouter.current().queryParams\n\n\tshowDesktop: (notification) ->\n\t\tif notification.payload.rid is Session.get('openedRoom') and window.document.hasFocus?()\n\t\t\treturn\n\n\t\tif Meteor.user().status is 'busy' or Meteor.settings.public.sandstorm?\n\t\t\treturn\n\n\t\tgetAvatarAsPng notification.payload.sender.username, (avatarAsPng) ->\n\t\t\tnotification.icon = avatarAsPng\n\t\t\tKonchatNotification.notify(notification)\n\n\tnewMessage: (rid) ->\n\t\tif not Session.equals('user_' + Meteor.userId() + '_status', 'busy')\n\t\t\tnewMessageNotification = Meteor.user()?.settings?.preferences?.newMessageNotification || 'chime'\n\t\t\tsub = ChatSubscription.findOne({ rid: rid }, { fields: { audioNotification: 1 } });\n\t\t\tif sub?.audioNotification isnt 'none'\n\t\t\t\tif sub?.audioNotification\n\t\t\t\t\t$(\"audio##{sub.audioNotification}\")?[0]?.play?()\n\t\t\t\telse if newMessageNotification isnt 'none'\n\t\t\t\t\t$(\"audio##{newMessageNotification}\")?[0]?.play?()\n\n\tnewRoom: (rid, withSound = true) ->\n\t\tTracker.nonreactive ->\n\t\t\tnewRoomSound = Session.get('newRoomSound')\n\t\t\tif newRoomSound?\n\t\t\t\tnewRoomSound = _.union newRoomSound, rid\n\t\t\telse\n\t\t\t\tnewRoomSound = [rid]\n\n\t\t\tSession.set('newRoomSound', newRoomSound)\n\n\t\t# $('.link-room-' + rid).addClass('new-room-highlight')\n\n\tremoveRoomNotification: (rid) ->\n\t\tTracker.nonreactive ->\n\t\t\tSession.set('newRoomSound', [])\n\n\t\t$('.link-room-' + rid).removeClass('new-room-highlight')\n\nTracker.autorun ->\n\tnewRoomNotification = Meteor.user()?.settings?.preferences?.newRoomNotification || 'door'\n\tif Session.get('newRoomSound')?.length > 0\n\t\tTracker.nonreactive ->\n\t\t\tif not Session.equals('user_' + Meteor.userId() + '_status', 'busy') and newRoomNotification isnt 'none'\n\t\t\t\t$(\"audio##{newRoomNotification}\")?[0]?.play?()\n\telse\n\t\t$(\"audio##{newRoomNotification}\")?[0]?.pause?()\n\t\t$(\"audio##{newRoomNotification}\")?[0]?.currentTime = 0\n","this.KonchatNotification = {\n  notificationStatus: new ReactiveVar,\n  getDesktopPermission: function() {\n    if (window.Notification && Notification.permission !== \"granted\" && !Meteor.settings[\"public\"].sandstorm) {\n      return Notification.requestPermission(function(status) {\n        KonchatNotification.notificationStatus.set(status);\n        if (Notification.permission !== status) {\n          return Notification.permission = status;\n        }\n      });\n    }\n  },\n  notify: function(notification) {\n    var message, ref;\n    if (window.Notification && Notification.permission === \"granted\") {\n      message = {\n        rid: (ref = notification.payload) != null ? ref.rid : void 0,\n        msg: notification.text,\n        notification: true\n      };\n      return RocketChat.promises.run('onClientMessageReceived', message).then(function(message) {\n        var n, notificationDuration, ref1, ref2, ref3, ref4;\n        n = new Notification(notification.title, {\n          icon: notification.icon || getAvatarUrlFromUsername(notification.payload.sender.username),\n          body: _.stripTags(message.msg),\n          tag: notification.payload._id,\n          silent: true,\n          canReply: true\n        });\n        notificationDuration = (notification.duration - 0) || (((ref1 = Meteor.user()) != null ? (ref2 = ref1.settings) != null ? (ref3 = ref2.preferences) != null ? ref3.desktopNotificationDuration : void 0 : void 0 : void 0) - 0) || RocketChat.settings.get('Desktop_Notifications_Duration');\n        if (notificationDuration > 0) {\n          setTimeout((function() {\n            return n.close();\n          }), notificationDuration * 1000);\n        }\n        if (((ref4 = notification.payload) != null ? ref4.rid : void 0) != null) {\n          if (n.addEventListener != null) {\n            n.addEventListener('reply', function(arg) {\n              var response;\n              response = arg.response;\n              return Meteor.call('sendMessage', {\n                _id: Random.id(),\n                rid: notification.payload.rid,\n                msg: response\n              });\n            });\n          }\n          return n.onclick = function() {\n            this.close();\n            window.focus();\n            switch (notification.payload.type) {\n              case 'd':\n                return FlowRouter.go('direct', {\n                  username: notification.payload.sender.username\n                }, FlowRouter.current().queryParams);\n              case 'c':\n                return FlowRouter.go('channel', {\n                  name: notification.payload.name\n                }, FlowRouter.current().queryParams);\n              case 'p':\n                return FlowRouter.go('group', {\n                  name: notification.payload.name\n                }, FlowRouter.current().queryParams);\n            }\n          };\n        }\n      });\n    }\n  },\n  showDesktop: function(notification) {\n    var base;\n    if (notification.payload.rid === Session.get('openedRoom') && (typeof (base = window.document).hasFocus === \"function\" ? base.hasFocus() : void 0)) {\n      return;\n    }\n    if (Meteor.user().status === 'busy' || (Meteor.settings[\"public\"].sandstorm != null)) {\n      return;\n    }\n    return getAvatarAsPng(notification.payload.sender.username, function(avatarAsPng) {\n      notification.icon = avatarAsPng;\n      return KonchatNotification.notify(notification);\n    });\n  },\n  newMessage: function(rid) {\n    var newMessageNotification, ref, ref1, ref2, ref3, ref4, ref5, ref6, sub;\n    if (!Session.equals('user_' + Meteor.userId() + '_status', 'busy')) {\n      newMessageNotification = ((ref = Meteor.user()) != null ? (ref1 = ref.settings) != null ? (ref2 = ref1.preferences) != null ? ref2.newMessageNotification : void 0 : void 0 : void 0) || 'chime';\n      sub = ChatSubscription.findOne({\n        rid: rid\n      }, {\n        fields: {\n          audioNotification: 1\n        }\n      });\n      if ((sub != null ? sub.audioNotification : void 0) !== 'none') {\n        if (sub != null ? sub.audioNotification : void 0) {\n          return (ref3 = $(\"audio#\" + sub.audioNotification)) != null ? (ref4 = ref3[0]) != null ? typeof ref4.play === \"function\" ? ref4.play() : void 0 : void 0 : void 0;\n        } else if (newMessageNotification !== 'none') {\n          return (ref5 = $(\"audio#\" + newMessageNotification)) != null ? (ref6 = ref5[0]) != null ? typeof ref6.play === \"function\" ? ref6.play() : void 0 : void 0 : void 0;\n        }\n      }\n    }\n  },\n  newRoom: function(rid, withSound) {\n    if (withSound == null) {\n      withSound = true;\n    }\n    return Tracker.nonreactive(function() {\n      var newRoomSound;\n      newRoomSound = Session.get('newRoomSound');\n      if (newRoomSound != null) {\n        newRoomSound = _.union(newRoomSound, rid);\n      } else {\n        newRoomSound = [rid];\n      }\n      return Session.set('newRoomSound', newRoomSound);\n    });\n  },\n  removeRoomNotification: function(rid) {\n    Tracker.nonreactive(function() {\n      return Session.set('newRoomSound', []);\n    });\n    return $('.link-room-' + rid).removeClass('new-room-highlight');\n  }\n};\n\nTracker.autorun(function() {\n  var newRoomNotification, ref, ref1, ref2, ref3, ref4, ref5, ref6, ref7;\n  newRoomNotification = ((ref = Meteor.user()) != null ? (ref1 = ref.settings) != null ? (ref2 = ref1.preferences) != null ? ref2.newRoomNotification : void 0 : void 0 : void 0) || 'door';\n  if (((ref3 = Session.get('newRoomSound')) != null ? ref3.length : void 0) > 0) {\n    return Tracker.nonreactive(function() {\n      var ref4, ref5;\n      if (!Session.equals('user_' + Meteor.userId() + '_status', 'busy') && newRoomNotification !== 'none') {\n        return (ref4 = $(\"audio#\" + newRoomNotification)) != null ? (ref5 = ref4[0]) != null ? typeof ref5.play === \"function\" ? ref5.play() : void 0 : void 0 : void 0;\n      }\n    });\n  } else {\n    if ((ref4 = $(\"audio#\" + newRoomNotification)) != null) {\n      if ((ref5 = ref4[0]) != null) {\n        if (typeof ref5.pause === \"function\") {\n          ref5.pause();\n        }\n      }\n    }\n    return (ref6 = $(\"audio#\" + newRoomNotification)) != null ? (ref7 = ref6[0]) != null ? ref7.currentTime = 0 : void 0 : void 0;\n  }\n});\n","/**\n * Get the parent template instance\n * @param {Number} [levels] How many levels to go up. Default is 1\n * @returns {Blaze.TemplateInstance}\n */\n\nBlaze.TemplateInstance.prototype.parentTemplate = function(levels) {\n\tlet view = Blaze.currentView;\n\tif (typeof levels === 'undefined') {\n\t\tlevels = 1;\n\t}\n\twhile (view) {\n\t\tif (view.name.substring(0, 9) === 'Template.' && !(levels--)) {\n\t\t\treturn view.templateInstance();\n\t\t}\n\t\tview = view.parentView;\n\t}\n};\n","### DEFINITIONS\n- If window loses focus user needs to scroll or click/touch some place\n- On hit ESC enable read, force read of current room and remove unread mark\n- When user change room disable read until user interaction\n- Only read if mark of *first-unread* is visible for user or if flag *force* was passed\n- Always read the opened room\n- The default method *read* has a delay of 2000ms to prevent multiple reads and to user be able to see the mark\n###\n\n# Meteor.startup ->\n\t# window.addEventListener 'focus', ->\n\t\t# readMessage.refreshUnreadMark(undefined, true)\n\n@readMessage = new class\n\tdebug: false\n\n\tcallbacks: []\n\n\tconstructor: ->\n\t\t@canReadMessage = false\n\n\treadNow: (force=false) ->\n\t\tconsole.log '--------------' if @debug\n\t\tconsole.log 'readMessage -> readNow init process force:', force if @debug\n\n\t\tself = @\n\n\t\tself.refreshUnreadMark()\n\n\t\tif force isnt true and @canReadMessage is false\n\t\t\tconsole.log 'readMessage -> readNow canceled by canReadMessage: false' if @debug\n\t\t\treturn\n\n\t\trid = Session.get 'openedRoom'\n\t\tif not rid?\n\t\t\tconsole.log 'readMessage -> readNow canceled, no rid informed' if @debug\n\t\t\treturn\n\n\t\tif force is true\n\t\t\tconsole.log 'readMessage -> readNow via force rid:', rid if @debug\n\t\t\treturn Meteor.call 'readMessages', rid, ->\n\t\t\t\tRoomHistoryManager.getRoom(rid).unreadNotLoaded.set 0\n\t\t\t\tself.refreshUnreadMark()\n\t\t\t\tself.fireRead rid\n\n\t\tsubscription = ChatSubscription.findOne rid: rid\n\t\tif not subscription?\n\t\t\tconsole.log 'readMessage -> readNow canceled, no subscription found for rid:', rid if @debug\n\t\t\treturn\n\n\t\tif subscription.alert is false and subscription.unread is 0\n\t\t\tconsole.log 'readMessage -> readNow canceled, alert', subscription.alert, 'and unread', subscription.unread if @debug\n\t\t\treturn\n\n\t\troom = RoomManager.getOpenedRoomByRid rid\n\t\tif not room?\n\t\t\tconsole.log 'readMessage -> readNow canceled, no room found for typeName:', subscription.t + subscription.name if @debug\n\t\t\treturn\n\n\t\t# Only read messages if user saw the first unread message\n\t\tunreadMark = $('.message.first-unread')\n\t\tif unreadMark.length > 0\n\t\t\tposition = unreadMark.position()\n\t\t\tvisible = position?.top >= 0\n\t\t\tif not visible and room.unreadSince.get()?\n\t\t\t\tconsole.log 'readMessage -> readNow canceled, unread mark visible:', visible, 'unread since exists', room.unreadSince.get()? if @debug\n\t\t\t\treturn\n\n\t\tconsole.log 'readMessage -> readNow rid:', rid if @debug\n\t\tMeteor.call 'readMessages', rid, ->\n\t\t\tRoomHistoryManager.getRoom(rid).unreadNotLoaded.set 0\n\t\t\tself.refreshUnreadMark()\n\t\t\tself.fireRead rid\n\n\tread: _.debounce (force) ->\n\t\t@readNow(force)\n\t, 1000\n\n\tdisable: ->\n\t\t@canReadMessage = false\n\n\tenable: ->\n\t\t@canReadMessage = document.hasFocus()\n\n\tisEnable: ->\n\t\treturn @canReadMessage is true\n\n\tonRead: (cb) ->\n\t\t@callbacks.push cb\n\n\tfireRead: (rid) ->\n\t\tfor cb in @callbacks\n\t\t\tcb(rid)\n\n\trefreshUnreadMark: (rid, force) ->\n\t\tself = @\n\n\t\trid ?= Session.get 'openedRoom'\n\t\tif not rid?\n\t\t\treturn\n\n\t\tsubscription = ChatSubscription.findOne rid: rid, {reactive: false}\n\t\tif not subscription?\n\t\t\treturn\n\n\t\troom = RoomManager.openedRooms[subscription.t + subscription.name]\n\t\tif not room?\n\t\t\treturn\n\n\t\t$roomDom = $(room.dom)\n\t\t$roomDom.find('.message.first-unread').addClass('first-unread-opaque')\n\n\t\tif not subscription.alert and subscription.unread is 0\n\t\t\troom.unreadSince.set undefined\n\t\t\treturn\n\n\t\tif not force? and subscription.rid is Session.get('openedRoom') and document.hasFocus()\n\t\t\treturn\n\n\t\t$roomDom.find('.message.first-unread').removeClass('first-unread').removeClass('first-unread-opaque')\n\n\t\tlastReadRecord = ChatMessage.findOne\n\t\t\trid: subscription.rid\n\t\t\tts:\n\t\t\t\t$lt: subscription.ls\n\t\t\t# 'u._id':\n\t\t\t# \t$ne: Meteor.userId()\n\t\t,\n\t\t\tsort:\n\t\t\t\tts: -1\n\n\t\tif not lastReadRecord? and RoomHistoryManager.getRoom(room.rid).unreadNotLoaded.get() is 0\n\t\t\tlastReadRecord =\n\t\t\t\tts: new Date(0)\n\n\t\tif lastReadRecord? or RoomHistoryManager.getRoom(room.rid).unreadNotLoaded.get() > 0\n\t\t\troom.unreadSince.set subscription.ls\n\t\telse\n\t\t\troom.unreadSince.set undefined\n\n\t\tif lastReadRecord?\n\t\t\tfirstUnreadRecord = ChatMessage.findOne\n\t\t\t\trid: subscription.rid\n\t\t\t\tts:\n\t\t\t\t\t$gt: lastReadRecord.ts\n\t\t\t\t'u._id':\n\t\t\t\t\t$ne: Meteor.userId()\n\t\t\t,\n\t\t\t\tsort:\n\t\t\t\t\tts: 1\n\n\t\t\tif firstUnreadRecord?\n\t\t\t\troom.unreadFirstId = firstUnreadRecord._id\n\t\t\t\t$roomDom.find('.message#'+firstUnreadRecord._id).addClass('first-unread')\n\n\nMeteor.startup ->\n\t$(window).on 'blur', ->\n\t\treadMessage.disable()\n\n\t$(window).on 'focus', ->\n\t\treadMessage.enable()\n\t\treadMessage.read()\n\n\t$(window).on 'click', (e) ->\n\t\treadMessage.enable()\n\t\treadMessage.read()\n\n\t$(window).on 'touchend', (e) ->\n\t\treadMessage.enable()\n\t\treadMessage.read()\n\n\t$(window).on 'keyup', (e) ->\n\t\tkey = e.which\n\n\t\tif key is 27\n\t\t\treadMessage.enable()\n\t\t\treadMessage.readNow(true)\n\t\t\t$('.message.first-unread').removeClass('first-unread')\n","\n/* DEFINITIONS\n- If window loses focus user needs to scroll or click/touch some place\n- On hit ESC enable read, force read of current room and remove unread mark\n- When user change room disable read until user interaction\n- Only read if mark of *first-unread* is visible for user or if flag *force* was passed\n- Always read the opened room\n- The default method *read* has a delay of 2000ms to prevent multiple reads and to user be able to see the mark\n */\nthis.readMessage = new ((function() {\n  _Class.prototype.debug = false;\n\n  _Class.prototype.callbacks = [];\n\n  function _Class() {\n    this.canReadMessage = false;\n  }\n\n  _Class.prototype.readNow = function(force) {\n    var position, rid, room, self, subscription, unreadMark, visible;\n    if (force == null) {\n      force = false;\n    }\n    if (this.debug) {\n      console.log('--------------');\n    }\n    if (this.debug) {\n      console.log('readMessage -> readNow init process force:', force);\n    }\n    self = this;\n    self.refreshUnreadMark();\n    if (force !== true && this.canReadMessage === false) {\n      if (this.debug) {\n        console.log('readMessage -> readNow canceled by canReadMessage: false');\n      }\n      return;\n    }\n    rid = Session.get('openedRoom');\n    if (rid == null) {\n      if (this.debug) {\n        console.log('readMessage -> readNow canceled, no rid informed');\n      }\n      return;\n    }\n    if (force === true) {\n      if (this.debug) {\n        console.log('readMessage -> readNow via force rid:', rid);\n      }\n      return Meteor.call('readMessages', rid, function() {\n        RoomHistoryManager.getRoom(rid).unreadNotLoaded.set(0);\n        self.refreshUnreadMark();\n        return self.fireRead(rid);\n      });\n    }\n    subscription = ChatSubscription.findOne({\n      rid: rid\n    });\n    if (subscription == null) {\n      if (this.debug) {\n        console.log('readMessage -> readNow canceled, no subscription found for rid:', rid);\n      }\n      return;\n    }\n    if (subscription.alert === false && subscription.unread === 0) {\n      if (this.debug) {\n        console.log('readMessage -> readNow canceled, alert', subscription.alert, 'and unread', subscription.unread);\n      }\n      return;\n    }\n    room = RoomManager.getOpenedRoomByRid(rid);\n    if (room == null) {\n      if (this.debug) {\n        console.log('readMessage -> readNow canceled, no room found for typeName:', subscription.t + subscription.name);\n      }\n      return;\n    }\n    unreadMark = $('.message.first-unread');\n    if (unreadMark.length > 0) {\n      position = unreadMark.position();\n      visible = (position != null ? position.top : void 0) >= 0;\n      if (!visible && (room.unreadSince.get() != null)) {\n        if (this.debug) {\n          console.log('readMessage -> readNow canceled, unread mark visible:', visible, 'unread since exists', room.unreadSince.get() != null);\n        }\n        return;\n      }\n    }\n    if (this.debug) {\n      console.log('readMessage -> readNow rid:', rid);\n    }\n    return Meteor.call('readMessages', rid, function() {\n      RoomHistoryManager.getRoom(rid).unreadNotLoaded.set(0);\n      self.refreshUnreadMark();\n      return self.fireRead(rid);\n    });\n  };\n\n  _Class.prototype.read = _.debounce(function(force) {\n    return this.readNow(force);\n  }, 1000);\n\n  _Class.prototype.disable = function() {\n    return this.canReadMessage = false;\n  };\n\n  _Class.prototype.enable = function() {\n    return this.canReadMessage = document.hasFocus();\n  };\n\n  _Class.prototype.isEnable = function() {\n    return this.canReadMessage === true;\n  };\n\n  _Class.prototype.onRead = function(cb) {\n    return this.callbacks.push(cb);\n  };\n\n  _Class.prototype.fireRead = function(rid) {\n    var cb, i, len, ref, results;\n    ref = this.callbacks;\n    results = [];\n    for (i = 0, len = ref.length; i < len; i++) {\n      cb = ref[i];\n      results.push(cb(rid));\n    }\n    return results;\n  };\n\n  _Class.prototype.refreshUnreadMark = function(rid, force) {\n    var $roomDom, firstUnreadRecord, lastReadRecord, room, self, subscription;\n    self = this;\n    if (rid == null) {\n      rid = Session.get('openedRoom');\n    }\n    if (rid == null) {\n      return;\n    }\n    subscription = ChatSubscription.findOne({\n      rid: rid\n    }, {\n      reactive: false\n    });\n    if (subscription == null) {\n      return;\n    }\n    room = RoomManager.openedRooms[subscription.t + subscription.name];\n    if (room == null) {\n      return;\n    }\n    $roomDom = $(room.dom);\n    $roomDom.find('.message.first-unread').addClass('first-unread-opaque');\n    if (!subscription.alert && subscription.unread === 0) {\n      room.unreadSince.set(void 0);\n      return;\n    }\n    if ((force == null) && subscription.rid === Session.get('openedRoom') && document.hasFocus()) {\n      return;\n    }\n    $roomDom.find('.message.first-unread').removeClass('first-unread').removeClass('first-unread-opaque');\n    lastReadRecord = ChatMessage.findOne({\n      rid: subscription.rid,\n      ts: {\n        $lt: subscription.ls\n      }\n    }, {\n      sort: {\n        ts: -1\n      }\n    });\n    if ((lastReadRecord == null) && RoomHistoryManager.getRoom(room.rid).unreadNotLoaded.get() === 0) {\n      lastReadRecord = {\n        ts: new Date(0)\n      };\n    }\n    if ((lastReadRecord != null) || RoomHistoryManager.getRoom(room.rid).unreadNotLoaded.get() > 0) {\n      room.unreadSince.set(subscription.ls);\n    } else {\n      room.unreadSince.set(void 0);\n    }\n    if (lastReadRecord != null) {\n      firstUnreadRecord = ChatMessage.findOne({\n        rid: subscription.rid,\n        ts: {\n          $gt: lastReadRecord.ts\n        },\n        'u._id': {\n          $ne: Meteor.userId()\n        }\n      }, {\n        sort: {\n          ts: 1\n        }\n      });\n      if (firstUnreadRecord != null) {\n        room.unreadFirstId = firstUnreadRecord._id;\n        return $roomDom.find('.message#' + firstUnreadRecord._id).addClass('first-unread');\n      }\n    }\n  };\n\n  return _Class;\n\n})());\n\nMeteor.startup(function() {\n  $(window).on('blur', function() {\n    return readMessage.disable();\n  });\n  $(window).on('focus', function() {\n    readMessage.enable();\n    return readMessage.read();\n  });\n  $(window).on('click', function(e) {\n    readMessage.enable();\n    return readMessage.read();\n  });\n  $(window).on('touchend', function(e) {\n    readMessage.enable();\n    return readMessage.read();\n  });\n  return $(window).on('keyup', function(e) {\n    var key;\n    key = e.which;\n    if (key === 27) {\n      readMessage.enable();\n      readMessage.readNow(true);\n      return $('.message.first-unread').removeClass('first-unread');\n    }\n  });\n});\n","RocketChat.Login = (->\n\t\tonClick = (el) ->\n\t\t\t$el = $(el)\n\t\t\tif $el.length\n\t\t\t\t$el.addClass \"active\"\n\t\t\t\t$el.find(\"input\").focus()\n\t\tonBlur = (input) ->\n\t\t\t$input = $(input)\n\t\t\tif $input.length\n\t\t\t\tif input.value == \"\"\n\t\t\t\t\t$input.parents(\".input-text\").removeClass \"active\"\n\t\tcheck = (form) ->\n\t\t\t$form = $(form)\n\t\t\tif $form.length\n\t\t\t\tinputs = $form.find(\"input\")\n\t\t\t\tinputs.each ->\n\t\t\t\t\tif @.value != \"\"\n\t\t\t\t\t\tconsole.log @.value\n\t\t\t\t\t\t$(@).parents(\".input-text\").addClass \"active\"\n\t\tcheck: check\n\t\tonClick: onClick\n\t\tonBlur: onBlur\n\t)()\n\nRocketChat.Button = (->\n\t\ttime = undefined\n\t\tloading = (el) ->\n\t\t\t$el = $(el)\n\t\t\tnext = el.attr(\"data-loading-text\")\n\t\t\thtml = el.find(\"span\").html()\n\t\t\tel.addClass(\"-progress\").attr(\"data-def-text\",html).find(\"span\").html(next)\n\t\t\ttime = setTimeout ->\n\t\t\t\tel.addClass(\"going\")\n\t\t\t, 1\n\t\tdone = (el) ->\n\t\t\t$el = $(el)\n\t\t\tel.addClass(\"done\")\n\t\treset = (el) ->\n\t\t\tclearTimeout(time) if time\n\t\t\t$el = $(el)\n\t\t\thtml= $el.attr(\"data-def-text\")\n\t\t\t$el.find(\"span\").html(html) if html\n\t\t\t$el.removeClass(\"-progress going done\")\n\t\tdone: done\n\t\tloading: loading\n\t\treset: reset\n\t)()\n\nRocketChat.animationSupport = ->\n\t\tanimeEnd =\n\t\t\tWebkitAnimation: \"webkitAnimationEnd\"\n\t\t\tOAnimation: \"oAnimationEnd\"\n\t\t\tmsAnimation: \"MSAnimationEnd\"\n\t\t\tanimation: \"animationend\"\n\n\t\ttransEndEventNames =\n\t\t\tWebkitTransition: \"webkitTransitionEnd\"\n\t\t\tMozTransition: \"transitionend\"\n\t\t\tOTransition: \"oTransitionEnd otransitionend\"\n\t\t\tmsTransition: \"MSTransitionEnd\"\n\t\t\ttransition: \"transitionend\"\n\t\tprefixB = transEndEventNames[Modernizr.prefixed(\"transition\")]\n\t\tprefixA = animeEnd[Modernizr.prefixed(\"animation\")]\n\t\tsupport = Modernizr.cssanimations\n\t\tsupport: support\n\t\tanimation: prefixA\n\t\ttransition: prefixB\n\nRocketChat.animeBack = (el, callback, type) ->\n\t\tel = $(el)\n\t\tif not el.length > 0\n\t\t\tcallback el    if callback\n\t\t\treturn\n\t\ts = animationSupport()\n\t\tp = ((if type then s.animation else s.transition))\n\t\tel.one p, (e) ->\n\n\t\t\t#el.off(p);\n\t\t\tcallback e\n\t\t\treturn\n\n\t\treturn\n\nRocketChat.preLoadImgs = (urls, callback) ->\n\t\tL_ = (x) ->\n\t\t\tif x.width > 0\n\t\t\t\t$(x).addClass(\"loaded\").removeClass \"loading\"\n\t\t\t\tloaded = $(\".loaded\", preLoader)\n\t\t\t\tif loaded.length is urls.length and not ended\n\t\t\t\t\tended = 1\n\t\t\t\t\timgs = preLoader.children()\n\t\t\t\t\tcallback imgs\n\t\t\t\t\tpreLoader.remove()\n\t\t\treturn\n\t\tim = new Array()\n\t\tpreLoader = $(\"<div/>\").attr(id: \"perverter-preloader\")\n\t\tloaded = undefined\n\t\tended = undefined\n\t\ti = 0\n\n\t\twhile i < urls.length\n\t\t\tim[i] = new Image()\n\t\t\tim[i].onload = ->\n\t\t\t\tL_ this\n\t\t\t\treturn\n\n\t\t\t$(im[i]).appendTo(preLoader).addClass \"loading\"\n\t\t\tim[i].src = urls[i]\n\t\t\tL_ im[i]    if im[i].width > 0\n\t\t\ti++\n\n\t\treturn\n","RocketChat.Login = (function() {\n  var check, onBlur, onClick;\n  onClick = function(el) {\n    var $el;\n    $el = $(el);\n    if ($el.length) {\n      $el.addClass(\"active\");\n      return $el.find(\"input\").focus();\n    }\n  };\n  onBlur = function(input) {\n    var $input;\n    $input = $(input);\n    if ($input.length) {\n      if (input.value === \"\") {\n        return $input.parents(\".input-text\").removeClass(\"active\");\n      }\n    }\n  };\n  check = function(form) {\n    var $form, inputs;\n    $form = $(form);\n    if ($form.length) {\n      inputs = $form.find(\"input\");\n      return inputs.each(function() {\n        if (this.value !== \"\") {\n          console.log(this.value);\n          return $(this).parents(\".input-text\").addClass(\"active\");\n        }\n      });\n    }\n  };\n  return {\n    check: check,\n    onClick: onClick,\n    onBlur: onBlur\n  };\n})();\n\nRocketChat.Button = (function() {\n  var done, loading, reset, time;\n  time = void 0;\n  loading = function(el) {\n    var $el, html, next;\n    $el = $(el);\n    next = el.attr(\"data-loading-text\");\n    html = el.find(\"span\").html();\n    el.addClass(\"-progress\").attr(\"data-def-text\", html).find(\"span\").html(next);\n    return time = setTimeout(function() {\n      return el.addClass(\"going\");\n    }, 1);\n  };\n  done = function(el) {\n    var $el;\n    $el = $(el);\n    return el.addClass(\"done\");\n  };\n  reset = function(el) {\n    var $el, html;\n    if (time) {\n      clearTimeout(time);\n    }\n    $el = $(el);\n    html = $el.attr(\"data-def-text\");\n    if (html) {\n      $el.find(\"span\").html(html);\n    }\n    return $el.removeClass(\"-progress going done\");\n  };\n  return {\n    done: done,\n    loading: loading,\n    reset: reset\n  };\n})();\n\nRocketChat.animationSupport = function() {\n  var animeEnd, prefixA, prefixB, support, transEndEventNames;\n  animeEnd = {\n    WebkitAnimation: \"webkitAnimationEnd\",\n    OAnimation: \"oAnimationEnd\",\n    msAnimation: \"MSAnimationEnd\",\n    animation: \"animationend\"\n  };\n  transEndEventNames = {\n    WebkitTransition: \"webkitTransitionEnd\",\n    MozTransition: \"transitionend\",\n    OTransition: \"oTransitionEnd otransitionend\",\n    msTransition: \"MSTransitionEnd\",\n    transition: \"transitionend\"\n  };\n  prefixB = transEndEventNames[Modernizr.prefixed(\"transition\")];\n  prefixA = animeEnd[Modernizr.prefixed(\"animation\")];\n  support = Modernizr.cssanimations;\n  return {\n    support: support,\n    animation: prefixA,\n    transition: prefixB\n  };\n};\n\nRocketChat.animeBack = function(el, callback, type) {\n  var p, s;\n  el = $(el);\n  if (!el.length > 0) {\n    if (callback) {\n      callback(el);\n    }\n    return;\n  }\n  s = animationSupport();\n  p = (type ? s.animation : s.transition);\n  el.one(p, function(e) {\n    callback(e);\n  });\n};\n\nRocketChat.preLoadImgs = function(urls, callback) {\n  var L_, ended, i, im, loaded, preLoader;\n  L_ = function(x) {\n    var ended, imgs, loaded;\n    if (x.width > 0) {\n      $(x).addClass(\"loaded\").removeClass(\"loading\");\n      loaded = $(\".loaded\", preLoader);\n      if (loaded.length === urls.length && !ended) {\n        ended = 1;\n        imgs = preLoader.children();\n        callback(imgs);\n        preLoader.remove();\n      }\n    }\n  };\n  im = new Array();\n  preLoader = $(\"<div/>\").attr({\n    id: \"perverter-preloader\"\n  });\n  loaded = void 0;\n  ended = void 0;\n  i = 0;\n  while (i < urls.length) {\n    im[i] = new Image();\n    im[i].onload = function() {\n      L_(this);\n    };\n    $(im[i]).appendTo(preLoader).addClass(\"loading\");\n    im[i].src = urls[i];\n    if (im[i].width > 0) {\n      L_(im[i]);\n    }\n    i++;\n  }\n};\n","@RoomHistoryManager = new class\n\tdefaultLimit = 50\n\n\thistories = {}\n\n\tgetRoom = (rid) ->\n\t\tif not histories[rid]?\n\t\t\thistories[rid] =\n\t\t\t\thasMore: new ReactiveVar true\n\t\t\t\thasMoreNext: new ReactiveVar false\n\t\t\t\tisLoading: new ReactiveVar false\n\t\t\t\tunreadNotLoaded: new ReactiveVar 0\n\t\t\t\tfirstUnread: new ReactiveVar\n\t\t\t\tloaded: undefined\n\n\t\treturn histories[rid]\n\n\tgetMore = (rid, limit=defaultLimit) ->\n\t\troom = getRoom rid\n\t\tif room.hasMore.curValue isnt true\n\t\t\treturn\n\n\t\troom.isLoading.set true\n\n\t\t# ScrollListener.setLoader true\n\t\tlastMessage = ChatMessage.findOne({rid: rid}, {sort: {ts: 1}})\n\t\t# lastMessage ?= ChatMessage.findOne({rid: rid}, {sort: {ts: 1}})\n\n\t\tif lastMessage?\n\t\t\tts = lastMessage.ts\n\t\telse\n\t\t\tts = undefined\n\n\t\tls = undefined\n\t\ttypeName = undefined\n\n\t\tsubscription = ChatSubscription.findOne rid: rid\n\t\tif subscription?\n\t\t\tls = subscription.ls\n\t\t\ttypeName = subscription.t + subscription.name\n\t\telse\n\t\t\tcurRoomDoc = ChatRoom.findOne(_id: rid)\n\t\t\ttypeName = curRoomDoc?.t + curRoomDoc?.name\n\n\t\tMeteor.call 'loadHistory', rid, ts, limit, ls, (err, result) ->\n\t\t\troom.unreadNotLoaded.set result?.unreadNotLoaded\n\t\t\troom.firstUnread.set result?.firstUnread\n\n\t\t\twrapper = $('.messages-box .wrapper').get(0)\n\t\t\tif wrapper?\n\t\t\t\tpreviousHeight = wrapper.scrollHeight\n\n\t\t\tfor item in result?.messages or [] when item.t isnt 'command'\n\t\t\t\titem.roles = _.union(UserRoles.findOne(item.u?._id)?.roles, RoomRoles.findOne({rid: item.rid, 'u._id': item.u?._id})?.roles)\n\t\t\t\tChatMessage.upsert {_id: item._id}, item\n\n\t\t\tif wrapper?\n\t\t\t\theightDiff = wrapper.scrollHeight - previousHeight\n\t\t\t\twrapper.scrollTop += heightDiff\n\n\t\t\tMeteor.defer ->\n\t\t\t\treadMessage.refreshUnreadMark(rid, true)\n\t\t\t\tRoomManager.updateMentionsMarksOfRoom typeName\n\n\t\t\troom.isLoading.set false\n\t\t\troom.loaded ?= 0\n\t\t\tif result?.messages?.length?\n\t\t\t\troom.loaded += result.messages.length\n\t\t\tif result?.messages?.length < limit\n\t\t\t\troom.hasMore.set false\n\n\tgetMoreNext = (rid, limit=defaultLimit) ->\n\t\troom = getRoom rid\n\t\tif room.hasMoreNext.curValue isnt true\n\t\t\treturn\n\n\t\tinstance = Blaze.getView($('.messages-box .wrapper')[0]).templateInstance()\n\t\tinstance.atBottom = false\n\n\t\troom.isLoading.set true\n\n\t\tlastMessage = ChatMessage.findOne({rid: rid}, {sort: {ts: -1}})\n\n\t\ttypeName = undefined\n\n\t\tsubscription = ChatSubscription.findOne rid: rid\n\t\tif subscription?\n\t\t\tls = subscription.ls\n\t\t\ttypeName = subscription.t + subscription.name\n\t\telse\n\t\t\tcurRoomDoc = ChatRoom.findOne(_id: rid)\n\t\t\ttypeName = curRoomDoc?.t + curRoomDoc?.name\n\n\t\tts = lastMessage.ts\n\n\t\tif ts\n\t\t\tMeteor.call 'loadNextMessages', rid, ts, limit, (err, result) ->\n\t\t\t\tfor item in result?.messages or []\n\t\t\t\t\tif item.t isnt 'command'\n\t\t\t\t\t\titem.roles = _.union(UserRoles.findOne(item.u?._id)?.roles, RoomRoles.findOne({rid: item.rid, 'u._id': item.u?._id})?.roles)\n\t\t\t\t\t\tChatMessage.upsert {_id: item._id}, item\n\n\t\t\t\tMeteor.defer ->\n\t\t\t\t\tRoomManager.updateMentionsMarksOfRoom typeName\n\n\t\t\t\troom.isLoading.set false\n\t\t\t\troom.loaded ?= 0\n\t\t\t\tif result.messages.length?\n\t\t\t\t\troom.loaded += result.messages.length\n\t\t\t\tif result.messages.length < limit\n\t\t\t\t\troom.hasMoreNext.set false\n\n\tgetSurroundingMessages = (message, limit=defaultLimit) ->\n\t\tunless message?.rid\n\t\t\treturn\n\n\t\tinstance = Blaze.getView($('.messages-box .wrapper')[0]).templateInstance()\n\n\t\tif ChatMessage.findOne message._id\n\t\t\twrapper = $('.messages-box .wrapper')\n\t\t\tmsgElement = $(\"##{message._id}\", wrapper)\n\t\t\tpos = wrapper.scrollTop() + msgElement.offset().top - wrapper.height()/2\n\t\t\twrapper.animate({\n\t\t\t\tscrollTop: pos\n\t\t\t}, 500)\n\t\t\tmsgElement.addClass('highlight')\n\n\t\t\tsetTimeout ->\n\t\t\t\tmessages = wrapper[0]\n\t\t\t\tinstance.atBottom = messages.scrollTop >= messages.scrollHeight - messages.clientHeight;\n\n\t\t\tsetTimeout ->\n\t\t\t\tmsgElement.removeClass('highlight')\n\t\t\t, 500\n\t\telse\n\t\t\troom = getRoom message.rid\n\t\t\troom.isLoading.set true\n\t\t\tChatMessage.remove { rid: message.rid }\n\n\t\t\ttypeName = undefined\n\n\t\t\tsubscription = ChatSubscription.findOne rid: message.rid\n\t\t\tif subscription?\n\t\t\t\tls = subscription.ls\n\t\t\t\ttypeName = subscription.t + subscription.name\n\t\t\telse\n\t\t\t\tcurRoomDoc = ChatRoom.findOne(_id: message.rid)\n\t\t\t\ttypeName = curRoomDoc?.t + curRoomDoc?.name\n\n\t\t\tMeteor.call 'loadSurroundingMessages', message, limit, (err, result) ->\n\t\t\t\tfor item in result?.messages or []\n\t\t\t\t\tif item.t isnt 'command'\n\t\t\t\t\t\titem.roles = _.union(UserRoles.findOne(item.u?._id)?.roles, RoomRoles.findOne({rid: item.rid, 'u._id': item.u?._id})?.roles)\n\t\t\t\t\t\tChatMessage.upsert {_id: item._id}, item\n\n\t\t\t\tMeteor.defer ->\n\t\t\t\t\treadMessage.refreshUnreadMark(message.rid, true)\n\t\t\t\t\tRoomManager.updateMentionsMarksOfRoom typeName\n\t\t\t\t\twrapper = $('.messages-box .wrapper')\n\t\t\t\t\tmsgElement = $(\"##{message._id}\", wrapper)\n\t\t\t\t\tpos = wrapper.scrollTop() + msgElement.offset().top - wrapper.height()/2\n\t\t\t\t\twrapper.animate({\n\t\t\t\t\t\tscrollTop: pos\n\t\t\t\t\t}, 500)\n\n\t\t\t\t\tmsgElement.addClass('highlight')\n\n\t\t\t\t\tsetTimeout ->\n\t\t\t\t\t\troom.isLoading.set false\n\t\t\t\t\t\tmessages = wrapper[0]\n\t\t\t\t\t\tinstance.atBottom = !result.moreAfter && messages.scrollTop >= messages.scrollHeight - messages.clientHeight;\n\t\t\t\t\t, 500\n\n\t\t\t\t\tsetTimeout ->\n\t\t\t\t\t\tmsgElement.removeClass('highlight')\n\t\t\t\t\t, 500\n\t\t\t\troom.loaded ?= 0\n\t\t\t\tif result.messages.length?\n\t\t\t\t\troom.loaded += result.messages.length\n\t\t\t\troom.hasMore.set result.moreBefore\n\t\t\t\troom.hasMoreNext.set result.moreAfter\n\n\thasMore = (rid) ->\n\t\troom = getRoom rid\n\n\t\treturn room.hasMore.get()\n\n\thasMoreNext = (rid) ->\n\t\troom = getRoom rid\n\t\treturn room.hasMoreNext.get()\n\n\n\tgetMoreIfIsEmpty = (rid) ->\n\t\troom = getRoom rid\n\n\t\tif room.loaded is undefined\n\t\t\tgetMore rid\n\n\n\tisLoading = (rid) ->\n\t\troom = getRoom rid\n\t\treturn room.isLoading.get()\n\n\tclear = (rid) ->\n\t\tChatMessage.remove({ rid: rid })\n\t\tif histories[rid]?\n\t\t\thistories[rid].hasMore.set true\n\t\t\thistories[rid].isLoading.set false\n\t\t\thistories[rid].loaded = undefined\n\n\tgetRoom: getRoom\n\tgetMore: getMore\n\tgetMoreNext: getMoreNext\n\tgetMoreIfIsEmpty: getMoreIfIsEmpty\n\thasMore: hasMore\n\thasMoreNext: hasMoreNext\n\tisLoading: isLoading\n\tclear: clear\n\tgetSurroundingMessages: getSurroundingMessages\n","this.RoomHistoryManager = new ((function() {\n  var clear, defaultLimit, getMore, getMoreIfIsEmpty, getMoreNext, getRoom, getSurroundingMessages, hasMore, hasMoreNext, histories, isLoading;\n\n  function _Class() {}\n\n  defaultLimit = 50;\n\n  histories = {};\n\n  getRoom = function(rid) {\n    if (histories[rid] == null) {\n      histories[rid] = {\n        hasMore: new ReactiveVar(true),\n        hasMoreNext: new ReactiveVar(false),\n        isLoading: new ReactiveVar(false),\n        unreadNotLoaded: new ReactiveVar(0),\n        firstUnread: new ReactiveVar,\n        loaded: void 0\n      };\n    }\n    return histories[rid];\n  };\n\n  getMore = function(rid, limit) {\n    var curRoomDoc, lastMessage, ls, room, subscription, ts, typeName;\n    if (limit == null) {\n      limit = defaultLimit;\n    }\n    room = getRoom(rid);\n    if (room.hasMore.curValue !== true) {\n      return;\n    }\n    room.isLoading.set(true);\n    lastMessage = ChatMessage.findOne({\n      rid: rid\n    }, {\n      sort: {\n        ts: 1\n      }\n    });\n    if (lastMessage != null) {\n      ts = lastMessage.ts;\n    } else {\n      ts = void 0;\n    }\n    ls = void 0;\n    typeName = void 0;\n    subscription = ChatSubscription.findOne({\n      rid: rid\n    });\n    if (subscription != null) {\n      ls = subscription.ls;\n      typeName = subscription.t + subscription.name;\n    } else {\n      curRoomDoc = ChatRoom.findOne({\n        _id: rid\n      });\n      typeName = (curRoomDoc != null ? curRoomDoc.t : void 0) + (curRoomDoc != null ? curRoomDoc.name : void 0);\n    }\n    return Meteor.call('loadHistory', rid, ts, limit, ls, function(err, result) {\n      var heightDiff, i, item, len, previousHeight, ref, ref1, ref2, ref3, ref4, ref5, ref6, wrapper;\n      room.unreadNotLoaded.set(result != null ? result.unreadNotLoaded : void 0);\n      room.firstUnread.set(result != null ? result.firstUnread : void 0);\n      wrapper = $('.messages-box .wrapper').get(0);\n      if (wrapper != null) {\n        previousHeight = wrapper.scrollHeight;\n      }\n      ref = (result != null ? result.messages : void 0) || [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        item = ref[i];\n        if (!(item.t !== 'command')) {\n          continue;\n        }\n        item.roles = _.union((ref1 = UserRoles.findOne((ref2 = item.u) != null ? ref2._id : void 0)) != null ? ref1.roles : void 0, (ref3 = RoomRoles.findOne({\n          rid: item.rid,\n          'u._id': (ref4 = item.u) != null ? ref4._id : void 0\n        })) != null ? ref3.roles : void 0);\n        ChatMessage.upsert({\n          _id: item._id\n        }, item);\n      }\n      if (wrapper != null) {\n        heightDiff = wrapper.scrollHeight - previousHeight;\n        wrapper.scrollTop += heightDiff;\n      }\n      Meteor.defer(function() {\n        readMessage.refreshUnreadMark(rid, true);\n        return RoomManager.updateMentionsMarksOfRoom(typeName);\n      });\n      room.isLoading.set(false);\n      if (room.loaded == null) {\n        room.loaded = 0;\n      }\n      if ((result != null ? (ref5 = result.messages) != null ? ref5.length : void 0 : void 0) != null) {\n        room.loaded += result.messages.length;\n      }\n      if ((result != null ? (ref6 = result.messages) != null ? ref6.length : void 0 : void 0) < limit) {\n        return room.hasMore.set(false);\n      }\n    });\n  };\n\n  getMoreNext = function(rid, limit) {\n    var curRoomDoc, instance, lastMessage, ls, room, subscription, ts, typeName;\n    if (limit == null) {\n      limit = defaultLimit;\n    }\n    room = getRoom(rid);\n    if (room.hasMoreNext.curValue !== true) {\n      return;\n    }\n    instance = Blaze.getView($('.messages-box .wrapper')[0]).templateInstance();\n    instance.atBottom = false;\n    room.isLoading.set(true);\n    lastMessage = ChatMessage.findOne({\n      rid: rid\n    }, {\n      sort: {\n        ts: -1\n      }\n    });\n    typeName = void 0;\n    subscription = ChatSubscription.findOne({\n      rid: rid\n    });\n    if (subscription != null) {\n      ls = subscription.ls;\n      typeName = subscription.t + subscription.name;\n    } else {\n      curRoomDoc = ChatRoom.findOne({\n        _id: rid\n      });\n      typeName = (curRoomDoc != null ? curRoomDoc.t : void 0) + (curRoomDoc != null ? curRoomDoc.name : void 0);\n    }\n    ts = lastMessage.ts;\n    if (ts) {\n      return Meteor.call('loadNextMessages', rid, ts, limit, function(err, result) {\n        var i, item, len, ref, ref1, ref2, ref3, ref4;\n        ref = (result != null ? result.messages : void 0) || [];\n        for (i = 0, len = ref.length; i < len; i++) {\n          item = ref[i];\n          if (item.t !== 'command') {\n            item.roles = _.union((ref1 = UserRoles.findOne((ref2 = item.u) != null ? ref2._id : void 0)) != null ? ref1.roles : void 0, (ref3 = RoomRoles.findOne({\n              rid: item.rid,\n              'u._id': (ref4 = item.u) != null ? ref4._id : void 0\n            })) != null ? ref3.roles : void 0);\n            ChatMessage.upsert({\n              _id: item._id\n            }, item);\n          }\n        }\n        Meteor.defer(function() {\n          return RoomManager.updateMentionsMarksOfRoom(typeName);\n        });\n        room.isLoading.set(false);\n        if (room.loaded == null) {\n          room.loaded = 0;\n        }\n        if (result.messages.length != null) {\n          room.loaded += result.messages.length;\n        }\n        if (result.messages.length < limit) {\n          return room.hasMoreNext.set(false);\n        }\n      });\n    }\n  };\n\n  getSurroundingMessages = function(message, limit) {\n    var curRoomDoc, instance, ls, msgElement, pos, room, subscription, typeName, wrapper;\n    if (limit == null) {\n      limit = defaultLimit;\n    }\n    if (!(message != null ? message.rid : void 0)) {\n      return;\n    }\n    instance = Blaze.getView($('.messages-box .wrapper')[0]).templateInstance();\n    if (ChatMessage.findOne(message._id)) {\n      wrapper = $('.messages-box .wrapper');\n      msgElement = $(\"#\" + message._id, wrapper);\n      pos = wrapper.scrollTop() + msgElement.offset().top - wrapper.height() / 2;\n      wrapper.animate({\n        scrollTop: pos\n      }, 500);\n      msgElement.addClass('highlight');\n      setTimeout(function() {\n        var messages;\n        messages = wrapper[0];\n        return instance.atBottom = messages.scrollTop >= messages.scrollHeight - messages.clientHeight;\n      });\n      return setTimeout(function() {\n        return msgElement.removeClass('highlight');\n      }, 500);\n    } else {\n      room = getRoom(message.rid);\n      room.isLoading.set(true);\n      ChatMessage.remove({\n        rid: message.rid\n      });\n      typeName = void 0;\n      subscription = ChatSubscription.findOne({\n        rid: message.rid\n      });\n      if (subscription != null) {\n        ls = subscription.ls;\n        typeName = subscription.t + subscription.name;\n      } else {\n        curRoomDoc = ChatRoom.findOne({\n          _id: message.rid\n        });\n        typeName = (curRoomDoc != null ? curRoomDoc.t : void 0) + (curRoomDoc != null ? curRoomDoc.name : void 0);\n      }\n      return Meteor.call('loadSurroundingMessages', message, limit, function(err, result) {\n        var i, item, len, ref, ref1, ref2, ref3, ref4;\n        ref = (result != null ? result.messages : void 0) || [];\n        for (i = 0, len = ref.length; i < len; i++) {\n          item = ref[i];\n          if (item.t !== 'command') {\n            item.roles = _.union((ref1 = UserRoles.findOne((ref2 = item.u) != null ? ref2._id : void 0)) != null ? ref1.roles : void 0, (ref3 = RoomRoles.findOne({\n              rid: item.rid,\n              'u._id': (ref4 = item.u) != null ? ref4._id : void 0\n            })) != null ? ref3.roles : void 0);\n            ChatMessage.upsert({\n              _id: item._id\n            }, item);\n          }\n        }\n        Meteor.defer(function() {\n          readMessage.refreshUnreadMark(message.rid, true);\n          RoomManager.updateMentionsMarksOfRoom(typeName);\n          wrapper = $('.messages-box .wrapper');\n          msgElement = $(\"#\" + message._id, wrapper);\n          pos = wrapper.scrollTop() + msgElement.offset().top - wrapper.height() / 2;\n          wrapper.animate({\n            scrollTop: pos\n          }, 500);\n          msgElement.addClass('highlight');\n          setTimeout(function() {\n            var messages;\n            room.isLoading.set(false);\n            messages = wrapper[0];\n            return instance.atBottom = !result.moreAfter && messages.scrollTop >= messages.scrollHeight - messages.clientHeight;\n          }, 500);\n          return setTimeout(function() {\n            return msgElement.removeClass('highlight');\n          }, 500);\n        });\n        if (room.loaded == null) {\n          room.loaded = 0;\n        }\n        if (result.messages.length != null) {\n          room.loaded += result.messages.length;\n        }\n        room.hasMore.set(result.moreBefore);\n        return room.hasMoreNext.set(result.moreAfter);\n      });\n    }\n  };\n\n  hasMore = function(rid) {\n    var room;\n    room = getRoom(rid);\n    return room.hasMore.get();\n  };\n\n  hasMoreNext = function(rid) {\n    var room;\n    room = getRoom(rid);\n    return room.hasMoreNext.get();\n  };\n\n  getMoreIfIsEmpty = function(rid) {\n    var room;\n    room = getRoom(rid);\n    if (room.loaded === void 0) {\n      return getMore(rid);\n    }\n  };\n\n  isLoading = function(rid) {\n    var room;\n    room = getRoom(rid);\n    return room.isLoading.get();\n  };\n\n  clear = function(rid) {\n    ChatMessage.remove({\n      rid: rid\n    });\n    if (histories[rid] != null) {\n      histories[rid].hasMore.set(true);\n      histories[rid].isLoading.set(false);\n      return histories[rid].loaded = void 0;\n    }\n  };\n\n  _Class.prototype.getRoom = getRoom;\n\n  _Class.prototype.getMore = getMore;\n\n  _Class.prototype.getMoreNext = getMoreNext;\n\n  _Class.prototype.getMoreIfIsEmpty = getMoreIfIsEmpty;\n\n  _Class.prototype.hasMore = hasMore;\n\n  _Class.prototype.hasMoreNext = hasMoreNext;\n\n  _Class.prototype.isLoading = isLoading;\n\n  _Class.prototype.clear = clear;\n\n  _Class.prototype.getSurroundingMessages = getSurroundingMessages;\n\n  return _Class;\n\n})());\n","loadMissedMessages = (rid) ->\n\tlastMessage = ChatMessage.findOne({rid: rid}, {sort: {ts: -1}, limit: 1})\n\tif not lastMessage?\n\t\treturn\n\n\tMeteor.call 'loadMissedMessages', rid, lastMessage.ts, (err, result) ->\n\t\tfor item in result\n\t\t\tRocketChat.promises.run('onClientMessageReceived', item).then (item) ->\n\t\t\t\titem.roles = _.union(UserRoles.findOne(item.u?._id)?.roles, RoomRoles.findOne({rid: item.rid, 'u._id': item.u?._id})?.roles)\n\t\t\t\tChatMessage.upsert {_id: item._id}, item\n\nconnectionWasOnline = true\nTracker.autorun ->\n\tconnected = Meteor.connection.status().connected\n\n\tif connected is true and connectionWasOnline is false and RoomManager.openedRooms?\n\t\tfor key, value of RoomManager.openedRooms\n\t\t\tif value.rid?\n\t\t\t\tloadMissedMessages(value.rid)\n\n\tconnectionWasOnline = connected\n\n# Reload rooms after login\ncurrentUsername = undefined\nTracker.autorun (c) ->\n\tuser = Meteor.user()\n\tif currentUsername is undefined and user?.username?\n\t\tcurrentUsername = user.username\n\t\tRoomManager.closeAllRooms()\n\t\tFlowRouter._current.route.callAction(FlowRouter._current)\n\nMeteor.startup ->\n\tChatMessage.find().observe\n\t\tremoved: (record) ->\n\t\t\tif RoomManager.getOpenedRoomByRid(record.rid)?\n\t\t\t\trecordBefore = ChatMessage.findOne {ts: {$lt: record.ts}}, {sort: {ts: -1}}\n\t\t\t\tif recordBefore?\n\t\t\t\t\tChatMessage.update {_id: recordBefore._id}, {$set: {tick: new Date}}\n\n\t\t\t\trecordAfter = ChatMessage.findOne {ts: {$gt: record.ts}}, {sort: {ts: 1}}\n\t\t\t\tif recordAfter?\n\t\t\t\t\tChatMessage.update {_id: recordAfter._id}, {$set: {tick: new Date}}\n\n\nonDeleteMessageStream = (msg) ->\n\tChatMessage.remove _id: msg._id\n\n\nTracker.autorun ->\n\tif Meteor.userId()\n\t\tRocketChat.Notifications.onUser 'message', (msg) ->\n\t\t\tmsg.u =\n\t\t\t\tusername: 'rocket.cat'\n\t\t\tmsg.private = true\n\n\t\t\tChatMessage.upsert { _id: msg._id }, msg\n\n\n@RoomManager = new class\n\topenedRooms = {}\n\tmsgStream = new Meteor.Streamer 'room-messages'\n\tonlineUsers = new ReactiveVar {}\n\n\tDep = new Tracker.Dependency\n\n\tclose = (typeName) ->\n\t\tif openedRooms[typeName]\n\t\t\tif openedRooms[typeName].rid?\n\t\t\t\tmsgStream.removeAllListeners openedRooms[typeName].rid\n\t\t\t\tRocketChat.Notifications.unRoom openedRooms[typeName].rid, 'deleteMessage', onDeleteMessageStream\n\n\t\t\topenedRooms[typeName].ready = false\n\t\t\topenedRooms[typeName].active = false\n\t\t\tif openedRooms[typeName].template?\n\t\t\t\tBlaze.remove openedRooms[typeName].template\n\t\t\tdelete openedRooms[typeName].dom\n\t\t\tdelete openedRooms[typeName].template\n\n\t\t\trid = openedRooms[typeName].rid\n\t\t\tdelete openedRooms[typeName]\n\n\t\t\tif rid?\n\t\t\t\tRoomHistoryManager.clear rid\n\n\n\tcomputation = Tracker.autorun ->\n\t\tfor typeName, record of openedRooms when record.active is true\n\t\t\tdo (typeName, record) ->\n\n\t\t\t\tuser = Meteor.user()\n\n\t\t\t\tif record.ready is true\n\t\t\t\t\treturn\n\n\t\t\t\tready = CachedChatRoom.ready.get() and CachedChatSubscription.ready.get() is true\n\n\t\t\t\tif ready is true\n\t\t\t\t\ttype = typeName.substr(0, 1)\n\t\t\t\t\tname = typeName.substr(1)\n\n\t\t\t\t\troom = Tracker.nonreactive =>\n\t\t\t\t\t\treturn RocketChat.roomTypes.findRoom(type, name, user)\n\n\t\t\t\t\tif not room?\n\t\t\t\t\t\trecord.ready = true\n\t\t\t\t\telse\n\t\t\t\t\t\topenedRooms[typeName].rid = room._id\n\n\t\t\t\t\t\tRoomHistoryManager.getMoreIfIsEmpty room._id\n\t\t\t\t\t\trecord.ready = RoomHistoryManager.isLoading(room._id) is false\n\t\t\t\t\t\tDep.changed()\n\n\t\t\t\t\t\tif openedRooms[typeName].streamActive isnt true\n\t\t\t\t\t\t\topenedRooms[typeName].streamActive = true\n\t\t\t\t\t\t\tmsgStream.on openedRooms[typeName].rid, (msg) ->\n\n\t\t\t\t\t\t\t\tRocketChat.promises.run('onClientMessageReceived', msg).then (msg) ->\n\n\t\t\t\t\t\t\t\t\t# Should not send message to room if room has not loaded all the current messages\n\t\t\t\t\t\t\t\t\tif RoomHistoryManager.hasMoreNext(openedRooms[typeName].rid) is false\n\n\t\t\t\t\t\t\t\t\t\t# Do not load command messages into channel\n\t\t\t\t\t\t\t\t\t\tif msg.t isnt 'command'\n\t\t\t\t\t\t\t\t\t\t\tmsg.roles = _.union(UserRoles.findOne(msg.u?._id)?.roles, RoomRoles.findOne({rid: msg.rid, 'u._id': msg.u?._id})?.roles)\n\t\t\t\t\t\t\t\t\t\t\tChatMessage.upsert { _id: msg._id }, msg\n\n\t\t\t\t\t\t\t\t\t\tMeteor.defer ->\n\t\t\t\t\t\t\t\t\t\t\tRoomManager.updateMentionsMarksOfRoom typeName\n\n\t\t\t\t\t\t\t\t\t\tRocketChat.callbacks.run 'streamMessage', msg\n\n\t\t\t\t\t\t\t\t\t\twindow.fireGlobalEvent('new-message', msg);\n\n\t\t\t\t\t\t\tRocketChat.Notifications.onRoom openedRooms[typeName].rid, 'deleteMessage', onDeleteMessageStream\n\n\t\t\t\tDep.changed()\n\n\n\tcloseOlderRooms = ->\n\t\tmaxRoomsOpen = 10\n\t\tif Object.keys(openedRooms).length <= maxRoomsOpen\n\t\t\treturn\n\n\t\troomsToClose = _.sortBy(_.values(openedRooms), 'lastSeen').reverse().slice(maxRoomsOpen)\n\t\tfor roomToClose in roomsToClose\n\t\t\tclose roomToClose.typeName\n\n\n\tcloseAllRooms = ->\n\t\tfor key, openedRoom of openedRooms\n\t\t\tclose openedRoom.typeName\n\n\n\topen = (typeName) ->\n\t\tif not openedRooms[typeName]?\n\t\t\topenedRooms[typeName] =\n\t\t\t\ttypeName: typeName\n\t\t\t\tactive: false\n\t\t\t\tready: false\n\t\t\t\tunreadSince: new ReactiveVar undefined\n\n\t\topenedRooms[typeName].lastSeen = new Date\n\n\t\tif openedRooms[typeName].ready\n\t\t\tcloseOlderRooms()\n\n\t\tif CachedChatSubscription.ready.get() is true\n\n\t\t\tif openedRooms[typeName].active isnt true\n\t\t\t\topenedRooms[typeName].active = true\n\n\t\t\t\tcomputation?.invalidate()\n\n\t\treturn {\n\t\t\tready: ->\n\t\t\t\tDep.depend()\n\t\t\t\treturn openedRooms[typeName].ready\n\t\t}\n\n\tgetOpenedRoomByRid = (rid) ->\n\t\tfor typeName, openedRoom of openedRooms\n\t\t\tif openedRoom.rid is rid\n\t\t\t\treturn openedRoom\n\n\tgetDomOfRoom = (typeName, rid) ->\n\t\troom = openedRooms[typeName]\n\t\tif not room?\n\t\t\treturn\n\n\t\tif not room.dom? and rid?\n\t\t\troom.dom = document.createElement 'div'\n\t\t\troom.dom.classList.add 'room-container'\n\t\t\tcontentAsFunc = (content) ->\n\t\t\t\treturn -> content\n\n\t\t\troom.template = Blaze._TemplateWith { _id: rid }, contentAsFunc(Template.room)\n\t\t\tBlaze.render room.template, room.dom #, nextNode, parentView\n\n\t\treturn room.dom\n\n\texistsDomOfRoom = (typeName) ->\n\t\troom = openedRooms[typeName]\n\t\treturn room?.dom?\n\n\tupdateUserStatus = (user, status, utcOffset) ->\n\t\tonlineUsersValue = onlineUsers.curValue\n\n\t\tif status is 'offline'\n\t\t\tdelete onlineUsersValue[user.username]\n\t\telse\n\t\t\tonlineUsersValue[user.username] =\n\t\t\t\t_id: user._id\n\t\t\t\tstatus: status\n\t\t\t\tutcOffset: utcOffset\n\n\t\tonlineUsers.set onlineUsersValue\n\n\tupdateMentionsMarksOfRoom = (typeName) ->\n\t\tdom = getDomOfRoom typeName\n\t\tif not dom?\n\t\t\treturn\n\n\t\tticksBar = $(dom).find('.ticks-bar')\n\t\t$(dom).find('.ticks-bar > .tick').remove()\n\n\t\tscrollTop = $(dom).find('.messages-box > .wrapper').scrollTop() - 50\n\t\ttotalHeight = $(dom).find('.messages-box > .wrapper > ul').height() + 40\n\n\t\t$('.messages-box .mention-link-me').each (index, item) ->\n\t\t\ttopOffset = $(item).offset().top + scrollTop\n\t\t\tpercent = 100 / totalHeight * topOffset\n\t\t\tif $(item).hasClass('mention-link-all')\n\t\t\t\tticksBar.append('<div class=\"tick background-attention-color\" style=\"top: '+percent+'%;\"></div>')\n\t\t\telse\n\t\t\t\tticksBar.append('<div class=\"tick background-primary-action-color\" style=\"top: '+percent+'%;\"></div>')\n\n\topen: open\n\tclose: close\n\tcloseAllRooms: closeAllRooms\n\tgetDomOfRoom: getDomOfRoom\n\texistsDomOfRoom: existsDomOfRoom\n\tmsgStream: msgStream\n\topenedRooms: openedRooms\n\tupdateUserStatus: updateUserStatus\n\tonlineUsers: onlineUsers\n\tupdateMentionsMarksOfRoom: updateMentionsMarksOfRoom\n\tgetOpenedRoomByRid: getOpenedRoomByRid\n\tcomputation: computation\n\n\nRocketChat.callbacks.add 'afterLogoutCleanUp', ->\n\tRoomManager.closeAllRooms()\n, RocketChat.callbacks.priority.MEDIUM, 'roommanager-after-logout-cleanup'\n","var connectionWasOnline, currentUsername, loadMissedMessages, onDeleteMessageStream;\n\nloadMissedMessages = function(rid) {\n  var lastMessage;\n  lastMessage = ChatMessage.findOne({\n    rid: rid\n  }, {\n    sort: {\n      ts: -1\n    },\n    limit: 1\n  });\n  if (lastMessage == null) {\n    return;\n  }\n  return Meteor.call('loadMissedMessages', rid, lastMessage.ts, function(err, result) {\n    var i, item, len, results;\n    results = [];\n    for (i = 0, len = result.length; i < len; i++) {\n      item = result[i];\n      results.push(RocketChat.promises.run('onClientMessageReceived', item).then(function(item) {\n        var ref, ref1, ref2, ref3;\n        item.roles = _.union((ref = UserRoles.findOne((ref1 = item.u) != null ? ref1._id : void 0)) != null ? ref.roles : void 0, (ref2 = RoomRoles.findOne({\n          rid: item.rid,\n          'u._id': (ref3 = item.u) != null ? ref3._id : void 0\n        })) != null ? ref2.roles : void 0);\n        return ChatMessage.upsert({\n          _id: item._id\n        }, item);\n      }));\n    }\n    return results;\n  });\n};\n\nconnectionWasOnline = true;\n\nTracker.autorun(function() {\n  var connected, key, ref, value;\n  connected = Meteor.connection.status().connected;\n  if (connected === true && connectionWasOnline === false && (RoomManager.openedRooms != null)) {\n    ref = RoomManager.openedRooms;\n    for (key in ref) {\n      value = ref[key];\n      if (value.rid != null) {\n        loadMissedMessages(value.rid);\n      }\n    }\n  }\n  return connectionWasOnline = connected;\n});\n\ncurrentUsername = void 0;\n\nTracker.autorun(function(c) {\n  var user;\n  user = Meteor.user();\n  if (currentUsername === void 0 && ((user != null ? user.username : void 0) != null)) {\n    currentUsername = user.username;\n    RoomManager.closeAllRooms();\n    return FlowRouter._current.route.callAction(FlowRouter._current);\n  }\n});\n\nMeteor.startup(function() {\n  return ChatMessage.find().observe({\n    removed: function(record) {\n      var recordAfter, recordBefore;\n      if (RoomManager.getOpenedRoomByRid(record.rid) != null) {\n        recordBefore = ChatMessage.findOne({\n          ts: {\n            $lt: record.ts\n          }\n        }, {\n          sort: {\n            ts: -1\n          }\n        });\n        if (recordBefore != null) {\n          ChatMessage.update({\n            _id: recordBefore._id\n          }, {\n            $set: {\n              tick: new Date\n            }\n          });\n        }\n        recordAfter = ChatMessage.findOne({\n          ts: {\n            $gt: record.ts\n          }\n        }, {\n          sort: {\n            ts: 1\n          }\n        });\n        if (recordAfter != null) {\n          return ChatMessage.update({\n            _id: recordAfter._id\n          }, {\n            $set: {\n              tick: new Date\n            }\n          });\n        }\n      }\n    }\n  });\n});\n\nonDeleteMessageStream = function(msg) {\n  return ChatMessage.remove({\n    _id: msg._id\n  });\n};\n\nTracker.autorun(function() {\n  if (Meteor.userId()) {\n    return RocketChat.Notifications.onUser('message', function(msg) {\n      msg.u = {\n        username: 'rocket.cat'\n      };\n      msg[\"private\"] = true;\n      return ChatMessage.upsert({\n        _id: msg._id\n      }, msg);\n    });\n  }\n});\n\nthis.RoomManager = new ((function() {\n  var Dep, close, closeAllRooms, closeOlderRooms, computation, existsDomOfRoom, getDomOfRoom, getOpenedRoomByRid, msgStream, onlineUsers, open, openedRooms, updateMentionsMarksOfRoom, updateUserStatus;\n\n  function _Class() {}\n\n  openedRooms = {};\n\n  msgStream = new Meteor.Streamer('room-messages');\n\n  onlineUsers = new ReactiveVar({});\n\n  Dep = new Tracker.Dependency;\n\n  close = function(typeName) {\n    var rid;\n    if (openedRooms[typeName]) {\n      if (openedRooms[typeName].rid != null) {\n        msgStream.removeAllListeners(openedRooms[typeName].rid);\n        RocketChat.Notifications.unRoom(openedRooms[typeName].rid, 'deleteMessage', onDeleteMessageStream);\n      }\n      openedRooms[typeName].ready = false;\n      openedRooms[typeName].active = false;\n      if (openedRooms[typeName].template != null) {\n        Blaze.remove(openedRooms[typeName].template);\n      }\n      delete openedRooms[typeName].dom;\n      delete openedRooms[typeName].template;\n      rid = openedRooms[typeName].rid;\n      delete openedRooms[typeName];\n      if (rid != null) {\n        return RoomHistoryManager.clear(rid);\n      }\n    }\n  };\n\n  computation = Tracker.autorun(function() {\n    var record, results, typeName;\n    results = [];\n    for (typeName in openedRooms) {\n      record = openedRooms[typeName];\n      if (record.active === true) {\n        results.push((function(typeName, record) {\n          var name, ready, room, type, user;\n          user = Meteor.user();\n          if (record.ready === true) {\n            return;\n          }\n          ready = CachedChatRoom.ready.get() && CachedChatSubscription.ready.get() === true;\n          if (ready === true) {\n            type = typeName.substr(0, 1);\n            name = typeName.substr(1);\n            room = Tracker.nonreactive((function(_this) {\n              return function() {\n                return RocketChat.roomTypes.findRoom(type, name, user);\n              };\n            })(this));\n            if (room == null) {\n              record.ready = true;\n            } else {\n              openedRooms[typeName].rid = room._id;\n              RoomHistoryManager.getMoreIfIsEmpty(room._id);\n              record.ready = RoomHistoryManager.isLoading(room._id) === false;\n              Dep.changed();\n              if (openedRooms[typeName].streamActive !== true) {\n                openedRooms[typeName].streamActive = true;\n                msgStream.on(openedRooms[typeName].rid, function(msg) {\n                  return RocketChat.promises.run('onClientMessageReceived', msg).then(function(msg) {\n                    var ref, ref1, ref2, ref3;\n                    if (RoomHistoryManager.hasMoreNext(openedRooms[typeName].rid) === false) {\n                      if (msg.t !== 'command') {\n                        msg.roles = _.union((ref = UserRoles.findOne((ref1 = msg.u) != null ? ref1._id : void 0)) != null ? ref.roles : void 0, (ref2 = RoomRoles.findOne({\n                          rid: msg.rid,\n                          'u._id': (ref3 = msg.u) != null ? ref3._id : void 0\n                        })) != null ? ref2.roles : void 0);\n                        ChatMessage.upsert({\n                          _id: msg._id\n                        }, msg);\n                      }\n                      Meteor.defer(function() {\n                        return RoomManager.updateMentionsMarksOfRoom(typeName);\n                      });\n                      RocketChat.callbacks.run('streamMessage', msg);\n                      return window.fireGlobalEvent('new-message', msg);\n                    }\n                  });\n                });\n                RocketChat.Notifications.onRoom(openedRooms[typeName].rid, 'deleteMessage', onDeleteMessageStream);\n              }\n            }\n          }\n          return Dep.changed();\n        })(typeName, record));\n      }\n    }\n    return results;\n  });\n\n  closeOlderRooms = function() {\n    var i, len, maxRoomsOpen, results, roomToClose, roomsToClose;\n    maxRoomsOpen = 10;\n    if (Object.keys(openedRooms).length <= maxRoomsOpen) {\n      return;\n    }\n    roomsToClose = _.sortBy(_.values(openedRooms), 'lastSeen').reverse().slice(maxRoomsOpen);\n    results = [];\n    for (i = 0, len = roomsToClose.length; i < len; i++) {\n      roomToClose = roomsToClose[i];\n      results.push(close(roomToClose.typeName));\n    }\n    return results;\n  };\n\n  closeAllRooms = function() {\n    var key, openedRoom, results;\n    results = [];\n    for (key in openedRooms) {\n      openedRoom = openedRooms[key];\n      results.push(close(openedRoom.typeName));\n    }\n    return results;\n  };\n\n  open = function(typeName) {\n    if (openedRooms[typeName] == null) {\n      openedRooms[typeName] = {\n        typeName: typeName,\n        active: false,\n        ready: false,\n        unreadSince: new ReactiveVar(void 0)\n      };\n    }\n    openedRooms[typeName].lastSeen = new Date;\n    if (openedRooms[typeName].ready) {\n      closeOlderRooms();\n    }\n    if (CachedChatSubscription.ready.get() === true) {\n      if (openedRooms[typeName].active !== true) {\n        openedRooms[typeName].active = true;\n        if (computation != null) {\n          computation.invalidate();\n        }\n      }\n    }\n    return {\n      ready: function() {\n        Dep.depend();\n        return openedRooms[typeName].ready;\n      }\n    };\n  };\n\n  getOpenedRoomByRid = function(rid) {\n    var openedRoom, typeName;\n    for (typeName in openedRooms) {\n      openedRoom = openedRooms[typeName];\n      if (openedRoom.rid === rid) {\n        return openedRoom;\n      }\n    }\n  };\n\n  getDomOfRoom = function(typeName, rid) {\n    var contentAsFunc, room;\n    room = openedRooms[typeName];\n    if (room == null) {\n      return;\n    }\n    if ((room.dom == null) && (rid != null)) {\n      room.dom = document.createElement('div');\n      room.dom.classList.add('room-container');\n      contentAsFunc = function(content) {\n        return function() {\n          return content;\n        };\n      };\n      room.template = Blaze._TemplateWith({\n        _id: rid\n      }, contentAsFunc(Template.room));\n      Blaze.render(room.template, room.dom);\n    }\n    return room.dom;\n  };\n\n  existsDomOfRoom = function(typeName) {\n    var room;\n    room = openedRooms[typeName];\n    return (room != null ? room.dom : void 0) != null;\n  };\n\n  updateUserStatus = function(user, status, utcOffset) {\n    var onlineUsersValue;\n    onlineUsersValue = onlineUsers.curValue;\n    if (status === 'offline') {\n      delete onlineUsersValue[user.username];\n    } else {\n      onlineUsersValue[user.username] = {\n        _id: user._id,\n        status: status,\n        utcOffset: utcOffset\n      };\n    }\n    return onlineUsers.set(onlineUsersValue);\n  };\n\n  updateMentionsMarksOfRoom = function(typeName) {\n    var dom, scrollTop, ticksBar, totalHeight;\n    dom = getDomOfRoom(typeName);\n    if (dom == null) {\n      return;\n    }\n    ticksBar = $(dom).find('.ticks-bar');\n    $(dom).find('.ticks-bar > .tick').remove();\n    scrollTop = $(dom).find('.messages-box > .wrapper').scrollTop() - 50;\n    totalHeight = $(dom).find('.messages-box > .wrapper > ul').height() + 40;\n    return $('.messages-box .mention-link-me').each(function(index, item) {\n      var percent, topOffset;\n      topOffset = $(item).offset().top + scrollTop;\n      percent = 100 / totalHeight * topOffset;\n      if ($(item).hasClass('mention-link-all')) {\n        return ticksBar.append('<div class=\"tick background-attention-color\" style=\"top: ' + percent + '%;\"></div>');\n      } else {\n        return ticksBar.append('<div class=\"tick background-primary-action-color\" style=\"top: ' + percent + '%;\"></div>');\n      }\n    });\n  };\n\n  _Class.prototype.open = open;\n\n  _Class.prototype.close = close;\n\n  _Class.prototype.closeAllRooms = closeAllRooms;\n\n  _Class.prototype.getDomOfRoom = getDomOfRoom;\n\n  _Class.prototype.existsDomOfRoom = existsDomOfRoom;\n\n  _Class.prototype.msgStream = msgStream;\n\n  _Class.prototype.openedRooms = openedRooms;\n\n  _Class.prototype.updateUserStatus = updateUserStatus;\n\n  _Class.prototype.onlineUsers = onlineUsers;\n\n  _Class.prototype.updateMentionsMarksOfRoom = updateMentionsMarksOfRoom;\n\n  _Class.prototype.getOpenedRoomByRid = getOpenedRoomByRid;\n\n  _Class.prototype.computation = computation;\n\n  return _Class;\n\n})());\n\nRocketChat.callbacks.add('afterLogoutCleanUp', function() {\n  return RoomManager.closeAllRooms();\n}, RocketChat.callbacks.priority.MEDIUM, 'roommanager-after-logout-cleanup');\n","this.SideNav = new class {\n\tconstructor() {\n\t\tthis.initiated = false;\n\t\tthis.sideNav = {};\n\t\tthis.flexNav = {};\n\t\tthis.arrow = {};\n\t\tthis.animating = false;\n\t\tthis.openQueue = [];\n\t}\n\n\ttoggleArrow(status = null) {\n\t\tif (status === 0) {\n\t\t\tthis.arrow.addClass('close');\n\t\t\tthis.arrow.removeClass('top');\n\t\t\treturn this.arrow.removeClass('bottom');\n\t\t} else if (status === -1 || (status !== 1 && this.arrow.hasClass('top'))) {\n\t\t\tthis.arrow.removeClass('close');\n\t\t\tthis.arrow.removeClass('top');\n\t\t\treturn this.arrow.addClass('bottom');\n\t\t} else {\n\t\t\tthis.arrow.removeClass('close');\n\t\t\tthis.arrow.addClass('top');\n\t\t\treturn this.arrow.removeClass('bottom');\n\t\t}\n\t}\n\ttoggleFlex(status, callback) {\n\t\tif (this.animating === true) {\n\t\t\treturn;\n\t\t}\n\t\tthis.animating = true;\n\t\tif (status === -1 || (status !== 1 && this.flexNav.opened)) {\n\t\t\tthis.flexNav.opened = false;\n\t\t\tthis.flexNav.addClass('animated-hidden');\n\t\t} else {\n\t\t\tthis.flexNav.opened = true;\n\t\t\tsetTimeout(() => {\n\t\t\t\treturn this.flexNav.removeClass('animated-hidden');\n\t\t\t}, 50);\n\t\t}\n\t\treturn setTimeout(() => {\n\t\t\tthis.animating = false;\n\t\t\treturn typeof callback === 'function' && callback();\n\t\t}, 500);\n\t}\n\tcloseFlex(callback = null) {\n\t\tlet subscription;\n\t\tif (!RocketChat.roomTypes.getTypes().filter(function(i) {\n\t\t\treturn i.route;\n\t\t}).map(function(i) {\n\t\t\treturn i.route.name;\n\t\t}).includes(FlowRouter.current().route.name)) {\n\t\t\tsubscription = RocketChat.models.Subscriptions.findOne({\n\t\t\t\trid: Session.get('openedRoom')\n\t\t\t});\n\t\t\tif (subscription != null) {\n\t\t\t\tRocketChat.roomTypes.openRouteLink(subscription.t, subscription, FlowRouter.current().queryParams);\n\t\t\t} else {\n\t\t\t\tFlowRouter.go('home');\n\t\t\t}\n\t\t}\n\t\tif (this.animating === true) {\n\t\t\treturn;\n\t\t}\n\t\tthis.toggleArrow(-1);\n\t\treturn this.toggleFlex(-1, callback);\n\t}\n\tflexStatus() {\n\t\treturn this.flexNav.opened;\n\t}\n\tsetFlex(template, data) {\n\t\tif (data == null) {\n\t\t\tdata = {};\n\t\t}\n\t\tSession.set('flex-nav-template', template);\n\t\treturn Session.set('flex-nav-data', data);\n\t}\n\tgetFlex() {\n\t\treturn {\n\t\t\ttemplate: Session.get('flex-nav-template'),\n\t\t\tdata: Session.get('flex-nav-data')\n\t\t};\n\t}\n\n\ttoggleCurrent() {\n\t\tif (this.flexNav && this.flexNav.opened) {\n\t\t\treturn this.closeFlex();\n\t\t} else {\n\t\t\treturn AccountBox.toggle();\n\t\t}\n\t}\n\toverArrow() {\n\t\treturn this.arrow.addClass('hover');\n\t}\n\tleaveArrow() {\n\t\treturn this.arrow.removeClass('hover');\n\t}\n\tarrowBindHover() {\n\t\tthis.arrow.on('mouseenter', () => {\n\t\t\treturn this.sideNav.find('header').addClass('hover');\n\t\t});\n\t\treturn this.arrow.on('mouseout', () => {\n\t\t\treturn this.sideNav.find('header').removeClass('hover');\n\t\t});\n\t}\n\tfocusInput() {\n\t\tconst sideNavDivs = _.filter(document.querySelectorAll('aside.side-nav')[0].children, function(ele) {\n\t\t\treturn ele.tagName === 'DIV' && !ele.classList.contains('hidden');\n\t\t});\n\t\tlet highestZidx = 0;\n\t\tlet highestZidxElem;\n\t\t_.each(sideNavDivs, (ele) => {\n\t\t\tconst zIndex = Number(window.getComputedStyle(ele).zIndex);\n\t\t\tif (Number(zIndex) > highestZidx) {\n\t\t\t\thighestZidx = Number(zIndex);\n\t\t\t\thighestZidxElem = ele;\n\t\t\t}\n\t\t});\n\t\tsetTimeout(() => {\n\t\t\tconst ref = highestZidxElem.querySelector('input');\n\t\t\treturn ref && ref.focus();\n\t\t}, 200);\n\t}\n\tvalidate() {\n\t\tconst invalid = [];\n\t\tthis.sideNav.find('input.required').each(function() {\n\t\t\tif (!this.value.length) {\n\t\t\t\treturn invalid.push($(this).prev('label').html());\n\t\t\t}\n\t\t});\n\t\tif (invalid.length) {\n\t\t\treturn invalid;\n\t\t}\n\t\treturn false;\n\t}\n\n\topenFlex(callback) {\n\t\tif (!this.initiated) {\n\t\t\treturn this.openQueue.push({\n\t\t\t\tconfig: this.getFlex(),\n\t\t\t\tcallback\n\t\t\t});\n\t\t}\n\t\tif (this.animating === true) {\n\t\t\treturn;\n\t\t}\n\t\tAccountBox.close();\n\t\tthis.toggleArrow(0);\n\t\tthis.toggleFlex(1, callback);\n\t\treturn this.focusInput();\n\t}\n\n\tinit() {\n\t\tthis.sideNav = $('.side-nav');\n\t\tthis.flexNav = this.sideNav.find('.flex-nav');\n\t\tthis.arrow = this.sideNav.children('.arrow');\n\t\tthis.setFlex('');\n\t\tthis.arrowBindHover();\n\t\tthis.initiated = true;\n\t\tif (this.openQueue.length > 0) {\n\t\t\tthis.openQueue.forEach((item) => {\n\t\t\t\tthis.setFlex(item.config.template, item.config.data);\n\t\t\t\treturn this.openFlex(item.callback);\n\t\t\t});\n\t\t\treturn this.openQueue = [];\n\t\t}\n\t}\n\tgetSideNav() {\n\t\treturn this.sideNav;\n\t}\n};\n","this.t = function(key, ...replaces) {\n\tif (_.isObject(replaces[0])) {\n\t\treturn TAPi18n.__(key, replaces);\n\t} else {\n\t\treturn TAPi18n.__(key, {\n\t\t\tpostProcess: 'sprintf',\n\t\t\tsprintf: replaces\n\t\t});\n\t}\n};\n\nthis.tr = function(key, options, ...replaces) {\n\tif (_.isObject(replaces[0])) {\n\t\treturn TAPi18n.__(key, options, replaces);\n\t} else {\n\t\treturn TAPi18n.__(key, options, {\n\t\t\tpostProcess: 'sprintf',\n\t\t\tsprintf: replaces\n\t\t});\n\t}\n};\n\nthis.isRtl = (language) => language != null && ['ar', 'dv', 'fa', 'he', 'ku', 'ps', 'sd', 'ug', 'ur', 'yi'].includes(language.split('-').shift().toLowerCase());\n","(function($) {\n\t/**\n\t * Auto-growing textareas; technique ripped from Facebook\n\t *\n\t *\n\t * http://github.com/jaz303/jquery-grab-bag/tree/master/javascripts/jquery.autogrow-textarea.js\n\t */\n\t$.fn.autogrow = function(options) {\n\t\treturn this.filter('textarea').each(function() {\n\t\t\tvar self = this;\n\t\t\tvar $self = $(self);\n\t\t\tvar minHeight = $self.height();\n\t\t\tvar noFlickerPad = $self.hasClass('autogrow-short') ? 0 : parseInt($self.css('lineHeight')) || 0;\n\t\t\tvar settings = $.extend({\n\t\t\t\tpreGrowCallback: null,\n\t\t\t\tpostGrowCallback: null\n\t\t\t}, options);\n\n\t\t\tvar shadow = $(\"div.autogrow-shadow\");\n\t\t\tif (!shadow.length) {\n\t\t\t\tshadow = $('<div></div>').addClass(\"autogrow-shadow\").appendTo(document.body);\n\t\t\t}\n\n\t\t\tshadow.css({\n\t\t\t\twidth: $self.width(),\n\t\t\t\tfontSize: $self.css('fontSize'),\n\t\t\t\tfontFamily: $self.css('fontFamily'),\n\t\t\t\tfontWeight: $self.css('fontWeight'),\n\t\t\t\tlineHeight: $self.css('lineHeight'),\n\t\t\t\tresize: 'none',\n\t\t\t\twordWrap: 'break-word'\n\t\t\t});\n\n\t\t\tvar update = function(event) {\n\t\t\t\tvar times = function(string, number) {\n\t\t\t\t\tfor (var i = 0, r = ''; i < number; i++) r += string;\n\t\t\t\t\treturn r;\n\t\t\t\t};\n\n\t\t\t\tvar val = self.value.replace(/</g, '&lt;')\n\t\t\t\t\t.replace(/>/g, '&gt;')\n\t\t\t\t\t.replace(/&/g, '&amp;')\n\t\t\t\t\t.replace(/\\n$/, '<br/>&nbsp;')\n\t\t\t\t\t.replace(/\\n/g, '<br/>')\n\t\t\t\t\t.replace(/ {2,}/g, function(space) {\n\t\t\t\t\t\treturn times('&nbsp;', space.length - 1) + ' ';\n\t\t\t\t\t});\n\n\t\t\t\t// Did enter get pressed?  Resize in this keydown event so that the flicker doesn't occur.\n\t\t\t\tif (event && event.data && event.data.event === 'keydown' && event.keyCode === 13 && (event.shiftKey || event.ctrlKey || event.altKey)) {\n\t\t\t\t\tval += '<br />';\n\t\t\t\t}\n\n\t\t\t\tshadow.css('width', $self.width());\n\t\t\t\tshadow.html(val + (noFlickerPad === 0 ? '...' : '')); // Append '...' to resize pre-emptively.\n\n\t\t\t\tvar newHeight = Math.max(shadow.height() + noFlickerPad + 1, minHeight);\n\t\t\t\tif (settings.preGrowCallback !== null) {\n\t\t\t\t\tnewHeight = settings.preGrowCallback($self, shadow, newHeight, minHeight);\n\t\t\t\t}\n\n\t\t\t\t$self.height(newHeight);\n\n\t\t\t\tif (settings.postGrowCallback !== null) {\n\t\t\t\t\tsettings.postGrowCallback($self);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t$self.change(update).keyup(update).keydown({\n\t\t\t\tevent: 'keydown'\n\t\t\t}, update);\n\t\t\t$(window).resize(update);\n\n\t\t\tupdate();\n\t\t\tself.updateAutogrow = update;\n\t\t});\n\t};\n})(jQuery);\n","import './codeMirrorComponent.html';\nimport './codeMirrorComponent.js';\n\nimport 'codemirror/addon/fold/brace-fold.js';\nimport 'codemirror/addon/fold/comment-fold.js';\nimport 'codemirror/addon/fold/foldcode.js';\nimport 'codemirror/addon/fold/foldgutter.css';\nimport 'codemirror/addon/fold/foldgutter.js';\nimport 'codemirror/addon/fold/indent-fold.js';\nimport 'codemirror/addon/fold/markdown-fold.js';\nimport 'codemirror/addon/fold/xml-fold.js';\n\n// lints\n// import 'codemirror/addon/lint/jsonlint.js';\n// import 'codemirror/addon/lint/jshint.js';\n// import 'codemirror/addon/lint/csslint.js';\n// import 'codemirror/addon/lint/css-lint.js';\n// import 'codemirror/addon/lint/html-lint.js';\n// import 'codemirror/addon/lint/javascript-lint.js';\n// import 'codemirror/addon/lint/json-lint.js';\n// import 'codemirror/addon/lint/yaml-lint.js';\n// import 'codemirror/addon/lint/lint.css';\n// import 'codemirror/addon/lint/lint.js';\n\n// active line mode\nimport 'codemirror/addon/selection/active-line.js';\n\n// search/replace\nimport 'codemirror/addon/search/search.js';\nimport 'codemirror/addon/search/searchcursor.js';\nimport 'codemirror/addon/dialog/dialog.js';\nimport 'codemirror/addon/dialog/dialog.css';\n\n// overlay: required by `gfm.js`\nimport 'codemirror/addon/mode/overlay.js';\n\n// markdown list continuation; nice complement for gfm\nimport 'codemirror/addon/edit/continuelist.js';\n\n// modes\nimport 'codemirror/mode/apl/apl.js';\nimport 'codemirror/mode/asterisk/asterisk.js';\nimport 'codemirror/mode/clike/clike.js';\nimport 'codemirror/mode/clojure/clojure.js';\nimport 'codemirror/mode/cobol/cobol.js';\nimport 'codemirror/mode/commonlisp/commonlisp.js';\nimport 'codemirror/mode/coffeescript/coffeescript.js';\nimport 'codemirror/mode/css/css.js';\nimport 'codemirror/mode/cypher/cypher.js';\nimport 'codemirror/mode/d/d.js';\nimport 'codemirror/mode/diff/diff.js';\nimport 'codemirror/mode/django/django.js';\nimport 'codemirror/mode/dockerfile/dockerfile.js';\nimport 'codemirror/mode/dtd/dtd.js';\nimport 'codemirror/mode/dylan/dylan.js';\nimport 'codemirror/mode/ecl/ecl.js';\nimport 'codemirror/mode/eiffel/eiffel.js';\nimport 'codemirror/mode/erlang/erlang.js';\nimport 'codemirror/mode/fortran/fortran.js';\nimport 'codemirror/mode/gas/gas.js';\nimport 'codemirror/mode/gfm/gfm.js';\nimport 'codemirror/mode/gherkin/gherkin.js';\nimport 'codemirror/mode/go/go.js';\nimport 'codemirror/mode/groovy/groovy.js';\nimport 'codemirror/mode/haml/haml.js';\nimport 'codemirror/mode/haskell/haskell.js';\nimport 'codemirror/mode/haxe/haxe.js';\nimport 'codemirror/mode/htmlembedded/htmlembedded.js';\nimport 'codemirror/mode/htmlmixed/htmlmixed.js';\nimport 'codemirror/mode/http/http.js';\nimport 'codemirror/mode/idl/idl.js';\nimport 'codemirror/mode/javascript/javascript.js';\nimport 'codemirror/mode/jinja2/jinja2.js';\nimport 'codemirror/mode/julia/julia.js';\nimport 'codemirror/mode/livescript/livescript.js';\nimport 'codemirror/mode/lua/lua.js';\nimport 'codemirror/mode/markdown/markdown.js';\nimport 'codemirror/mode/mirc/mirc.js';\nimport 'codemirror/mode/mllike/mllike.js';\nimport 'codemirror/mode/modelica/modelica.js';\nimport 'codemirror/mode/nginx/nginx.js';\nimport 'codemirror/mode/ntriples/ntriples.js';\nimport 'codemirror/mode/octave/octave.js';\nimport 'codemirror/mode/pascal/pascal.js';\nimport 'codemirror/mode/pegjs/pegjs.js';\nimport 'codemirror/mode/perl/perl.js';\nimport 'codemirror/mode/php/php.js';\nimport 'codemirror/mode/pig/pig.js';\nimport 'codemirror/mode/properties/properties.js';\nimport 'codemirror/mode/puppet/puppet.js';\nimport 'codemirror/mode/python/python.js';\nimport 'codemirror/mode/q/q.js';\nimport 'codemirror/mode/r/r.js';\nimport 'codemirror/mode/rpm/rpm.js';\nimport 'codemirror/mode/rst/rst.js';\nimport 'codemirror/mode/ruby/ruby.js';\nimport 'codemirror/mode/rust/rust.js';\nimport 'codemirror/mode/sass/sass.js';\nimport 'codemirror/mode/scheme/scheme.js';\nimport 'codemirror/mode/shell/shell.js';\nimport 'codemirror/mode/sieve/sieve.js';\nimport 'codemirror/mode/slim/slim.js';\nimport 'codemirror/mode/smalltalk/smalltalk.js';\nimport 'codemirror/mode/smarty/smarty.js';\nimport 'codemirror/mode/solr/solr.js';\nimport 'codemirror/mode/sparql/sparql.js';\nimport 'codemirror/mode/sql/sql.js';\nimport 'codemirror/mode/stex/stex.js';\nimport 'codemirror/mode/tcl/tcl.js';\nimport 'codemirror/mode/textile/textile.js';\nimport 'codemirror/mode/tiddlywiki/tiddlywiki.js';\nimport 'codemirror/mode/tiki/tiki.js';\nimport 'codemirror/mode/toml/toml.js';\nimport 'codemirror/mode/tornado/tornado.js';\nimport 'codemirror/mode/turtle/turtle.js';\nimport 'codemirror/mode/vb/vb.js';\nimport 'codemirror/mode/vbscript/vbscript.js';\nimport 'codemirror/mode/velocity/velocity.js';\nimport 'codemirror/mode/verilog/verilog.js';\nimport 'codemirror/mode/xml/xml.js';\nimport 'codemirror/mode/xquery/xquery.js';\nimport 'codemirror/mode/yaml/yaml.js';\nimport 'codemirror/mode/z80/z80.js';\n\n// themes\n// import 'codemirror/theme/3024-day.css';\n// import 'codemirror/theme/3024-night.css';\n// import 'codemirror/theme/ambiance-mobile.css';\n// import 'codemirror/theme/ambiance.css';\n// import 'codemirror/theme/base16-dark.css';\n// import 'codemirror/theme/base16-light.css';\n// import 'codemirror/theme/blackboard.css';\n// import 'codemirror/theme/cobalt.css';\n// import 'codemirror/theme/eclipse.css';\n// import 'codemirror/theme/elegant.css';\n// import 'codemirror/theme/erlang-dark.css';\n// import 'codemirror/theme/lesser-dark.css';\n// import 'codemirror/theme/mbo.css';\n// import 'codemirror/theme/mdn-like.css';\n// import 'codemirror/theme/midnight.css';\n// import 'codemirror/theme/monokai.css';\n// import 'codemirror/theme/neat.css';\n// import 'codemirror/theme/neo.css';\n// import 'codemirror/theme/night.css';\n// import 'codemirror/theme/paraiso-dark.css';\n// import 'codemirror/theme/paraiso-light.css';\n// import 'codemirror/theme/pastel-on-dark.css';\n// import 'codemirror/theme/rubyblue.css';\n// import 'codemirror/theme/solarized.css';\n// import 'codemirror/theme/the-matrix.css';\n// import 'codemirror/theme/tomorrow-night-eighties.css';\n// import 'codemirror/theme/twilight.css';\n// import 'codemirror/theme/vibrant-ink.css';\n// import 'codemirror/theme/xq-dark.css';\n// import 'codemirror/theme/xq-light.css';\n\n// key bindings\n// import 'codemirror/keymap/emacs.js';\nimport 'codemirror/keymap/sublime.js';\n// import 'codemirror/keymap/vim.js';\n","/* global CodeMirrors */\nCodeMirrors = {};\n\nimport 'codemirror/lib/codemirror.css';\nimport CodeMirror from 'codemirror/lib/codemirror.js';\n\nTemplate.CodeMirror.rendered = function() {\n\tconst options = this.data.options || { lineNumbers: true };\n\tconst textarea = this.find('textarea');\n\tconst editor = CodeMirror.fromTextArea(textarea, options);\n\n\tCodeMirrors[this.data.id || 'code-mirror-textarea'] = editor;\n\n\tconst self = this;\n\teditor.on('change', function(doc) {\n\t\tconst val = doc.getValue();\n\t\ttextarea.value = val;\n\t\tif (self.data.reactiveVar) {\n\t\t\tSession.set(self.data.reactiveVar, val);\n\t\t}\n\t});\n\n\tif (this.data.reactiveVar) {\n\t\tthis.autorun(function() {\n\t\t\tconst val = Session.get(self.data.reactiveVar) || '';\n\t\t\tif (val !== editor.getValue()) {\n\t\t\t\teditor.setValue(val);\n\t\t\t}\n\t\t});\n\t}\n\n\tMeteor.defer(function() {\n\t\teditor.refresh();\n\t});\n};\n\nTemplate.CodeMirror.destroyed = function() {\n\tdelete CodeMirrors[this.data.id || 'code-mirror-textarea'];\n\tthis.$(`#${ this.data.id || 'code-mirror-textarea' }`).next('.CodeMirror').remove();\n};\n\nTemplate.CodeMirror.helpers({\n\teditorId() {\n\t\treturn this.id || 'code-mirror-textarea';\n\t},\n\n\teditorName() {\n\t\treturn this.name || 'code-mirror-textarea';\n\t}\n});\n","/* globals facebookConnectPlugin Facebook*/\nMeteor.loginWithFacebookCordova = function(options, callback) {\n\tif (!callback && typeof options === 'function') {\n\t\tcallback = options;\n\t\toptions = null;\n\t}\n\tconst credentialRequestCompleteCallback = Accounts.oauth.credentialRequestCompleteHandler(callback);\n\tconst fbLoginSuccess = function(data) {\n\t\tdata.cordova = true;\n\t\treturn Accounts.callLoginMethod({\n\t\t\tmethodArguments: [data],\n\t\t\tuserCallback: callback\n\t\t});\n\t};\n\tif (typeof facebookConnectPlugin !== 'undefined') {\n\t\treturn facebookConnectPlugin.getLoginStatus(function(response) {\n\t\t\tif (response.status !== 'connected') {\n\t\t\t\treturn facebookConnectPlugin.login(['public_profile', 'email'], fbLoginSuccess, function(error) {\n\t\t\t\t\tconsole.log('login', JSON.stringify(error), error);\n\t\t\t\t\treturn callback(error);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn fbLoginSuccess(response);\n\t\t\t}\n\t\t}, function(error) {\n\t\t\tconsole.log('getLoginStatus', JSON.stringify(error), error);\n\t\t\treturn callback(error);\n\t\t});\n\t}\n\treturn Facebook.requestCredential(options, credentialRequestCompleteCallback);\n};\n","/* globals device cordova*/\nif (Meteor.isCordova) {\n\tconst body = $(document.body);\n\tdocument.addEventListener('deviceready', function() {\n\t\tif (typeof device !== 'undefined' && device !== null && device.platform.toLowerCase() !== 'android') {\n\t\t\tcordova.plugins.Keyboard.hideKeyboardAccessoryBar(true);\n\t\t\treturn cordova.plugins.Keyboard.disableScroll(true);\n\t\t}\n\t});\n\twindow.addEventListener('native.keyboardshow', function() {\n\t\tif (typeof device !== 'undefined' && device !== null && device.platform.toLowerCase() !== 'android') {\n\t\t\tif (Meteor.userId() != null) {\n\t\t\t\t$('.main-content').css('height', window.innerHeight);\n\t\t\t\t$('.sweet-alert').css('transform', `translateY(-${ (document.height - window.innerHeight) / 2 }px)`).css('-webkit-transform', `translateY(-${ (document.height - window.innerHeight) / 2 }px)`);\n\t\t\t} else {\n\t\t\t\tbody.css('height', window.innerHeight);\n\t\t\t\tbody.css('overflow', 'scroll');\n\t\t\t}\n\t\t}\n\t});\n\twindow.addEventListener('native.keyboardhide', function() {\n\t\tif (typeof device !== 'undefined' && device !== null && device.platform.toLowerCase() !== 'android') {\n\t\t\tif (Meteor.userId() != null) {\n\t\t\t\t$('.main-content').css('height', window.innerHeight);\n\t\t\t\t$('.sweet-alert').css('transform', '').css('-webkit-transform', '');\n\t\t\t} else {\n\t\t\t\tbody.css('height', window.innerHeight);\n\t\t\t\tbody.css('overflow', 'visible');\n\t\t\t}\n\t\t}\n\t});\n}\n","if Meteor.isCordova\n\t# Push.addListener 'token', (token) ->\n\t# \tMeteor.call 'log', 'CLIENT', 'token', arguments\n\n\t# Push.addListener 'error', (err) ->\n\t# \tMeteor.call 'log', 'CLIENT', 'error', arguments\n\t# \tif err.type == 'apn.cordova'\n\t# \t\tMeteor.call 'log', 'CLIENT', err.error\n\n\t# Push.addListener 'register', (evt) ->\n\t# \tMeteor.call 'log', 'CLIENT', 'register', arguments\n\n\t# Push.addListener 'alert', (notification) ->\n\t# \tMeteor.call 'log', 'CLIENT', 'alert', arguments\n\n\t# Push.addListener 'sound', (notification) ->\n\t# \tMeteor.call 'log', 'CLIENT', 'sound', arguments\n\n\t# Push.addListener 'badge', (notification) ->\n\t# \tMeteor.call 'log', 'CLIENT', 'badge', arguments\n\n\t# Push.addListener 'message', (notification) ->\n\t# \tMeteor.call 'log', 'CLIENT', 'message', arguments\n\n\tPush.addListener 'startup', (notification) ->\n\t\t# Meteor.call 'log', 'CLIENT', 'startup', arguments\n\n\t\tif notification.payload?.rid?\n\t\t\tif notification.payload.host is Meteor.absoluteUrl()\n\t\t\t\tswitch notification.payload.type\n\t\t\t\t\twhen 'c'\n\t\t\t\t\t\tFlowRouter.go 'channel', { name: notification.payload.name }, FlowRouter.current().queryParams\n\t\t\t\t\twhen 'p'\n\t\t\t\t\t\tFlowRouter.go 'group', { name: notification.payload.name }, FlowRouter.current().queryParams\n\t\t\t\t\twhen 'd'\n\t\t\t\t\t\tFlowRouter.go 'direct', { username: notification.payload.sender.username }, FlowRouter.current().queryParams\n\t\t\telse\n\t\t\t\tpath = ''\n\t\t\t\tswitch notification.payload.type\n\t\t\t\t\twhen 'c'\n\t\t\t\t\t\tpath = 'channel/' + notification.payload.name\n\t\t\t\t\twhen 'p'\n\t\t\t\t\t\tpath = 'group/' + notification.payload.name\n\t\t\t\t\twhen 'd'\n\t\t\t\t\t\tpath = 'direct/' + notification.payload.sender.username\n\n\t\t\t\thost = notification.payload.host.replace /\\/$/, ''\n\t\t\t\tif Servers.serverExists(host) isnt true\n\t\t\t\t\treturn\n\n\t\t\t\tServers.startServer host, path, (err, url) ->\n\t\t\t\t\tif err?\n\t\t\t\t\t\t# TODO err\n\t\t\t\t\t\treturn console.log err\n\n\n\tMeteor.startup ->\n\t\tTracker.autorun ->\n\t\t\tif RocketChat.settings.get('Push_enable') is true\n\n\t\t\t\tPush.Configure\n\t\t\t\t\tandroid:\n\t\t\t\t\t\tsenderID: window.ANDROID_SENDER_ID\n\t\t\t\t\t\tsound: true\n\t\t\t\t\t\tvibrate: true\n\t\t\t\t\tios:\n\t\t\t\t\t\tbadge: true\n\t\t\t\t\t\tclearBadge: true\n\t\t\t\t\t\tsound: true\n\t\t\t\t\t\talert: true\n","if (Meteor.isCordova) {\n  Push.addListener('startup', function(notification) {\n    var host, path, ref;\n    if (((ref = notification.payload) != null ? ref.rid : void 0) != null) {\n      if (notification.payload.host === Meteor.absoluteUrl()) {\n        switch (notification.payload.type) {\n          case 'c':\n            return FlowRouter.go('channel', {\n              name: notification.payload.name\n            }, FlowRouter.current().queryParams);\n          case 'p':\n            return FlowRouter.go('group', {\n              name: notification.payload.name\n            }, FlowRouter.current().queryParams);\n          case 'd':\n            return FlowRouter.go('direct', {\n              username: notification.payload.sender.username\n            }, FlowRouter.current().queryParams);\n        }\n      } else {\n        path = '';\n        switch (notification.payload.type) {\n          case 'c':\n            path = 'channel/' + notification.payload.name;\n            break;\n          case 'p':\n            path = 'group/' + notification.payload.name;\n            break;\n          case 'd':\n            path = 'direct/' + notification.payload.sender.username;\n        }\n        host = notification.payload.host.replace(/\\/$/, '');\n        if (Servers.serverExists(host) !== true) {\n          return;\n        }\n        return Servers.startServer(host, path, function(err, url) {\n          if (err != null) {\n            return console.log(err);\n          }\n        });\n      }\n    }\n  });\n  Meteor.startup(function() {\n    return Tracker.autorun(function() {\n      if (RocketChat.settings.get('Push_enable') === true) {\n        return Push.Configure({\n          android: {\n            senderID: window.ANDROID_SENDER_ID,\n            sound: true,\n            vibrate: true\n          },\n          ios: {\n            badge: true,\n            clearBadge: true,\n            sound: true,\n            alert: true\n          }\n        });\n      }\n    });\n  });\n}\n","Meteor.startup ->\n\treturn unless Meteor.isCordova\n\n\t# Handle click events for all external URLs\n\t$(document).on 'deviceready', ->\n\t\tplatform = device.platform.toLowerCase()\n\t\t$(document).on 'click', (e) ->\n\t\t\t$link = $(e.target).closest('a[href]')\n\t\t\treturn unless $link.length > 0\n\t\t\turl = $link.attr('href')\n\n\t\t\tif /^https?:\\/\\/.+/.test(url) is true\n\t\t\t\twindow.open url, '_system'\n\t\t\t\te.preventDefault()\n","Meteor.startup(function() {\n  if (!Meteor.isCordova) {\n    return;\n  }\n  return $(document).on('deviceready', function() {\n    var platform;\n    platform = device.platform.toLowerCase();\n    return $(document).on('click', function(e) {\n      var $link, url;\n      $link = $(e.target).closest('a[href]');\n      if (!($link.length > 0)) {\n        return;\n      }\n      url = $link.attr('href');\n      if (/^https?:\\/\\/.+/.test(url) === true) {\n        window.open(url, '_system');\n        return e.preventDefault();\n      }\n    });\n  });\n});\n","/* globals UserPresence, readMessage */\n\nlet timer = undefined;\nif (Meteor.isCordova) {\n\tdocument.addEventListener('pause', () => {\n\t\tUserPresence.setAway();\n\t\treadMessage.disable();\n\n\t\t//Only disconnect after one minute of being in the background\n\t\ttimer = setTimeout(() => {\n\t\t\tMeteor.disconnect();\n\t\t\ttimer = undefined;\n\t\t}, 60000);\n\t}, true);\n\n\tdocument.addEventListener('resume', () => {\n\t\tif (!_.isUndefined(timer)) {\n\t\t\tclearTimeout(timer);\n\t\t}\n\n\t\tMeteor.reconnect();\n\t\tUserPresence.setOnline();\n\t\treadMessage.enable();\n\t}, true);\n}\n","@AudioRecorder = new class\n\tstart: (cb) ->\n\t\twindow.AudioContext = window.AudioContext or window.webkitAudioContext\n\t\tnavigator.getUserMedia = navigator.getUserMedia or navigator.webkitGetUserMedia\n\t\twindow.URL = window.URL or window.webkitURL\n\n\t\twindow.audioContext = new AudioContext\n\n\t\tok = (stream) =>\n\t\t\t@startUserMedia(stream)\n\t\t\tcb?.call(@)\n\n\t\tif not navigator.getUserMedia?\n\t\t\treturn cb false\n\n\t\tnavigator.getUserMedia {audio: true}, ok, (e) ->\n\t\t\tconsole.log('No live audio input: ' + e)\n\n\tstartUserMedia: (stream) ->\n\t\t@stream = stream\n\t\tinput = window.audioContext.createMediaStreamSource(stream)\n\t\t@recorder = new Recorder(input, {workerPath: '/recorderWorker.js'})\n\t\t@recorder.record()\n\n\tstop: (cb) ->\n\t\t@recorder.stop()\n\n\t\tif cb?\n\t\t\t@getBlob cb\n\n\t\t@stream.getAudioTracks()[0].stop()\n\n\t\t@recorder.clear()\n\n\t\twindow.audioContext.close()\n\t\tdelete window.audioContext\n\t\tdelete @recorder\n\t\tdelete @stream\n\n\tgetBlob: (cb) ->\n\t\t@recorder.exportWAV cb\n","this.AudioRecorder = new ((function() {\n  function _Class() {}\n\n  _Class.prototype.start = function(cb) {\n    var ok;\n    window.AudioContext = window.AudioContext || window.webkitAudioContext;\n    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia;\n    window.URL = window.URL || window.webkitURL;\n    window.audioContext = new AudioContext;\n    ok = (function(_this) {\n      return function(stream) {\n        _this.startUserMedia(stream);\n        return cb != null ? cb.call(_this) : void 0;\n      };\n    })(this);\n    if (navigator.getUserMedia == null) {\n      return cb(false);\n    }\n    return navigator.getUserMedia({\n      audio: true\n    }, ok, function(e) {\n      return console.log('No live audio input: ' + e);\n    });\n  };\n\n  _Class.prototype.startUserMedia = function(stream) {\n    var input;\n    this.stream = stream;\n    input = window.audioContext.createMediaStreamSource(stream);\n    this.recorder = new Recorder(input, {\n      workerPath: '/recorderWorker.js'\n    });\n    return this.recorder.record();\n  };\n\n  _Class.prototype.stop = function(cb) {\n    this.recorder.stop();\n    if (cb != null) {\n      this.getBlob(cb);\n    }\n    this.stream.getAudioTracks()[0].stop();\n    this.recorder.clear();\n    window.audioContext.close();\n    delete window.audioContext;\n    delete this.recorder;\n    return delete this.stream;\n  };\n\n  _Class.prototype.getBlob = function(cb) {\n    return this.recorder.exportWAV(cb);\n  };\n\n  return _Class;\n\n})());\n","@VideoRecorder = new class\n\tstarted: false\n\tcameraStarted: new ReactiveVar false\n\trecording: new ReactiveVar false\n\trecordingAvailable: new ReactiveVar false\n\n\tstart: (videoel, cb) ->\n\t\tnavigator.getUserMedia = navigator.getUserMedia or navigator.webkitGetUserMedia or navigator.mozGetUserMedia\n\t\twindow.URL = window.URL or window.webkitURL\n\n\t\t@videoel = videoel\n\t\tok = (stream) =>\n\t\t\t@startUserMedia(stream)\n\t\t\tcb?.call(@)\n\n\t\tif not navigator.getUserMedia?\n\t\t\treturn cb false\n\n\t\tnavigator.getUserMedia {audio: true, video: true}, ok, (e) ->\n\t\t\tconsole.log('No live video input: ' + e)\n\n\trecord: ->\n\t\t@chunks = []\n\t\tif not @stream?\n\t\t\treturn\n\t\t@mediaRecorder = new MediaRecorder(@stream)\n\t\t@mediaRecorder.stream = @stream\n\t\t@mediaRecorder.mimeType = 'video/webm'\n\t\t@mediaRecorder.ondataavailable = (blobev) =>\n\t\t\t@chunks.push(blobev.data)\n\t\t\tif not @recordingAvailable.get()\n\t\t\t\t@recordingAvailable.set true\n\t\t@mediaRecorder.start()\n\t\t@recording.set true\n\n\tstartUserMedia: (stream) ->\n\t\t@stream = stream\n\t\t@videoel.src = URL.createObjectURL(stream)\n\t\t@videoel.onloadedmetadata = (e) =>\n\t\t\t@videoel.play()\n\n\t\t@started = true\n\t\t@cameraStarted.set true\n\n\tstop: (cb) ->\n\t\tif @started\n\t\t\t@stopRecording()\n\n\t\t\tif @stream?\n\t\t\t\tvtracks = @stream.getVideoTracks()\n\t\t\t\tfor vtrack in vtracks\n\t\t\t\t\tvtrack.stop()\n\n\t\t\t\tatracks = @stream.getAudioTracks()\n\t\t\t\tfor atrack in atracks\n\t\t\t\t\tatrack.stop()\n\n\t\t\tif @videoel?\n\t\t\t\t@videoel.pause\n\t\t\t\t@videoel.src = ''\n\n\t\t\t@started = false\n\t\t\t@cameraStarted.set false\n\t\t\t@recordingAvailable.set false\n\n\t\t\tif cb? and @chunks?\n\t\t\t\tblob = new Blob(@chunks, { 'type' :  'video/webm' })\n\t\t\t\tcb(blob)\n\n\t\t\tdelete @recorder\n\t\t\tdelete @stream\n\t\t\tdelete @videoel\n\n\tstopRecording: ->\n\t\tif @started and @recording and @mediaRecorder?\n\t\t\t@mediaRecorder.stop()\n\t\t\t@recording.set false\n\t\t\tdelete @mediaRecorder\n","this.VideoRecorder = new ((function() {\n  function _Class() {}\n\n  _Class.prototype.started = false;\n\n  _Class.prototype.cameraStarted = new ReactiveVar(false);\n\n  _Class.prototype.recording = new ReactiveVar(false);\n\n  _Class.prototype.recordingAvailable = new ReactiveVar(false);\n\n  _Class.prototype.start = function(videoel, cb) {\n    var ok;\n    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;\n    window.URL = window.URL || window.webkitURL;\n    this.videoel = videoel;\n    ok = (function(_this) {\n      return function(stream) {\n        _this.startUserMedia(stream);\n        return cb != null ? cb.call(_this) : void 0;\n      };\n    })(this);\n    if (navigator.getUserMedia == null) {\n      return cb(false);\n    }\n    return navigator.getUserMedia({\n      audio: true,\n      video: true\n    }, ok, function(e) {\n      return console.log('No live video input: ' + e);\n    });\n  };\n\n  _Class.prototype.record = function() {\n    this.chunks = [];\n    if (this.stream == null) {\n      return;\n    }\n    this.mediaRecorder = new MediaRecorder(this.stream);\n    this.mediaRecorder.stream = this.stream;\n    this.mediaRecorder.mimeType = 'video/webm';\n    this.mediaRecorder.ondataavailable = (function(_this) {\n      return function(blobev) {\n        _this.chunks.push(blobev.data);\n        if (!_this.recordingAvailable.get()) {\n          return _this.recordingAvailable.set(true);\n        }\n      };\n    })(this);\n    this.mediaRecorder.start();\n    return this.recording.set(true);\n  };\n\n  _Class.prototype.startUserMedia = function(stream) {\n    this.stream = stream;\n    this.videoel.src = URL.createObjectURL(stream);\n    this.videoel.onloadedmetadata = (function(_this) {\n      return function(e) {\n        return _this.videoel.play();\n      };\n    })(this);\n    this.started = true;\n    return this.cameraStarted.set(true);\n  };\n\n  _Class.prototype.stop = function(cb) {\n    var atrack, atracks, blob, i, j, len, len1, vtrack, vtracks;\n    if (this.started) {\n      this.stopRecording();\n      if (this.stream != null) {\n        vtracks = this.stream.getVideoTracks();\n        for (i = 0, len = vtracks.length; i < len; i++) {\n          vtrack = vtracks[i];\n          vtrack.stop();\n        }\n        atracks = this.stream.getAudioTracks();\n        for (j = 0, len1 = atracks.length; j < len1; j++) {\n          atrack = atracks[j];\n          atrack.stop();\n        }\n      }\n      if (this.videoel != null) {\n        this.videoel.pause;\n        this.videoel.src = '';\n      }\n      this.started = false;\n      this.cameraStarted.set(false);\n      this.recordingAvailable.set(false);\n      if ((cb != null) && (this.chunks != null)) {\n        blob = new Blob(this.chunks, {\n          'type': 'video/webm'\n        });\n        cb(blob);\n      }\n      delete this.recorder;\n      delete this.stream;\n      return delete this.videoel;\n    }\n  };\n\n  _Class.prototype.stopRecording = function() {\n    if (this.started && this.recording && (this.mediaRecorder != null)) {\n      this.mediaRecorder.stop();\n      this.recording.set(false);\n      return delete this.mediaRecorder;\n    }\n  };\n\n  return _Class;\n\n})());\n","(function(window){\n\n  var WORKER_PATH = 'recorderWorker.js';\n\n  var Recorder = function(source, cfg){\n    var config = cfg || {};\n    var bufferLen = config.bufferLen || 4096;\n    var numChannels = config.numChannels || 2;\n    this.context = source.context;\n    this.node = (this.context.createScriptProcessor ||\n                 this.context.createJavaScriptNode).call(this.context,\n                 bufferLen, numChannels, numChannels);\n    var worker = new Worker(config.workerPath || WORKER_PATH);\n    worker.postMessage({\n      command: 'init',\n      config: {\n        sampleRate: this.context.sampleRate,\n        numChannels: numChannels\n      }\n    });\n    var recording = false,\n      currCallback;\n\n    this.node.onaudioprocess = function(e){\n      if (!recording) return;\n      var buffer = [];\n      for (var channel = 0; channel < numChannels; channel++){\n          buffer.push(e.inputBuffer.getChannelData(channel));\n      }\n      worker.postMessage({\n        command: 'record',\n        buffer: buffer\n      });\n    }\n\n    this.configure = function(cfg){\n      for (var prop in cfg){\n        if (cfg.hasOwnProperty(prop)){\n          config[prop] = cfg[prop];\n        }\n      }\n    }\n\n    this.record = function(){\n      recording = true;\n    }\n\n    this.stop = function(){\n      recording = false;\n    }\n\n    this.clear = function(){\n      worker.postMessage({ command: 'clear' });\n    }\n\n    this.getBuffer = function(cb) {\n      currCallback = cb || config.callback;\n      worker.postMessage({ command: 'getBuffer' })\n    }\n\n    this.exportWAV = function(cb, type){\n      currCallback = cb || config.callback;\n      type = type || config.type || 'audio/wav';\n      if (!currCallback) throw new Error('Callback not set');\n      worker.postMessage({\n        command: 'exportWAV',\n        type: type\n      });\n    }\n\n    worker.onmessage = function(e){\n      var blob = e.data;\n      currCallback(blob);\n    }\n\n    source.connect(this.node);\n    this.node.connect(this.context.destination);    //this should not be necessary\n  };\n\n  Recorder.forceDownload = function(blob, filename){\n    var url = (window.URL || window.webkitURL).createObjectURL(blob);\n    var link = window.document.createElement('a');\n    link.href = url;\n    link.download = filename || 'output.wav';\n    var click = document.createEvent(\"Event\");\n    click.initEvent(\"click\", true, true);\n    link.dispatchEvent(click);\n  }\n\n  window.Recorder = Recorder;\n\n})(window);","// Adapted from http://stackoverflow.com/a/499158\n\n$.fn.setCursorPosition = function(pos) {\n\tthis.each(function(index, elem) {\n\t\tconst p = pos < 0 ? elem.value.length - pos : pos;\n\t\tif (elem.setSelectionRange) {\n\t\t\telem.setSelectionRange(p, p);\n\t\t} else if (elem.createTextRange) {\n\t\t\tconst range = elem.createTextRange();\n\t\t\trange.collapse(true);\n\t\t\trange.moveEnd('character', p);\n\t\t\trange.moveStart('character', p);\n\t\t\trange.select();\n\t\t}\n\t});\n\treturn this;\n};\n","const escapify = {\n\tinit() {\n\t\tconst that = this;\n\t\tdocument.addEventListener('keyup', (event) => {\n\t\t\tconst keyName = event.key;\n\t\t\tif (keyName === 'Escape') {\n\t\t\t\tthat.sideNavIcon();\n\t\t\t\tthat.flextTabButton();\n\t\t\t\tthat.videoDialog();\n\t\t\t\tthat.sweetAlerts();\n\t\t\t}\n\t\t}, false);\n\t},\n\n\tgetClickEvent() {\n\t\treturn new MouseEvent('click', {\n\t\t\tbubbles: true,\n\t\t\tcancelable: true,\n\t\t\tview: window\n\t\t});\n\t},\n\n\tflextTabButton() {\n\t\tconst flextTabButton = document.querySelector('.flex-tab-bar .tab-button.active');\n\t\tif (flextTabButton) {\n\t\t\tflextTabButton.dispatchEvent(this.getClickEvent());\n\t\t\treturn;\n\t\t}\n\t},\n\n\tsideNavIcon() {\n\t\tconst sideNavArrow = document.querySelector('.side-nav .arrow');\n\t\tif (sideNavArrow && (sideNavArrow.classList.contains('top') || sideNavArrow.classList.contains('close'))) {\n\t\t\tSideNav.toggleCurrent();\n\t\t\treturn;\n\t\t}\n\t},\n\n\tvideoDialog() {\n\t\tconst vrecDialog = document.querySelector('.vrec-dialog');\n\t\tif (vrecDialog && Number(window.getComputedStyle(vrecDialog).opacity) === 1) {\n\t\t\tVideoRecorder.stop();\n\t\t\tVRecDialog.close();\n\t\t\treturn;\n\t\t}\n\t},\n\n\tsweetAlerts() {\n\t\tconst sweetAlert = document.querySelector('.sweet-alert');\n\t\tif (sweetAlert) {\n\t\t\tdocument.querySelector('.sweet-alert .sa-button-container .cancel').dispatchEvent(this.getClickEvent());\n\t\t\treturn;\n\t\t}\n\t}\n};\n\nthis.escapify = escapify;\nthis.escapify.init();\n","Template.roomNotFound.helpers({\n\tdata() {\n\t\treturn Session.get('roomNotFound');\n\t},\n\tname() {\n\t\treturn Blaze._escape(this.name);\n\t}\n});\n","/* globals WebRTC */\nTemplate.videoButtons.helpers({\n\tvideoAvaliable() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')) != null;\n\t},\n\tvideoActive() {\n\t\tconst {localUrl, remoteItems} = WebRTC.getInstanceByRoomId(Session.get('openedRoom'));\n\t\tconst r = remoteItems.get() || [];\n\t\treturn localUrl.get() != null || r.length > 0;\n\t},\n\tcallInProgress() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).callInProgress.get();\n\t}\n});\n\nTemplate.videoButtons.events({\n\t'click .start-video-call'() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).startCall({\n\t\t\taudio: true,\n\t\t\tvideo: true\n\t\t});\n\t},\n\t'click .start-audio-call'() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).startCall({\n\t\t\taudio: true\n\t\t});\n\t},\n\t'click .join-video-call'() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).joinCall({\n\t\t\taudio: true,\n\t\t\tvideo: true\n\t\t});\n\t},\n\t'click .join-audio-call'() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).joinCall({\n\t\t\taudio: true\n\t\t});\n\t}\n});\n","/* globals WebRTC */\nTemplate.videoCall.onCreated(function() {\n\treturn this.mainVideo = new ReactiveVar('$auto');\n});\n\nTemplate.videoCall.helpers({\n\tvideoAvaliable() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')) != null;\n\t},\n\tvideoActive() {\n\t\tconst webrtc = WebRTC.getInstanceByRoomId(Session.get('openedRoom'));\n\t\tconst overlay = this.overlay != null;\n\t\tif (overlay !== (webrtc != null ? webrtc.overlayEnabled.get() : null)) {\n\t\t\treturn false;\n\t\t}\n\t\tlet { remoteItems } = webrtc;\n\t\tconst { localUrl } = webrtc;\n\t\tremoteItems = remoteItems.get() || [];\n\t\treturn (localUrl.get() != null) || remoteItems.length > 0;\n\t},\n\tcallInProgress() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).callInProgress.get();\n\t},\n\toverlayEnabled() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).overlayEnabled.get();\n\t},\n\taudioEnabled() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).audioEnabled.get();\n\t},\n\tvideoEnabled() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).videoEnabled.get();\n\t},\n\taudioAndVideoEnabled() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).audioEnabled.get() && WebRTC.getInstanceByRoomId(Session.get('openedRoom')).videoEnabled.get();\n\t},\n\tscreenShareAvailable() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).screenShareAvailable;\n\t},\n\tscreenShareEnabled() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).screenShareEnabled.get();\n\t},\n\tremoteVideoItems() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).remoteItems.get();\n\t},\n\tselfVideoUrl() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).localUrl.get();\n\t},\n\tmainVideoUrl() {\n\t\tconst template = Template.instance();\n\t\tconst webrtc = WebRTC.getInstanceByRoomId(Session.get('openedRoom'));\n\t\tif (template.mainVideo.get() === '$self') {\n\t\t\treturn webrtc.localUrl.get();\n\t\t}\n\t\tif (template.mainVideo.get() === '$auto') {\n\t\t\tconst remoteItems = webrtc.remoteItems.get() | [];\n\t\t\tif (remoteItems.length > 0) {\n\t\t\t\treturn remoteItems[0].url;\n\t\t\t}\n\t\t\treturn webrtc.localUrl.get();\n\t\t}\n\t\tif (webrtc.remoteItemsById.get()[template.mainVideo.get()] != null) {\n\t\t\treturn webrtc.remoteItemsById.get()[template.mainVideo.get()].url;\n\t\t} else {\n\t\t\ttemplate.mainVideo.set('$auto');\n\t\t}\n\t},\n\tmainVideoUsername() {\n\t\tconst template = Template.instance();\n\t\tconst webrtc = WebRTC.getInstanceByRoomId(Session.get('openedRoom'));\n\t\tif (template.mainVideo.get() === '$self') {\n\t\t\treturn t('you');\n\t\t}\n\t\tif (template.mainVideo.get() === '$auto') {\n\t\t\tconst remoteItems = webrtc.remoteItems.get() || [];\n\t\t\tif (remoteItems.length > 0) {\n\t\t\t\tconst user = Meteor.users.findOne(remoteItems[0].id);\n\t\t\t\treturn user != null ? user.username : undefined;\n\t\t\t}\n\t\t\treturn t('you');\n\t\t}\n\t\tif (webrtc.remoteItemsById.get()[template.mainVideo.get()] != null) {\n\t\t\tconst user = Meteor.users.findOne(webrtc.remoteItemsById.get()[template.mainVideo.get()].id);\n\t\t\treturn user != null ? user.username : undefined;\n\t\t} else {\n\t\t\ttemplate.mainVideo.set('$auto');\n\t\t}\n\t},\n\tusernameByUserId(userId) {\n\t\tconst user = Meteor.users.findOne(userId);\n\t\treturn user != null ? user.username : undefined;\n\t}\n});\n\nTemplate.videoCall.events({\n\t'click .stop-call'() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).stop();\n\t},\n\t'click .video-item'(e, t) {\n\t\treturn t.mainVideo.set($(e.currentTarget).data('username'));\n\t},\n\t'click .disable-audio'() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).disableAudio();\n\t},\n\t'click .enable-audio'() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).enableAudio();\n\t},\n\t'click .disable-video'() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).disableVideo();\n\t},\n\t'click .enable-video'() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).enableVideo();\n\t},\n\t'click .disable-screen-share'() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).disableScreenShare();\n\t},\n\t'click .enable-screen-share'() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).enableScreenShare();\n\t},\n\t'click .disable-overlay'() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).overlayEnabled.set(false);\n\t},\n\t'click .enable-overlay'() {\n\t\treturn WebRTC.getInstanceByRoomId(Session.get('openedRoom')).overlayEnabled.set(true);\n\t},\n\t'loadstart video[muted]'(e) {\n\t\te.currentTarget.muted = true;\n\t\treturn e.currentTarget.volume = 0;\n\t}\n});\n","Template.burger.helpers({\n\tunread() {\n\t\treturn Session.get('unread');\n\t},\n\tisMenuOpen() {\n\t\tif (Session.equals('isMenuOpen', true)) {\n\t\t\treturn 'menu-opened';\n\t\t}\n\t}\n});\n","Template.home.helpers({\n\ttitle() {\n\t\treturn RocketChat.settings.get('Layout_Home_Title');\n\t},\n\tbody() {\n\t\treturn RocketChat.settings.get('Layout_Home_Body');\n\t}\n});\n","const mobileMessageMenu = {\n\tshow(message, template, e, scope) {\n\t\tif (!window.plugins.actionsheet) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\t'androidTheme': window.plugins.actionsheet.ANDROID_THEMES.THEME_HOLO_LIGHT,\n\t\t\t'buttonLabels': [\n\t\t\t\tTAPi18n.__('Report Abuse')\n\t\t\t],\n\t\t\tandroidEnableCancelButton: true,\n\t\t\taddCancelButtonWithLabel: TAPi18n.__('Cancel')\n\t\t};\n\n\t\tconst buttonActions = [\n\t\t\tmobileMessageMenu.reportAbuse\n\t\t];\n\n\t\tconst buttons = RocketChat.MessageAction.getButtons(message, message.customClass || 'message-mobile');\n\n\t\tfor (let i = 0, len = buttons.length; i < len; i++) {\n\t\t\tif (buttons[i].id === 'delete-message') {\n\t\t\t\toptions.addDestructiveButtonWithLabel = TAPi18n.__(buttons[i].i18nLabel);\n\t\t\t\tbuttonActions.unshift(buttons[i].action);\n\t\t\t} else {\n\t\t\t\tbuttonActions.push(buttons[i].action);\n\t\t\t\toptions.buttonLabels.push(TAPi18n.__(buttons[i].i18nLabel));\n\t\t\t}\n\t\t}\n\n\t\twindow.plugins.actionsheet.show(options, (buttonIndex) => {\n\t\t\tif (buttonActions[buttonIndex - 1] != null) {\n\t\t\t\treturn buttonActions[buttonIndex - 1].call(scope, e, template, message);\n\t\t\t}\n\t\t});\n\n\t},\n\treportAbuse: (e, t, message) => {\n\t\tswal({\n\t\t\ttitle: TAPi18n.__('Report_this_message_question_mark'),\n\t\t\ttext: message.msg,\n\t\t\tinputPlaceholder: TAPi18n.__('Why_do_you_want_to_report_question_mark'),\n\t\t\ttype: 'input',\n\t\t\tshowCancelButton: true,\n\t\t\tconfirmButtonColor: '#DD6B55',\n\t\t\tconfirmButtonText: TAPi18n.__('Report_exclamation_mark'),\n\t\t\tcancelButtonText: TAPi18n.__('Cancel'),\n\t\t\tcloseOnConfirm: false,\n\t\t\thtml: false\n\t\t}, (inputValue) => {\n\t\t\tif (inputValue === false) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (inputValue === '') {\n\t\t\t\tswal.showInputError(TAPi18n.__('You_need_to_write_something'));\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tMeteor.call('reportMessage', message._id, inputValue);\n\n\t\t\tswal({\n\t\t\t\ttitle: TAPi18n.__('Report_sent'),\n\t\t\t\ttext: TAPi18n.__('Thank_you_exclamation_mark '),\n\t\t\t\ttype: 'success',\n\t\t\t\ttimer: 1000,\n\t\t\t\tshowConfirmButton: false\n\t\t\t});\n\t\t});\n\t}\n};\n\nthis.mobileMessageMenu = mobileMessageMenu;\n","import moment from 'moment';\n\nTemplate.privateHistory.helpers({\n\thistory() {\n\t\tconst items = ChatSubscription.find({\n\t\t\tname: {\n\t\t\t\t$regex: Session.get('historyFilter'),\n\t\t\t\t$options: 'i'\n\t\t\t},\n\t\t\tt: {\n\t\t\t\t$in: ['d', 'c', 'p']\n\t\t\t},\n\t\t\tarchived: {\n\t\t\t\t$ne: true\n\t\t\t}\n\t\t}, {\n\t\t\t'sort': {\n\t\t\t\t'ts': -1\n\t\t\t}\n\t\t});\n\t\treturn {\n\t\t\titems,\n\t\t\tlength: items.count()\n\t\t};\n\t},\n\tarchivedHistory() {\n\t\tconst items = ChatSubscription.find({\n\t\t\tname: {\n\t\t\t\t$regex: Session.get('historyFilter'),\n\t\t\t\t$options: 'i'\n\t\t\t},\n\t\t\tt: {\n\t\t\t\t$in: ['d', 'c', 'p']\n\t\t\t},\n\t\t\tarchived: true\n\t\t}, {\n\t\t\t'sort': {\n\t\t\t\t'ts': -1\n\t\t\t}\n\t\t});\n\t\treturn {\n\t\t\titems,\n\t\t\tlength: items.count()\n\t\t};\n\t},\n\troomOf(rid) {\n\t\treturn ChatRoom.findOne(rid);\n\t},\n\ttype() {\n\t\tswitch (this.t) {\n\t\t\tcase 'd':\n\t\t\t\treturn 'icon-at';\n\t\t\tcase 'c':\n\t\t\t\treturn 'icon-hash';\n\t\t\tcase 'p':\n\t\t\t\treturn 'icon-lock';\n\t\t}\n\t},\n\tcreation() {\n\t\treturn moment(this.ts).format('LLL');\n\t},\n\tlastMessage() {\n\t\tif (this.lm) {\n\t\t\treturn moment(this.lm).format('LLL');\n\t\t}\n\t},\n\tpath() {\n\t\tswitch (this.t) {\n\t\t\tcase 'c':\n\t\t\t\treturn FlowRouter.path('channel', {\n\t\t\t\t\tname: this.name\n\t\t\t\t});\n\t\t\tcase 'p':\n\t\t\t\treturn FlowRouter.path('group', {\n\t\t\t\t\tname: this.name\n\t\t\t\t});\n\t\t\tcase 'd':\n\t\t\t\treturn FlowRouter.path('direct', {\n\t\t\t\t\tusername: this.name\n\t\t\t\t});\n\t\t}\n\t}\n});\n\nTemplate.privateHistory.events({\n\t'keydown #history-filter'(event) {\n\t\tif (event.which === 13) {\n\t\t\tevent.stopPropagation();\n\t\t\treturn event.preventDefault();\n\t\t}\n\t},\n\t'keyup #history-filter'(event) {\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\t\treturn Session.set('historyFilter', event.currentTarget.value);\n\t}\n});\n","import moment from 'moment'\nimport mime from 'mime-type/with-db'\nimport {ChartDialog} from 'meteor/lily:ui-chart'\n\nsocialSharing = (options = {}) ->\n\twindow.plugins.socialsharing.share(options.message, options.subject, options.file, options.link)\n\nisSubscribed = (_id) ->\n\treturn ChatSubscription.find({ rid: _id }).count() > 0\n\nfavoritesEnabled = ->\n\treturn RocketChat.settings.get 'Favorite_Rooms'\n\nuserCanDrop = (_id) ->\n\treturn !RocketChat.roomTypes.readOnly _id, Meteor.user()\n\nTemplate.room.helpers\n\tisTranslated: ->\n\t\tsub = ChatSubscription.findOne { rid: this._id }, { fields: { autoTranslate: 1, autoTranslateLanguage: 1 } }\n\t\treturn RocketChat.settings.get('AutoTranslate_Enabled') and sub?.autoTranslate is true and sub.autoTranslateLanguage?\n\n\tembeddedVersion: ->\n\t\treturn RocketChat.Layout.isEmbedded()\n\n\tfavorite: ->\n\t\tsub = ChatSubscription.findOne { rid: this._id }, { fields: { f: 1 } }\n\t\treturn 'icon-star favorite-room pending-color' if sub?.f? and sub.f and favoritesEnabled()\n\t\treturn 'icon-star-empty'\n\n\tfavoriteLabel: ->\n\t\tsub = ChatSubscription.findOne { rid: this._id }, { fields: { f: 1 } }\n\t\treturn \"Unfavorite\" if sub?.f? and sub.f and favoritesEnabled()\n\t\treturn \"Favorite\"\n\n\tsubscribed: ->\n\t\treturn isSubscribed(this._id)\n\n\tmessagesHistory: ->\n\t\tconsole = {log: -> '### messagesHistory'}\n\t\thideMessagesOfType = []\n\t\tRocketChat.settings.collection.find({_id: /Message_HideType_.+/}).forEach (record) ->\n\t\t\ttype = record._id.replace('Message_HideType_', '')\n\t\t\tswitch (type)\n\t\t\t\twhen 'mute_unmute'\n\t\t\t\t\tconsole.log('##### mute_unmute')\n\t\t\t\t\ttypes = [ 'user-muted', 'user-unmuted' ]\n\t\t\t\telse\n\t\t\t\t\tconsole.log('##### NOT mute_unmute')\n\t\t\t\t\ttypes = [ type ]\n\t\t\ttypes.forEach (type) ->\n\t\t\t\tindex = hideMessagesOfType.indexOf(type)\n\n\t\t\t\tif record.value is true and index is -1\n\t\t\t\t\thideMessagesOfType.push(type)\n\t\t\t\telse if index > -1\n\t\t\t\t\thideMessagesOfType.splice(index, 1)\n\n\t\tquery =\n\t\t\trid: this._id\n\n\t\tif hideMessagesOfType.length > 0\n\t\t\tquery.t =\n\t\t\t\t$nin: hideMessagesOfType\n\n\t\toptions =\n\t\t\tsort:\n\t\t\t\tts: 1\n\n\t\treturn ChatMessage.find(query, options)\n\n\thasMore: ->\n\t\treturn RoomHistoryManager.hasMore this._id\n\n\thasMoreNext: ->\n\t\treturn RoomHistoryManager.hasMoreNext this._id\n\n\tisLoading: ->\n\t\treturn RoomHistoryManager.isLoading this._id\n\n\twindowId: ->\n\t\treturn \"chat-window-#{this._id}\"\n\n\tuploading: ->\n\t\treturn Session.get 'uploading'\n\n\troomName: ->\n\t\troomData = Session.get('roomData' + this._id)\n\t\treturn '' unless roomData\n\n\t\treturn RocketChat.roomTypes.getRoomName roomData.t, roomData\n\n\tsecondaryName: ->\n\t\troomData = Session.get('roomData' + this._id)\n\t\treturn '' unless roomData\n\n\t\treturn RocketChat.roomTypes.getSecondaryRoomName roomData.t, roomData\n\n\troomTopic: ->\n\t\troomData = Session.get('roomData' + this._id)\n\t\tconsole.log roomData.topic\n\t\treturn '' unless roomData\n\t\treturn roomData.topic\n\n\tshowAnnouncement: ->\n\t\troomData = Session.get('roomData' + this._id)\n\t\treturn false unless roomData\n\t\tMeteor.defer =>\n\t\t\tif window.chatMessages and window.chatMessages[roomData._id]\n\t\t\t\twindow.chatMessages[roomData._id].resize()\n\t\treturn roomData.announcement isnt undefined and roomData.announcement isnt ''\n\n\troomAnnouncement: ->\n\t\troomData = Session.get('roomData' + this._id)\n\t\treturn '' unless roomData\n\t\treturn roomData.announcement\n\n\troomIcon: ->\n\t\troomData = Session.get('roomData' + this._id)\n\t\treturn '' unless roomData?.t\n\n\t\treturn RocketChat.roomTypes.getIcon roomData?.t\n\n\tuserStatus: ->\n\t\troomData = Session.get('roomData' + this._id)\n\t\treturn RocketChat.roomTypes.getUserStatus(roomData.t, this._id) or 'offline'\n\n\tmaxMessageLength: ->\n\t\treturn RocketChat.settings.get('Message_MaxAllowedSize')\n\n\tunreadData: ->\n\t\tdata =\n\t\t\tcount: RoomHistoryManager.getRoom(this._id).unreadNotLoaded.get() + Template.instance().unreadCount.get()\n\n\t\troom = RoomManager.getOpenedRoomByRid this._id\n\t\tif room?\n\t\t\tdata.since = room.unreadSince?.get()\n\n\t\treturn data\n\n\tcontainerBarsShow: (unreadData, uploading) ->\n\t\treturn 'show' if (unreadData?.count > 0 and unreadData.since?) or uploading?.length > 0\n\n\tformatUnreadSince: ->\n\t\tif not this.since? then return\n\n\t\treturn moment(this.since).calendar(null, {sameDay: 'LT'})\n\n\tflexData: ->\n\t\tflexData =\n\t\t\ttabBar: Template.instance().tabBar\n\t\t\tdata:\n\t\t\t\trid: this._id\n\t\t\t\tuserDetail: Template.instance().userDetail.get(),\n\t\t\t\tclearUserDetail: Template.instance().clearUserDetail\n\n\t\treturn flexData\n\n\tadminClass: ->\n\t\treturn 'admin' if RocketChat.authz.hasRole(Meteor.userId(), 'admin')\n\n\tshowToggleFavorite: ->\n\t\treturn true if isSubscribed(this._id) and favoritesEnabled()\n\n\tviewMode: ->\n\t\tviewMode = Meteor.user()?.settings?.preferences?.viewMode\n\t\tswitch viewMode\n\t\t\twhen 1 then cssClass = 'cozy'\n\t\t\twhen 2 then cssClass = 'compact'\n\t\t\telse cssClass = ''\n\t\treturn cssClass\n\n\tselectable: ->\n\t\treturn Template.instance().selectable.get()\n\n\thideUsername: ->\n\t\treturn if Meteor.user()?.settings?.preferences?.hideUsernames then 'hide-usernames'\n\n\thideAvatar: ->\n\t\treturn if Meteor.user()?.settings?.preferences?.hideAvatars then 'hide-avatars'\n\n\tuserCanDrop: ->\n\t\treturn userCanDrop @_id\n\n\tcanPreview: ->\n\t\troom = Session.get('roomData' + this._id)\n\t\tif room.t isnt 'c'\n\t\t\treturn true\n\n\t\tif RocketChat.settings.get('Accounts_AllowAnonymousRead') is true\n\t\t\treturn true\n\n\t\tif RocketChat.authz.hasAllPermission('preview-c-room')\n\t\t\treturn true\n\n\t\treturn RocketChat.models.Subscriptions.findOne({rid: this._id})?\n\nisSocialSharingOpen = false\ntouchMoved = false\n\nTemplate.room.events\n\t\"click, touchend\": (e, t) ->\n\t\tMeteor.setTimeout ->\n\t\t\tt.sendToBottomIfNecessaryDebounced()\n\t\t, 100\n\n\t\"click .messages-container\": (e) ->\n\t\tif Template.instance().tabBar.getState() is 'opened' and Meteor.user()?.settings?.preferences?.hideFlexTab\n\t\t\tTemplate.instance().tabBar.close()\n\n\t\"touchstart .message\": (e, t) ->\n\t\ttouchMoved = false\n\t\tisSocialSharingOpen = false\n\t\tif e.originalEvent.touches.length isnt 1\n\t\t\treturn\n\n\t\tif $(e.currentTarget).hasClass('system')\n\t\t\treturn\n\n\t\tif e.target and e.target.nodeName is 'AUDIO'\n\t\t\treturn\n\n\t\tif e.target and e.target.nodeName is 'A' and /^https?:\\/\\/.+/.test(e.target.getAttribute('href'))\n\t\t\te.preventDefault()\n\t\t\te.stopPropagation()\n\n\t\tmessage = this._arguments[1]\n\t\tdoLongTouch = =>\n\n\t\t\tif window.plugins?.socialsharing?\n\t\t\t\tisSocialSharingOpen = true\n\n\t\t\t\tif e.target and e.target.nodeName is 'A' and /^https?:\\/\\/.+/.test(e.target.getAttribute('href'))\n\t\t\t\t\tif message.attachments?\n\t\t\t\t\t\tattachment = _.find message.attachments, (item) -> return item.title is e.target.innerText\n\t\t\t\t\t\tif attachment?\n\t\t\t\t\t\t\tsocialSharing\n\t\t\t\t\t\t\t\tfile: e.target.href\n\t\t\t\t\t\t\t\tsubject: e.target.innerText\n\t\t\t\t\t\t\t\tmessage: message.msg\n\t\t\t\t\t\t\treturn\n\n\t\t\t\t\tsocialSharing\n\t\t\t\t\t\tlink: e.target.href\n\t\t\t\t\t\tsubject: e.target.innerText\n\t\t\t\t\t\tmessage: message.msg\n\t\t\t\t\treturn\n\n\t\t\t\tif e.target and e.target.nodeName is 'IMG'\n\t\t\t\t\tsocialSharing\n\t\t\t\t\t\tfile: e.target.src\n\t\t\t\t\t\tmessage: message.msg\n\t\t\t\t\treturn\n\n\t\t\tmobileMessageMenu.show(message, t, e, this)\n\n\t\tMeteor.clearTimeout t.touchtime\n\t\tt.touchtime = Meteor.setTimeout doLongTouch, 500\n\n\t\"click .message img\": (e, t) ->\n\t\tMeteor.clearTimeout t.touchtime\n\t\tif isSocialSharingOpen is true or touchMoved is true\n\t\t\te.preventDefault()\n\t\t\te.stopPropagation()\n\n\t\"touchend .message\": (e, t) ->\n\t\tMeteor.clearTimeout t.touchtime\n\t\tif isSocialSharingOpen is true\n\t\t\te.preventDefault()\n\t\t\te.stopPropagation()\n\t\t\treturn\n\n\t\tif e.target and e.target.nodeName is 'A' and /^https?:\\/\\/.+/.test(e.target.getAttribute('href'))\n\t\t\tif touchMoved is true\n\t\t\t\te.preventDefault()\n\t\t\t\te.stopPropagation()\n\t\t\t\treturn\n\n\t\t\tif cordova?.InAppBrowser?\n\t\t\t\tcordova.InAppBrowser.open(e.target.href, '_system')\n\t\t\telse\n\t\t\t\twindow.open(e.target.href)\n\n\t\"touchmove .message\": (e, t) ->\n\t\ttouchMoved = true\n\t\tMeteor.clearTimeout t.touchtime\n\n\t\"touchcancel .message\": (e, t) ->\n\t\tMeteor.clearTimeout t.touchtime\n\n\t\"click .upload-progress-text > button\": (e) ->\n\t\te.preventDefault();\n\t\tSession.set \"uploading-cancel-#{this.id}\", true\n\n\t\"click .unread-bar > button.mark-read\": ->\n\t\treadMessage.readNow(true)\n\n\t\"click .unread-bar > button.jump-to\": (e, t) ->\n\t\t_id = t.data._id\n\t\tmessage = RoomHistoryManager.getRoom(_id)?.firstUnread.get()\n\t\tif message?\n\t\t\tRoomHistoryManager.getSurroundingMessages(message, 50)\n\t\telse\n\t\t\tsubscription = ChatSubscription.findOne({ rid: _id })\n\t\t\tmessage = ChatMessage.find({ rid: _id, ts: { $gt: subscription?.ls } }, { sort: { ts: 1 }, limit: 1 }).fetch()[0]\n\t\t\tRoomHistoryManager.getSurroundingMessages(message, 50)\n\n\t'click .toggle-favorite': (event) ->\n\t\tevent.stopPropagation()\n\t\tevent.preventDefault()\n\t\tMeteor.call 'toggleFavorite', @_id, !$('i', event.currentTarget).hasClass('favorite-room'), (err) ->\n\t\t\tif err\n\t\t\t\treturn handleError(err)\n\n\t'click .edit-room-title': (event) ->\n\t\tevent.preventDefault()\n\t\tSession.set('editRoomTitle', true)\n\t\t$(\".fixed-title\").addClass \"visible\"\n\t\tMeteor.setTimeout ->\n\t\t\t$('#room-title-field').focus().select()\n\t\t, 10\n\n\t\"click .flex-tab .user-image > button\" : (e, instance) ->\n\t\tif not Meteor.userId()?\n\t\t\treturn\n\n\t\tinstance.tabBar.open()\n\t\tinstance.setUserDetail @user.username\n\n\t'click .user-card-message': (e, instance) ->\n\t\tif not Meteor.userId()?\n\t\t\treturn\n\n\t\troomData = Session.get('roomData' + this._arguments[1].rid)\n\n\t\tif RocketChat.Layout.isEmbedded()\n\t\t\tfireGlobalEvent('click-user-card-message', { username: this._arguments[1].u.username })\n\t\t\te.preventDefault()\n\t\t\te.stopPropagation()\n\t\t\treturn\n\n\t\tif roomData.t in ['c', 'p', 'd']\n\t\t\tinstance.setUserDetail this._arguments[1].u.username\n\n\t\tinstance.tabBar.setTemplate('membersList')\n\t\tinstance.tabBar.open()\n\n\t'scroll .wrapper': _.throttle (e, instance) ->\n\t\tif RoomHistoryManager.isLoading(@_id) is false and (RoomHistoryManager.hasMore(@_id) is true or RoomHistoryManager.hasMoreNext(@_id) is true)\n\t\t\tif RoomHistoryManager.hasMore(@_id) is true and e.target.scrollTop is 0\n\t\t\t\tRoomHistoryManager.getMore(@_id)\n\t\t\telse if RoomHistoryManager.hasMoreNext(@_id) is true and e.target.scrollTop >= e.target.scrollHeight - e.target.clientHeight\n\t\t\t\tRoomHistoryManager.getMoreNext(@_id)\n\t, 200\n\n\t'click .new-message': (e) ->\n\t\tTemplate.instance().atBottom = true\n\t\tTemplate.instance().find('.input-message').focus()\n\n\t'click .message-cog': (e) ->\n\t\tmessage = @_arguments[1]\n\t\tRocketChat.MessageAction.hideDropDown()\n\n\t\tdropDown = $(\".messages-box \\##{message._id} .message-dropdown\")\n\n\t\tif dropDown.length is 0\n\t\t\tactions = RocketChat.MessageAction.getButtons message, 'message'\n\n\t\t\tel = Blaze.toHTMLWithData Template.messageDropdown,\n\t\t\t\tactions: actions\n\n\t\t\t$(\".messages-box \\##{message._id} .message-cog-container\").append el\n\n\t\t\tdropDown = $(\".messages-box \\##{message._id} .message-dropdown\")\n\n\t\tdropDown.show()\n\n\t'click .message-dropdown .message-action': (e, t) ->\n\t\tel = $(e.currentTarget)\n\n\t\tbutton = RocketChat.MessageAction.getButtonById el.data('id')\n\t\tif button?.action?\n\t\t\tbutton.action.call @, e, t\n\n\t'click .message-dropdown-close': ->\n\t\tRocketChat.MessageAction.hideDropDown()\n\n\t\"click .mention-link\": (e, instance) ->\n\t\tif not Meteor.userId()?\n\t\t\treturn\n\n\t\tchannel = $(e.currentTarget).data('channel')\n\t\tif channel?\n\t\t\tif RocketChat.Layout.isEmbedded()\n\t\t\t\treturn fireGlobalEvent('click-mention-link', { path: FlowRouter.path('channel', {name: channel}), channel: channel })\n\n\t\t\tFlowRouter.go 'channel', { name: channel }, FlowRouter.current().queryParams\n\t\t\treturn\n\n\t\tif RocketChat.Layout.isEmbedded()\n\t\t\tfireGlobalEvent('click-mention-link', { username: $(e.currentTarget).data('username') })\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\treturn\n\n\t\tinstance.tabBar.setTemplate 'membersList'\n\t\tinstance.setUserDetail $(e.currentTarget).data('username')\n\n\t\tinstance.tabBar.open()\n\n\t'click .image-to-download': (event) ->\n\t\tChatMessage.update {_id: this._arguments[1]._id, 'urls.url': $(event.currentTarget).data('url')}, {$set: {'urls.$.downloadImages': true}}\n\t\tChatMessage.update {_id: this._arguments[1]._id, 'attachments.image_url': $(event.currentTarget).data('url')}, {$set: {'attachments.$.downloadImages': true}}\n\n\t\t#차트 클릭 이벤트\n\t'click li[data-chartView=true]': (event) ->\n\t\tChartDialog.preview(event.currentTarget)\n\n\t'click .collapse-switch': (e) ->\n\t\tindex = $(e.currentTarget).data('index')\n\t\tcollapsed = $(e.currentTarget).data('collapsed')\n\t\tid = @_arguments[1]._id\n\n\t\tif @_arguments[1]?.attachments?\n\t\t\tChatMessage.update {_id: id}, {$set: {\"attachments.#{index}.collapsed\": !collapsed}}\n\n\t\tif @_arguments[1]?.urls?\n\t\t\tChatMessage.update {_id: id}, {$set: {\"urls.#{index}.collapsed\": !collapsed}}\n\n\t'dragenter .dropzone': (e) ->\n\t\ttypes = e.originalEvent?.dataTransfer?.types\n\t\tif types?.length > 0 and _.every(types, (type) => type.indexOf('text/') is -1 or type.indexOf('text/uri-list') isnt -1) and userCanDrop this._id\n\t\t\te.currentTarget.classList.add 'over'\n\n\t'dragleave .dropzone-overlay': (e) ->\n\t\te.currentTarget.parentNode.classList.remove 'over'\n\n\t'dragover .dropzone-overlay': (e) ->\n\t\te = e.originalEvent or e\n\t\tif e.dataTransfer.effectAllowed in ['move', 'linkMove']\n\t\t\te.dataTransfer.dropEffect = 'move'\n\t\telse\n\t\t\te.dataTransfer.dropEffect = 'copy'\n\n\t'dropped .dropzone-overlay': (event) ->\n\t\tevent.currentTarget.parentNode.classList.remove 'over'\n\n\t\te = event.originalEvent or event\n\t\tfiles = e.dataTransfer?.files or []\n\n\t\tfilesToUpload = []\n\t\tfor file in files\n\t\t\t# `file.type = mime.lookup(file.name)` does not work.\n\t\t\tObject.defineProperty(file, 'type', { value: mime.lookup(file.name) })\n\t\t\tfilesToUpload.push\n\t\t\t\tfile: file\n\t\t\t\tname: file.name\n\n\t\tfileUpload filesToUpload\n\n\t'load img': (e, template) ->\n\t\ttemplate.sendToBottomIfNecessary?()\n\n\t'click .jump-recent button': (e, template) ->\n\t\te.preventDefault()\n\t\ttemplate.atBottom = true\n\t\tRoomHistoryManager.clear(template?.data?._id)\n\n\t'click .message': (e, template) ->\n\t\tif template.selectable.get()\n\t\t\tdocument.selection?.empty() or window.getSelection?().removeAllRanges()\n\t\t\tdata = Blaze.getData(e.currentTarget)\n\t\t\t_id = data?._arguments?[1]?._id\n\n\t\t\tif !template.selectablePointer\n\t\t\t\ttemplate.selectablePointer = _id\n\n\t\t\tif !e.shiftKey\n\t\t\t\ttemplate.selectedMessages = template.getSelectedMessages()\n\t\t\t\ttemplate.selectedRange = []\n\t\t\t\ttemplate.selectablePointer = _id\n\n\t\t\ttemplate.selectMessages _id\n\n\t\t\tselectedMessages = $('.messages-box .message.selected').map((i, message) -> message.id)\n\t\t\tremoveClass = _.difference selectedMessages, template.getSelectedMessages()\n\t\t\taddClass = _.difference template.getSelectedMessages(), selectedMessages\n\t\t\tfor message in removeClass\n\t\t\t\t$(\".messages-box ##{message}\").removeClass('selected')\n\t\t\tfor message in addClass\n\t\t\t\t$(\".messages-box ##{message}\").addClass('selected')\n\n\nTemplate.room.onCreated ->\n\t# this.scrollOnBottom = true\n\t# this.typing = new msgTyping this.data._id\n\tthis.showUsersOffline = new ReactiveVar false\n\tthis.atBottom = if FlowRouter.getQueryParam('msg') then false else true\n\tthis.unreadCount = new ReactiveVar 0\n\n\tthis.selectable = new ReactiveVar false\n\tthis.selectedMessages = []\n\tthis.selectedRange = []\n\tthis.selectablePointer = null\n\n\tthis.flexTemplate = new ReactiveVar\n\n\tthis.userDetail = new ReactiveVar FlowRouter.getParam('username')\n\n\tthis.tabBar = new RocketChatTabBar();\n\tthis.tabBar.showGroup(FlowRouter.current().route.name);\n\n\tthis.resetSelection = (enabled) =>\n\t\tthis.selectable.set(enabled)\n\t\t$('.messages-box .message.selected').removeClass 'selected'\n\t\tthis.selectedMessages = []\n\t\tthis.selectedRange = []\n\t\tthis.selectablePointer = null\n\n\tthis.selectMessages = (to) =>\n\t\tif this.selectablePointer is to and this.selectedRange.length > 0\n\t\t\tthis.selectedRange = []\n\t\telse\n\t\t\tmessage1 = ChatMessage.findOne this.selectablePointer\n\t\t\tmessage2 = ChatMessage.findOne to\n\n\t\t\tminTs = _.min([message1.ts, message2.ts])\n\t\t\tmaxTs = _.max([message1.ts, message2.ts])\n\n\t\t\tthis.selectedRange = _.pluck(ChatMessage.find({ rid: message1.rid, ts: { $gte: minTs, $lte: maxTs } }).fetch(), '_id')\n\n\tthis.getSelectedMessages = =>\n\t\tmessages = this.selectedMessages\n\t\taddMessages = false\n\t\tfor message in this.selectedRange\n\t\t\tif messages.indexOf(message) is -1\n\t\t\t\taddMessages = true\n\t\t\t\tbreak\n\n\t\tif addMessages\n\t\t\tpreviewMessages = _.compact(_.uniq(this.selectedMessages.concat(this.selectedRange)))\n\t\telse\n\t\t\tpreviewMessages = _.compact(_.difference(this.selectedMessages, this.selectedRange))\n\n\t\treturn previewMessages\n\n\tthis.setUserDetail = (username) =>\n\t\tthis.userDetail.set username\n\n\tthis.clearUserDetail = =>\n\t\tthis.userDetail.set null\n\n\tMeteor.call 'getRoomRoles', @data._id, (error, results) ->\n\t\tif error\n\t\t\treturn handleError(error)\n\n\t\tfor record in results\n\t\t\tdelete record._id\n\t\t\tRoomRoles.upsert { rid: record.rid, \"u._id\": record.u._id }, record\n\n\tRoomRoles.find({ rid: @data._id }).observe\n\t\tadded: (role) =>\n\t\t\tChatMessage.update { rid: @data._id, \"u._id\": role?.u?._id }, { $addToSet: { roles: role._id } }, { multi: true } # Update message to re-render DOM\n\t\tchanged: (role, oldRole) =>\n\t\t\tChatMessage.update { rid: @data._id, \"u._id\": role?.u?._id }, { $inc: { rerender: 1 } }, { multi: true } # Update message to re-render DOM\n\t\tremoved: (role) =>\n\t\t\tChatMessage.update { rid: @data._id, \"u._id\": role?.u?._id }, { $pull: { roles: role._id } }, { multi: true } # Update message to re-render DOM\n\nTemplate.room.onDestroyed ->\n\twindow.removeEventListener 'resize', this.onWindowResize\n\nTemplate.room.onRendered ->\n\tunless window.chatMessages\n\t\twindow.chatMessages = {}\n\tunless window.chatMessages[Session.get('openedRoom')]\n\t\twindow.chatMessages[Session.get('openedRoom')] = new ChatMessages\n\tchatMessages[Session.get('openedRoom')].init(this.firstNode)\n\n\tif Meteor.Device.isDesktop()\n\t\tsetTimeout ->\n\t\t\t$('.message-form .input-message').focus()\n\t\t, 100\n\n\t# ScrollListener.init()\n\n\twrapper = this.find('.wrapper')\n\twrapperUl = this.find('.wrapper > ul')\n\tnewMessage = this.find(\".new-message\")\n\n\t# 차트 표시\n\t$.each $(wrapperUl).find(\"li[data-chartview=true]\"), (index) ->\n\t\tHighcharts.chart($(this).data('target'), $(this).data(\"chartdata\"))\n\n\ttemplate = this\n\n\tmessageBox = $('.messages-box')\n\n\ttemplate.isAtBottom = (scrollThreshold) ->\n\t\tif not scrollThreshold? then scrollThreshold = 0\n\t\tif wrapper.scrollTop + scrollThreshold >= wrapper.scrollHeight - wrapper.clientHeight\n\t\t\tnewMessage.className = \"new-message background-primary-action-color color-content-background-color not\"\n\t\t\treturn true\n\t\treturn false\n\n\ttemplate.sendToBottom = ->\n\t\twrapper.scrollTop = wrapper.scrollHeight - wrapper.clientHeight\n\t\tnewMessage.className = \"new-message background-primary-action-color color-content-background-color not\"\n\n\ttemplate.checkIfScrollIsAtBottom = ->\n\t\ttemplate.atBottom = template.isAtBottom(100)\n\t\treadMessage.enable()\n\t\treadMessage.read()\n\n\ttemplate.sendToBottomIfNecessary = ->\n\t\tif template.atBottom is true and template.isAtBottom() isnt true\n\t\t\ttemplate.sendToBottom()\n\n\ttemplate.sendToBottomIfNecessaryDebounced = _.debounce template.sendToBottomIfNecessary, 10\n\n\ttemplate.sendToBottomIfNecessary()\n\n\tif not window.MutationObserver?\n\t\twrapperUl.addEventListener 'DOMSubtreeModified', ->\n\t\t\ttemplate.sendToBottomIfNecessaryDebounced()\n\telse\n\t\tobserver = new MutationObserver (mutations) ->\n\t\t\tmutations.forEach (mutation) ->\n\t\t\t\ttemplate.sendToBottomIfNecessaryDebounced()\n\n\t\tobserver.observe wrapperUl,\n\t\t\tchildList: true\n\t\t# observer.disconnect()\n\n\ttemplate.onWindowResize = ->\n\t\tMeteor.defer ->\n\t\t\ttemplate.sendToBottomIfNecessaryDebounced()\n\n\twindow.addEventListener 'resize', template.onWindowResize\n\n\twrapper.addEventListener 'mousewheel', ->\n\t\ttemplate.atBottom = false\n\t\tMeteor.defer ->\n\t\t\ttemplate.checkIfScrollIsAtBottom()\n\n\twrapper.addEventListener 'wheel', ->\n\t\ttemplate.atBottom = false\n\t\tMeteor.defer ->\n\t\t\ttemplate.checkIfScrollIsAtBottom()\n\n\twrapper.addEventListener 'touchstart', ->\n\t\ttemplate.atBottom = false\n\n\twrapper.addEventListener 'touchend', ->\n\t\tMeteor.defer ->\n\t\t\ttemplate.checkIfScrollIsAtBottom()\n\t\tMeteor.setTimeout ->\n\t\t\ttemplate.checkIfScrollIsAtBottom()\n\t\t, 1000\n\t\tMeteor.setTimeout ->\n\t\t\ttemplate.checkIfScrollIsAtBottom()\n\t\t, 2000\n\n\twrapper.addEventListener 'scroll', ->\n\t\ttemplate.atBottom = false\n\t\tMeteor.defer ->\n\t\t\ttemplate.checkIfScrollIsAtBottom()\n\n\t$('.flex-tab-bar').on 'click', (e, t) ->\n\t\tMeteor.setTimeout ->\n\t\t\ttemplate.sendToBottomIfNecessaryDebounced()\n\t\t, 50\n\n\trtl = $('html').hasClass('rtl')\n\n\tupdateUnreadCount = _.throttle ->\n\t\tmessageBoxOffset = messageBox.offset()\n\n\t\tif rtl\n\t\t\tlastInvisibleMessageOnScreen = document.elementFromPoint(messageBoxOffset.left+messageBox.width()-1, messageBoxOffset.top+1)\n\t\telse\n\t\t\tlastInvisibleMessageOnScreen = document.elementFromPoint(messageBoxOffset.left+1, messageBoxOffset.top+1)\n\n\t\tif lastInvisibleMessageOnScreen?.id?\n\t\t\tlastMessage = ChatMessage.findOne lastInvisibleMessageOnScreen.id\n\t\t\tif lastMessage?\n\t\t\t\tsubscription = ChatSubscription.findOne rid: template.data._id\n\t\t\t\tcount = ChatMessage.find({rid: template.data._id, ts: {$lte: lastMessage.ts, $gt: subscription?.ls}}).count()\n\t\t\t\ttemplate.unreadCount.set count\n\t\t\telse\n\t\t\t\ttemplate.unreadCount.set 0\n\t, 300\n\n\treadMessage.onRead (rid) ->\n\t\tif rid is template.data._id\n\t\t\ttemplate.unreadCount.set 0\n\n\twrapper.addEventListener 'scroll', ->\n\t\tupdateUnreadCount()\n\n\t# salva a data da renderização para exibir alertas de novas mensagens\n\t$.data(this.firstNode, 'renderedAt', new Date)\n\n\twebrtc = WebRTC.getInstanceByRoomId template.data._id\n\tif webrtc?\n\t\tTracker.autorun =>\n\t\t\tif webrtc.remoteItems.get()?.length > 0\n\t\t\t\t@tabBar.setTemplate 'membersList'\n\t\t\t\t@tabBar.open()\n\n\t\t\tif webrtc.localUrl.get()?\n\t\t\t\t@tabBar.setTemplate 'membersList'\n\t\t\t\t@tabBar.open()\n","var favoritesEnabled, isSocialSharingOpen, isSubscribed, socialSharing, touchMoved, userCanDrop;\n\nimport moment from 'moment';\n\nimport mime from 'mime-type/with-db';\n\nimport {\n  ChartDialog\n} from 'meteor/lily:ui-chart';\n\nsocialSharing = function(options) {\n  if (options == null) {\n    options = {};\n  }\n  return window.plugins.socialsharing.share(options.message, options.subject, options.file, options.link);\n};\n\nisSubscribed = function(_id) {\n  return ChatSubscription.find({\n    rid: _id\n  }).count() > 0;\n};\n\nfavoritesEnabled = function() {\n  return RocketChat.settings.get('Favorite_Rooms');\n};\n\nuserCanDrop = function(_id) {\n  return !RocketChat.roomTypes.readOnly(_id, Meteor.user());\n};\n\nTemplate.room.helpers({\n  isTranslated: function() {\n    var sub;\n    sub = ChatSubscription.findOne({\n      rid: this._id\n    }, {\n      fields: {\n        autoTranslate: 1,\n        autoTranslateLanguage: 1\n      }\n    });\n    return RocketChat.settings.get('AutoTranslate_Enabled') && (sub != null ? sub.autoTranslate : void 0) === true && (sub.autoTranslateLanguage != null);\n  },\n  embeddedVersion: function() {\n    return RocketChat.Layout.isEmbedded();\n  },\n  favorite: function() {\n    var sub;\n    sub = ChatSubscription.findOne({\n      rid: this._id\n    }, {\n      fields: {\n        f: 1\n      }\n    });\n    if (((sub != null ? sub.f : void 0) != null) && sub.f && favoritesEnabled()) {\n      return 'icon-star favorite-room pending-color';\n    }\n    return 'icon-star-empty';\n  },\n  favoriteLabel: function() {\n    var sub;\n    sub = ChatSubscription.findOne({\n      rid: this._id\n    }, {\n      fields: {\n        f: 1\n      }\n    });\n    if (((sub != null ? sub.f : void 0) != null) && sub.f && favoritesEnabled()) {\n      return \"Unfavorite\";\n    }\n    return \"Favorite\";\n  },\n  subscribed: function() {\n    return isSubscribed(this._id);\n  },\n  messagesHistory: function() {\n    var console, hideMessagesOfType, options, query;\n    console = {\n      log: function() {\n        return '### messagesHistory';\n      }\n    };\n    hideMessagesOfType = [];\n    RocketChat.settings.collection.find({\n      _id: /Message_HideType_.+/\n    }).forEach(function(record) {\n      var type, types;\n      type = record._id.replace('Message_HideType_', '');\n      switch (type) {\n        case 'mute_unmute':\n          console.log('##### mute_unmute');\n          types = ['user-muted', 'user-unmuted'];\n          break;\n        default:\n          console.log('##### NOT mute_unmute');\n          types = [type];\n      }\n      return types.forEach(function(type) {\n        var index;\n        index = hideMessagesOfType.indexOf(type);\n        if (record.value === true && index === -1) {\n          return hideMessagesOfType.push(type);\n        } else if (index > -1) {\n          return hideMessagesOfType.splice(index, 1);\n        }\n      });\n    });\n    query = {\n      rid: this._id\n    };\n    if (hideMessagesOfType.length > 0) {\n      query.t = {\n        $nin: hideMessagesOfType\n      };\n    }\n    options = {\n      sort: {\n        ts: 1\n      }\n    };\n    return ChatMessage.find(query, options);\n  },\n  hasMore: function() {\n    return RoomHistoryManager.hasMore(this._id);\n  },\n  hasMoreNext: function() {\n    return RoomHistoryManager.hasMoreNext(this._id);\n  },\n  isLoading: function() {\n    return RoomHistoryManager.isLoading(this._id);\n  },\n  windowId: function() {\n    return \"chat-window-\" + this._id;\n  },\n  uploading: function() {\n    return Session.get('uploading');\n  },\n  roomName: function() {\n    var roomData;\n    roomData = Session.get('roomData' + this._id);\n    if (!roomData) {\n      return '';\n    }\n    return RocketChat.roomTypes.getRoomName(roomData.t, roomData);\n  },\n  secondaryName: function() {\n    var roomData;\n    roomData = Session.get('roomData' + this._id);\n    if (!roomData) {\n      return '';\n    }\n    return RocketChat.roomTypes.getSecondaryRoomName(roomData.t, roomData);\n  },\n  roomTopic: function() {\n    var roomData;\n    roomData = Session.get('roomData' + this._id);\n    console.log(roomData.topic);\n    if (!roomData) {\n      return '';\n    }\n    return roomData.topic;\n  },\n  showAnnouncement: function() {\n    var roomData;\n    roomData = Session.get('roomData' + this._id);\n    if (!roomData) {\n      return false;\n    }\n    Meteor.defer((function(_this) {\n      return function() {\n        if (window.chatMessages && window.chatMessages[roomData._id]) {\n          return window.chatMessages[roomData._id].resize();\n        }\n      };\n    })(this));\n    return roomData.announcement !== void 0 && roomData.announcement !== '';\n  },\n  roomAnnouncement: function() {\n    var roomData;\n    roomData = Session.get('roomData' + this._id);\n    if (!roomData) {\n      return '';\n    }\n    return roomData.announcement;\n  },\n  roomIcon: function() {\n    var roomData;\n    roomData = Session.get('roomData' + this._id);\n    if (!(roomData != null ? roomData.t : void 0)) {\n      return '';\n    }\n    return RocketChat.roomTypes.getIcon(roomData != null ? roomData.t : void 0);\n  },\n  userStatus: function() {\n    var roomData;\n    roomData = Session.get('roomData' + this._id);\n    return RocketChat.roomTypes.getUserStatus(roomData.t, this._id) || 'offline';\n  },\n  maxMessageLength: function() {\n    return RocketChat.settings.get('Message_MaxAllowedSize');\n  },\n  unreadData: function() {\n    var data, ref, room;\n    data = {\n      count: RoomHistoryManager.getRoom(this._id).unreadNotLoaded.get() + Template.instance().unreadCount.get()\n    };\n    room = RoomManager.getOpenedRoomByRid(this._id);\n    if (room != null) {\n      data.since = (ref = room.unreadSince) != null ? ref.get() : void 0;\n    }\n    return data;\n  },\n  containerBarsShow: function(unreadData, uploading) {\n    if (((unreadData != null ? unreadData.count : void 0) > 0 && (unreadData.since != null)) || (uploading != null ? uploading.length : void 0) > 0) {\n      return 'show';\n    }\n  },\n  formatUnreadSince: function() {\n    if (this.since == null) {\n      return;\n    }\n    return moment(this.since).calendar(null, {\n      sameDay: 'LT'\n    });\n  },\n  flexData: function() {\n    var flexData;\n    flexData = {\n      tabBar: Template.instance().tabBar,\n      data: {\n        rid: this._id,\n        userDetail: Template.instance().userDetail.get(),\n        clearUserDetail: Template.instance().clearUserDetail\n      }\n    };\n    return flexData;\n  },\n  adminClass: function() {\n    if (RocketChat.authz.hasRole(Meteor.userId(), 'admin')) {\n      return 'admin';\n    }\n  },\n  showToggleFavorite: function() {\n    if (isSubscribed(this._id) && favoritesEnabled()) {\n      return true;\n    }\n  },\n  viewMode: function() {\n    var cssClass, ref, ref1, ref2, viewMode;\n    viewMode = (ref = Meteor.user()) != null ? (ref1 = ref.settings) != null ? (ref2 = ref1.preferences) != null ? ref2.viewMode : void 0 : void 0 : void 0;\n    switch (viewMode) {\n      case 1:\n        cssClass = 'cozy';\n        break;\n      case 2:\n        cssClass = 'compact';\n        break;\n      default:\n        cssClass = '';\n    }\n    return cssClass;\n  },\n  selectable: function() {\n    return Template.instance().selectable.get();\n  },\n  hideUsername: function() {\n    var ref, ref1, ref2;\n    if ((ref = Meteor.user()) != null ? (ref1 = ref.settings) != null ? (ref2 = ref1.preferences) != null ? ref2.hideUsernames : void 0 : void 0 : void 0) {\n      return 'hide-usernames';\n    }\n  },\n  hideAvatar: function() {\n    var ref, ref1, ref2;\n    if ((ref = Meteor.user()) != null ? (ref1 = ref.settings) != null ? (ref2 = ref1.preferences) != null ? ref2.hideAvatars : void 0 : void 0 : void 0) {\n      return 'hide-avatars';\n    }\n  },\n  userCanDrop: function() {\n    return userCanDrop(this._id);\n  },\n  canPreview: function() {\n    var room;\n    room = Session.get('roomData' + this._id);\n    if (room.t !== 'c') {\n      return true;\n    }\n    if (RocketChat.settings.get('Accounts_AllowAnonymousRead') === true) {\n      return true;\n    }\n    if (RocketChat.authz.hasAllPermission('preview-c-room')) {\n      return true;\n    }\n    return RocketChat.models.Subscriptions.findOne({\n      rid: this._id\n    }) != null;\n  }\n});\n\nisSocialSharingOpen = false;\n\ntouchMoved = false;\n\nTemplate.room.events({\n  \"click, touchend\": function(e, t) {\n    return Meteor.setTimeout(function() {\n      return t.sendToBottomIfNecessaryDebounced();\n    }, 100);\n  },\n  \"click .messages-container\": function(e) {\n    var ref, ref1, ref2;\n    if (Template.instance().tabBar.getState() === 'opened' && ((ref = Meteor.user()) != null ? (ref1 = ref.settings) != null ? (ref2 = ref1.preferences) != null ? ref2.hideFlexTab : void 0 : void 0 : void 0)) {\n      return Template.instance().tabBar.close();\n    }\n  },\n  \"touchstart .message\": function(e, t) {\n    var doLongTouch, message;\n    touchMoved = false;\n    isSocialSharingOpen = false;\n    if (e.originalEvent.touches.length !== 1) {\n      return;\n    }\n    if ($(e.currentTarget).hasClass('system')) {\n      return;\n    }\n    if (e.target && e.target.nodeName === 'AUDIO') {\n      return;\n    }\n    if (e.target && e.target.nodeName === 'A' && /^https?:\\/\\/.+/.test(e.target.getAttribute('href'))) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    message = this._arguments[1];\n    doLongTouch = (function(_this) {\n      return function() {\n        var attachment, ref;\n        if (((ref = window.plugins) != null ? ref.socialsharing : void 0) != null) {\n          isSocialSharingOpen = true;\n          if (e.target && e.target.nodeName === 'A' && /^https?:\\/\\/.+/.test(e.target.getAttribute('href'))) {\n            if (message.attachments != null) {\n              attachment = _.find(message.attachments, function(item) {\n                return item.title === e.target.innerText;\n              });\n              if (attachment != null) {\n                socialSharing({\n                  file: e.target.href,\n                  subject: e.target.innerText,\n                  message: message.msg\n                });\n                return;\n              }\n            }\n            socialSharing({\n              link: e.target.href,\n              subject: e.target.innerText,\n              message: message.msg\n            });\n            return;\n          }\n          if (e.target && e.target.nodeName === 'IMG') {\n            socialSharing({\n              file: e.target.src,\n              message: message.msg\n            });\n            return;\n          }\n        }\n        return mobileMessageMenu.show(message, t, e, _this);\n      };\n    })(this);\n    Meteor.clearTimeout(t.touchtime);\n    return t.touchtime = Meteor.setTimeout(doLongTouch, 500);\n  },\n  \"click .message img\": function(e, t) {\n    Meteor.clearTimeout(t.touchtime);\n    if (isSocialSharingOpen === true || touchMoved === true) {\n      e.preventDefault();\n      return e.stopPropagation();\n    }\n  },\n  \"touchend .message\": function(e, t) {\n    Meteor.clearTimeout(t.touchtime);\n    if (isSocialSharingOpen === true) {\n      e.preventDefault();\n      e.stopPropagation();\n      return;\n    }\n    if (e.target && e.target.nodeName === 'A' && /^https?:\\/\\/.+/.test(e.target.getAttribute('href'))) {\n      if (touchMoved === true) {\n        e.preventDefault();\n        e.stopPropagation();\n        return;\n      }\n      if ((typeof cordova !== \"undefined\" && cordova !== null ? cordova.InAppBrowser : void 0) != null) {\n        return cordova.InAppBrowser.open(e.target.href, '_system');\n      } else {\n        return window.open(e.target.href);\n      }\n    }\n  },\n  \"touchmove .message\": function(e, t) {\n    touchMoved = true;\n    return Meteor.clearTimeout(t.touchtime);\n  },\n  \"touchcancel .message\": function(e, t) {\n    return Meteor.clearTimeout(t.touchtime);\n  },\n  \"click .upload-progress-text > button\": function(e) {\n    e.preventDefault();\n    return Session.set(\"uploading-cancel-\" + this.id, true);\n  },\n  \"click .unread-bar > button.mark-read\": function() {\n    return readMessage.readNow(true);\n  },\n  \"click .unread-bar > button.jump-to\": function(e, t) {\n    var _id, message, ref, subscription;\n    _id = t.data._id;\n    message = (ref = RoomHistoryManager.getRoom(_id)) != null ? ref.firstUnread.get() : void 0;\n    if (message != null) {\n      return RoomHistoryManager.getSurroundingMessages(message, 50);\n    } else {\n      subscription = ChatSubscription.findOne({\n        rid: _id\n      });\n      message = ChatMessage.find({\n        rid: _id,\n        ts: {\n          $gt: subscription != null ? subscription.ls : void 0\n        }\n      }, {\n        sort: {\n          ts: 1\n        },\n        limit: 1\n      }).fetch()[0];\n      return RoomHistoryManager.getSurroundingMessages(message, 50);\n    }\n  },\n  'click .toggle-favorite': function(event) {\n    event.stopPropagation();\n    event.preventDefault();\n    return Meteor.call('toggleFavorite', this._id, !$('i', event.currentTarget).hasClass('favorite-room'), function(err) {\n      if (err) {\n        return handleError(err);\n      }\n    });\n  },\n  'click .edit-room-title': function(event) {\n    event.preventDefault();\n    Session.set('editRoomTitle', true);\n    $(\".fixed-title\").addClass(\"visible\");\n    return Meteor.setTimeout(function() {\n      return $('#room-title-field').focus().select();\n    }, 10);\n  },\n  \"click .flex-tab .user-image > button\": function(e, instance) {\n    if (Meteor.userId() == null) {\n      return;\n    }\n    instance.tabBar.open();\n    return instance.setUserDetail(this.user.username);\n  },\n  'click .user-card-message': function(e, instance) {\n    var ref, roomData;\n    if (Meteor.userId() == null) {\n      return;\n    }\n    roomData = Session.get('roomData' + this._arguments[1].rid);\n    if (RocketChat.Layout.isEmbedded()) {\n      fireGlobalEvent('click-user-card-message', {\n        username: this._arguments[1].u.username\n      });\n      e.preventDefault();\n      e.stopPropagation();\n      return;\n    }\n    if ((ref = roomData.t) === 'c' || ref === 'p' || ref === 'd') {\n      instance.setUserDetail(this._arguments[1].u.username);\n    }\n    instance.tabBar.setTemplate('membersList');\n    return instance.tabBar.open();\n  },\n  'scroll .wrapper': _.throttle(function(e, instance) {\n    if (RoomHistoryManager.isLoading(this._id) === false && (RoomHistoryManager.hasMore(this._id) === true || RoomHistoryManager.hasMoreNext(this._id) === true)) {\n      if (RoomHistoryManager.hasMore(this._id) === true && e.target.scrollTop === 0) {\n        return RoomHistoryManager.getMore(this._id);\n      } else if (RoomHistoryManager.hasMoreNext(this._id) === true && e.target.scrollTop >= e.target.scrollHeight - e.target.clientHeight) {\n        return RoomHistoryManager.getMoreNext(this._id);\n      }\n    }\n  }, 200),\n  'click .new-message': function(e) {\n    Template.instance().atBottom = true;\n    return Template.instance().find('.input-message').focus();\n  },\n  'click .message-cog': function(e) {\n    var actions, dropDown, el, message;\n    message = this._arguments[1];\n    RocketChat.MessageAction.hideDropDown();\n    dropDown = $(\".messages-box \\#\" + message._id + \" .message-dropdown\");\n    if (dropDown.length === 0) {\n      actions = RocketChat.MessageAction.getButtons(message, 'message');\n      el = Blaze.toHTMLWithData(Template.messageDropdown, {\n        actions: actions\n      });\n      $(\".messages-box \\#\" + message._id + \" .message-cog-container\").append(el);\n      dropDown = $(\".messages-box \\#\" + message._id + \" .message-dropdown\");\n    }\n    return dropDown.show();\n  },\n  'click .message-dropdown .message-action': function(e, t) {\n    var button, el;\n    el = $(e.currentTarget);\n    button = RocketChat.MessageAction.getButtonById(el.data('id'));\n    if ((button != null ? button.action : void 0) != null) {\n      return button.action.call(this, e, t);\n    }\n  },\n  'click .message-dropdown-close': function() {\n    return RocketChat.MessageAction.hideDropDown();\n  },\n  \"click .mention-link\": function(e, instance) {\n    var channel;\n    if (Meteor.userId() == null) {\n      return;\n    }\n    channel = $(e.currentTarget).data('channel');\n    if (channel != null) {\n      if (RocketChat.Layout.isEmbedded()) {\n        return fireGlobalEvent('click-mention-link', {\n          path: FlowRouter.path('channel', {\n            name: channel\n          }),\n          channel: channel\n        });\n      }\n      FlowRouter.go('channel', {\n        name: channel\n      }, FlowRouter.current().queryParams);\n      return;\n    }\n    if (RocketChat.Layout.isEmbedded()) {\n      fireGlobalEvent('click-mention-link', {\n        username: $(e.currentTarget).data('username')\n      });\n      e.stopPropagation();\n      e.preventDefault();\n      return;\n    }\n    instance.tabBar.setTemplate('membersList');\n    instance.setUserDetail($(e.currentTarget).data('username'));\n    return instance.tabBar.open();\n  },\n  'click .image-to-download': function(event) {\n    ChatMessage.update({\n      _id: this._arguments[1]._id,\n      'urls.url': $(event.currentTarget).data('url')\n    }, {\n      $set: {\n        'urls.$.downloadImages': true\n      }\n    });\n    return ChatMessage.update({\n      _id: this._arguments[1]._id,\n      'attachments.image_url': $(event.currentTarget).data('url')\n    }, {\n      $set: {\n        'attachments.$.downloadImages': true\n      }\n    });\n  },\n  'click li[data-chartView=true]': function(event) {\n    return ChartDialog.preview(event.currentTarget);\n  },\n  'click .collapse-switch': function(e) {\n    var collapsed, id, index, obj, obj1, ref, ref1;\n    index = $(e.currentTarget).data('index');\n    collapsed = $(e.currentTarget).data('collapsed');\n    id = this._arguments[1]._id;\n    if (((ref = this._arguments[1]) != null ? ref.attachments : void 0) != null) {\n      ChatMessage.update({\n        _id: id\n      }, {\n        $set: (\n          obj = {},\n          obj[\"attachments.\" + index + \".collapsed\"] = !collapsed,\n          obj\n        )\n      });\n    }\n    if (((ref1 = this._arguments[1]) != null ? ref1.urls : void 0) != null) {\n      return ChatMessage.update({\n        _id: id\n      }, {\n        $set: (\n          obj1 = {},\n          obj1[\"urls.\" + index + \".collapsed\"] = !collapsed,\n          obj1\n        )\n      });\n    }\n  },\n  'dragenter .dropzone': function(e) {\n    var ref, ref1, types;\n    types = (ref = e.originalEvent) != null ? (ref1 = ref.dataTransfer) != null ? ref1.types : void 0 : void 0;\n    if ((types != null ? types.length : void 0) > 0 && _.every(types, (function(_this) {\n      return function(type) {\n        return type.indexOf('text/') === -1 || type.indexOf('text/uri-list') !== -1;\n      };\n    })(this)) && userCanDrop(this._id)) {\n      return e.currentTarget.classList.add('over');\n    }\n  },\n  'dragleave .dropzone-overlay': function(e) {\n    return e.currentTarget.parentNode.classList.remove('over');\n  },\n  'dragover .dropzone-overlay': function(e) {\n    var ref;\n    e = e.originalEvent || e;\n    if ((ref = e.dataTransfer.effectAllowed) === 'move' || ref === 'linkMove') {\n      return e.dataTransfer.dropEffect = 'move';\n    } else {\n      return e.dataTransfer.dropEffect = 'copy';\n    }\n  },\n  'dropped .dropzone-overlay': function(event) {\n    var e, file, files, filesToUpload, j, len, ref;\n    event.currentTarget.parentNode.classList.remove('over');\n    e = event.originalEvent || event;\n    files = ((ref = e.dataTransfer) != null ? ref.files : void 0) || [];\n    filesToUpload = [];\n    for (j = 0, len = files.length; j < len; j++) {\n      file = files[j];\n      Object.defineProperty(file, 'type', {\n        value: mime.lookup(file.name)\n      });\n      filesToUpload.push({\n        file: file,\n        name: file.name\n      });\n    }\n    return fileUpload(filesToUpload);\n  },\n  'load img': function(e, template) {\n    return typeof template.sendToBottomIfNecessary === \"function\" ? template.sendToBottomIfNecessary() : void 0;\n  },\n  'click .jump-recent button': function(e, template) {\n    var ref;\n    e.preventDefault();\n    template.atBottom = true;\n    return RoomHistoryManager.clear(template != null ? (ref = template.data) != null ? ref._id : void 0 : void 0);\n  },\n  'click .message': function(e, template) {\n    var _id, addClass, data, j, k, len, len1, message, ref, ref1, ref2, removeClass, results1, selectedMessages;\n    if (template.selectable.get()) {\n      ((ref = document.selection) != null ? ref.empty() : void 0) || (typeof window.getSelection === \"function\" ? window.getSelection().removeAllRanges() : void 0);\n      data = Blaze.getData(e.currentTarget);\n      _id = data != null ? (ref1 = data._arguments) != null ? (ref2 = ref1[1]) != null ? ref2._id : void 0 : void 0 : void 0;\n      if (!template.selectablePointer) {\n        template.selectablePointer = _id;\n      }\n      if (!e.shiftKey) {\n        template.selectedMessages = template.getSelectedMessages();\n        template.selectedRange = [];\n        template.selectablePointer = _id;\n      }\n      template.selectMessages(_id);\n      selectedMessages = $('.messages-box .message.selected').map(function(i, message) {\n        return message.id;\n      });\n      removeClass = _.difference(selectedMessages, template.getSelectedMessages());\n      addClass = _.difference(template.getSelectedMessages(), selectedMessages);\n      for (j = 0, len = removeClass.length; j < len; j++) {\n        message = removeClass[j];\n        $(\".messages-box #\" + message).removeClass('selected');\n      }\n      results1 = [];\n      for (k = 0, len1 = addClass.length; k < len1; k++) {\n        message = addClass[k];\n        results1.push($(\".messages-box #\" + message).addClass('selected'));\n      }\n      return results1;\n    }\n  }\n});\n\nTemplate.room.onCreated(function() {\n  this.showUsersOffline = new ReactiveVar(false);\n  this.atBottom = FlowRouter.getQueryParam('msg') ? false : true;\n  this.unreadCount = new ReactiveVar(0);\n  this.selectable = new ReactiveVar(false);\n  this.selectedMessages = [];\n  this.selectedRange = [];\n  this.selectablePointer = null;\n  this.flexTemplate = new ReactiveVar;\n  this.userDetail = new ReactiveVar(FlowRouter.getParam('username'));\n  this.tabBar = new RocketChatTabBar();\n  this.tabBar.showGroup(FlowRouter.current().route.name);\n  this.resetSelection = (function(_this) {\n    return function(enabled) {\n      _this.selectable.set(enabled);\n      $('.messages-box .message.selected').removeClass('selected');\n      _this.selectedMessages = [];\n      _this.selectedRange = [];\n      return _this.selectablePointer = null;\n    };\n  })(this);\n  this.selectMessages = (function(_this) {\n    return function(to) {\n      var maxTs, message1, message2, minTs;\n      if (_this.selectablePointer === to && _this.selectedRange.length > 0) {\n        return _this.selectedRange = [];\n      } else {\n        message1 = ChatMessage.findOne(_this.selectablePointer);\n        message2 = ChatMessage.findOne(to);\n        minTs = _.min([message1.ts, message2.ts]);\n        maxTs = _.max([message1.ts, message2.ts]);\n        return _this.selectedRange = _.pluck(ChatMessage.find({\n          rid: message1.rid,\n          ts: {\n            $gte: minTs,\n            $lte: maxTs\n          }\n        }).fetch(), '_id');\n      }\n    };\n  })(this);\n  this.getSelectedMessages = (function(_this) {\n    return function() {\n      var addMessages, j, len, message, messages, previewMessages, ref;\n      messages = _this.selectedMessages;\n      addMessages = false;\n      ref = _this.selectedRange;\n      for (j = 0, len = ref.length; j < len; j++) {\n        message = ref[j];\n        if (messages.indexOf(message) === -1) {\n          addMessages = true;\n          break;\n        }\n      }\n      if (addMessages) {\n        previewMessages = _.compact(_.uniq(_this.selectedMessages.concat(_this.selectedRange)));\n      } else {\n        previewMessages = _.compact(_.difference(_this.selectedMessages, _this.selectedRange));\n      }\n      return previewMessages;\n    };\n  })(this);\n  this.setUserDetail = (function(_this) {\n    return function(username) {\n      return _this.userDetail.set(username);\n    };\n  })(this);\n  this.clearUserDetail = (function(_this) {\n    return function() {\n      return _this.userDetail.set(null);\n    };\n  })(this);\n  Meteor.call('getRoomRoles', this.data._id, function(error, results) {\n    var j, len, record, results1;\n    if (error) {\n      return handleError(error);\n    }\n    results1 = [];\n    for (j = 0, len = results.length; j < len; j++) {\n      record = results[j];\n      delete record._id;\n      results1.push(RoomRoles.upsert({\n        rid: record.rid,\n        \"u._id\": record.u._id\n      }, record));\n    }\n    return results1;\n  });\n  return RoomRoles.find({\n    rid: this.data._id\n  }).observe({\n    added: (function(_this) {\n      return function(role) {\n        var ref;\n        return ChatMessage.update({\n          rid: _this.data._id,\n          \"u._id\": role != null ? (ref = role.u) != null ? ref._id : void 0 : void 0\n        }, {\n          $addToSet: {\n            roles: role._id\n          }\n        }, {\n          multi: true\n        });\n      };\n    })(this),\n    changed: (function(_this) {\n      return function(role, oldRole) {\n        var ref;\n        return ChatMessage.update({\n          rid: _this.data._id,\n          \"u._id\": role != null ? (ref = role.u) != null ? ref._id : void 0 : void 0\n        }, {\n          $inc: {\n            rerender: 1\n          }\n        }, {\n          multi: true\n        });\n      };\n    })(this),\n    removed: (function(_this) {\n      return function(role) {\n        var ref;\n        return ChatMessage.update({\n          rid: _this.data._id,\n          \"u._id\": role != null ? (ref = role.u) != null ? ref._id : void 0 : void 0\n        }, {\n          $pull: {\n            roles: role._id\n          }\n        }, {\n          multi: true\n        });\n      };\n    })(this)\n  });\n});\n\nTemplate.room.onDestroyed(function() {\n  return window.removeEventListener('resize', this.onWindowResize);\n});\n\nTemplate.room.onRendered(function() {\n  var messageBox, newMessage, observer, rtl, template, updateUnreadCount, webrtc, wrapper, wrapperUl;\n  if (!window.chatMessages) {\n    window.chatMessages = {};\n  }\n  if (!window.chatMessages[Session.get('openedRoom')]) {\n    window.chatMessages[Session.get('openedRoom')] = new ChatMessages;\n  }\n  chatMessages[Session.get('openedRoom')].init(this.firstNode);\n  if (Meteor.Device.isDesktop()) {\n    setTimeout(function() {\n      return $('.message-form .input-message').focus();\n    }, 100);\n  }\n  wrapper = this.find('.wrapper');\n  wrapperUl = this.find('.wrapper > ul');\n  newMessage = this.find(\".new-message\");\n  $.each($(wrapperUl).find(\"li[data-chartview=true]\"), function(index) {\n    return Highcharts.chart($(this).data('target'), $(this).data(\"chartdata\"));\n  });\n  template = this;\n  messageBox = $('.messages-box');\n  template.isAtBottom = function(scrollThreshold) {\n    if (scrollThreshold == null) {\n      scrollThreshold = 0;\n    }\n    if (wrapper.scrollTop + scrollThreshold >= wrapper.scrollHeight - wrapper.clientHeight) {\n      newMessage.className = \"new-message background-primary-action-color color-content-background-color not\";\n      return true;\n    }\n    return false;\n  };\n  template.sendToBottom = function() {\n    wrapper.scrollTop = wrapper.scrollHeight - wrapper.clientHeight;\n    return newMessage.className = \"new-message background-primary-action-color color-content-background-color not\";\n  };\n  template.checkIfScrollIsAtBottom = function() {\n    template.atBottom = template.isAtBottom(100);\n    readMessage.enable();\n    return readMessage.read();\n  };\n  template.sendToBottomIfNecessary = function() {\n    if (template.atBottom === true && template.isAtBottom() !== true) {\n      return template.sendToBottom();\n    }\n  };\n  template.sendToBottomIfNecessaryDebounced = _.debounce(template.sendToBottomIfNecessary, 10);\n  template.sendToBottomIfNecessary();\n  if (window.MutationObserver == null) {\n    wrapperUl.addEventListener('DOMSubtreeModified', function() {\n      return template.sendToBottomIfNecessaryDebounced();\n    });\n  } else {\n    observer = new MutationObserver(function(mutations) {\n      return mutations.forEach(function(mutation) {\n        return template.sendToBottomIfNecessaryDebounced();\n      });\n    });\n    observer.observe(wrapperUl, {\n      childList: true\n    });\n  }\n  template.onWindowResize = function() {\n    return Meteor.defer(function() {\n      return template.sendToBottomIfNecessaryDebounced();\n    });\n  };\n  window.addEventListener('resize', template.onWindowResize);\n  wrapper.addEventListener('mousewheel', function() {\n    template.atBottom = false;\n    return Meteor.defer(function() {\n      return template.checkIfScrollIsAtBottom();\n    });\n  });\n  wrapper.addEventListener('wheel', function() {\n    template.atBottom = false;\n    return Meteor.defer(function() {\n      return template.checkIfScrollIsAtBottom();\n    });\n  });\n  wrapper.addEventListener('touchstart', function() {\n    return template.atBottom = false;\n  });\n  wrapper.addEventListener('touchend', function() {\n    Meteor.defer(function() {\n      return template.checkIfScrollIsAtBottom();\n    });\n    Meteor.setTimeout(function() {\n      return template.checkIfScrollIsAtBottom();\n    }, 1000);\n    return Meteor.setTimeout(function() {\n      return template.checkIfScrollIsAtBottom();\n    }, 2000);\n  });\n  wrapper.addEventListener('scroll', function() {\n    template.atBottom = false;\n    return Meteor.defer(function() {\n      return template.checkIfScrollIsAtBottom();\n    });\n  });\n  $('.flex-tab-bar').on('click', function(e, t) {\n    return Meteor.setTimeout(function() {\n      return template.sendToBottomIfNecessaryDebounced();\n    }, 50);\n  });\n  rtl = $('html').hasClass('rtl');\n  updateUnreadCount = _.throttle(function() {\n    var count, lastInvisibleMessageOnScreen, lastMessage, messageBoxOffset, subscription;\n    messageBoxOffset = messageBox.offset();\n    if (rtl) {\n      lastInvisibleMessageOnScreen = document.elementFromPoint(messageBoxOffset.left + messageBox.width() - 1, messageBoxOffset.top + 1);\n    } else {\n      lastInvisibleMessageOnScreen = document.elementFromPoint(messageBoxOffset.left + 1, messageBoxOffset.top + 1);\n    }\n    if ((lastInvisibleMessageOnScreen != null ? lastInvisibleMessageOnScreen.id : void 0) != null) {\n      lastMessage = ChatMessage.findOne(lastInvisibleMessageOnScreen.id);\n      if (lastMessage != null) {\n        subscription = ChatSubscription.findOne({\n          rid: template.data._id\n        });\n        count = ChatMessage.find({\n          rid: template.data._id,\n          ts: {\n            $lte: lastMessage.ts,\n            $gt: subscription != null ? subscription.ls : void 0\n          }\n        }).count();\n        return template.unreadCount.set(count);\n      } else {\n        return template.unreadCount.set(0);\n      }\n    }\n  }, 300);\n  readMessage.onRead(function(rid) {\n    if (rid === template.data._id) {\n      return template.unreadCount.set(0);\n    }\n  });\n  wrapper.addEventListener('scroll', function() {\n    return updateUnreadCount();\n  });\n  $.data(this.firstNode, 'renderedAt', new Date);\n  webrtc = WebRTC.getInstanceByRoomId(template.data._id);\n  if (webrtc != null) {\n    return Tracker.autorun((function(_this) {\n      return function() {\n        var ref;\n        if (((ref = webrtc.remoteItems.get()) != null ? ref.length : void 0) > 0) {\n          _this.tabBar.setTemplate('membersList');\n          _this.tabBar.open();\n        }\n        if (webrtc.localUrl.get() != null) {\n          _this.tabBar.setTemplate('membersList');\n          return _this.tabBar.open();\n        }\n      };\n    })(this));\n  }\n});\n","Template.roomSearch.helpers({\n\troomIcon() {\n\t\tif (this.type === 'u') {\n\t\t\treturn 'icon-at';\n\t\t}\n\t\tif (this.type === 'r') {\n\t\t\treturn RocketChat.roomTypes.getIcon(this.t);\n\t\t}\n\t},\n\tuserStatus() {\n\t\tif (this.type === 'u') {\n\t\t\treturn `status-${ this.status }`;\n\t\t}\n\t}\n});\n","/* globals KonchatNotification */\nTemplate.secretURL.helpers({\n\tregistrationAllowed() {\n\t\tconst {hashIsValid} = Template.instance();\n\t\treturn RocketChat.settings.get('Accounts_RegistrationForm') === 'Secret URL' && hashIsValid && hashIsValid.get();\n\t},\n\tready() {\n\t\tconst {subscriptionsReady, hashReady} = Template.instance();\n\t\treturn typeof subscriptionsReady === 'function' && subscriptionsReady() && hashReady && hashReady.get();\n\t}\n});\n\nTemplate.secretURL.onCreated(function() {\n\tthis.hashIsValid = new ReactiveVar(false);\n\tthis.hashReady = new ReactiveVar(false);\n\tMeteor.call('checkRegistrationSecretURL', FlowRouter.getParam('hash'), (err, success) => {\n\t\tthis.hashReady.set(true);\n\t\tif (success) {\n\t\t\tSession.set('loginDefaultState', 'register');\n\t\t\tKonchatNotification.getDesktopPermission();\n\t\t\treturn this.hashIsValid.set(true);\n\t\t}\n\t\treturn this.hashIsValid.set(false);\n\t});\n});\n\nTemplate.secretURL.onRendered(function() {\n\treturn $('#initial-page-loading').remove();\n});\n","import PhotoSwipe from 'photoswipe';\nimport PhotoSwipeUI_Default from 'photoswipe/dist/photoswipe-ui-default';\nimport 'photoswipe/dist/photoswipe.css';\n\nMeteor.startup(() => {\n\tconst initGallery = (selector, items, options) => {\n\t\tconst gallery = new PhotoSwipe(selector, PhotoSwipeUI_Default, items, options);\n\t\tgallery.init();\n\t};\n\n\tconst getItems = (selector, imageSrc) => {\n\t\tconst results = {\n\t\t\tindex: 0,\n\t\t\titems: []\n\t\t};\n\n\t\tfor (let i = 0, len = selector.length; i < len; i++) {\n\t\t\tresults.items.push({\n\t\t\t\tsrc: selector[i].src,\n\t\t\t\tw: selector[i].naturalWidth,\n\t\t\t\th: selector[i].naturalHeight,\n\t\t\t\ttitle: selector[i].dataset.title,\n\t\t\t\tdescription: selector[i].dataset.description\n\t\t\t});\n\n\t\t\tif (imageSrc === selector[i].src) {\n\t\t\t\tresults.index = i;\n\t\t\t}\n\t\t}\n\n\t\treturn results;\n\t};\n\n\tconst galleryOptions = {\n\t\tindex: 0,\n\t\tbgOpacity: 0.8,\n\t\tshowHideOpacity: true,\n\t\tcounterEl: false,\n\t\tshareEl: false\n\t};\n\n\t$(document).on('click', '.gallery-item', function() {\n\t\tconst images = getItems(document.querySelectorAll('.gallery-item'), $(this)[0].src);\n\n\t\tgalleryOptions.index = images.index;\n\t\tgalleryOptions.addCaptionHTMLFn = function(item, captionEl) {\n\t\t\tcaptionEl.children[0].innerHTML = `${ item.title }<br/><small>${ item.description }</small> `;\n\t\t\treturn true;\n\t\t};\n\n\t\tinitGallery(document.getElementById('pswp'), images.items, galleryOptions);\n\t});\n\n\t$(document).on('click', '.room-files-image', (e) => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tconst img = new Image();\n\t\timg.src = e.currentTarget.href;\n\t\timg.addEventListener('load', function() {\n\t\t\tconst item = [{\n\t\t\t\tsrc: this.src,\n\t\t\t\tw: this.naturalWidth,\n\t\t\t\th: this.naturalHeight\n\t\t\t}];\n\n\t\t\tinitGallery(document.getElementById('pswp'), item, galleryOptions);\n\t\t});\n\t});\n});\n","Template.cmsPage.onCreated(function() {\n\tthis.page = new ReactiveVar('');\n\treturn Meteor.autorun(() => {\n\t\tconst cmsPage = Session.get('cmsPage');\n\t\tif (cmsPage != null) {\n\t\t\treturn this.page.set(RocketChat.settings.get(cmsPage));\n\t\t}\n\t});\n});\n\nTemplate.cmsPage.helpers({\n\tpage() {\n\t\treturn Template.instance().page.get();\n\t}\n});\n\nTemplate.cmsPage.events({\n\t'click .cms-page-close'() {\n\t\treturn FlowRouter.go('/');\n\t}\n});\n\nTemplate.cmsPage.onRendered(function() {\n\treturn $('#initial-page-loading').remove();\n});\n","Template.fxOsInstallPrompt.onRendered(function() {\n\n\tconst showPrompt = function() {\n\t\tconst request = window.navigator.mozApps.install(`http://${ location.host }/manifest.webapp`);\n\t\trequest.onsuccess = function() {\n\t\t\tBlazeLayout.render('fxOsInstallDone');\n\t\t};\n\t\trequest.onerror = function() {\n\t\t\tBlazeLayout.render('fxOsInstallError', {\n\t\t\t\tinstallError: this.error.name\n\t\t\t});\n\t\t};\n\t};\n\tsetTimeout(showPrompt, 2000);\n\treturn $('#initial-page-loading').remove();\n});\n\nTemplate.fxOsInstallDone.onRendered(() => $('#initial-page-loading').remove());\nTemplate.fxOsInstallError.onRendered(() => $('#initial-page-loading').remove());\n","Template.modal.rendered = function() {};\n"]}