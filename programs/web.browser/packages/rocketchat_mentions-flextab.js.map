{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:mentions-flextab/client/lib/MentionedMessage.js","meteor://ðŸ’»app/packages/rocketchat:mentions-flextab/client/views/mentionsFlexTab.js","meteor://ðŸ’»app/packages/rocketchat:mentions-flextab/client/actionButton.js","meteor://ðŸ’»app/packages/rocketchat:mentions-flextab/client/tabBar.js"],"names":["MentionedMessage","Mongo","Collection","Template","mentionsFlexTab","helpers","hasMessages","find","rid","sort","ts","count","messages","message","_","extend","customClass","hasMore","instance","get","onCreated","ReactiveVar","limit","autorun","mentionedMessageFind","data","subscribe","set","events","e","t","stopPropagation","preventDefault","message_id","$","currentTarget","closest","attr","RocketChat","MessageAction","hideDropDown","remove","findOne","actions","getButtons","el","Blaze","toHTMLWithData","messageDropdown","append","dropDown","show","throttle","target","scrollTop","scrollHeight","clientHeight","Meteor","startup","addButton","id","icon","i18nLabel","context","action","_arguments","RoomHistoryManager","getSurroundingMessages","validation","mentionedList","order","TabBar","groups","i18nTitle","template"],"mappings":"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","file":"/packages/rocketchat_mentions-flextab.js","sourcesContent":["this.MentionedMessage = new Mongo.Collection('rocketchat_mentioned_message');\n","/*globals MentionedMessage */\nTemplate.mentionsFlexTab.helpers({\n\thasMessages() {\n\t\treturn MentionedMessage.find({\n\t\t\trid: this.rid\n\t\t}, {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t}\n\t\t}).count() > 0;\n\t},\n\tmessages() {\n\t\treturn MentionedMessage.find({\n\t\t\trid: this.rid\n\t\t}, {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t}\n\t\t});\n\t},\n\tmessage() {\n\t\treturn _.extend(this, {\n\t\t\tcustomClass: 'mentions'\n\t\t});\n\t},\n\thasMore() {\n\t\treturn Template.instance().hasMore.get();\n\t}\n});\n\nTemplate.mentionsFlexTab.onCreated(function() {\n\tthis.hasMore = new ReactiveVar(true);\n\tthis.limit = new ReactiveVar(50);\n\treturn this.autorun(() => {\n\t\tconst mentionedMessageFind = MentionedMessage.find({ rid: this.data.rid });\n\t\treturn this.subscribe('mentionedMessages', this.data.rid, this.limit.get(), () => {\n\t\t\tif (mentionedMessageFind.count() < this.limit.get()) {\n\t\t\t\treturn this.hasMore.set(false);\n\t\t\t}\n\t\t});\n\t});\n});\n\nTemplate.mentionsFlexTab.events({\n\t'click .message-cog'(e, t) {\n\t\te.stopPropagation();\n\t\te.preventDefault();\n\t\tconst message_id = $(e.currentTarget).closest('.message').attr('id');\n\t\tRocketChat.MessageAction.hideDropDown();\n\t\tt.$(`\\#${ message_id } .message-dropdown`).remove();\n\t\tconst message = MentionedMessage.findOne(message_id);\n\t\tconst actions = RocketChat.MessageAction.getButtons(message, 'mentions');\n\t\tconst el = Blaze.toHTMLWithData(Template.messageDropdown, {\n\t\t\tactions\n\t\t});\n\t\tt.$(`\\#${ message_id } .message-cog-container`).append(el);\n\t\tconst dropDown = t.$(`\\#${ message_id } .message-dropdown`);\n\t\treturn dropDown.show();\n\t},\n\t'scroll .content': _.throttle(function(e, instance) {\n\t\tif (e.target.scrollTop >= e.target.scrollHeight - e.target.clientHeight && instance.hasMore.get()) {\n\t\t\treturn instance.limit.set(instance.limit.get() + 50);\n\t\t}\n\t}, 200)\n});\n","Meteor.startup(function() {\n\treturn RocketChat.MessageAction.addButton({\n\t\tid: 'jump-to-message',\n\t\ticon: 'icon-right-hand',\n\t\ti18nLabel: 'Jump_to_message',\n\t\tcontext: ['mentions'],\n\t\taction() {\n\t\t\tconst message = this._arguments[1];\n\t\t\tRocketChat.MessageAction.hideDropDown();\n\t\t\treturn RoomHistoryManager.getSurroundingMessages(message, 50);\n\t\t},\n\t\tvalidation(message) {\n\t\t\treturn message.mentionedList === true;\n\t\t},\n\t\torder: 100\n\t});\n});\n","Meteor.startup(function() {\n\treturn RocketChat.TabBar.addButton({\n\t\tgroups: ['channel', 'group'],\n\t\tid: 'mentions',\n\t\ti18nTitle: 'Mentions',\n\t\ticon: 'icon-at',\n\t\ttemplate: 'mentionsFlexTab',\n\t\torder: 3\n\t});\n});\n"]}