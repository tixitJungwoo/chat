{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:emoji/function-isSet.js","meteor://ðŸ’»app/packages/rocketchat:emoji/rocketchat.js","meteor://ðŸ’»app/packages/rocketchat:emoji/emojiParser.js","meteor://ðŸ’»app/packages/rocketchat:emoji/emojiPicker.js","meteor://ðŸ’»app/packages/rocketchat:emoji/lib/emojiRenderer.js","meteor://ðŸ’»app/packages/rocketchat:emoji/lib/EmojiPicker.js","meteor://ðŸ’»app/packages/rocketchat:emoji/emojiButton.js","meteor://ðŸ’»app/packages/rocketchat:emoji/keyboardFix.js"],"names":["isSet","fn","value","e","undefined","isSetNotNull","RocketChat","emoji","packages","base","emojiCategories","recent","TAPi18n","__","emojisByCategory","toneList","render","html","list","callbacks","add","message","Meteor","user","settings","preferences","useEmojis","_","trim","replace","Object","keys","forEach","emojiPackage","checkEmojiOnly","$","emojiOnly","childNode","childNodes","hasOwnProperty","child","hasClass","addClass","text","unwrap","priority","LOW","categoryName","category","getEmojisByCategory","t","Template","instance","actualTone","tone","total","length","i","correctPackage","image","getEmojisBySearchTerm","searchTerm","searchRegExp","RegExp","escape","test","emojiObject","emojiFound","key","contents","indexOf","emojiPicker","helpers","categories","push","emojiByCategory","concat","isVisible","currentCategory","get","emojiList","currentSearchTerm","activeCategory","recentNeedsUpdate","currentTone","hash","events","event","stopPropagation","preventDefault","val","change","focus","set","currentTarget","substr","toggleClass","parseInt","dataset","newTone","EmojiPicker","setTone","setCurrentTone","input","pickEmoji","keyCode","target","cst","onCreated","getTone","getRecent","ReactiveVar","removeClass","autorun","renderEmoji","Blaze","registerHelper","view","getData","HTML","Raw","width","height","initiated","source","opened","pickCallback","init","window","localStorage","getItem","split","document","body","click","closest","is","close","resize","debounce","setPosition","isOpened","setItem","sourcePos","offset","left","top","cssProperties","windowSize","pickerWidth","emojiButtonSize","outerWidth","css","open","callback","containerEl","emojiInput","find","addRecent","pos","splice","unshift","updateRecent","refreshDynamicEmojiLists","dynamicEmojiLists","emojiCustom","rocket","without","messageBox","parent","emojiValue","caretPos","prop","textAreaTxt","substring","isCordova","addEventListener","device","platform","toLowerCase"],"mappings":"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","file":"/packages/rocketchat_emoji.js","sourcesContent":["/* globals isSet:true, isSetNotNull:true */\n//http://stackoverflow.com/a/26990347 function isSet() from Gajus\nisSet = function(fn) {\n\tlet value;\n\ttry {\n\t\tvalue = fn();\n\t} catch (e) {\n\t\tvalue = undefined;\n\t} finally {\n\t\treturn value !== undefined;\n\t}\n};\n\nisSetNotNull = function(fn) {\n\tlet value;\n\ttry {\n\t\tvalue = fn();\n\t} catch (e) {\n\t\tvalue = null;\n\t} finally {\n\t\treturn value !== null && value !== undefined;\n\t}\n};\n\n/* exported isSet, isSetNotNull */\n","RocketChat.emoji = {\n\tpackages: {\n\t\tbase: {\n\t\t\temojiCategories: { recent: TAPi18n.__('Frequently_Used') },\n\t\t\temojisByCategory: {\n\t\t\t\trecent: []\n\t\t\t},\n\t\t\ttoneList: {},\n\t\t\trender(html) {\n\t\t\t\treturn html;\n\t\t\t}\n\t\t}\n\t},\n\tlist: {}\n};\n","/* globals isSetNotNull */\n/*\n * emojiParser is a function that will replace emojis\n * @param {Object} message - The message object\n */\nRocketChat.callbacks.add('renderMessage', (message) => {\n\tif (isSetNotNull(() => Meteor.user().settings.preferences.useEmojis) && !Meteor.user().settings.preferences.useEmojis) {\n\t\treturn message;\n\t}\n\n\tif (_.trim(message.html)) {\n\t\t//&#39; to apostrophe (') for emojis such as :')\n\t\tmessage.html = message.html.replace(/&#39;/g, '\\'');\n\n\t\tObject.keys(RocketChat.emoji.packages).forEach((emojiPackage) => {\n\t\t\tmessage.html = RocketChat.emoji.packages[emojiPackage].render(message.html);\n\t\t});\n\n\t\tconst checkEmojiOnly = $(`<div>${ message.html }</div>`);\n\t\tlet emojiOnly = true;\n\t\tfor (const childNode in checkEmojiOnly[0].childNodes) {\n\t\t\tif (checkEmojiOnly[0].childNodes.hasOwnProperty(childNode)) {\n\t\t\t\tconst child = $(checkEmojiOnly[0].childNodes[childNode]);\n\n\t\t\t\tif (child.hasClass('emoji') || child.hasClass('emojione')) {\n\t\t\t\t\tcheckEmojiOnly[0].childNodes[childNode] = child.addClass('big');\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (_.trim(child.text()) === '') {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\temojiOnly = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (emojiOnly) {\n\t\t\tmessage.html = checkEmojiOnly.unwrap().html();\n\t\t}\n\n\t\t//apostrophe (') back to &#39;\n\t\tmessage.html = message.html.replace(/\\'/g, '&#39;');\n\t}\n\n\treturn message;\n}, RocketChat.callbacks.priority.LOW, 'emoji');\n","/* globals Template, isSetNotNull */\nconst emojiCategories = {};\n/**\n * Turns category hash to a nice readable translated name\n * @param {string} category hash\n * @return {string} readable and translated\n */\nfunction categoryName(category) {\n\tfor (const emojiPackage in RocketChat.emoji.packages) {\n\t\tif (RocketChat.emoji.packages.hasOwnProperty(emojiPackage)) {\n\t\t\tif (RocketChat.emoji.packages[emojiPackage].emojiCategories.hasOwnProperty(category)) {\n\t\t\t\treturn RocketChat.emoji.packages[emojiPackage].emojiCategories[category];\n\t\t\t}\n\t\t}\n\t}\n\tif (emojiCategories.hasOwnProperty(category)) {\n\t\treturn emojiCategories[category];\n\t}\n\t// unknown category; better hash than nothing\n\treturn category;\n}\n\nfunction getEmojisByCategory(category) {\n\tconst t = Template.instance();\n\tconst actualTone = t.tone;\n\tlet html = '';\n\tfor (const emojiPackage in RocketChat.emoji.packages) {\n\t\tif (RocketChat.emoji.packages.hasOwnProperty(emojiPackage)) {\n\t\t\tif (RocketChat.emoji.packages[emojiPackage].emojisByCategory.hasOwnProperty(category)) {\n\t\t\t\tconst total = RocketChat.emoji.packages[emojiPackage].emojisByCategory[category].length;\n\t\t\t\tfor (let i = 0; i < total; i++) {\n\t\t\t\t\tconst emoji = RocketChat.emoji.packages[emojiPackage].emojisByCategory[category][i];\n\t\t\t\t\tlet tone = '';\n\n\t\t\t\t\tif (actualTone > 0 && RocketChat.emoji.packages[emojiPackage].toneList.hasOwnProperty(emoji)) {\n\t\t\t\t\t\ttone = `_tone${ actualTone }`;\n\t\t\t\t\t}\n\n\t\t\t\t\t//set correctPackage here to allow for recent emojis to work properly\n\t\t\t\t\tif (isSetNotNull(() => RocketChat.emoji.list[`:${ emoji }:`].emojiPackage)) {\n\t\t\t\t\t\tconst correctPackage = RocketChat.emoji.list[`:${ emoji }:`].emojiPackage;\n\t\t\t\t\t\tconst image = RocketChat.emoji.packages[correctPackage].render(`:${ emoji }${ tone }:`);\n\n\t\t\t\t\t\thtml += `<li class=\"emoji-${ emoji }\" data-emoji=\"${ emoji }\" title=\"${ emoji }\">${ image }</li>`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn html;\n}\n\nfunction getEmojisBySearchTerm(searchTerm) {\n\tlet html = '';\n\tconst t = Template.instance();\n\tconst actualTone = t.tone;\n\n\tconst searchRegExp = new RegExp(RegExp.escape(searchTerm.replace(/:/g, '')), 'i');\n\n\tfor (let emoji in RocketChat.emoji.list) {\n\t\tif (!RocketChat.emoji.list.hasOwnProperty(emoji)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (searchRegExp.test(emoji)) {\n\t\t\tconst emojiObject = RocketChat.emoji.list[emoji];\n\t\t\tconst emojiPackage = emojiObject.emojiPackage;\n\t\t\tlet tone = '';\n\t\t\temoji = emoji.replace(/:/g, '');\n\n\t\t\tif (actualTone > 0 && RocketChat.emoji.packages[emojiPackage].toneList.hasOwnProperty(emoji)) {\n\t\t\t\ttone = `_tone${ actualTone }`;\n\t\t\t}\n\n\t\t\tlet emojiFound = false;\n\n\t\t\tfor (const key in RocketChat.emoji.packages[emojiPackage].emojisByCategory) {\n\t\t\t\tif (RocketChat.emoji.packages[emojiPackage].emojisByCategory.hasOwnProperty(key)) {\n\t\t\t\t\tconst contents = RocketChat.emoji.packages[emojiPackage].emojisByCategory[key];\n\t\t\t\t\tif (contents.indexOf(emoji) !== -1) {\n\t\t\t\t\t\temojiFound = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (emojiFound) {\n\t\t\t\tconst image = RocketChat.emoji.packages[emojiPackage].render(`:${ emoji }${ tone }:`);\n\t\t\t\thtml += `<li class=\"emoji-${ emoji }\" data-emoji=\"${ emoji }\" title=\"${ emoji }\">${ image }</li>`;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn html;\n}\n\nTemplate.emojiPicker.helpers({\n\tcategory() {\n\t\tconst categories = [];\n\t\tfor (const emojiPackage in RocketChat.emoji.packages) {\n\t\t\tif (RocketChat.emoji.packages.hasOwnProperty(emojiPackage)) {\n\t\t\t\tfor (const key in RocketChat.emoji.packages[emojiPackage].emojisByCategory) {\n\t\t\t\t\tif (RocketChat.emoji.packages[emojiPackage].emojisByCategory.hasOwnProperty(key)) {\n\t\t\t\t\t\tcategories.push(key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn categories;\n\t},\n\temojiByCategory(category) {\n\t\tlet emojisByCategory = [];\n\t\tfor (const emojiPackage in RocketChat.emoji.packages) {\n\t\t\tif (RocketChat.emoji.packages.hasOwnProperty(emojiPackage)) {\n\t\t\t\tif (RocketChat.emoji.packages[emojiPackage].emojisByCategory.hasOwnProperty(category)) {\n\t\t\t\t\temojisByCategory = emojisByCategory.concat(RocketChat.emoji.packages[emojiPackage].emojisByCategory[category]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn emojisByCategory;\n\t},\n\tisVisible(category) {\n\t\treturn Template.instance().currentCategory.get() === category ? 'visible' : '';\n\t},\n\temojiList(category) {\n\t\tconst t = Template.instance();\n\t\tconst searchTerm = t.currentSearchTerm.get();\n\t\tconst activeCategory = t.currentCategory.get();\n\t\t//this will cause the reflow when recent list gets updated\n\t\tt.recentNeedsUpdate.get();\n\n\t\t//we only need to replace the active category, since switching tabs resets the filter\n\t\tif (activeCategory !== category) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (searchTerm.length > 0) {\n\t\t\treturn getEmojisBySearchTerm(searchTerm);\n\t\t} else {\n\t\t\treturn getEmojisByCategory(category);\n\t\t}\n\t},\n\tcurrentTone() {\n\t\treturn `tone-${ Template.instance().tone }`;\n\t},\n\t/**\n\t * Returns true if a given emoji category is active\n\t *\n\t * @param {string} category hash\n\t * @return {boolean} true if active, false otherwise\n\t */\n\tactiveCategory(category) {\n\t\treturn Template.instance().currentCategory.get() === category ? 'active' : '';\n\t},\n\tcategoryName,\n\t/**\n\t * Returns currently active emoji category hash\n\t *\n\t * @return {string} category hash\n\t */\n\tcurrentCategory() {\n\t\tconst t = Template.instance();\n\t\tconst hash = t.currentCategory.get();\n\t\tconst searchTerm = t.currentSearchTerm.get();\n\n\t\tif (searchTerm.length > 0) {\n\t\t\treturn TAPi18n.__('Search');\n\t\t} else {\n\t\t\treturn categoryName(hash);\n\t\t}\n\t}\n});\n\nTemplate.emojiPicker.events({\n\t'click .emoji-picker'(event) {\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\t},\n\t'click .category-link'(event, instance) {\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\n\t\tinstance.$('.emoji-filter .search').val('').change();\n\t\tinstance.$('.emoji-filter .search').focus();\n\n\t\tinstance.currentCategory.set(event.currentTarget.hash.substr(1));\n\n\t\treturn false;\n\t},\n\t'click .change-tone > a'(event, instance) {\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\n\t\tinstance.$('.tone-selector').toggleClass('show');\n\t},\n\t'click .tone-selector .tone'(event, instance) {\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\n\t\tconst tone = parseInt(event.currentTarget.dataset.tone);\n\t\tlet newTone;\n\n\t\tif (tone > 0) {\n\t\t\tnewTone = `_tone${ tone }`;\n\t\t} else {\n\t\t\tnewTone = '';\n\t\t}\n\n\t\tfor (const emojiPackage in RocketChat.emoji.packages) {\n\t\t\tif (RocketChat.emoji.packages.hasOwnProperty(emojiPackage)) {\n\t\t\t\tif (RocketChat.emoji.packages[emojiPackage].hasOwnProperty('toneList')) {\n\t\t\t\t\tfor (const emoji in RocketChat.emoji.packages[emojiPackage].toneList) {\n\t\t\t\t\t\tif (RocketChat.emoji.packages[emojiPackage].toneList.hasOwnProperty(emoji)) {\n\t\t\t\t\t\t\t$(`.emoji-${ emoji }`).html(RocketChat.emoji.packages[emojiPackage].render(`:${ emoji }${ newTone }:`));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.EmojiPicker.setTone(tone);\n\n\t\tinstance.setCurrentTone(tone);\n\n\t\t$('.tone-selector').toggleClass('show');\n\t},\n\t'click .emoji-list li'(event, instance) {\n\t\tevent.stopPropagation();\n\n\t\tconst emoji = event.currentTarget.dataset.emoji;\n\t\tconst actualTone = instance.tone;\n\t\tlet tone = '';\n\n\t\tfor (const emojiPackage in RocketChat.emoji.packages) {\n\t\t\tif (RocketChat.emoji.packages.hasOwnProperty(emojiPackage)) {\n\t\t\t\tif (actualTone > 0 && RocketChat.emoji.packages[emojiPackage].toneList.hasOwnProperty(emoji)) {\n\t\t\t\t\ttone = `_tone${ actualTone }`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst input = $('.emoji-filter input.search');\n\t\tif (input) {\n\t\t\tinput.val('');\n\t\t}\n\t\tinstance.currentSearchTerm.set('');\n\n\t\tRocketChat.EmojiPicker.pickEmoji(emoji + tone);\n\t},\n\t'keydown .emoji-filter .search'(event) {\n\t\tif (event.keyCode === 13) {\n\t\t\tevent.preventDefault();\n\t\t}\n\t},\n\t'keyup .emoji-filter .search, change .emoji-filter .search'(event, instance) {\n\t\tconst value = event.target.value.trim();\n\t\tconst cst = instance.currentSearchTerm;\n\t\tif (value === cst.get()) {\n\t\t\treturn;\n\t\t}\n\t\tcst.set(value);\n\t}\n});\n\nTemplate.emojiPicker.onCreated(function() {\n\tthis.tone = RocketChat.EmojiPicker.getTone();\n\tconst recent = RocketChat.EmojiPicker.getRecent();\n\tthis.recentNeedsUpdate = new ReactiveVar(false);\n\tthis.currentCategory = new ReactiveVar(recent.length > 0 ? 'recent' : 'people');\n\tthis.currentSearchTerm = new ReactiveVar('');\n\n\trecent.forEach((emoji) => {\n\t\tRocketChat.emoji.packages.base.emojisByCategory.recent.push(emoji);\n\t});\n\n\tthis.setCurrentTone = (newTone) => {\n\t\t$('.current-tone').removeClass(`tone-${ this.tone }`);\n\t\t$('.current-tone').addClass(`tone-${ newTone }`);\n\t\tthis.tone = newTone;\n\t};\n\n\tthis.autorun(() => {\n\t\tif (this.recentNeedsUpdate.get()) {\n\t\t\tthis.recentNeedsUpdate.set(false);\n\t\t}\n\t});\n});\n","/* globals HTML, isSetNotNull, renderEmoji:true */\nrenderEmoji = function(emoji) {\n\tif (isSetNotNull(() => RocketChat.emoji.list[emoji].emojiPackage)) {\n\t\tconst emojiPackage = RocketChat.emoji.list[emoji].emojiPackage;\n\t\treturn RocketChat.emoji.packages[emojiPackage].render(emoji);\n\t}\n};\n\nBlaze.registerHelper('renderEmoji', renderEmoji);\n\nTemplate.registerHelper('renderEmoji', new Template('renderEmoji', function() {\n\tconst view = this;\n\tconst emoji = Blaze.getData(view);\n\n\tif (isSetNotNull(() => RocketChat.emoji.list[emoji].emojiPackage)) {\n\t\tconst emojiPackage = RocketChat.emoji.list[emoji].emojiPackage;\n\t\treturn new HTML.Raw(RocketChat.emoji.packages[emojiPackage].render(emoji));\n\t}\n\n\treturn '';\n}));\n\n/* exported renderEmoji */\n","/* globals Blaze, Template */\nRocketChat.EmojiPicker = {\n\twidth: 390,\n\theight: 238,\n\tinitiated: false,\n\tinput: null,\n\tsource: null,\n\trecent: [],\n\ttone: null,\n\topened: false,\n\tpickCallback: null,\n\tinit() {\n\t\tif (this.initiated) {\n\t\t\treturn;\n\t\t}\n\t\tthis.initiated = true;\n\n\t\tthis.recent = window.localStorage.getItem('emoji.recent') ? window.localStorage.getItem('emoji.recent').split(',') : [];\n\t\tthis.tone = window.localStorage.getItem('emoji.tone') || 0;\n\n\t\tBlaze.render(Template.emojiPicker, document.body);\n\n\t\t$(document).click((event) => {\n\t\t\tif (!this.opened) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!$(event.target).closest('.emoji-picker').length && !$(event.target).is('.emoji-picker')) {\n\t\t\t\tif (this.opened) {\n\t\t\t\t\tthis.close();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$(window).resize(_.debounce(() => {\n\t\t\tif (!this.opened) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.setPosition();\n\t\t}, 300));\n\t},\n\tisOpened() {\n\t\treturn this.opened;\n\t},\n\tsetTone(tone) {\n\t\tthis.tone = tone;\n\t\twindow.localStorage.setItem('emoji.tone', tone);\n\t},\n\tgetTone() {\n\t\treturn this.tone;\n\t},\n\tgetRecent() {\n\t\treturn this.recent;\n\t},\n\tsetPosition() {\n\t\tconst sourcePos = $(this.source).offset();\n\t\tconst left = sourcePos.left;\n\t\tconst top = (sourcePos.top - this.height - 5);\n\t\tconst cssProperties = {\n\t\t\ttop,\n\t\t\tleft\n\t\t};\n\n\t\tif (top < 0) {\n\t\t\tcssProperties.top = 10;\n\t\t}\n\n\t\tif (left < 35) {\n\t\t\tcssProperties.left = 0;\n\t\t} else {\n\t\t\tconst windowSize = $(window).width();\n\t\t\tconst pickerWidth = $('.emoji-picker').width();\n\n\t\t\tif (left + pickerWidth > windowSize) {\n\t\t\t\tconst emojiButtonSize = $('.reaction-message.message-action').outerWidth();\n\t\t\t\tcssProperties.left = left - pickerWidth + emojiButtonSize;\n\t\t\t}\n\t\t}\n\n\t\treturn $('.emoji-picker').css(cssProperties);\n\t},\n\topen(source, callback) {\n\t\tif (!this.initiated) {\n\t\t\tthis.init();\n\t\t}\n\t\tthis.pickCallback = callback;\n\t\tthis.source = source;\n\n\t\tconst containerEl = this.setPosition();\n\t\tcontainerEl.addClass('show');\n\n\t\tconst emojiInput = containerEl.find('.emoji-filter input.search');\n\t\tif (emojiInput) {\n\t\t\temojiInput.focus();\n\t\t}\n\t\tthis.opened = true;\n\t},\n\tclose() {\n\t\t$('.emoji-picker').removeClass('show');\n\t\tthis.opened = false;\n\t},\n\tpickEmoji(emoji) {\n\t\tthis.pickCallback(emoji);\n\n\t\tthis.close();\n\t\tthis.addRecent(emoji);\n\t},\n\taddRecent(emoji) {\n\t\tconst pos = this.recent.indexOf(emoji);\n\n\t\tif (pos !== -1) {\n\t\t\tthis.recent.splice(pos, 1);\n\t\t}\n\n\t\tthis.recent.unshift(emoji);\n\n\t\twindow.localStorage.setItem('emoji.recent', this.recent);\n\t\tRocketChat.emoji.packages.base.emojisByCategory.recent = this.recent;\n\t\tthis.updateRecent();\n\t},\n\tupdateRecent() {\n\t\tconst instance = Template.instance();\n\t\tif (instance) {\n\t\t\tinstance.recentNeedsUpdate.set(true);\n\t\t} else {\n\t\t\tthis.refreshDynamicEmojiLists();\n\t\t}\n\t},\n\trefreshDynamicEmojiLists() {\n\t\tconst dynamicEmojiLists = [\n\t\t\tRocketChat.emoji.packages.base.emojisByCategory.recent,\n\t\t\tRocketChat.emoji.packages.emojiCustom.emojisByCategory.rocket\n\t\t];\n\n\t\tdynamicEmojiLists.forEach((category) => {\n\t\t\tif (category) {\n\t\t\t\tfor (let i = 0; i < category.length; i++) {\n\t\t\t\t\tconst emoji = category[i];\n\t\t\t\t\tif (!RocketChat.emoji.list[`:${ emoji }:`]) {\n\t\t\t\t\t\tcategory = _.without(category, emoji);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n","/* globals Template */\nTemplate.messageBox.events({\n\t'click .emoji-picker-icon'(event) {\n\t\tevent.stopPropagation();\n\t\tif (RocketChat.EmojiPicker.isOpened()) {\n\t\t\tRocketChat.EmojiPicker.close();\n\t\t} else {\n\t\t\tRocketChat.EmojiPicker.open(event.currentTarget, (emoji) => {\n\t\t\t\tconst input = $(event.currentTarget).parent().parent().find('.input-message');\n\n\t\t\t\tconst emojiValue = `:${ emoji }:`;\n\n\t\t\t\tconst caretPos = input.prop('selectionStart');\n\t\t\t\tconst textAreaTxt = input.val();\n\n\t\t\t\tinput.val(textAreaTxt.substring(0, caretPos) + emojiValue + textAreaTxt.substring(caretPos));\n\n\t\t\t\tinput.focus();\n\n\t\t\t\tinput.prop('selectionStart', caretPos + emojiValue.length);\n\t\t\t\tinput.prop('selectionEnd', caretPos + emojiValue.length);\n\t\t\t});\n\t\t}\n\t}\n});\n\nTemplate.messageBox.onCreated(function() {\n\tRocketChat.EmojiPicker.init();\n});\n","/* global device */\n\nif (Meteor.isCordova) {\n\twindow.addEventListener('native.keyboardshow', function() {\n\t\tif ((typeof device !== 'undefined' && device !== null ? device.platform.toLowerCase() : false) !== 'android') {\n\t\t\tRocketChat.EmojiPicker.setPosition();\n\t\t}\n\t});\n\twindow.addEventListener('native.keyboardhide', function() {\n\t\tif ((typeof device !== 'undefined' && device !== null ? device.platform.toLowerCase() : false) !== 'android') {\n\t\t\tRocketChat.EmojiPicker.setPosition();\n\t\t}\n\t});\n}\n"]}