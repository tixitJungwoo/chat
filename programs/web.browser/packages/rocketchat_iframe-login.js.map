{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:iframe-login/iframe_client.js"],"names":["_unstoreLoginToken","Accounts","RocketChat","iframeLogin","tryLogin","apply","arguments","IframeLogin","enabled","reactiveIframeUrl","ReactiveVar","reactiveEnabled","iframeUrl","undefined","apiUrl","apiMethod","Tracker","autorun","c","settings","get","set","stop","_storedLoginToken","callback","console","log","options","beforeSend","xhr","withCredentials","separator","indexOf","window","cordova","navigator","userAgent","HTTP","call","error","result","data","token","loginWithToken","Match","test","String","loginToken","Meteor","callLoginMethod","methodArguments","iframe","userCallback","requestCredential","serviceName","tokenOrError","Error","secret","OAuth","_retrieveCredentialSecret","credential","serviceData","addEventListener","e","_","isObject","event","source","postMessage","response","message","origin","fbLoginSuccess","fbLoginError","facebookConnectPlugin","authResponse","accessToken","expiresIn","expiresAt","userID","id","getLoginStatus","status","login","permissions","twitterLoginSuccess","twitterLoginFailure","TwitterConnect","userName","screenName","userId","accessTokenSecret","googleLoginSuccess","oauthToken","googleLoginFailure","plugins","googleplus","email","displayName","name","gender","imageUrl","picture","givenName","given_name","familyName","family_name","scopes","webClientId","offline"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,sHAEA,IAAMA,qBAAqBC,SAASD,kBAApC;;AACAC,SAASD,kBAAT,GAA8B,YAAW;AACxCE,YAAWC,WAAX,CAAuBC,QAAvB;;AACAJ,oBAAmBK,KAAnB,CAAyBJ,QAAzB,EAAmCK,SAAnC;AACA,CAHD;;IAKMC,W;AACL,wBAAc;AAAA;;AAAA;AACb,OAAKC,OAAL,GAAe,KAAf;AACA,OAAKC,iBAAL,GAAyB,IAAIC,WAAJ,EAAzB;AACA,OAAKC,eAAL,GAAuB,IAAID,WAAJ,EAAvB;AACA,OAAKE,SAAL,GAAiBC,SAAjB;AACA,OAAKC,MAAL,GAAcD,SAAd;AACA,OAAKE,SAAL,GAAiBF,SAAjB;AAEAG,UAAQC,OAAR,CAAgB,UAACC,CAAD,EAAO;AACtB,SAAKV,OAAL,GAAeN,WAAWiB,QAAX,CAAoBC,GAApB,CAAwB,yBAAxB,CAAf;;AACA,SAAKT,eAAL,CAAqBU,GAArB,CAAyB,MAAKb,OAA9B;;AAEA,SAAKI,SAAL,GAAiBV,WAAWiB,QAAX,CAAoBC,GAApB,CAAwB,qBAAxB,CAAjB;AACA,SAAKN,MAAL,GAAcZ,WAAWiB,QAAX,CAAoBC,GAApB,CAAwB,yBAAxB,CAAd;AACA,SAAKL,SAAL,GAAiBb,WAAWiB,QAAX,CAAoBC,GAApB,CAAwB,4BAAxB,CAAjB;;AAEA,OAAI,MAAKZ,OAAL,KAAiB,KAArB,EAA4B;AAC3B,WAAOU,EAAEI,IAAF,EAAP;AACA;;AAED,OAAI,MAAKd,OAAL,KAAiB,IAAjB,IAAyB,MAAKI,SAA9B,IAA2C,MAAKE,MAAhD,IAA0D,MAAKC,SAAnE,EAA8E;AAC7EG,MAAEI,IAAF;;AACA,QAAI,CAACrB,SAASsB,iBAAT,EAAL,EAAmC;AAClC,WAAKnB,QAAL,CAAc,YAAM,CAAE,CAAtB;AACA;AACD;AACD,GAlBD;AAmBA;;uBAEDA,Q;oBAASoB,Q,EAAU;AAAA;;AAClB,OAAI,CAAC,KAAKhB,OAAV,EAAmB;AAClB;AACA;;AAED,OAAI,CAAC,KAAKI,SAAN,IAAmB,CAAC,KAAKE,MAAzB,IAAmC,CAAC,KAAKC,SAA7C,EAAwD;AACvD;AACA;;AAEDU,WAAQC,GAAR,CAAY,UAAZ;AACA,OAAMC,UAAU;AACfC,gBAAY,UAACC,GAAD,EAAS;AACpBA,SAAIC,eAAJ,GAAsB,IAAtB;AACA;AAHc,IAAhB;AAMA,OAAIlB,YAAY,KAAKA,SAArB;AACA,OAAImB,YAAY,GAAhB;;AACA,OAAInB,UAAUoB,OAAV,CAAkB,GAAlB,IAAyB,CAAC,CAA9B,EAAiC;AAChCD,gBAAY,GAAZ;AACA;;AAED,OAAIE,OAAOC,OAAX,EAAoB;AACnBtB,iBAAiBmB,SAAjB;AACA,IAFD,MAEO,IAAII,UAAUC,SAAV,CAAoBJ,OAApB,CAA4B,UAA5B,IAA0C,CAAC,CAA/C,EAAkD;AACxDpB,iBAAiBmB,SAAjB;AACA;;AAEDM,QAAKC,IAAL,CAAU,KAAKvB,SAAf,EAA0B,KAAKD,MAA/B,EAAuCa,OAAvC,EAAgD,UAACY,KAAD,EAAQC,MAAR,EAAmB;AAClEf,YAAQC,GAAR,CAAYa,KAAZ,EAAmBC,MAAnB;;AACA,QAAIA,UAAUA,OAAOC,IAAjB,IAAyBD,OAAOC,IAAP,CAAYC,KAAzC,EAAgD;AAC/C,YAAKC,cAAL,CAAoBH,OAAOC,IAA3B,EAAiC,UAACF,KAAD,EAAQC,MAAR,EAAmB;AACnD,UAAID,KAAJ,EAAW;AACV,cAAK9B,iBAAL,CAAuBY,GAAvB,CAA2BT,SAA3B;AACA,OAFD,MAEO;AACN,cAAKH,iBAAL,CAAuBY,GAAvB;AACA;;AACDG,eAASe,KAAT,EAAgBC,MAAhB;AACA,MAPD;AAQA,KATD,MASO;AACN,YAAK/B,iBAAL,CAAuBY,GAAvB,CAA2BT,SAA3B;;AACAY,cAASe,KAAT,EAAgBC,MAAhB;AACA;AACD,IAfD;AAgBA;;;;;uBAEDG,c;0BAAeD,K,EAAOlB,Q,EAAU;AAC/B,OAAI,CAAC,KAAKhB,OAAV,EAAmB;AAClB;AACA;;AAED,OAAIoC,MAAMC,IAAN,CAAWH,KAAX,EAAkBI,MAAlB,CAAJ,EAA+B;AAC9BJ,YAAQ;AACPA;AADO,KAAR;AAGA;;AAEDjB,WAAQC,GAAR,CAAY,gBAAZ;;AAEA,OAAIgB,MAAMK,UAAV,EAAsB;AACrB,WAAOC,OAAOL,cAAP,CAAsBD,MAAMK,UAA5B,EAAwCvB,QAAxC,CAAP;AACA;;AAEDvB,YAASgD,eAAT,CAAyB;AACxBC,qBAAiB,CAAC;AACjBC,aAAQ,IADS;AAEjBT,YAAOA,MAAMA;AAFI,KAAD,CADO;AAKxBU,kBAAc5B;AALU,IAAzB;AAOA;;;;;;;;AAGFtB,WAAWC,WAAX,GAAyB,IAAII,WAAJ,EAAzB;;AAEA,IAAM8C,oBAAoB,UAACC,WAAD,EAAyC;AAAA,KAA3B3B,OAA2B,uEAAjB,EAAiB;AAAA,KAAbH,QAAa;AAClES,QAAOqB,WAAP,EAAoBD,iBAApB,CAAsC1B,OAAtC,EAA+C,UAAC4B,YAAD,EAAkB;AAChE,MAAIA,gBAAgBA,wBAAwBC,KAA5C,EAAmD;AAClD,UAAOhC,SAAS+B,YAAT,CAAP;AACA;;AAED,MAAME,SAASC,MAAMC,yBAAN,CAAgCJ,YAAhC,CAAf;;AAEA,MAAI,CAACE,MAAL,EAAa;AACZ,UAAOjC,SAAS,IAAIgC,KAAJ,CAAU,gBAAV,CAAT,CAAP;AACA;;AAEDR,SAAOV,IAAP,CAAY,0BAAZ,EAAwCiB,YAAxC,EAAsDE,MAAtD,EAA8D,UAAClB,KAAD,EAAQqB,UAAR,EAAuB;AACpF,OAAI,CAACA,UAAL,EAAiB;AAChB,WAAOpC,SAAS,IAAIgC,KAAJ,CAAU,sBAAV,CAAT,CAAP;AACA;;AAEDhC,YAASoC,WAAWC,WAApB,EAAiCN,YAAjC,EAA+CE,MAA/C;AACA,GAND;AAOA,EAlBD;AAmBA,CApBD;;AAsBAxB,OAAO6B,gBAAP,CAAwB,SAAxB,EAAmC,UAACC,CAAD,EAAO;AACzC,KAAI,CAAEC,EAAEC,QAAF,CAAWF,EAAEtB,IAAb,CAAN,EAA0B;AACzB;AACA;;AAED,SAAQsB,EAAEtB,IAAF,CAAOyB,KAAf;AACC,OAAK,kBAAL;AACChE,cAAWC,WAAX,CAAuBC,QAAvB,CAAgC,UAACmC,KAAD,EAAW;AAC1C,QAAIA,KAAJ,EAAW;AACVwB,OAAEI,MAAF,CAASC,WAAT,CAAqB;AACpBF,aAAO,aADa;AAEpBG,gBAAU9B,MAAM+B;AAFI,MAArB,EAGGP,EAAEQ,MAHL;AAIA;AACD,IAPD;AAQA;;AAED,OAAK,kBAAL;AACCrE,cAAWC,WAAX,CAAuBwC,cAAvB,CAAsCoB,EAAEtB,IAAxC,EAA8C,UAACF,KAAD,EAAW;AACxD,QAAIA,KAAJ,EAAW;AACVwB,OAAEI,MAAF,CAASC,WAAT,CAAqB;AACpBF,aAAO,aADa;AAEpBG,gBAAU9B,MAAM+B;AAFI,MAArB,EAGGP,EAAEQ,MAHL;AAIA;AACD,IAPD;AAQA;;AAED,OAAK,qBAAL;AACC,OAAMC,iBAAiB,UAACH,QAAD,EAAc;AACpC5C,YAAQC,GAAR,CAAY,wBAAZ,EAAsC2C,QAAtC;AACAN,MAAEI,MAAF,CAASC,WAAT,CAAqB;AACpBF,YAAO,wBADa;AAEpBG,uBAFoB,CAGpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAVoB,KAArB,EAWGN,EAAEQ,MAXL;AAYA,IAdD;;AAgBA,OAAME,eAAe,UAAClC,KAAD,EAAQ8B,QAAR,EAAqB;AACzC5C,YAAQC,GAAR,CAAY,sBAAZ,EAAoCa,KAApC,EAA2C8B,QAA3C;AACAN,MAAEI,MAAF,CAASC,WAAT,CAAqB;AACpBF,YAAO,sBADa;AAEpB3B,iBAFoB;AAGpB8B;AAHoB,KAArB,EAIGN,EAAEQ,MAJL;AAKA,IAPD;;AASA,OAAI,OAAOtC,OAAOyC,qBAAd,KAAwC,WAA5C,EAAyD;AACxDrB,sBAAkB,UAAlB,EAA8B,EAA9B,EAAkC,UAACQ,WAAD,EAAcnB,KAAd,EAAqBe,MAArB,EAAgC;AACjE,SAAII,eAAeA,uBAAuBL,KAA1C,EAAiD;AAChD,aAAOiB,aAAa,kBAAb,EAAiCZ,WAAjC,CAAP;AACA,MAFD,MAEO;AACNW,qBAAe;AACdG,qBAAc;AACbC,qBAAaf,YAAYe,WADZ;AAEbC,mBAAWhB,YAAYiB,SAFV;AAGbrB;AAHa,QADA;AAMdsB,eAAQlB,YAAYmB;AANN,OAAf;AAQA;AACD,KAbD;AAcA;AACA;;AAEDN,yBAAsBO,cAAtB,CAAqC,UAACZ,QAAD,EAAc;AAClD,QAAIA,SAASa,MAAT,KAAoB,WAAxB,EAAqC;AACpC,YAAOV,eAAeH,QAAf,CAAP;AACA;;AAEDK,0BAAsBS,KAAtB,CAA4BpB,EAAEtB,IAAF,CAAO2C,WAAnC,EAAgDZ,cAAhD,EAAgE,UAACjC,KAAD,EAAW;AAC1E,YAAOkC,aAAa,aAAb,EAA4BlC,KAA5B,CAAP;AACA,KAFD;AAGA,IARD,EAQG,UAACA,KAAD,EAAW;AACb,WAAOkC,aAAa,kBAAb,EAAiClC,KAAjC,CAAP;AACA,IAVD;AAWA;;AAED,OAAK,oBAAL;AACC,OAAM8C,sBAAsB,UAAChB,QAAD,EAAc;AACzC5C,YAAQC,GAAR,CAAY,uBAAZ,EAAqC2C,QAArC;AACAN,MAAEI,MAAF,CAASC,WAAT,CAAqB;AACpBF,YAAO,uBADa;AAEpBG,uBAFoB,CAGpB;AACA;AACA;AACA;AACA;AACA;;AARoB,KAArB,EASGN,EAAEQ,MATL;AAUA,IAZD;;AAcA,OAAMe,sBAAsB,UAAC/C,KAAD,EAAW;AACtCd,YAAQC,GAAR,CAAY,qBAAZ,EAAmCa,KAAnC;AACAwB,MAAEI,MAAF,CAASC,WAAT,CAAqB;AACpBF,YAAO,qBADa;AAEpB3B;AAFoB,KAArB,EAGGwB,EAAEQ,MAHL;AAIA,IAND;;AAQA,OAAI,OAAOtC,OAAOsD,cAAd,KAAiC,WAArC,EAAkD;AACjDlC,sBAAkB,SAAlB,EAA6B,EAA7B,EAAiC,UAACQ,WAAD,EAAiB;AACjD,SAAIA,eAAeA,uBAAuBL,KAA1C,EAAiD;AAChD,aAAO8B,oBAAoB,kBAApB,EAAwCzB,WAAxC,CAAP;AACA,MAFD,MAEO;AACNwB,0BAAoB;AACnBG,iBAAU3B,YAAY4B,UADH;AAEnBC,eAAQ7B,YAAYmB,EAFD;AAGnBvB,eAAQI,YAAY8B,iBAHD;AAInBjD,cAAOmB,YAAYe;AAJA,OAApB;AAMA;AACD,KAXD;AAYA;AACA;;AAEDW,kBAAeJ,KAAf,CAAqBE,mBAArB,EAA0CC,mBAA1C;AACA;;AAED,OAAK,mBAAL;AACC,OAAMM,qBAAqB,UAACvB,QAAD,EAAc;AACxC,QAAI,OAAOA,SAASwB,UAAhB,KAA+B,QAA/B,IAA2C,OAAOxB,SAASO,WAAhB,KAAgC,QAA/E,EAAyF;AACxFP,cAASO,WAAT,GAAuBP,SAASwB,UAAhC;AACA;;AAEDpE,YAAQC,GAAR,CAAY,sBAAZ,EAAoC2C,QAApC;AACAN,MAAEI,MAAF,CAASC,WAAT,CAAqB;AACpBF,YAAO,sBADa;AAEpBG,uBAFoB,CAGpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAboB,KAArB,EAcGN,EAAEQ,MAdL;AAeA,IArBD;;AAuBA,OAAMuB,qBAAqB,UAACvD,KAAD,EAAW;AACrCd,YAAQC,GAAR,CAAY,oBAAZ,EAAkCa,KAAlC;AACAwB,MAAEI,MAAF,CAASC,WAAT,CAAqB;AACpBF,YAAO,oBADa;AAEpB3B;AAFoB,KAArB,EAGGwB,EAAEQ,MAHL;AAIA,IAND;;AAQA,OAAI,OAAOtC,OAAO8D,OAAd,KAA0B,WAA1B,IAAyC,OAAO9D,OAAO8D,OAAP,CAAeC,UAAtB,KAAqC,WAAlF,EAA+F;AAC9F3C,sBAAkB,QAAlB,EAA4B,EAA5B,EAAgC,UAACQ,WAAD,EAAiB;AAChD,SAAIA,eAAeA,uBAAuBL,KAA1C,EAAiD;AAChD,aAAOsC,mBAAmB,kBAAnB,EAAuCjC,WAAvC,CAAP;AACA,MAFD,MAEO;AACN+B,yBAAmB;AAClBK,cAAOpC,YAAYoC,KADD;AAElBP,eAAQ7B,YAAYmB,EAFF;AAGlBkB,oBAAarC,YAAYsC,IAHP;AAIlBC,eAAQvC,YAAYuC,MAJF;AAKlBC,iBAAUxC,YAAYyC,OALJ;AAMlBC,kBAAW1C,YAAY2C,UANL;AAOlBC,mBAAY5C,YAAY6C,WAPN;AAQlB9B,oBAAaf,YAAYe;AARP,OAAnB;AAUA;AACD,KAfD;AAgBA;AACA;;AAED,OAAMjD,UAAU;AACfgF,YAAQ5C,EAAEtB,IAAF,CAAOkE,MADA;AAEfC,iBAAa7C,EAAEtB,IAAF,CAAOmE,WAFL;AAGfC,aAAS;AAHM,IAAhB;AAMA5E,UAAO8D,OAAP,CAAeC,UAAf,CAA0Bb,KAA1B,CAAgCxD,OAAhC,EAAyCiE,kBAAzC,EAA6DE,kBAA7D;AACA;AArLF;AAuLA,CA5LD,yG","file":"/packages/rocketchat_iframe-login.js","sourcesContent":["/* globals Accounts, Tracker, ReactiveVar, FlowRouter, Accounts, HTTP, facebookConnectPlugin, TwitterConnect, OAuth */\n\nconst _unstoreLoginToken = Accounts._unstoreLoginToken;\nAccounts._unstoreLoginToken = function() {\n\tRocketChat.iframeLogin.tryLogin();\n\t_unstoreLoginToken.apply(Accounts, arguments);\n};\n\nclass IframeLogin {\n\tconstructor() {\n\t\tthis.enabled = false;\n\t\tthis.reactiveIframeUrl = new ReactiveVar();\n\t\tthis.reactiveEnabled = new ReactiveVar();\n\t\tthis.iframeUrl = undefined;\n\t\tthis.apiUrl = undefined;\n\t\tthis.apiMethod = undefined;\n\n\t\tTracker.autorun((c) => {\n\t\t\tthis.enabled = RocketChat.settings.get('Accounts_iframe_enabled');\n\t\t\tthis.reactiveEnabled.set(this.enabled);\n\n\t\t\tthis.iframeUrl = RocketChat.settings.get('Accounts_iframe_url');\n\t\t\tthis.apiUrl = RocketChat.settings.get('Accounts_Iframe_api_url');\n\t\t\tthis.apiMethod = RocketChat.settings.get('Accounts_Iframe_api_method');\n\n\t\t\tif (this.enabled === false) {\n\t\t\t\treturn c.stop();\n\t\t\t}\n\n\t\t\tif (this.enabled === true && this.iframeUrl && this.apiUrl && this.apiMethod) {\n\t\t\t\tc.stop();\n\t\t\t\tif (!Accounts._storedLoginToken()) {\n\t\t\t\t\tthis.tryLogin(() => {});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\ttryLogin(callback) {\n\t\tif (!this.enabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.iframeUrl || !this.apiUrl || !this.apiMethod) {\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.log('tryLogin');\n\t\tconst options = {\n\t\t\tbeforeSend: (xhr) => {\n\t\t\t\txhr.withCredentials = true;\n\t\t\t}\n\t\t};\n\n\t\tlet iframeUrl = this.iframeUrl;\n\t\tlet separator = '?';\n\t\tif (iframeUrl.indexOf('?') > -1) {\n\t\t\tseparator = '&';\n\t\t}\n\n\t\tif (window.cordova) {\n\t\t\tiframeUrl += `${ separator }client=cordova`;\n\t\t} else if (navigator.userAgent.indexOf('Electron') > -1) {\n\t\t\tiframeUrl += `${ separator }client=electron`;\n\t\t}\n\n\t\tHTTP.call(this.apiMethod, this.apiUrl, options, (error, result) => {\n\t\t\tconsole.log(error, result);\n\t\t\tif (result && result.data && result.data.token) {\n\t\t\t\tthis.loginWithToken(result.data, (error, result) => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tthis.reactiveIframeUrl.set(iframeUrl);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.reactiveIframeUrl.set();\n\t\t\t\t\t}\n\t\t\t\t\tcallback(error, result);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.reactiveIframeUrl.set(iframeUrl);\n\t\t\t\tcallback(error, result);\n\t\t\t}\n\t\t});\n\t}\n\n\tloginWithToken(token, callback) {\n\t\tif (!this.enabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (Match.test(token, String)) {\n\t\t\ttoken = {\n\t\t\t\ttoken\n\t\t\t};\n\t\t}\n\n\t\tconsole.log('loginWithToken');\n\n\t\tif (token.loginToken) {\n\t\t\treturn Meteor.loginWithToken(token.loginToken, callback);\n\t\t}\n\n\t\tAccounts.callLoginMethod({\n\t\t\tmethodArguments: [{\n\t\t\t\tiframe: true,\n\t\t\t\ttoken: token.token\n\t\t\t}],\n\t\t\tuserCallback: callback\n\t\t});\n\t}\n}\n\nRocketChat.iframeLogin = new IframeLogin();\n\nconst requestCredential = (serviceName, options = {}, callback) => {\n\twindow[serviceName].requestCredential(options, (tokenOrError) => {\n\t\tif (tokenOrError && tokenOrError instanceof Error) {\n\t\t\treturn callback(tokenOrError);\n\t\t}\n\n\t\tconst secret = OAuth._retrieveCredentialSecret(tokenOrError);\n\n\t\tif (!secret) {\n\t\t\treturn callback(new Error('Invalid secret'));\n\t\t}\n\n\t\tMeteor.call('OAuth.retrieveCredential', tokenOrError, secret, (error, credential) => {\n\t\t\tif (!credential) {\n\t\t\t\treturn callback(new Error('Credential not found'));\n\t\t\t}\n\n\t\t\tcallback(credential.serviceData, tokenOrError, secret);\n\t\t});\n\t});\n};\n\nwindow.addEventListener('message', (e) => {\n\tif (! _.isObject(e.data)) {\n\t\treturn;\n\t}\n\n\tswitch (e.data.event) {\n\t\tcase 'try-iframe-login':\n\t\t\tRocketChat.iframeLogin.tryLogin((error) => {\n\t\t\t\tif (error) {\n\t\t\t\t\te.source.postMessage({\n\t\t\t\t\t\tevent: 'login-error',\n\t\t\t\t\t\tresponse: error.message\n\t\t\t\t\t}, e.origin);\n\t\t\t\t}\n\t\t\t});\n\t\t\tbreak;\n\n\t\tcase 'login-with-token':\n\t\t\tRocketChat.iframeLogin.loginWithToken(e.data, (error) => {\n\t\t\t\tif (error) {\n\t\t\t\t\te.source.postMessage({\n\t\t\t\t\t\tevent: 'login-error',\n\t\t\t\t\t\tresponse: error.message\n\t\t\t\t\t}, e.origin);\n\t\t\t\t}\n\t\t\t});\n\t\t\tbreak;\n\n\t\tcase 'call-facebook-login':\n\t\t\tconst fbLoginSuccess = (response) => {\n\t\t\t\tconsole.log('facebook-login-success', response);\n\t\t\t\te.source.postMessage({\n\t\t\t\t\tevent: 'facebook-login-success',\n\t\t\t\t\tresponse\n\t\t\t\t\t// authResponse: Object\n\t\t\t\t\t// \taccessToken: \"a7s6d8a76s8d7...\"\n\t\t\t\t\t// \texpiresIn: \"5172793\"\n\t\t\t\t\t// \tsecret: \"...\"\n\t\t\t\t\t// \tsession_key: true\n\t\t\t\t\t// \tsig: \"...\"\n\t\t\t\t\t// userID: \"675676576\"\n\t\t\t\t\t// status: \"connected\"\n\t\t\t\t}, e.origin);\n\t\t\t};\n\n\t\t\tconst fbLoginError = (error, response) => {\n\t\t\t\tconsole.log('facebook-login-error', error, response);\n\t\t\t\te.source.postMessage({\n\t\t\t\t\tevent: 'facebook-login-error',\n\t\t\t\t\terror,\n\t\t\t\t\tresponse\n\t\t\t\t}, e.origin);\n\t\t\t};\n\n\t\t\tif (typeof window.facebookConnectPlugin === 'undefined') {\n\t\t\t\trequestCredential('Facebook', {}, (serviceData, token, secret) => {\n\t\t\t\t\tif (serviceData && serviceData instanceof Error) {\n\t\t\t\t\t\treturn fbLoginError('poup-login-error', serviceData);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfbLoginSuccess({\n\t\t\t\t\t\t\tauthResponse: {\n\t\t\t\t\t\t\t\taccessToken: serviceData.accessToken,\n\t\t\t\t\t\t\t\texpiresIn: serviceData.expiresAt,\n\t\t\t\t\t\t\t\tsecret\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tuserID: serviceData.id\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tfacebookConnectPlugin.getLoginStatus((response) => {\n\t\t\t\tif (response.status === 'connected') {\n\t\t\t\t\treturn fbLoginSuccess(response);\n\t\t\t\t}\n\n\t\t\t\tfacebookConnectPlugin.login(e.data.permissions, fbLoginSuccess, (error) => {\n\t\t\t\t\treturn fbLoginError('login-error', error);\n\t\t\t\t});\n\t\t\t}, (error) => {\n\t\t\t\treturn fbLoginError('get-status-error', error);\n\t\t\t});\n\t\t\tbreak;\n\n\t\tcase 'call-twitter-login':\n\t\t\tconst twitterLoginSuccess = (response) => {\n\t\t\t\tconsole.log('twitter-login-success', response);\n\t\t\t\te.source.postMessage({\n\t\t\t\t\tevent: 'twitter-login-success',\n\t\t\t\t\tresponse\n\t\t\t\t\t// {\n\t\t\t\t\t// \t\"userName\": \"orodrigok\",\n\t\t\t\t\t// \t\"userId\": 293123,\n\t\t\t\t\t// \t\"secret\": \"asdua09sud\",\n\t\t\t\t\t// \t\"token\": \"2jh3k1j2h3\"\n\t\t\t\t\t// }\n\t\t\t\t}, e.origin);\n\t\t\t};\n\n\t\t\tconst twitterLoginFailure = (error) => {\n\t\t\t\tconsole.log('twitter-login-error', error);\n\t\t\t\te.source.postMessage({\n\t\t\t\t\tevent: 'twitter-login-error',\n\t\t\t\t\terror\n\t\t\t\t}, e.origin);\n\t\t\t};\n\n\t\t\tif (typeof window.TwitterConnect === 'undefined') {\n\t\t\t\trequestCredential('Twitter', {}, (serviceData) => {\n\t\t\t\t\tif (serviceData && serviceData instanceof Error) {\n\t\t\t\t\t\treturn twitterLoginFailure('poup-login-error', serviceData);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttwitterLoginSuccess({\n\t\t\t\t\t\t\tuserName: serviceData.screenName,\n\t\t\t\t\t\t\tuserId: serviceData.id,\n\t\t\t\t\t\t\tsecret: serviceData.accessTokenSecret,\n\t\t\t\t\t\t\ttoken: serviceData.accessToken\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tTwitterConnect.login(twitterLoginSuccess, twitterLoginFailure);\n\t\t\tbreak;\n\n\t\tcase 'call-google-login':\n\t\t\tconst googleLoginSuccess = (response) => {\n\t\t\t\tif (typeof response.oauthToken === 'string' && typeof response.accessToken !== 'string') {\n\t\t\t\t\tresponse.accessToken = response.oauthToken;\n\t\t\t\t}\n\n\t\t\t\tconsole.log('google-login-success', response);\n\t\t\t\te.source.postMessage({\n\t\t\t\t\tevent: 'google-login-success',\n\t\t\t\t\tresponse\n\t\t\t\t\t// {\n\t\t\t\t\t// \t\"email\": \"rodrigoknascimento@gmail.com\",\n\t\t\t\t\t// \t\"userId\": \"1082039180239\",\n\t\t\t\t\t// \t\"displayName\": \"Rodrigo Nascimento\",\n\t\t\t\t\t// \t\"gender\": \"male\",\n\t\t\t\t\t// \t\"imageUrl\": \"https://lh5.googleusercontent.com/-shUpniJA480/AAAAAAAAAAI/AAAAAAAAAqY/_B8oyS8yBw0/photo.jpg?sz=50\",\n\t\t\t\t\t// \t\"givenName\": \"Rodrigo\",\n\t\t\t\t\t// \t\"familyName\": \"Nascimento\",\n\t\t\t\t\t// \t\"ageRangeMin\": 21,\n\t\t\t\t\t// \t\"accessToken\": \"123198273kajhsdh1892h\"\n\t\t\t\t\t// }\n\t\t\t\t}, e.origin);\n\t\t\t};\n\n\t\t\tconst googleLoginFailure = (error) => {\n\t\t\t\tconsole.log('google-login-error', error);\n\t\t\t\te.source.postMessage({\n\t\t\t\t\tevent: 'google-login-error',\n\t\t\t\t\terror\n\t\t\t\t}, e.origin);\n\t\t\t};\n\n\t\t\tif (typeof window.plugins === 'undefined' || typeof window.plugins.googleplus === 'undefined') {\n\t\t\t\trequestCredential('Google', {}, (serviceData) => {\n\t\t\t\t\tif (serviceData && serviceData instanceof Error) {\n\t\t\t\t\t\treturn googleLoginFailure('poup-login-error', serviceData);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tgoogleLoginSuccess({\n\t\t\t\t\t\t\temail: serviceData.email,\n\t\t\t\t\t\t\tuserId: serviceData.id,\n\t\t\t\t\t\t\tdisplayName: serviceData.name,\n\t\t\t\t\t\t\tgender: serviceData.gender,\n\t\t\t\t\t\t\timageUrl: serviceData.picture,\n\t\t\t\t\t\t\tgivenName: serviceData.given_name,\n\t\t\t\t\t\t\tfamilyName: serviceData.family_name,\n\t\t\t\t\t\t\taccessToken: serviceData.accessToken\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tconst options = {\n\t\t\t\tscopes: e.data.scopes,\n\t\t\t\twebClientId: e.data.webClientId,\n\t\t\t\toffline: true\n\t\t\t};\n\n\t\t\twindow.plugins.googleplus.login(options, googleLoginSuccess, googleLoginFailure);\n\t\t\tbreak;\n\t}\n});\n"]}