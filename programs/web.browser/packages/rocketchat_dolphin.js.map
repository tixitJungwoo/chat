{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:dolphin/common.js"],"names":["config","serverURL","authorizePath","tokenPath","identityPath","scope","addAutopublishFields","forLoggedInUser","forOtherUsers","Dolphin","CustomOAuth","DolphinOnCreateUser","options","user","services","dolphin","NickName","username","Meteor","isServer","startup","RocketChat","models","Settings","find","_id","observe","added","settings","get","configure","changed","data","buttonLabelText","buttonColor","buttonLabelColor","clientId","secret","loginStyle","ServiceConfiguration","configurations","upsert","service","$set","callbacks","add","priority","HIGH","Tracker","autorun"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA,yBAEA,IAAMA,SAAS;AACdC,YAAW,EADG;AAEdC,gBAAe,iBAFD;AAGdC,YAAW,kBAHG;AAIdC,eAAc,mBAJA;AAKdC,QAAO,OALO;AAMdC,uBAAsB;AACrBC,mBAAiB,CAAC,kBAAD,CADI;AAErBC,iBAAe,CAAC,uBAAD;AAFM;AANR,CAAf;AAYA,IAAMC,UAAU,IAAIC,WAAJ,CAAgB,SAAhB,EAA2BV,MAA3B,CAAhB;;AAEA,SAASW,mBAAT,CAA6BC,OAA7B,EAAsCC,IAAtC,EAA4C;AAC3C,KAAIA,QAAQA,KAAKC,QAAb,IAAyBD,KAAKC,QAAL,CAAcC,OAAvC,IAAkDF,KAAKC,QAAL,CAAcC,OAAd,CAAsBC,QAA5E,EAAsF;AACrFH,OAAKI,QAAL,GAAgBJ,KAAKC,QAAL,CAAcC,OAAd,CAAsBC,QAAtC;AACA;;AACD,QAAOH,IAAP;AACA;;AAED,IAAIK,OAAOC,QAAX,EAAqB;AACpBD,QAAOE,OAAP,CAAe;AAAA,SACdC,WAAWC,MAAX,CAAkBC,QAAlB,CAA2BC,IAA3B,CAAgC;AAAEC,QAAK;AAAP,GAAhC,EAAuEC,OAAvE,CAA+E;AAC9EC,QAD8E,cACtE;AACP3B,WAAOC,SAAP,GAAmBoB,WAAWO,QAAX,CAAoBC,GAApB,CAAwB,4BAAxB,CAAnB;AACA,WAAOpB,QAAQqB,SAAR,CAAkB9B,MAAlB,CAAP;AACA,IAJ6E;AAK9E+B,UAL8E,cAKpE;AACT/B,WAAOC,SAAP,GAAmBoB,WAAWO,QAAX,CAAoBC,GAApB,CAAwB,4BAAxB,CAAnB;AACA,WAAOpB,QAAQqB,SAAR,CAAkB9B,MAAlB,CAAP;AACA;AAR6E,GAA/E,CADc;AAAA,EAAf;;AAaA,KAAIqB,WAAWO,QAAX,CAAoBC,GAApB,CAAwB,4BAAxB,CAAJ,EAA2D;AAC1D,MAAMG,OAAO;AACZC,oBAAiBZ,WAAWO,QAAX,CAAoBC,GAApB,CAAwB,0CAAxB,CADL;AAEZK,gBAAab,WAAWO,QAAX,CAAoBC,GAApB,CAAwB,qCAAxB,CAFD;AAGZM,qBAAkBd,WAAWO,QAAX,CAAoBC,GAApB,CAAwB,2CAAxB,CAHN;AAIZO,aAAUf,WAAWO,QAAX,CAAoBC,GAApB,CAAwB,2BAAxB,CAJE;AAKZQ,WAAQhB,WAAWO,QAAX,CAAoBC,GAApB,CAAwB,+BAAxB,CALI;AAMZ5B,cAAWoB,WAAWO,QAAX,CAAoBC,GAApB,CAAwB,4BAAxB,CANC;AAOZS,eAAYjB,WAAWO,QAAX,CAAoBC,GAApB,CAAwB,oCAAxB;AAPA,GAAb;AAUAU,uBAAqBC,cAArB,CAAoCC,MAApC,CAA2C;AAACC,YAAS;AAAV,GAA3C,EAAiE;AAACC,SAAMX;AAAP,GAAjE;AACA;;AAEDX,YAAWuB,SAAX,CAAqBC,GAArB,CAAyB,kBAAzB,EAA6ClC,mBAA7C,EAAkEU,WAAWuB,SAAX,CAAqBE,QAArB,CAA8BC,IAAhG;AACA,CA7BD,MA6BO;AACN7B,QAAOE,OAAP,CAAe;AAAA,SACd4B,QAAQC,OAAR,CAAgB,YAAW;AAC1B,OAAI5B,WAAWO,QAAX,CAAoBC,GAApB,CAAwB,4BAAxB,CAAJ,EAA2D;AAC1D7B,WAAOC,SAAP,GAAmBoB,WAAWO,QAAX,CAAoBC,GAApB,CAAwB,4BAAxB,CAAnB;AACA,WAAOpB,QAAQqB,SAAR,CAAkB9B,MAAlB,CAAP;AACA;AACD,GALD,CADc;AAAA,EAAf;AAQA,6G","file":"/packages/rocketchat_dolphin.js","sourcesContent":["// Dolphin OAuth2\n/* globals CustomOAuth */\n\nconst config = {\n\tserverURL: '',\n\tauthorizePath: '/m/oauth2/auth/',\n\ttokenPath: '/m/oauth2/token/',\n\tidentityPath: '/m/oauth2/api/me/',\n\tscope: 'basic',\n\taddAutopublishFields: {\n\t\tforLoggedInUser: ['services.dolphin'],\n\t\tforOtherUsers: ['services.dolphin.name']\n\t}\n};\n\nconst Dolphin = new CustomOAuth('dolphin', config);\n\nfunction DolphinOnCreateUser(options, user) {\n\tif (user && user.services && user.services.dolphin && user.services.dolphin.NickName) {\n\t\tuser.username = user.services.dolphin.NickName;\n\t}\n\treturn user;\n}\n\nif (Meteor.isServer) {\n\tMeteor.startup(() =>\n\t\tRocketChat.models.Settings.find({ _id: 'Accounts_OAuth_Dolphin_URL' }).observe({\n\t\t\tadded() {\n\t\t\t\tconfig.serverURL = RocketChat.settings.get('Accounts_OAuth_Dolphin_URL');\n\t\t\t\treturn Dolphin.configure(config);\n\t\t\t},\n\t\t\tchanged() {\n\t\t\t\tconfig.serverURL = RocketChat.settings.get('Accounts_OAuth_Dolphin_URL');\n\t\t\t\treturn Dolphin.configure(config);\n\t\t\t}\n\t\t})\n\t);\n\n\tif (RocketChat.settings.get('Accounts_OAuth_Dolphin_URL')) {\n\t\tconst data = {\n\t\t\tbuttonLabelText: RocketChat.settings.get('Accounts_OAuth_Dolphin_button_label_text'),\n\t\t\tbuttonColor: RocketChat.settings.get('Accounts_OAuth_Dolphin_button_color'),\n\t\t\tbuttonLabelColor: RocketChat.settings.get('Accounts_OAuth_Dolphin_button_label_color'),\n\t\t\tclientId: RocketChat.settings.get('Accounts_OAuth_Dolphin_id'),\n\t\t\tsecret: RocketChat.settings.get('Accounts_OAuth_Dolphin_secret'),\n\t\t\tserverURL: RocketChat.settings.get('Accounts_OAuth_Dolphin_URL'),\n\t\t\tloginStyle: RocketChat.settings.get('Accounts_OAuth_Dolphin_login_style')\n\t\t};\n\n\t\tServiceConfiguration.configurations.upsert({service: 'dolphin'}, {$set: data});\n\t}\n\n\tRocketChat.callbacks.add('beforeCreateUser', DolphinOnCreateUser, RocketChat.callbacks.priority.HIGH);\n} else {\n\tMeteor.startup(() =>\n\t\tTracker.autorun(function() {\n\t\t\tif (RocketChat.settings.get('Accounts_OAuth_Dolphin_URL')) {\n\t\t\t\tconfig.serverURL = RocketChat.settings.get('Accounts_OAuth_Dolphin_URL');\n\t\t\t\treturn Dolphin.configure(config);\n\t\t\t}\n\t\t})\n\t);\n}\n"]}