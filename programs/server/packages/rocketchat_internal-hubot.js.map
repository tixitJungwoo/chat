{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat_internal-hubot/hubot.coffee","meteor://ðŸ’»app/hubot.coffee.js","meteor://ðŸ’»app/packages/rocketchat_internal-hubot/settings.coffee"],"names":["CoffeeScript","DEBUG","Robot","bind","fs","init","path","sendHelper","slice","extend","child","parent","key","hasProp","call","ctor","constructor","prototype","__super__","hasOwnProperty","Npm","require","register","Hubot","Response","priv","ref","strings","arguments","length","robot","adapter","apply","envelope","concat","loadAdapter","f","g","Meteor","bindEnvironment","args","self","superClass","hear","respond","enter","leave","topic","error","catchAll","user","users","findOne","username","name","fields","regex","callback","RocketChatAdapter","send","console","log","blue","_this","string","room","id","RocketChat","sendMessage","InternalHubot","msg","_id","emote","rid","u","message","action","to","reply","map","str","play","run","emit","brain","mergeData","close","Adapter","InternalHubotReceiver","InternalHubotTextMessage","InternalHubotUser","models","Rooms","findOneById","t","User","TextMessage","receive","HubotScripts","e","i","j","len","len1","modulePath","modulesToLoad","scriptFile","scriptsToLoad","parseHelp","__meteor_bootstrap__","serverDir","green","red","settings","get","split","s","trim","err","results","shift","push","logger","_","debounce","alias","callbacks","add","priority","LOW","remove","startup","Settings","findByIds","observe","changed","addGroup","type","group","i18nLabel","i18nDescription"],"mappings":"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","file":"/packages/rocketchat_internal-hubot.js","sourcesContent":["CoffeeScript = Npm.require('coffee-script')\nCoffeeScript.register()\n\nHubot = Npm.require('hubot')\n\nfs = Npm.require('fs')\npath = Npm.require('path')\n\n# Start a hubot, connected to our chat room.\n# 'use strict'\n\n# Log messages?\nDEBUG = false\n\n# Monkey-patch Hubot to support private messages\nHubot.Response::priv = (strings...) ->\n\t@robot.adapter.priv @envelope, strings...\n\n# More monkey-patching\nHubot.Robot::loadAdapter = -> # disable\n\n# grrrr, Meteor.bindEnvironment doesn't preserve `this` apparently\nbind = (f) ->\n\tg = Meteor.bindEnvironment (self, args...) -> f.apply(self, args)\n\t(args...) -> g @, args...\n\nclass Robot extends Hubot.Robot\n\tconstructor: (args...) ->\n\t\tsuper args...\n\t\t@hear = bind @hear\n\t\t@respond = bind @respond\n\t\t@enter = bind @enter\n\t\t@leave = bind @leave\n\t\t@topic = bind @topic\n\t\t@error = bind @error\n\t\t@catchAll = bind @catchAll\n\t\t@user = Meteor.users.findOne {username: @name}, fields: username: 1\n\tloadAdapter: -> false\n\thear:    (regex, callback) -> super regex, Meteor.bindEnvironment callback\n\trespond: (regex, callback) -> super regex, Meteor.bindEnvironment callback\n\tenter: (callback) -> super Meteor.bindEnvironment(callback)\n\tleave: (callback) -> super Meteor.bindEnvironment(callback)\n\ttopic: (callback) -> super Meteor.bindEnvironment(callback)\n\terror: (callback) -> super Meteor.bindEnvironment(callback)\n\tcatchAll: (callback) -> super Meteor.bindEnvironment(callback)\n\nclass RocketChatAdapter extends Hubot.Adapter\n\t# Public: Raw method for sending data back to the chat source. Extend this.\n\t#\n\t# envelope - A Object with message, room and user details.\n\t# strings  - One or more Strings for each message to send.\n\t#\n\t# Returns nothing.\n\tsend: (envelope, strings...) ->\n\t\tconsole.log 'ROCKETCHATADAPTER -> send'.blue if DEBUG\n\t\t# console.log envelope, strings\n\t\tsendHelper @robot, envelope, strings, (string) =>\n\t\t\tconsole.log \"send #{envelope.room}: #{string} (#{envelope.user.id})\" if DEBUG\n\t\t\tRocketChat.sendMessage InternalHubot.user, { msg: string }, { _id: envelope.room }\n\n\t# Public: Raw method for sending emote data back to the chat source.\n\t#\n\t# envelope - A Object with message, room and user details.\n\t# strings  - One or more Strings for each message to send.\n\t#\n\t# Returns nothing.\n\temote: (envelope, strings...) ->\n\t\tconsole.log 'ROCKETCHATADAPTER -> emote'.blue if DEBUG\n\t\tsendHelper @robot, envelope, strings, (string) =>\n\t\t\tconsole.log \"emote #{envelope.rid}: #{string} (#{envelope.u.username})\" if DEBUG\n\t\t\treturn @priv envelope, \"*** #{string} ***\" if envelope.message.private\n\t\t\tMeteor.call \"sendMessage\",\n\t\t\t\tmsg: string\n\t\t\t\trid: envelope.rid\n\t\t\t\taction: true\n\n\t# Priv: our extension -- send a PM to user\n\tpriv: (envelope, strings...) ->\n\t\tconsole.log 'ROCKETCHATADAPTER -> priv'.blue if DEBUG\n\t\tsendHelper @robot, envelope, strings, (string) ->\n\t\t\tconsole.log \"priv #{envelope.room}: #{string} (#{envelope.user.id})\" if DEBUG\n\t\t\tMeteor.call \"sendMessage\",\n\t\t\t\tu:\n\t\t\t\t\tusername: \"rocketbot\"\n\t\t\t\tto: \"#{envelope.user.id}\"\n\t\t\t\tmsg: string\n\t\t\t\trid: envelope.room\n\n\t# Public: Raw method for building a reply and sending it back to the chat\n\t# source. Extend this.\n\t#\n\t# envelope - A Object with message, room and user details.\n\t# strings  - One or more Strings for each reply to send.\n\t#\n\t# Returns nothing.\n\treply: (envelope, strings...) ->\n\t\tconsole.log 'ROCKETCHATADAPTER -> reply'.blue if DEBUG\n\t\tif envelope.message.private\n\t\t\t@priv envelope, strings...\n\t\telse\n\t\t\t@send envelope, strings.map((str) -> \"#{envelope.user.name}: #{str}\")...\n\n\t# Public: Raw method for setting a topic on the chat source. Extend this.\n\t#\n\t# envelope - A Object with message, room and user details.\n\t# strings  - One more more Strings to set as the topic.\n\t#\n\t# Returns nothing.\n\ttopic: (envelope, strings...) ->\n\t\tconsole.log 'ROCKETCHATADAPTER -> topic'.blue if DEBUG\n\n\t# Public: Raw method for playing a sound in the chat source. Extend this.\n\t#\n\t# envelope - A Object with message, room and user details.\n\t# strings  - One or more strings for each play message to send.\n\t#\n\t# Returns nothing\n\tplay: (envelope, strings...) ->\n\t\tconsole.log 'ROCKETCHATADAPTER -> play'.blue if DEBUG\n\n\t# Public: Raw method for invoking the bot to run. Extend this.\n\t#\n\t# Returns nothing.\n\trun: ->\n\t\tconsole.log 'ROCKETCHATADAPTER -> run'.blue if DEBUG\n\t\t@robot.emit 'connected'\n\t\t@robot.brain.mergeData {}\n\t\t# @robot.brain.emit 'loaded'\n\n\t# Public: Raw method for shutting the bot down. Extend this.\n\t#\n\t# Returns nothing.\n\tclose: ->\n\t\tconsole.log 'ROCKETCHATADAPTER -> close'.blue if DEBUG\n\nclass InternalHubotReceiver\n\tconstructor: (message) ->\n\t\tconsole.log message if DEBUG\n\t\tif message.u.username isnt InternalHubot.name\n\t\t\troom = RocketChat.models.Rooms.findOneById message.rid\n\n\t\t\tif room.t is 'c'\n\t\t\t\tInternalHubotUser = new Hubot.User(message.u.username, room: message.rid)\n\t\t\t\tInternalHubotTextMessage = new Hubot.TextMessage(InternalHubotUser, message.msg, message._id)\n\t\t\t\tInternalHubot.adapter.receive InternalHubotTextMessage\n\t\treturn message\n\nclass HubotScripts\n\tconstructor: (robot) ->\n\t\tmodulesToLoad = [\n\t\t\t'hubot-help/src/help.coffee'\n\t\t]\n\n\t\tfor modulePath in modulesToLoad\n\t\t\ttry\n\t\t\t\tNpm.require(modulePath)(robot)\n\t\t\t\trobot.parseHelp __meteor_bootstrap__.serverDir+'/npm/node_modules/meteor/rocketchat_internal-hubot/node_modules/'+modulePath\n\t\t\t\tconsole.log \"Loaded #{modulePath}\".green\n\t\t\tcatch e\n\t\t\t\tconsole.log \"can't load #{modulePath}\".red\n\t\t\t\tconsole.log e\n\n\t\tscriptsToLoad = RocketChat.settings.get('InternalHubot_ScriptsToLoad').split(',') or []\n\n\t\tfor scriptFile in scriptsToLoad\n\t\t\ttry\n\t\t\t\tscriptFile = s.trim(scriptFile)\n\n\t\t\t\tNpm.require('hubot-scripts/src/scripts/'+scriptFile)(robot)\n\t\t\t\t# robot.loadFile __meteor_bootstrap__.serverDir+'/npm/node_modules/meteor/rocketchat_internal-hubot/node_modules/hubot-scripts/src/scripts', scriptFile\n\t\t\t\trobot.parseHelp __meteor_bootstrap__.serverDir+'/npm/node_modules/meteor/rocketchat_internal-hubot/node_modules/hubot-scripts/src/scripts/'+scriptFile\n\t\t\t\tconsole.log \"Loaded #{scriptFile}\".green\n\t\t\tcatch e\n\t\t\t\tconsole.log \"can't load #{scriptFile}\".red\n\t\t\t\tconsole.log e\n\nsendHelper = Meteor.bindEnvironment (robot, envelope, strings, map) ->\n\twhile strings.length > 0\n\t\tstring = strings.shift()\n\t\tif typeof(string) == 'function'\n\t\t\tstring()\n\t\telse\n\t\t\ttry\n\t\t\t\tmap(string)\n\t\t\tcatch err\n\t\t\t\tconsole.error \"Hubot error: #{err}\" if DEBUG\n\t\t\t\trobot.logger.error \"RocketChat send error: #{err}\"\n\nInternalHubot = {}\n\ninit = _.debounce Meteor.bindEnvironment( =>\n\tif RocketChat.settings.get 'InternalHubot_Enabled'\n\t\tInternalHubot = new Robot null, null, false, RocketChat.settings.get 'InternalHubot_Username'\n\t\tInternalHubot.alias = 'bot'\n\t\tInternalHubot.adapter = new RocketChatAdapter InternalHubot\n\t\tHubotScripts(InternalHubot)\n\t\tInternalHubot.run()\n\t\tRocketChat.callbacks.add 'afterSaveMessage', InternalHubotReceiver, RocketChat.callbacks.priority.LOW, 'InternalHubot'\n\telse\n\t\tInternalHubot = {}\n\t\tRocketChat.callbacks.remove 'afterSaveMessage', 'InternalHubot'\n), 1000\n\nMeteor.startup ->\n\tinit()\n\tRocketChat.models.Settings.findByIds([ 'InternalHubot_Username', 'InternalHubot_Enabled', 'InternalHubot_ScriptsToLoad']).observe\n\t\tchanged: ->\n\t\t\tinit()\n","var CoffeeScript, DEBUG, Robot, bind, fs, init, path, sendHelper,                                                                              \n  slice = [].slice,\n  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  hasProp = {}.hasOwnProperty;\n\nCoffeeScript = Npm.require('coffee-script');\n\nCoffeeScript.register();\n\nHubot = Npm.require('hubot');\n\nfs = Npm.require('fs');\n\npath = Npm.require('path');\n\nDEBUG = false;\n\nHubot.Response.prototype.priv = function() {\n  var ref, strings;\n  strings = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n  return (ref = this.robot.adapter).priv.apply(ref, [this.envelope].concat(slice.call(strings)));\n};\n\nHubot.Robot.prototype.loadAdapter = function() {};\n\nbind = function(f) {\n  var g;\n  g = Meteor.bindEnvironment(function() {\n    var args, self;\n    self = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n    return f.apply(self, args);\n  });\n  return function() {\n    var args;\n    args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n    return g.apply(null, [this].concat(slice.call(args)));\n  };\n};\n\nRobot = (function(superClass) {\n  extend(Robot, superClass);\n\n  function Robot() {\n    var args;\n    args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n    Robot.__super__.constructor.apply(this, args);\n    this.hear = bind(this.hear);\n    this.respond = bind(this.respond);\n    this.enter = bind(this.enter);\n    this.leave = bind(this.leave);\n    this.topic = bind(this.topic);\n    this.error = bind(this.error);\n    this.catchAll = bind(this.catchAll);\n    this.user = Meteor.users.findOne({\n      username: this.name\n    }, {\n      fields: {\n        username: 1\n      }\n    });\n  }\n\n  Robot.prototype.loadAdapter = function() {\n    return false;\n  };\n\n  Robot.prototype.hear = function(regex, callback) {\n    return Robot.__super__.hear.call(this, regex, Meteor.bindEnvironment(callback));\n  };\n\n  Robot.prototype.respond = function(regex, callback) {\n    return Robot.__super__.respond.call(this, regex, Meteor.bindEnvironment(callback));\n  };\n\n  Robot.prototype.enter = function(callback) {\n    return Robot.__super__.enter.call(this, Meteor.bindEnvironment(callback));\n  };\n\n  Robot.prototype.leave = function(callback) {\n    return Robot.__super__.leave.call(this, Meteor.bindEnvironment(callback));\n  };\n\n  Robot.prototype.topic = function(callback) {\n    return Robot.__super__.topic.call(this, Meteor.bindEnvironment(callback));\n  };\n\n  Robot.prototype.error = function(callback) {\n    return Robot.__super__.error.call(this, Meteor.bindEnvironment(callback));\n  };\n\n  Robot.prototype.catchAll = function(callback) {\n    return Robot.__super__.catchAll.call(this, Meteor.bindEnvironment(callback));\n  };\n\n  return Robot;\n\n})(Hubot.Robot);\n\nRocketChatAdapter = (function(superClass) {\n  extend(RocketChatAdapter, superClass);\n\n  function RocketChatAdapter() {\n    return RocketChatAdapter.__super__.constructor.apply(this, arguments);\n  }\n\n  RocketChatAdapter.prototype.send = function() {\n    var envelope, strings;\n    envelope = arguments[0], strings = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n    if (DEBUG) {\n      console.log('ROCKETCHATADAPTER -> send'.blue);\n    }\n    return sendHelper(this.robot, envelope, strings, (function(_this) {\n      return function(string) {\n        if (DEBUG) {\n          console.log(\"send \" + envelope.room + \": \" + string + \" (\" + envelope.user.id + \")\");\n        }\n        return RocketChat.sendMessage(InternalHubot.user, {\n          msg: string\n        }, {\n          _id: envelope.room\n        });\n      };\n    })(this));\n  };\n\n  RocketChatAdapter.prototype.emote = function() {\n    var envelope, strings;\n    envelope = arguments[0], strings = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n    if (DEBUG) {\n      console.log('ROCKETCHATADAPTER -> emote'.blue);\n    }\n    return sendHelper(this.robot, envelope, strings, (function(_this) {\n      return function(string) {\n        if (DEBUG) {\n          console.log(\"emote \" + envelope.rid + \": \" + string + \" (\" + envelope.u.username + \")\");\n        }\n        if (envelope.message[\"private\"]) {\n          return _this.priv(envelope, \"*** \" + string + \" ***\");\n        }\n        return Meteor.call(\"sendMessage\", {\n          msg: string,\n          rid: envelope.rid,\n          action: true\n        });\n      };\n    })(this));\n  };\n\n  RocketChatAdapter.prototype.priv = function() {\n    var envelope, strings;\n    envelope = arguments[0], strings = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n    if (DEBUG) {\n      console.log('ROCKETCHATADAPTER -> priv'.blue);\n    }\n    return sendHelper(this.robot, envelope, strings, function(string) {\n      if (DEBUG) {\n        console.log(\"priv \" + envelope.room + \": \" + string + \" (\" + envelope.user.id + \")\");\n      }\n      return Meteor.call(\"sendMessage\", {\n        u: {\n          username: \"rocketbot\"\n        },\n        to: \"\" + envelope.user.id,\n        msg: string,\n        rid: envelope.room\n      });\n    });\n  };\n\n  RocketChatAdapter.prototype.reply = function() {\n    var envelope, strings;\n    envelope = arguments[0], strings = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n    if (DEBUG) {\n      console.log('ROCKETCHATADAPTER -> reply'.blue);\n    }\n    if (envelope.message[\"private\"]) {\n      return this.priv.apply(this, [envelope].concat(slice.call(strings)));\n    } else {\n      return this.send.apply(this, [envelope].concat(slice.call(strings.map(function(str) {\n        return envelope.user.name + \": \" + str;\n      }))));\n    }\n  };\n\n  RocketChatAdapter.prototype.topic = function() {\n    var envelope, strings;\n    envelope = arguments[0], strings = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n    if (DEBUG) {\n      return console.log('ROCKETCHATADAPTER -> topic'.blue);\n    }\n  };\n\n  RocketChatAdapter.prototype.play = function() {\n    var envelope, strings;\n    envelope = arguments[0], strings = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n    if (DEBUG) {\n      return console.log('ROCKETCHATADAPTER -> play'.blue);\n    }\n  };\n\n  RocketChatAdapter.prototype.run = function() {\n    if (DEBUG) {\n      console.log('ROCKETCHATADAPTER -> run'.blue);\n    }\n    this.robot.emit('connected');\n    return this.robot.brain.mergeData({});\n  };\n\n  RocketChatAdapter.prototype.close = function() {\n    if (DEBUG) {\n      return console.log('ROCKETCHATADAPTER -> close'.blue);\n    }\n  };\n\n  return RocketChatAdapter;\n\n})(Hubot.Adapter);\n\nInternalHubotReceiver = (function() {\n  function InternalHubotReceiver(message) {\n    var InternalHubotTextMessage, InternalHubotUser, room;\n    if (DEBUG) {\n      console.log(message);\n    }\n    if (message.u.username !== InternalHubot.name) {\n      room = RocketChat.models.Rooms.findOneById(message.rid);\n      if (room.t === 'c') {\n        InternalHubotUser = new Hubot.User(message.u.username, {\n          room: message.rid\n        });\n        InternalHubotTextMessage = new Hubot.TextMessage(InternalHubotUser, message.msg, message._id);\n        InternalHubot.adapter.receive(InternalHubotTextMessage);\n      }\n    }\n    return message;\n  }\n\n  return InternalHubotReceiver;\n\n})();\n\nHubotScripts = (function() {\n  function HubotScripts(robot) {\n    var e, i, j, len, len1, modulePath, modulesToLoad, scriptFile, scriptsToLoad;\n    modulesToLoad = ['hubot-help/src/help.coffee'];\n    for (i = 0, len = modulesToLoad.length; i < len; i++) {\n      modulePath = modulesToLoad[i];\n      try {\n        Npm.require(modulePath)(robot);\n        robot.parseHelp(__meteor_bootstrap__.serverDir + '/npm/node_modules/meteor/rocketchat_internal-hubot/node_modules/' + modulePath);\n        console.log((\"Loaded \" + modulePath).green);\n      } catch (error) {\n        e = error;\n        console.log((\"can't load \" + modulePath).red);\n        console.log(e);\n      }\n    }\n    scriptsToLoad = RocketChat.settings.get('InternalHubot_ScriptsToLoad').split(',') || [];\n    for (j = 0, len1 = scriptsToLoad.length; j < len1; j++) {\n      scriptFile = scriptsToLoad[j];\n      try {\n        scriptFile = s.trim(scriptFile);\n        Npm.require('hubot-scripts/src/scripts/' + scriptFile)(robot);\n        robot.parseHelp(__meteor_bootstrap__.serverDir + '/npm/node_modules/meteor/rocketchat_internal-hubot/node_modules/hubot-scripts/src/scripts/' + scriptFile);\n        console.log((\"Loaded \" + scriptFile).green);\n      } catch (error) {\n        e = error;\n        console.log((\"can't load \" + scriptFile).red);\n        console.log(e);\n      }\n    }\n  }\n\n  return HubotScripts;\n\n})();\n\nsendHelper = Meteor.bindEnvironment(function(robot, envelope, strings, map) {\n  var err, results, string;\n  results = [];\n  while (strings.length > 0) {\n    string = strings.shift();\n    if (typeof string === 'function') {\n      results.push(string());\n    } else {\n      try {\n        results.push(map(string));\n      } catch (error) {\n        err = error;\n        if (DEBUG) {\n          console.error(\"Hubot error: \" + err);\n        }\n        results.push(robot.logger.error(\"RocketChat send error: \" + err));\n      }\n    }\n  }\n  return results;\n});\n\nInternalHubot = {};\n\ninit = _.debounce(Meteor.bindEnvironment((function(_this) {\n  return function() {\n    if (RocketChat.settings.get('InternalHubot_Enabled')) {\n      InternalHubot = new Robot(null, null, false, RocketChat.settings.get('InternalHubot_Username'));\n      InternalHubot.alias = 'bot';\n      InternalHubot.adapter = new RocketChatAdapter(InternalHubot);\n      HubotScripts(InternalHubot);\n      InternalHubot.run();\n      return RocketChat.callbacks.add('afterSaveMessage', InternalHubotReceiver, RocketChat.callbacks.priority.LOW, 'InternalHubot');\n    } else {\n      InternalHubot = {};\n      return RocketChat.callbacks.remove('afterSaveMessage', 'InternalHubot');\n    }\n  };\n})(this)), 1000);\n\nMeteor.startup(function() {\n  init();\n  return RocketChat.models.Settings.findByIds(['InternalHubot_Username', 'InternalHubot_Enabled', 'InternalHubot_ScriptsToLoad']).observe({\n    changed: function() {\n      return init();\n    }\n  });\n});\n","RocketChat.settings.addGroup 'InternalHubot'\nRocketChat.settings.add 'InternalHubot_Enabled', false, { type: 'boolean', group: 'InternalHubot', i18nLabel: 'Enabled' }\nRocketChat.settings.add 'InternalHubot_Username', 'rocket.cat', { type: 'string', group: 'InternalHubot', i18nLabel: 'Username', i18nDescription: 'InternalHubot_Username_Description' }\nRocketChat.settings.add 'InternalHubot_ScriptsToLoad', 'hello.coffee,zen.coffee', { type: 'string', group: 'InternalHubot'}\n"]}