{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:autotranslate/client/lib/autotranslate.js","meteor://ðŸ’»app/packages/rocketchat:autotranslate/client/lib/actionButton.js","meteor://ðŸ’»app/packages/rocketchat:autotranslate/client/lib/tabBar.js","meteor://ðŸ’»app/packages/rocketchat:autotranslate/client/views/autoTranslateFlexTab.js"],"names":["RocketChat","AutoTranslate","messageIdsToWait","supportedLanguages","getLanguage","rid","subscription","models","Subscriptions","findOne","fields","autoTranslateLanguage","language","Meteor","user","window","defaultUserLanguage","indexOf","_","findWhere","substr","translateAttachments","attachments","attachment","author_name","username","text","translations","description","length","init","call","err","languages","Tracker","autorun","settings","get","authz","hasAtLeastOnePermission","callbacks","add","message","autoTranslate","u","_id","userId","autoTranslateShowInverse","html","priority","HIGH","msg","Messages","update","$set","autoTranslateFetching","undefined","$unset","remove","startup","MessageAction","addButton","id","icon","i18nLabel","context","action","_arguments","hideDropDown","validation","order","removeButton","TabBar","groups","i18nTitle","template","toastr","module","watch","require","v","Template","autoTranslateFlexTab","helpers","sub","ChatSubscription","instance","autoTranslateValue","t","editing","field","languageName","targetLanguage","name","onCreated","currentData","ReactiveVar","userLanguage","set","validateSetting","value","$","val","error","saveSetting","previousLanguage","prop","data","defaultLanguage","handleError","query","$ne","$or","$exists","multi","display","random","Random","events","e","keyCode","preventDefault","currentTarget","setTimeout","focus","select","attr"],"mappings":"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","file":"/packages/rocketchat_autotranslate.js","sourcesContent":["RocketChat.AutoTranslate = {\n\tmessageIdsToWait: {},\n\tsupportedLanguages: [],\n\n\tgetLanguage(rid) {\n\t\tlet subscription = {};\n\t\tif (rid) {\n\t\t\tsubscription = RocketChat.models.Subscriptions.findOne({ rid }, { fields: { autoTranslateLanguage: 1 } });\n\t\t}\n\t\tconst language = subscription && subscription.autoTranslateLanguage || Meteor.user().language || window.defaultUserLanguage();\n\t\tif (language.indexOf('-') !== -1) {\n\t\t\tif (!_.findWhere(this.supportedLanguages, { language })) {\n\t\t\t\treturn language.substr(0, 2);\n\t\t\t}\n\t\t}\n\t\treturn language;\n\t},\n\n\ttranslateAttachments(attachments, language) {\n\t\tfor (const attachment of attachments) {\n\t\t\tif (attachment.author_name !== Meteor.user().username) {\n\t\t\t\tif (attachment.text && attachment.translations && attachment.translations[language]) {\n\t\t\t\t\tattachment.text = attachment.translations[language];\n\t\t\t\t}\n\n\t\t\t\tif (attachment.description && attachment.translations && attachment.translations[language]) {\n\t\t\t\t\tattachment.description = attachment.translations[language];\n\t\t\t\t}\n\n\t\t\t\tif (attachment.attachments && attachment.attachments.length > 0) {\n\t\t\t\t\tattachment.attachments = this.translateAttachments(attachment.attachments, language);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn attachments;\n\t},\n\n\tinit() {\n\t\tMeteor.call('autoTranslate.getSupportedLanguages', 'en', (err, languages) => {\n\t\t\tthis.supportedLanguages = languages || [];\n\t\t});\n\n\t\tTracker.autorun(() => {\n\t\t\tif (RocketChat.settings.get('AutoTranslate_Enabled') && RocketChat.authz.hasAtLeastOnePermission(['auto-translate'])) {\n\t\t\t\tRocketChat.callbacks.add('renderMessage', (message) => {\n\t\t\t\t\tconst subscription = RocketChat.models.Subscriptions.findOne({ rid: message.rid }, { fields: { autoTranslate: 1, autoTranslateLanguage: 1 } });\n\t\t\t\t\tconst autoTranslateLanguage = this.getLanguage(message.rid);\n\t\t\t\t\tif (message.u && message.u._id !== Meteor.userId()) {\n\t\t\t\t\t\tif (!message.translations) {\n\t\t\t\t\t\t\tmessage.translations = {};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (subscription && subscription.autoTranslate !== message.autoTranslateShowInverse) {\n\t\t\t\t\t\t\tmessage.translations['original'] = message.html;\n\t\t\t\t\t\t\tif (message.translations[autoTranslateLanguage]) {\n\t\t\t\t\t\t\t\tmessage.html = message.translations[autoTranslateLanguage];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (message.attachments && message.attachments.length > 0) {\n\t\t\t\t\t\t\t\tmessage.attachments = this.translateAttachments(message.attachments, autoTranslateLanguage);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (message.attachments && message.attachments.length > 0) {\n\t\t\t\t\t\tmessage.attachments = this.translateAttachments(message.attachments, autoTranslateLanguage);\n\t\t\t\t\t}\n\t\t\t\t\treturn message;\n\t\t\t\t}, RocketChat.callbacks.priority.HIGH - 3, 'autotranslate');\n\n\t\t\t\tRocketChat.callbacks.add('streamMessage', (message) => {\n\t\t\t\t\tif (message.u && message.u._id !== Meteor.userId()) {\n\t\t\t\t\t\tconst subscription = RocketChat.models.Subscriptions.findOne({ rid: message.rid }, { fields: { autoTranslate: 1, autoTranslateLanguage: 1 } });\n\t\t\t\t\t\tconst language = this.getLanguage(message.rid);\n\t\t\t\t\t\tif (subscription && subscription.autoTranslate === true && ((message.msg && (!message.translations || !message.translations[language])))) { // || (message.attachments && !_.find(message.attachments, attachment => { return attachment.translations && attachment.translations[language]; }))\n\t\t\t\t\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { autoTranslateFetching: true } });\n\t\t\t\t\t\t} else if (this.messageIdsToWait[message._id] !== undefined && subscription && subscription.autoTranslate !== true) {\n\t\t\t\t\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { autoTranslateShowInverse: true }, $unset: { autoTranslateFetching: true } });\n\t\t\t\t\t\t\tdelete this.messageIdsToWait[message._id];\n\t\t\t\t\t\t} else if (message.autoTranslateFetching === true) {\n\t\t\t\t\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $unset: { autoTranslateFetching: true } });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, RocketChat.callbacks.priority.HIGH - 3, 'autotranslate-stream');\n\t\t\t} else {\n\t\t\t\tRocketChat.callbacks.remove('renderMessage', 'autotranslate');\n\t\t\t\tRocketChat.callbacks.remove('streamMessage', 'autotranslate-stream');\n\t\t\t}\n\t\t});\n\t}\n};\n\nMeteor.startup(function() {\n\tRocketChat.AutoTranslate.init();\n});\n","Meteor.startup(function() {\n\tTracker.autorun(function() {\n\t\tif (RocketChat.settings.get('AutoTranslate_Enabled') && RocketChat.authz.hasAtLeastOnePermission(['auto-translate'])) {\n\t\t\tRocketChat.MessageAction.addButton({\n\t\t\t\tid: 'toggle-language',\n\t\t\t\ticon: 'icon-language',\n\t\t\t\ti18nLabel: 'Toggle_original_translated',\n\t\t\t\tcontext: [\n\t\t\t\t\t'message',\n\t\t\t\t\t'message-mobile'\n\t\t\t\t],\n\t\t\t\taction() {\n\t\t\t\t\tconst message = this._arguments[1];\n\t\t\t\t\tconst language = RocketChat.AutoTranslate.getLanguage(message.rid);\n\t\t\t\t\tRocketChat.MessageAction.hideDropDown();\n\t\t\t\t\tif ((!message.translations || !message.translations[language])) { //} && !_.find(message.attachments, attachment => { return attachment.translations && attachment.translations[language]; })) {\n\t\t\t\t\t\tRocketChat.AutoTranslate.messageIdsToWait[message._id] = true;\n\t\t\t\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { autoTranslateFetching: true } });\n\t\t\t\t\t\tMeteor.call('autoTranslate.translateMessage', message, language);\n\t\t\t\t\t} else if (message.autoTranslateShowInverse) {\n\t\t\t\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $unset: { autoTranslateShowInverse: true } });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { autoTranslateShowInverse: true } });\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tvalidation(message) {\n\t\t\t\t\treturn message && message.u && message.u._id !== Meteor.userId();\n\t\t\t\t},\n\n\t\t\t\torder: 90\n\t\t\t});\n\t\t} else {\n\t\t\tRocketChat.MessageAction.removeButton('toggle-language');\n\t\t}\n\t});\n});\n","Meteor.startup(function() {\n\tTracker.autorun(function() {\n\t\tif (RocketChat.settings.get('AutoTranslate_Enabled') && RocketChat.authz.hasAtLeastOnePermission(['auto-translate'])) {\n\t\t\tRocketChat.TabBar.addButton({\n\t\t\t\tgroups: ['channel', 'group', 'direct'],\n\t\t\t\tid: 'autotranslate',\n\t\t\t\ti18nTitle: 'Auto_Translate',\n\t\t\t\ticon: 'icon-language',\n\t\t\t\ttemplate: 'autoTranslateFlexTab',\n\t\t\t\torder: 20\n\t\t\t});\n\t\t} else {\n\t\t\tRocketChat.TabBar.removeButton('autotranslate');\n\t\t}\n\t});\n});\n","/* globals ChatSubscription */\nimport toastr from 'toastr';\n\nTemplate.autoTranslateFlexTab.helpers({\n\tautoTranslate() {\n\t\tconst sub = ChatSubscription.findOne({\n\t\t\trid: Template.instance().rid\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tautoTranslate: 1\n\t\t\t}\n\t\t});\n\t\treturn sub && sub.autoTranslate ? true : false;\n\t},\n\n\tautoTranslateValue() {\n\t\tconst sub = ChatSubscription.findOne({\n\t\t\trid: Template.instance().rid\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tautoTranslate: 1\n\t\t\t}\n\t\t});\n\t\treturn sub && sub.autoTranslate ? t('True') : t('False');\n\t},\n\n\tautoTranslateLanguage() {\n\t\tconst sub = ChatSubscription.findOne({\n\t\t\trid: Template.instance().rid\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tautoTranslateLanguage: 1\n\t\t\t}\n\t\t});\n\t\tconst autoTranslateLanguage = sub && sub.autoTranslateLanguage || Meteor.user().language || window.defaultUserLanguage() || '';\n\t\tconst supportedLanguages = Template.instance().supportedLanguages.get();\n\t\tlet language = _.findWhere(supportedLanguages, { language: autoTranslateLanguage });\n\t\tif (language) {\n\t\t\treturn language.language;\n\t\t} else if (autoTranslateLanguage.indexOf('-') !== -1) {\n\t\t\tlanguage = _.findWhere(supportedLanguages, { language: autoTranslateLanguage.substr(0, 2) });\n\t\t\treturn language && language.language;\n\t\t}\n\t},\n\n\tediting(field) {\n\t\treturn Template.instance().editing.get() === field;\n\t},\n\n\tsupportedLanguages() {\n\t\treturn Template.instance().supportedLanguages.get();\n\t},\n\n\tlanguageName(targetLanguage) {\n\t\tif (targetLanguage) {\n\t\t\tconst supportedLanguages = Template.instance().supportedLanguages.get();\n\t\t\tlet language = _.findWhere(supportedLanguages, { language: targetLanguage });\n\t\t\tif (language) {\n\t\t\t\treturn language.name;\n\t\t\t} else if (targetLanguage.indexOf('-') !== -1) {\n\t\t\t\tlanguage = _.findWhere(supportedLanguages, { language: targetLanguage.substr(0, 2) });\n\t\t\t\treturn language && language.name;\n\t\t\t}\n\t\t}\n\t}\n});\n\nTemplate.autoTranslateFlexTab.onCreated(function() {\n\tthis.rid = Template.currentData().rid;\n\tthis.editing = new ReactiveVar();\n\tthis.supportedLanguages = new ReactiveVar([]);\n\tconst userLanguage = Meteor.user().language || window.defaultUserLanguage();\n\tMeteor.call('autoTranslate.getSupportedLanguages', userLanguage, (err, languages) => {\n\t\tthis.supportedLanguages.set(languages || []);\n\t});\n\n\tthis.validateSetting = (field) => {\n\t\tlet value;\n\t\tswitch (field) {\n\t\t\tcase 'autoTranslate':\n\t\t\t\treturn true;\n\t\t\tcase 'autoTranslateLanguage':\n\t\t\t\tvalue = this.$(`select[name=${ field }]`).val();\n\t\t\t\tif (!_.findWhere(this.supportedLanguages.get(), { language: value })) {\n\t\t\t\t\ttoastr.error(t('Invalid_setting_s', value || ''));\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t}\n\t};\n\n\tthis.saveSetting = () => {\n\t\tconst field = this.editing.get();\n\t\tconst subscription = RocketChat.models.Subscriptions.findOne({ rid: this.rid, 'u._id': Meteor.userId() });\n\t\tconst previousLanguage = subscription.autoTranslateLanguage;\n\t\tlet value;\n\t\tswitch (field) {\n\t\t\tcase 'autoTranslate':\n\t\t\t\tvalue = this.$(`input[name=${ field }]`).prop('checked') ? '1' : '0';\n\t\t\t\tbreak;\n\t\t\tcase 'autoTranslateLanguage':\n\t\t\t\tvalue = this.$(`select[name=${ field }]`).val();\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (this.validateSetting(field)) {\n\t\t\tMeteor.call('autoTranslate.saveSettings', this.data.rid, field, value, { defaultLanguage: Meteor.user().language || window.defaultUserLanguage() }, (err/*, result*/) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn handleError(err);\n\t\t\t\t}\n\n\t\t\t\tconst query = { rid: this.data.rid, 'u._id': { $ne: Meteor.userId() } };\n\t\t\t\tif (field === 'autoTranslateLanguage') {\n\t\t\t\t\tquery.$or = [ { [`translations.${ previousLanguage }`]: { $exists: 1 } }, { [`translations.${ value }`]: { $exists: 1 } }, { [`attachments.translations.${ previousLanguage }`]: { $exists: 1 } }, { [`attachments.translations.${ value }`]: { $exists: 1 } } ];\n\t\t\t\t} else {\n\t\t\t\t\tquery.$or = [ { [`translations.${ subscription.autoTranslateLanguage }`]: { $exists: 1 } }, { [`attachments.translations.${ subscription.autoTranslateLanguage }`]: { $exists: 1 } } ];\n\t\t\t\t}\n\n\t\t\t\tif (field === 'autoTranslate' && value === '0') {\n\t\t\t\t\tRocketChat.models.Messages.update(query, { $unset: { autoTranslateShowInverse: 1 } }, { multi: true });\n\t\t\t\t}\n\n\t\t\t\tconst display = field === 'autoTranslate' ? true : subscription && subscription.autoTranslate;\n\t\t\t\tif (display) {\n\t\t\t\t\tquery.autoTranslateShowInverse = { $ne: true };\n\t\t\t\t} else {\n\t\t\t\t\tquery.autoTranslateShowInverse = true;\n\t\t\t\t}\n\n\t\t\t\tRocketChat.models.Messages.update(query, { $set: { random: Random.id() } }, { multi: true });\n\n\t\t\t\tthis.editing.set();\n\t\t\t});\n\t\t}\n\t};\n});\n\nTemplate.autoTranslateFlexTab.events({\n\t'keydown input[type=text]'(e, instance) {\n\t\tif (e.keyCode === 13) {\n\t\t\te.preventDefault();\n\t\t\tinstance.saveSetting();\n\t\t}\n\t},\n\n\t'click [data-edit]'(e, instance) {\n\t\te.preventDefault();\n\t\tinstance.editing.set($(e.currentTarget).data('edit'));\n\t\tsetTimeout(function() { instance.$('input.editing').focus().select(); }, 100);\n\t},\n\n\t'change [type=checkbox]'(e, instance) {\n\t\tinstance.editing.set($(e.currentTarget).attr('name'));\n\t\tinstance.saveSetting();\n\t},\n\n\t'click .cancel'(e, instance) {\n\t\te.preventDefault();\n\t\tinstance.editing.set();\n\t},\n\n\t'click .save'(e, instance) {\n\t\te.preventDefault();\n\t\tinstance.saveSetting();\n\t}\n});\n"]}