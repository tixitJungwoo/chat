{"version":3,"sources":["meteor://ğŸ’»app/server/lib/cordova/facebook-login.js","meteor://ğŸ’»app/server/lib/accounts.js","meteor://ğŸ’»app/server/lib/cordova.js","meteor://ğŸ’»app/server/startup/migrations/v001.js","meteor://ğŸ’»app/server/startup/migrations/v002.js","meteor://ğŸ’»app/server/startup/migrations/v003.js","meteor://ğŸ’»app/server/startup/migrations/v004.js","meteor://ğŸ’»app/server/startup/migrations/v005.js","meteor://ğŸ’»app/server/startup/migrations/v006.js","meteor://ğŸ’»app/server/startup/migrations/v007.js","meteor://ğŸ’»app/server/startup/migrations/v008.js","meteor://ğŸ’»app/server/startup/migrations/v009.js","meteor://ğŸ’»app/server/startup/migrations/v010.js","meteor://ğŸ’»app/server/startup/migrations/v011.js","meteor://ğŸ’»app/server/startup/migrations/v012.js","meteor://ğŸ’»app/server/startup/migrations/v013.js","meteor://ğŸ’»app/server/startup/migrations/v014.js","meteor://ğŸ’»app/server/startup/migrations/v015.js","meteor://ğŸ’»app/server/startup/migrations/v016.js","meteor://ğŸ’»app/server/startup/migrations/v017.js","meteor://ğŸ’»app/server/startup/migrations/v018.js","meteor://ğŸ’»app/server/startup/migrations/v019.js","meteor://ğŸ’»app/server/startup/migrations/v020.js","meteor://ğŸ’»app/server/startup/migrations/v021.js","meteor://ğŸ’»app/server/startup/migrations/v022.js","meteor://ğŸ’»app/server/startup/migrations/v023.js","meteor://ğŸ’»app/server/startup/migrations/v024.js","meteor://ğŸ’»app/server/startup/migrations/v025.js","meteor://ğŸ’»app/server/startup/migrations/v026.js","meteor://ğŸ’»app/server/startup/migrations/v027.js","meteor://ğŸ’»app/server/startup/migrations/v028.js","meteor://ğŸ’»app/server/startup/migrations/v029.js","meteor://ğŸ’»app/server/startup/migrations/v030.js","meteor://ğŸ’»app/server/startup/migrations/v031.js","meteor://ğŸ’»app/server/startup/migrations/v032.js","meteor://ğŸ’»app/server/startup/migrations/v033.js","meteor://ğŸ’»app/server/startup/migrations/v034.js","meteor://ğŸ’»app/server/startup/migrations/v035.js","meteor://ğŸ’»app/server/startup/migrations/v036.js","meteor://ğŸ’»app/server/startup/migrations/v037.js","meteor://ğŸ’»app/server/startup/migrations/v038.js","meteor://ğŸ’»app/server/startup/migrations/v039.js","meteor://ğŸ’»app/server/startup/migrations/v040.js","meteor://ğŸ’»app/server/startup/migrations/v041.js","meteor://ğŸ’»app/server/startup/migrations/v042.js","meteor://ğŸ’»app/server/startup/migrations/v043.js","meteor://ğŸ’»app/server/startup/migrations/v044.js","meteor://ğŸ’»app/server/startup/migrations/v045.js","meteor://ğŸ’»app/server/startup/migrations/v046.js","meteor://ğŸ’»app/server/startup/migrations/v047.js","meteor://ğŸ’»app/server/startup/migrations/v048.js","meteor://ğŸ’»app/server/startup/migrations/v049.js","meteor://ğŸ’»app/server/startup/migrations/v050.js","meteor://ğŸ’»app/server/startup/migrations/v051.js","meteor://ğŸ’»app/server/startup/migrations/v052.js","meteor://ğŸ’»app/server/startup/migrations/v053.js","meteor://ğŸ’»app/server/startup/migrations/v054.js","meteor://ğŸ’»app/server/startup/migrations/v055.js","meteor://ğŸ’»app/server/startup/migrations/v056.js","meteor://ğŸ’»app/server/startup/migrations/v057.js","meteor://ğŸ’»app/server/startup/migrations/v058.js","meteor://ğŸ’»app/server/startup/migrations/v059.js","meteor://ğŸ’»app/server/startup/migrations/v060.js","meteor://ğŸ’»app/server/startup/migrations/v061.js","meteor://ğŸ’»app/server/startup/migrations/v062.js","meteor://ğŸ’»app/server/startup/migrations/v063.js","meteor://ğŸ’»app/server/startup/migrations/v064.js","meteor://ğŸ’»app/server/startup/migrations/v065.js","meteor://ğŸ’»app/server/startup/migrations/v066.js","meteor://ğŸ’»app/server/startup/migrations/v067.js","meteor://ğŸ’»app/server/startup/migrations/v068.js","meteor://ğŸ’»app/server/startup/migrations/v069.js","meteor://ğŸ’»app/server/startup/migrations/v070.js","meteor://ğŸ’»app/server/startup/migrations/v071.js","meteor://ğŸ’»app/server/startup/migrations/v072.js","meteor://ğŸ’»app/server/startup/migrations/v073.js","meteor://ğŸ’»app/server/startup/migrations/v074.js","meteor://ğŸ’»app/server/startup/migrations/v075.js","meteor://ğŸ’»app/server/startup/migrations/v076.js","meteor://ğŸ’»app/server/startup/migrations/v077.js","meteor://ğŸ’»app/server/startup/migrations/v078.js","meteor://ğŸ’»app/server/startup/migrations/v079.js","meteor://ğŸ’»app/server/startup/migrations/v080.js","meteor://ğŸ’»app/server/startup/migrations/v081.js","meteor://ğŸ’»app/server/startup/migrations/v082.js","meteor://ğŸ’»app/server/startup/migrations/v083.js","meteor://ğŸ’»app/server/startup/migrations/v084.js","meteor://ğŸ’»app/server/startup/migrations/v085.js","meteor://ğŸ’»app/server/startup/migrations/v086.js","meteor://ğŸ’»app/server/startup/migrations/v087.js","meteor://ğŸ’»app/server/startup/migrations/v088.js","meteor://ğŸ’»app/server/startup/migrations/v089.js","meteor://ğŸ’»app/server/startup/migrations/v090.js","meteor://ğŸ’»app/server/startup/migrations/v091.js","meteor://ğŸ’»app/server/startup/migrations/v092.js","meteor://ğŸ’»app/server/startup/migrations/v093.js","meteor://ğŸ’»app/server/startup/migrations/xrun.js","meteor://ğŸ’»app/server/startup/appcache.js","meteor://ğŸ’»app/server/startup/avatar.js","meteor://ğŸ’»app/server/startup/cron.js","meteor://ğŸ’»app/server/startup/i18n-validation.js","meteor://ğŸ’»app/server/startup/initialData.js","meteor://ğŸ’»app/server/startup/presence.js","meteor://ğŸ’»app/server/startup/roomPublishes.js","meteor://ğŸ’»app/server/startup/serverRunning.js","meteor://ğŸ’»app/server/configuration/accounts_meld.js","meteor://ğŸ’»app/server/methods/OEmbedCacheCleanup.js","meteor://ğŸ’»app/server/methods/addAllUserToRoom.js","meteor://ğŸ’»app/server/methods/addRoomModerator.js","meteor://ğŸ’»app/server/methods/addRoomOwner.js","meteor://ğŸ’»app/server/methods/afterVerifyEmail.js","meteor://ğŸ’»app/server/methods/canAccessRoom.js","meteor://ğŸ’»app/server/methods/channelsList.js","meteor://ğŸ’»app/server/methods/createDirectMessage.js","meteor://ğŸ’»app/server/methods/deleteFileMessage.js","meteor://ğŸ’»app/server/methods/deleteUser.js","meteor://ğŸ’»app/server/methods/eraseRoom.js","meteor://ğŸ’»app/server/methods/getAvatarSuggestion.js","meteor://ğŸ’»app/server/methods/getRoomIdByNameOrId.js","meteor://ğŸ’»app/server/methods/getTotalChannels.js","meteor://ğŸ’»app/server/methods/getUsernameSuggestion.js","meteor://ğŸ’»app/server/methods/getUsersOfRoom.js","meteor://ğŸ’»app/server/methods/groupsList.js","meteor://ğŸ’»app/server/methods/hideRoom.js","meteor://ğŸ’»app/server/methods/loadHistory.js","meteor://ğŸ’»app/server/methods/loadLocale.js","meteor://ğŸ’»app/server/methods/loadMissedMessages.js","meteor://ğŸ’»app/server/methods/loadNextMessages.js","meteor://ğŸ’»app/server/methods/loadSurroundingMessages.js","meteor://ğŸ’»app/server/methods/logoutCleanUp.js","meteor://ğŸ’»app/server/methods/messageSearch.js","meteor://ğŸ’»app/server/methods/migrate.js","meteor://ğŸ’»app/server/methods/muteUserInRoom.js","meteor://ğŸ’»app/server/methods/openRoom.js","meteor://ğŸ’»app/server/methods/readMessages.js","meteor://ğŸ’»app/server/methods/registerUser.js","meteor://ğŸ’»app/server/methods/removeRoomModerator.js","meteor://ğŸ’»app/server/methods/removeRoomOwner.js","meteor://ğŸ’»app/server/methods/removeUserFromRoom.js","meteor://ğŸ’»app/server/methods/reportMessage.js","meteor://ğŸ’»app/server/methods/resetAvatar.js","meteor://ğŸ’»app/server/methods/saveUserPreferences.js","meteor://ğŸ’»app/server/methods/saveUserProfile.js","meteor://ğŸ’»app/server/methods/sendConfirmationEmail.js","meteor://ğŸ’»app/server/methods/sendForgotPasswordEmail.js","meteor://ğŸ’»app/server/methods/setAvatarFromService.js","meteor://ğŸ’»app/server/methods/setUserActiveStatus.js","meteor://ğŸ’»app/server/methods/setUserPassword.js","meteor://ğŸ’»app/server/methods/toogleFavorite.js","meteor://ğŸ’»app/server/methods/unmuteUserInRoom.js","meteor://ğŸ’»app/server/methods/userSetUtcOffset.js","meteor://ğŸ’»app/server/publications/activeUsers.js","meteor://ğŸ’»app/server/publications/channelAndPrivateAutocomplete.js","meteor://ğŸ’»app/server/publications/fullUserData.js","meteor://ğŸ’»app/server/publications/messages.js","meteor://ğŸ’»app/server/publications/privateHistory.js","meteor://ğŸ’»app/server/publications/room.js","meteor://ğŸ’»app/server/publications/roomFiles.js","meteor://ğŸ’»app/server/publications/roomSubscriptionsByRole.js","meteor://ğŸ’»app/server/publications/spotlight.js","meteor://ğŸ’»app/server/publications/subscription.js","meteor://ğŸ’»app/server/publications/userAutocomplete.js","meteor://ğŸ’»app/server/publications/userChannels.js","meteor://ğŸ’»app/server/publications/userData.js","meteor://ğŸ’»app/server/stream/messages.js","meteor://ğŸ’»app/server/stream/streamBroadcast.js","meteor://ğŸ’»app/lib/RegExp.js","meteor://ğŸ’»app/lib/fileUpload.js","meteor://ğŸ’»app/lib/francocatena_fix.js","meteor://ğŸ’»app/lib/underscore.string.js"],"names":["getIdentity","accessToken","HTTP","get","params","access_token","data","error","_","extend","Error","message","response","Accounts","registerLoginHandler","loginRequest","cordova","authResponse","identity","serviceData","expiresAt","Date","now","expiresIn","whitelisted","fields","pick","options","profile","updateOrCreateUserFromExternalService","accountsConfig","forbidClientAccountCreation","loginExpirationInDays","RocketChat","settings","config","emailTemplates","siteName","from","verifyEmailHtml","verifyEmail","text","html","user","url","replace","Meteor","absoluteUrl","resetPasswordHtml","resetPassword","enrollAccount","subject","TAPi18n","__","lng","language","placeholders","header","footer","name","email","emails","address","onCreateUser","callbacks","run","status","active","firstName","lastName","services","Object","values","service","username","verified","insertUserDoc","wrap","roles","Match","test","globalRoles","String","length","concat","password","defaultAuthServiceRoles","split","map","s","trim","type","_id","call","users","findOne","joinDefaultChannels","runAsUser","joinDefaultChannelsSilenced","hasAdmin","models","Users","push","authz","addUserRoles","validateLoginAttempt","login","allowed","includes","validEmail","filter","updateLastLoginById","defer","validateNewUser","domainWhiteList","isEmpty","domain","inWhiteList","some","match","RegExp","escape","methods","push_test","method","hasRole","Push","enabled","query","$and","userId","$or","$exists","tokens","appCollection","find","count","send","title","apn","sound","sendPush","token","tries","post","statusCode","console","log","remove","SystemLogger","milli","Math","pow","setTimeout","configurePush","debug","allow","gcm","apiKey","projectNumber","passphrase","keyData","certData","gateway","undefined","Configure","production","sendInterval","sendBatchSize","serverSend","badge","forEach","app","topic","appName","startup","Migrations","add","version","up","lastLogin","generateUsernameSuggestion","setUsername","JSON","stringify","avatarOrigin","avatars","getAvatarSuggestionForUser","keys","dataURI","blob","RocketChatFile","dataURIParse","image","contentType","rs","bufferToStream","Buffer","ws","RocketChatFileAvatarInstance","createWriteStream","on","bindEnvironment","setAvatarOrigin","pipe","Subscriptions","tryDropIndex","uid","nonreactive","sub","update","findOneById","$set","$unset","Rooms","room","$in","uids","usernames","t","k","v","oldId","sort","join","insert","removeById","rid","multi","Messages","rn","$rename","item","Random","id","toLowerCase","setNameById","$ne","msgs","$lt","removeByRoomId","$size","newUserName","findOneByUsername","floor","random","findByType","newId","id0","id1","ids","u","by","findOneByName","upsert","index","urls","isString","OEmbed","rocketUrlParser","Settings","CDN_PREFIX","value","group","ENV","MAIL_URL","denyUnverifiedEmails","public","avatarStore","path","toMigrate","source","Mongo","Collection","target","model","OEmbedCache","collection","rawCollection","collectionName","doc","rawSource","wrapAsync","drop","err","errmsg","newUsernames","uniq","admin","findOneAdmin","oldestUser","createdAt","setAllUsersActive","metaKeys","old","oldAndNew","oldSetting","oldValue","newSetting","new","newValue","oldFilesCollection","oldGridFSCollection","oldChunkCollection","newFilesCollection","Uploads","newGridFSCollection","newChunkCollection","cfsRecord","nameParts","original","extension","pop","record","size","complete","uploading","store","uploadedAt","updatedAt","oldGridFsFile","ObjectID","copies","files","key","filename","chunkSize","uploadDate","aliases","metadata","md5","files_id","oldChunk","n","urlsItem","parsedUrl","pathname","msg","_hidden","changes","Accounts_Facebook","Accounts_Facebook_id","Accounts_Facebook_secret","Accounts_Google","Accounts_Google_id","Accounts_Google_secret","Accounts_Github","Accounts_Github_id","Accounts_Github_secret","Accounts_Gitlab","Accounts_Gitlab_id","Accounts_Gitlab_secret","Accounts_Linkedin","Accounts_Linkedin_id","Accounts_Linkedin_secret","Accounts_Meteor","Accounts_Meteor_id","Accounts_Meteor_secret","Accounts_Twitter","Accounts_Twitter_id","Accounts_Twitter_secret","to","ServiceConfiguration","configurations","admins","fetch","pluck","green","rooms","findByTypes","creator","msgQuery","msgOptions","cursorFileMessages","file","$multi","i18nLabel","upgradeEtsToEditAt","Permissions","persistent","hidden","mentions","_roles","scope","Roles","addRole","LDAP_Url","LDAP_TLS","LDAP_DN","LDAP_Bind_Search","$setOnInsert","WebRTC_STUN_Server","WebRTC_TURN_Server","WebRTC_TURN_Username","WebRTC_TURN_Password","servers","encodeURIComponent","API_Analytics","scriptAlert","integrations","Integrations","script","processIncomingRequestScript","prepareOutgoingRequestScript","processOutgoingResponseScript","integration","module","watch","require","loginHeader","requestUrl","resolve","result","npmRequestOptions","encoding","Assets","setAsset","content","headers","e","addUserPermission","allowPinning","$addToSet","footerValue","packageValue","customOauth","parts","bot","__migration_assets_files","chunks","__migration_assets_chunks","list","oldFile","mime","updateById","defaultUrl","assets","newRoomNotification","preferences","disableNewRoomNotification","newMessageNotification","disableNewMessageNotification","optOut","i18nDescription","favoriteRooms","lastVisitor","limit","lastNumber","parseInt","autolinkerUrls","RocketBot_Enabled","RocketBot_Name","ts","code","tryEnsureIndex","label","escapeHTML","Statistics","installedAt","subscriptions","$not","$type","subscription","setArchivedByUsername","forward","timeout","replace1","replace2","replace3","replace4","replace5","replace6","oldColor","LivechatDepartment","showOnRegistration","GoogleSiteVerification_id","setting","reactions","visitor","visitorEmails","oauth","athorizedClients","section","channel","OAuthApps","redirectUri","getUsersInRole","removeUserFromRoles","oldPermission","down","newPermission","rids","outgoingIntegrations","i","event","retryFailedCalls","retryCount","retryDelay","linkedin","setName","runOnEdits","getVersion","migrateTo","control","_getControl","last","_list","_setControl","AppCache","onlineOnly","getFileType","storeType","RocketChatStore","transformWrite","readStream","writeStream","height","width","gm","fileName","background","resize","gravity","crop","extent","stream","absolutePath","WebApp","connectHandlers","use","req","res","decodeURIComponent","writeHead","write","end","sandstorm","picture","setHeader","getFileWithReadStream","reqModifiedHeader","colors","color","initials","position","usernameParts","first","substr","toUpperCase","svg","toUTCString","once","chunk","fileType","logger","Logger","SyncedCron","opts","level","generateStatistics","statistics","save","host","warn","cleanupOEmbedCache","schedule","parser","cron","getMinutes","job","getHours","start","flat","obj","newObj","isObject","i18nValidation","l","errors","langs","TAPi18next","resStore","lang","len","present","difference","red","white","rpad","createWithIdTypeAndName","db","create","statusDefault","utcOffset","getBinary","deleteFile","process","env","ADMIN_PASS","adminUser","ADMIN_NAME","ADMIN_EMAIL","re","findOneByEmailAddress","ADMIN_USERNAME","nameValidation","checkUsernameAvailability","setPassword","INITIAL_USER","initialUser","parse","TEST_MODE","addUserToDefaultChannels","instance","port","PORT","INSTANCE_IP","InstanceStatus","registerInstance","UserPresence","UserPresenceMonitor","roomTypes","setPublish","identifier","cl","announcement","muted","archived","ro","reactWhenReadOnly","jitsiTimeout","description","sysMes","joinCodeRequired","hasPermission","joinCode","findByTypeAndName","roomId","findByTypeNameAndUserId","findById","ready","findByTypeAndNameContainingUsername","hasAtLeastOnePermission","findByTypeContainingUsernames","fs","semver","oplogState","MongoInternals","defaultRemoteCollectionDriver","mongo","_oplogHandle","onOplogEntry","desiredNodeVersion","clean","readFileSync","cwd","toString","desiredNodeVersionMajor","major","Info","versions","node","arch","platform","commit","hash","branch","satisfies","startup_box","error_box","exit","orig_updateOrCreateUserFromExternalService","serviceName","_OAuthCustom","Array","isArray","a","primary","emailAddress","findQuery","findWhere","resetPasswordAndSetRequirePasswordChange","setServiceId","setEmailVerified","apply","arguments","OEmbedCacheCleanup","date","expirationDays","setDate","getDate","removeAfterDate","addAllUserToRoom","activeUsersOnly","check","Boolean","userCount","userFilter","findOneByRoomIdAndUserId","addUsernameById","createWithRoomAndUser","open","alert","unread","createUserJoinWithRoomIdAndUser","addRoomModerator","addRoleById","fromUser","createSubscriptionRoleAddedWithRoomIdAndUser","role","Notifications","notifyLogged","addRoomOwner","afterVerifyEmail","verifiedEmail","removeUserRoles","canAccessRoom","Maybe","channelsList","channelType","unblock","Optional","Number","isNumber","roomIds","findByTypeAndUserId","userPref","mergeChannels","globalPref","channels","findByNameContainingTypesWithUsername","findContainingTypesWithUsername","createDirectMessage","me","upsertSubscription","ls","DDPRateLimiter","addRule","connectionId","deleteFileMessage","fileID","getMessageByFileId","FileUpload","delete","deleteUser","adminCount","userIsAdmin","indexOf","action","eraseRoom","fromId","facebook","google","github","pictureUrl","twitter","profile_image_url_https","gitlab","avatar_url","Gravatar","imageUrl","secure","validAvatars","avatar","getAvatarSuggestion","getRoomIdByNameOrId","getTotalChannels","slug","slugify","usernameIsAvaliable","$regex","generateSuggestion","preferredHandle","flatten","compact","getUsernameSuggestion","getUsersOfRoom","showAll","_user","records","findByRoomId","total","groupsList","nameFilter","groups","escapeRegExp","findByIds","hideRoom","hideByRoomIdAndUserId","hideMessagesOfType","types","splice","loadHistory","canAnonymous","canPreview","editedAt","findVisibleByRoomIdBeforeTimestampNotContainingTypes","findVisibleByRoomIdNotContainingTypes","UI_Use_Real_Name","messages","starred","unreadNotLoaded","firstUnread","firstMessage","unreadMessages","findVisibleByRoomIdBetweenTimestampsNotContainingTypes","loadLocale","locale","getText","loadMissedMessages","findVisibleByRoomIdAfterTimestamp","loadNextMessages","findVisibleByRoomId","loadSurroundingMessages","ceil","recordsBefore","findVisibleByRoomIdBeforeTimestamp","moreBefore","recordsAfter","afterMessages","moreAfter","logoutCleanUp","messageSearch","currentUserId","currentUserName","currentUserTimezoneOffset","filterStarred","filterUrl","filterPinned","pinned","filterLocation","location","$exist","filterBeforeDate","day","month","year","beforeDate","setHours","getUTCHours","getTimezoneOffset","$lte","filterAfterDate","afterDate","setUTCHours","$gte","filterOnDate","dayAfter","sortByTimestamp","direction","startsWith","$options","mention","r","$text","$search","score","$meta","getMigrationVersion","muteUserInRoom","ObjectIncluding","mutedUser","muteUsernameByRoomId","createUserMutedWithRoomIdAndUser","openRoom","openByRoomIdAndUserId","readMessages","setAsReadByRoomIdAndUserId","registerUser","formData","AllowAnonymousRead","AllowAnonymousWrite","_loginUser","pass","secretURL","validateEmailDomain","userData","importedUser","importIds","createUser","saveCustomFields","userModel","sendVerificationEmail","removeRoomModerator","removeRoleById","createSubscriptionRoleRemovedWithRoomIdAndUser","removeRoomOwner","numOwners","removeUserFromRoom","removedUser","removeUsernameById","removeByRoomIdAndUserId","createUserRemovedWithRoomIdAndUser","reportMessage","messageId","Reports","createWithMessageDescriptionAndUserId","resetAvatar","unsetAvatarOrigin","saveUserPreferences","setLanguage","useEmojis","convertAsciiEmoji","saveMobileBandwidth","collapseMediaByDefault","unreadRoomsMode","autoImageLoad","emailNotificationMode","unreadAlert","desktopNotificationDuration","viewMode","hideUsernames","hideRoles","hideAvatars","hideFlexTab","highlights","sendOnEnter","setPreferences","saveUserProfile","customFields","checkPassword","typedPassword","bcrypt","passCheck","_checkPassword","digest","algorithm","realname","setRealName","newPassword","logout","setProfile","sendConfirmationEmail","sendForgotPasswordEmail","regex","userEmail","sendResetPasswordEmail","setAvatarFromService","setUserAvatar","setUserActiveStatus","setUserActive","unsetLoginTokens","setUserPassword","requirePasswordChange","unsetRequirePasswordChange","toggleFavorite","f","setFavoriteByRoomIdAndUserId","unmuteUserInRoom","unmutedUser","unmuteUsernameByRoomId","createUserUnmutedWithRoomIdAndUser","userSetUtcOffset","setUtcOffset","publish","findUsersNotOffline","selector","pub","cursorHandle","findByNameStartingAndTypes","observeChanges","added","changed","removed","onStop","stop","getFullUserData","publication","cursor","cursorDelete","findInvisibleByRoomId","cursorDeleteHandle","findByContainingUsername","lm","livechatData","tags","sms","sentiment","roomMap","_room","findByDefaultAndTypes","findBySubscriptionUserIdUpdatedAfter","trashFindDeletedAfter","_deletedAt","findBySubscriptionUserId","getRoomByTypeAndName","roomFind","getRoomFind","cache","notifyUserInThisInstance","cursorFileListHandle","findNotHiddenFilesOfRoom","findByRoomIdAndRoles","spotlight","roomOptions","findByNameAndTypeNotDefault","userOptions","findByActiveUsersExcept","findByNameAndTypeNotContainingUsername","fname","audioNotification","desktopNotifications","mobilePushNotifications","emailNotifications","_updatedAt","blocked","blocker","autoTranslate","autoTranslateLanguage","disableNotifications","hideUnreadStatus","findByUserId","processQueryOptionsOnResult","exceptions","findActiveByUsernameOrNameRegexWithExceptions","term","statusConnection","defaultRoom","requirePasswordChangeReason","statusLivechat","msgStream","Streamer","allowWrite","allowRead","eventName","allowEmit","roomParticipant","roomType","publishMessage","imported","emitWithoutBroadcast","_db","DDPCommon","connections","sections","connection","auth","_authorizeConnection","info","instanceId","ok","broadcastAuth","authorizeConnection","getCollection","startMatrixBroadcast","_createdAt","observe","extraInformation","isDocker","instanceRecord","disconnect","DDP","connect","_dontPrintErrors","LoggerManager","logLevel","onReconnect","remoteId","selfId","streamName","args","StreamerCentral","instances","_emit","startStreamCastBroadcast","_stream","raw_msg","parseDDP","subscribe","startStreamBroadcast","fn","broadcast","fromInstance","results","connected","endpoint","conn","assign","currentStatus","Cookies","UploadFS","initFileStore","cookie","isClient","document","_storedLoginToken","fileStore","GridFS","Filter","onCheck","validateFileUpload","fileId","identify","format","Orientation","autoOrient","onRead","rawCookies","rc_uid","rc_token","findOneByIdAndLoginToken","isServer","Tracker","autorun","c","cachedCollection","i18n_status_func","mixin","each","functions","prototype","exports"],"mappings":"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","file":"/app.js","sourcesContent":["function getIdentity(accessToken) {\n\ttry {\n\t\treturn HTTP.get('https://graph.facebook.com/me', {\n\t\t\tparams: {\n\t\t\t\taccess_token: accessToken\n\t\t\t}\n\t\t}).data;\n\t} catch (error) {\n\t\tthrow _.extend(new Error(`Failed to fetch identity from Facebook. ${ error.message }`), {\n\t\t\tresponse: error.response\n\t\t});\n\t}\n}\n\nAccounts.registerLoginHandler(function(loginRequest) {\n\tif (!loginRequest.cordova) {\n\t\treturn;\n\t}\n\n\tloginRequest = loginRequest.authResponse;\n\n\tconst identity = getIdentity(loginRequest.accessToken);\n\tconst serviceData = {\n\t\taccessToken: loginRequest.accessToken,\n\t\texpiresAt: Date.now() + 1000 * loginRequest.expiresIn\n\t};\n\n\tconst whitelisted = ['id', 'email', 'name', 'first_name', 'last_name', 'link', 'username', 'gender', 'locale', 'age_range'];\n\tconst fields = _.pick(identity, whitelisted);\n\tconst options = {\n\t\tprofile: {}\n\t};\n\n\t_.extend(serviceData, fields);\n\t_.extend(options.profile, fields);\n\n\treturn Accounts.updateOrCreateUserFromExternalService('facebook', serviceData, options);\n});\n","const accountsConfig = {\n    forbidClientAccountCreation: true,\n    loginExpirationInDays: RocketChat.settings.get('Accounts_LoginExpiration')\n};\n\nAccounts.config(accountsConfig);\n\nAccounts.emailTemplates.siteName = RocketChat.settings.get('Site_Name');\n\nAccounts.emailTemplates.from = `${ RocketChat.settings.get('Site_Name') } <${ RocketChat.settings.get('From_Email') }>`;\n\nconst verifyEmailHtml = Accounts.emailTemplates.verifyEmail.text;\n\nAccounts.emailTemplates.verifyEmail.html = function (user, url) {\n    url = url.replace(Meteor.absoluteUrl(), `${ Meteor.absoluteUrl() }login/`);\n    return verifyEmailHtml(user, url);\n};\n\nconst resetPasswordHtml = Accounts.emailTemplates.resetPassword.text;\n\nAccounts.emailTemplates.resetPassword.html = function (user, url) {\n    url = url.replace(/\\/#\\//, '/');\n    return resetPasswordHtml(user, url);\n};\n\nAccounts.emailTemplates.enrollAccount.subject = function (user = {}) {\n    let subject;\n    if (RocketChat.settings.get('Accounts_Enrollment_Customized')) {\n        subject = RocketChat.settings.get('Accounts_Enrollment_Email_Subject');\n    } else {\n        subject = TAPi18n.__('Accounts_Enrollment_Email_Subject_Default', {\n            lng: user.language || RocketChat.settings.get('language') || 'en'\n        });\n    }\n    return RocketChat.placeholders.replace(subject);\n};\n\nAccounts.emailTemplates.enrollAccount.html = function (user = {}/*, url*/) {\n    let html;\n    if (RocketChat.settings.get('Accounts_Enrollment_Customized')) {\n        html = RocketChat.settings.get('Accounts_Enrollment_Email');\n    } else {\n        html = TAPi18n.__('Accounts_Enrollment_Email_Default', {\n            lng: user.language || RocketChat.settings.get('language') || 'en'\n        });\n    }\n\n    const header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n    const footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n    html = RocketChat.placeholders.replace(html, {\n        name: user.name,\n        email: user.emails && user.emails[0] && user.emails[0].address\n    });\n\n    return header + html + footer;\n};\n\nAccounts.onCreateUser(function (options, user = {}) {\n    RocketChat.callbacks.run('beforeCreateUser', options, user);\n\n    user.status = 'offline';\n    user.active = !RocketChat.settings.get('Accounts_ManuallyApproveNewUsers');\n\n    if (!user.name) {\n        if (options.profile) {\n            if (options.profile.name) {\n                user.name = options.profile.name;\n            } else if (options.profile.firstName && options.profile.lastName) {\n                // LinkedIn format\n                user.name = `${ options.profile.firstName } ${ options.profile.lastName }`;\n            } else if (options.profile.firstName) {\n                // LinkedIn format\n                user.name = options.profile.firstName;\n            }\n        }\n    }\n\n    if (user.services) {\n        for (const service of Object.values(user.services)) {\n            if (!user.name) {\n                user.name = service.name || service.username;\n            }\n\n            if (!user.emails && service.email) {\n                user.emails = [{\n                    address: service.email,\n                    verified: true\n                }];\n            }\n        }\n    }\n\n    return user;\n});\n\nAccounts.insertUserDoc = _.wrap(Accounts.insertUserDoc, function (insertUserDoc, options, user) {\n    let roles = [];\n\n    if (Match.test(user.globalRoles, [String]) && user.globalRoles.length > 0) {\n        roles = roles.concat(user.globalRoles);\n    }\n\n    delete user.globalRoles;\n\n    if (user.services && !user.services.password) {\n        const defaultAuthServiceRoles = String(RocketChat.settings.get('Accounts_Registration_AuthenticationServices_Default_Roles')).split(',');\n        if (defaultAuthServiceRoles.length > 0) {\n            roles = roles.concat(defaultAuthServiceRoles.map(s => s.trim()));\n        }\n    }\n\n    if (!user.type) {\n        user.type = 'user';\n    }\n\n    const _id = insertUserDoc.call(Accounts, options, user);\n\n    user = Meteor.users.findOne({\n        _id\n    });\n\n    if (user.username && options.joinDefaultChannels !== false && user.joinDefaultChannels !== false) {\n        Meteor.runAsUser(_id, function () {\n            return Meteor.call('joinDefaultChannels', options.joinDefaultChannelsSilenced);\n        });\n    }\n\n    if (roles.length === 0) {\n        const hasAdmin = RocketChat.models.Users.findOne({\n            roles: 'admin',\n            type: 'user'\n        }, {\n            fields: {\n                _id: 1\n            }\n        });\n\n        if (hasAdmin) {\n            roles.push('user');\n        } else {\n            roles.push('admin');\n        }\n    }\n\n    RocketChat.authz.addUserRoles(_id, roles);\n\n    return _id;\n});\n\nAccounts.validateLoginAttempt(function (login) {\n    login = RocketChat.callbacks.run('beforeValidateLogin', login);\n\n    if (login.allowed !== true) {\n        return login.allowed;\n    }\n\n    if (login.user.type === 'visitor') {\n        return true;\n    }\n\n    if (!!login.user.active !== true) {\n        throw new Meteor.Error('error-user-is-not-activated', 'User is not activated', {\n            'function': 'Accounts.validateLoginAttempt'\n        });\n    }\n\n    if (login.user.roles.includes('admin') === false && login.type === 'password' && RocketChat.settings.get('Accounts_EmailVerification') === true) {\n        const validEmail = login.user.emails.filter(email => email.verified === true);\n        if (validEmail.length === 0) {\n            throw new Meteor.Error('error-invalid-email', 'Invalid email __email__');\n        }\n    }\n\n    login = RocketChat.callbacks.run('onValidateLogin', login);\n\n    RocketChat.models.Users.updateLastLoginById(login.user._id);\n    Meteor.defer(function () {\n        return RocketChat.callbacks.run('afterValidateLogin', login);\n    });\n\n    return true;\n});\n\nAccounts.validateNewUser(function (user) {\n    if (user.type === 'visitor') {\n        return true;\n    }\n\n    if (RocketChat.settings.get('Accounts_Registration_AuthenticationServices_Enabled') === false && RocketChat.settings.get('LDAP_Enable') === false && !(user.services && user.services.password)) {\n        throw new Meteor.Error('registration-disabled-authentication-services', 'User registration is disabled for authentication services');\n    }\n\n    return true;\n});\n\nAccounts.validateNewUser(function (user) {\n    if (user.type === 'visitor') {\n        return true;\n    }\n\n    let domainWhiteList = RocketChat.settings.get('Accounts_AllowedDomainsList');\n    if (_.isEmpty(s.trim(domainWhiteList))) {\n        return true;\n    }\n\n    domainWhiteList = domainWhiteList.split(',').map(domain => domain.trim());\n\n    if (user.emails && user.emails.length > 0) {\n        const email = user.emails[0].address;\n        const inWhiteList = domainWhiteList.some(domain => email.match(`@${ RegExp.escape(domain) }$`));\n\n        if (inWhiteList === false) {\n            throw new Meteor.Error('error-invalid-domain');\n        }\n    }\n\n    return true;\n});\n","/* global Push, SystemLogger */\n\nMeteor.methods({\n\t// log() {\n\t// \treturn console.log(...arguments);\n\t// },\n\n\tpush_test() {\n\t\tconst user = Meteor.user();\n\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tif (Push.enabled !== true) {\n\t\t\tthrow new Meteor.Error('error-push-disabled', 'Push is disabled', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tconst query = {\n\t\t\t$and: [{\n\t\t\t\tuserId: user._id\n\t\t\t}, {\n\t\t\t\t$or: [{\n\t\t\t\t\t'token.apn': {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\t'token.gcm': {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t}]\n\t\t};\n\n\t\tconst tokens = Push.appCollection.find(query).count();\n\n\t\tif (tokens === 0) {\n\t\t\tthrow new Meteor.Error('error-no-tokens-for-this-user', 'There are no tokens for this user', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tPush.send({\n\t\t\tfrom: 'push',\n\t\t\ttitle: `@${ user.username }`,\n\t\t\ttext: TAPi18n.__('This_is_a_push_test_messsage'),\n\t\t\tapn: {\n\t\t\t\ttext: `@${ user.username }:\\n${ TAPi18n.__('This_is_a_push_test_messsage') }`\n\t\t\t},\n\t\t\tsound: 'default',\n\t\t\tquery: {\n\t\t\t\tuserId: user._id\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tmessage: 'Your_push_was_sent_to_s_devices',\n\t\t\tparams: [tokens]\n\t\t};\n\t}\n});\n\nfunction sendPush(service, token, options, tries = 0) {\n\tconst data = {\n\t\tdata: {\n\t\t\ttoken,\n\t\t\toptions\n\t\t}\n\t};\n\n\treturn HTTP.post(`${ RocketChat.settings.get('Push_gateway') }/push/${ service }/send`, data, function(error, response) {\n\t\tif (response && response.statusCode === 406) {\n\t\t\tconsole.log('removing push token', token);\n\t\t\tPush.appCollection.remove({\n\t\t\t\t$or: [{\n\t\t\t\t\t'token.apn': token\n\t\t\t\t}, {\n\t\t\t\t\t'token.gcm': token\n\t\t\t\t}]\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (!error) {\n\t\t\treturn;\n\t\t}\n\n\t\tSystemLogger.error(`Error sending push to gateway (${ tries } try) ->`, error);\n\n\t\tif (tries <= 6) {\n\t\t\tconst milli = Math.pow(10, tries + 2);\n\n\t\t\tSystemLogger.log('Trying sending push to gateway again in', milli, 'milliseconds');\n\n\t\t\treturn Meteor.setTimeout(function() {\n\t\t\t\treturn sendPush(service, token, options, tries + 1);\n\t\t\t}, milli);\n\t\t}\n\t});\n}\n\nfunction configurePush() {\n\tif (RocketChat.settings.get('Push_debug')) {\n\t\tPush.debug = true;\n\t\tconsole.log('Push: configuring...');\n\t}\n\n\tif (RocketChat.settings.get('Push_enable') === true) {\n\t\tPush.allow({\n\t\t\tsend(userId/*, notification*/) {\n\t\t\t\treturn RocketChat.authz.hasRole(userId, 'admin');\n\t\t\t}\n\t\t});\n\n\t\tlet apn;\n\t\tlet gcm;\n\n\t\tif (RocketChat.settings.get('Push_enable_gateway') === false) {\n\t\t\tgcm = {\n\t\t\t\tapiKey: RocketChat.settings.get('Push_gcm_api_key'),\n\t\t\t\tprojectNumber: RocketChat.settings.get('Push_gcm_project_number')\n\t\t\t};\n\n\t\t\tapn = {\n\t\t\t\tpassphrase: RocketChat.settings.get('Push_apn_passphrase'),\n\t\t\t\tkeyData: RocketChat.settings.get('Push_apn_key'),\n\t\t\t\tcertData: RocketChat.settings.get('Push_apn_cert')\n\t\t\t};\n\n\t\t\tif (RocketChat.settings.get('Push_production') !== true) {\n\t\t\t\tapn = {\n\t\t\t\t\tpassphrase: RocketChat.settings.get('Push_apn_dev_passphrase'),\n\t\t\t\t\tkeyData: RocketChat.settings.get('Push_apn_dev_key'),\n\t\t\t\t\tcertData: RocketChat.settings.get('Push_apn_dev_cert'),\n\t\t\t\t\tgateway: 'gateway.sandbox.push.apple.com'\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!apn.keyData || apn.keyData.trim() === '' || !apn.certData || apn.certData.trim() === '') {\n\t\t\t\tapn = undefined;\n\t\t\t}\n\n\t\t\tif (!gcm.apiKey || gcm.apiKey.trim() === '' || !gcm.projectNumber || gcm.projectNumber.trim() === '') {\n\t\t\t\tgcm = undefined;\n\t\t\t}\n\t\t}\n\n\t\tPush.Configure({\n\t\t\tapn,\n\t\t\tgcm,\n\t\t\tproduction: RocketChat.settings.get('Push_production'),\n\t\t\tsendInterval: 1000,\n\t\t\tsendBatchSize: 10\n\t\t});\n\n\t\tif (RocketChat.settings.get('Push_enable_gateway') === true) {\n\t\t\tPush.serverSend = function(options = {badge: 0}) {\n\t\t\t\tif (options.from !== String(options.from)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"from\" not a string');\n\t\t\t\t}\n\t\t\t\tif (options.title !== String(options.title)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"title\" not a string');\n\t\t\t\t}\n\t\t\t\tif (options.text !== String(options.text)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"text\" not a string');\n\t\t\t\t}\n\t\t\t\tif (RocketChat.settings.get('Push_debug')) {\n\t\t\t\t\tconsole.log(`Push: send message \"${ options.title }\" via query`, options.query);\n\t\t\t\t}\n\n\t\t\t\tconst query = {\n\t\t\t\t\t$and: [options.query, {\n\t\t\t\t\t\t$or: [{\n\t\t\t\t\t\t\t'token.apn': {\n\t\t\t\t\t\t\t\t$exists: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t'token.gcm': {\n\t\t\t\t\t\t\t\t$exists: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t}]\n\t\t\t\t};\n\n\t\t\t\treturn Push.appCollection.find(query).forEach((app) => {\n\t\t\t\t\tif (RocketChat.settings.get('Push_debug')) {\n\t\t\t\t\t\tconsole.log('Push: send to token', app.token);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (app.token.apn) {\n\t\t\t\t\t\toptions.topic = app.appName;\n\t\t\t\t\t\treturn sendPush('apn', app.token.apn, options);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (app.token.gcm) {\n\t\t\t\t\t\treturn sendPush('gcm', app.token.gcm, options);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\t\treturn Push.enabled = true;\n\t}\n}\n\nMeteor.startup(function() {\n\treturn configurePush();\n});\n","RocketChat.Migrations.add({\n\tversion: 1,\n\tup() {\n\t\treturn RocketChat.models.Users.find({\n\t\t\tusername: {\n\t\t\t\t$exists: false\n\t\t\t},\n\t\t\tlastLogin: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tconst username = RocketChat.generateUsernameSuggestion(user);\n\t\t\tif (username && username.trim() !== '') {\n\t\t\t\treturn RocketChat.models.Users.setUsername(user._id, username);\n\t\t\t} else {\n\t\t\t\treturn console.log('User without username', JSON.stringify(user, null, ' '));\n\t\t\t}\n\t\t});\n\t}\n});\n","/* globals getAvatarSuggestionForUser */\n\nRocketChat.Migrations.add({\n\tversion: 2,\n\tup() {\n\t\treturn RocketChat.models.Users.find({\n\t\t\tavatarOrigin: {\n\t\t\t\t$exists: false\n\t\t\t},\n\t\t\tusername: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tconst avatars = getAvatarSuggestionForUser(user);\n\t\t\tconst services = Object.keys(avatars);\n\n\t\t\tif (services.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst service = services[0];\n\n\t\t\tconsole.log(user.username, '->', service);\n\n\t\t\tconst dataURI = avatars[service].blob;\n\t\t\tconst {image, contentType} = RocketChatFile.dataURIParse(dataURI);\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(new Buffer(image, 'base64'));\n\t\t\tconst ws = RocketChatFileAvatarInstance.createWriteStream(`${ user.username }.jpg`, contentType);\n\n\t\t\tws.on('end', Meteor.bindEnvironment(function() {\n\t\t\t\treturn RocketChat.models.Users.setAvatarOrigin(user._id, service);\n\t\t\t}));\n\n\t\t\treturn rs.pipe(ws);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 3,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('uid_1');\n\t\tRocketChat.models.Subscriptions.tryDropIndex('rid_1_uid_1');\n\n\t\tconsole.log('Fixing ChatSubscription uid');\n\n\t\tRocketChat.models.Subscriptions.find({\n\t\t\tuid: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach((sub) => {\n\t\t\tconst update = {};\n\t\t\tconst user = RocketChat.models.Users.findOneById(sub.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tif (!update.$set) {\n\t\t\t\t\tupdate.$set = {};\n\t\t\t\t}\n\n\t\t\t\tif (!update.$unset) {\n\t\t\t\t\tupdate.$unset = {};\n\t\t\t\t}\n\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (Object.keys(update).length > 0) {\n\t\t\t\treturn RocketChat.models.Subscriptions.update(sub._id, update);\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('Fixing ChatRoom uids');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\t'uids.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach(function(room) {\n\t\t\tconst update = {};\n\t\t\tconst users = RocketChat.models.Users.find({\n\t\t\t\t_id: {\n\t\t\t\t\t$in: room.uids\n\t\t\t\t},\n\t\t\t\tusername: {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst usernames = users.map(function(user) {\n\t\t\t\treturn user.username;\n\t\t\t});\n\n\t\t\tif (!update.$set) {\n\t\t\t\tupdate.$set = {};\n\t\t\t}\n\n\t\t\tif (!update.$unset) {\n\t\t\t\tupdate.$unset = {};\n\t\t\t}\n\n\t\t\tupdate.$set.usernames = usernames;\n\t\t\tupdate.$unset.uids = 1;\n\n\t\t\tconst user = RocketChat.models.Users.findOneById(room.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (room.t === 'd' && usernames.length === 2) {\n\t\t\t\tfor (const k of Object.keys(update.$set)) {\n\t\t\t\t\tconst v = update.$set[k];\n\t\t\t\t\troom[k] = v;\n\t\t\t\t}\n\n\t\t\t\tfor (const k of Object.keys(update.$unset)) {\n\t\t\t\t\tdelete room[k];\n\t\t\t\t}\n\n\t\t\t\tconst oldId = room._id;\n\n\t\t\t\troom._id = usernames.sort().join(',');\n\n\t\t\t\tRocketChat.models.Rooms.insert(room);\n\t\t\t\tRocketChat.models.Rooms.removeById(oldId);\n\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: oldId\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: room._id\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.models.Messages.update({\n\t\t\t\t\trid: oldId\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: room._id\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn RocketChat.models.Rooms.update(room._id, update);\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('Fixing ChatMessage uid');\n\n\t\tRocketChat.models.Messages.find({\n\t\t\tuid: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach((message) => {\n\t\t\tconst update = {};\n\t\t\tconst user = RocketChat.models.Users.findOneById(message.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tif (!update.$set) {\n\t\t\t\t\tupdate.$set = {};\n\t\t\t\t}\n\n\t\t\t\tif (!update.$unset) {\n\t\t\t\t\tupdate.$unset = {};\n\t\t\t\t}\n\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (Object.keys(update).length > 0) {\n\t\t\t\treturn RocketChat.models.Messages.update(message._id, update);\n\t\t\t}\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 4,\n\tup() {\n\t\tRocketChat.models.Messages.tryDropIndex('rid_1');\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1');\n\n\t\tconsole.log('Rename rn to name');\n\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\trn: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\t$rename: {\n\t\t\t\trn: 'name'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tconsole.log('Adding names to rooms without name');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\tname: ''\n\t\t}).forEach((item) => {\n\t\t\tconst name = Random.id().toLowerCase();\n\n\t\t\tRocketChat.models.Rooms.setNameById(item._id, name);\n\n\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\trid: item._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: true\n\t\t\t});\n\t\t});\n\n\t\tconsole.log('Making room names unique');\n\n\t\tRocketChat.models.Rooms.find().forEach(function(room) {\n\n\t\t\treturn RocketChat.models.Rooms.find({\n\t\t\t\tname: room.name,\n\t\t\t\t_id: {\n\t\t\t\t\t$ne: room._id\n\t\t\t\t}\n\t\t\t}).forEach((item) => {\n\t\t\t\tconst name = `${ room.name }-${ Random.id(2).toLowerCase() }`;\n\n\t\t\t\tRocketChat.models.Rooms.setNameById(item._id, name);\n\n\t\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: item._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tname\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 5,\n\tup() {\n\t\tconsole.log('Dropping test rooms with less than 2 messages');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\tmsgs: {\n\t\t\t\t$lt: 2\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconsole.log('Dropped: ', room.name);\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\treturn RocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t});\n\n\t\tconsole.log('Dropping test rooms with less than 2 user');\n\t\tRocketChat.models.Rooms.find({\n\t\t\tusernames: {\n\t\t\t\t$size: 1\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconsole.log('Dropped: ', room.name);\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\treturn RocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t});\n\n\t\tconsole.log('Adding username to all users');\n\t\tRocketChat.models.Users.find({\n\t\t\tusername: {\n\t\t\t\t$exists: 0\n\t\t\t},\n\t\t\temails: {\n\t\t\t\t$exists: 1\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tlet newUserName = user.emails[0].address.split('@')[0];\n\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconsole.log(`Adding: username ${ newUserName } to all user ${ user._id }`);\n\t\t\treturn RocketChat.models.Users.setUsername(user._id, newUserName);\n\t\t});\n\n\t\tconsole.log('Fixing _id of direct messages rooms');\n\t\tRocketChat.models.Rooms.findByType('d').forEach(function(room) {\n\t\t\tlet newId = '';\n\t\t\tconst id0 = RocketChat.models.Users.findOneByUsername(room.usernames[0])._id;\n\t\t\tconst id1 = RocketChat.models.Users.findOneByUsername(room.usernames[1])._id;\n\t\t\tconst ids = [id0, id1];\n\n\t\t\tnewId = ids.sort().join('');\n\t\t\tif (newId !== room._id) {\n\t\t\t\tconsole.log(`Fixing: _id ${ room._id } to ${ newId }`);\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: newId\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: 1\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Messages.update({\n\t\t\t\t\trid: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: newId\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: 1\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\t\troom._id = newId;\n\t\t\t\tRocketChat.models.Rooms.insert(room);\n\t\t\t}\n\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t\t'u._id': id0\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: room.usernames[1]\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t\t'u._id': id1\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: room.usernames[0]\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tconsole.log('Adding u.username to all documents');\n\t\tRocketChat.models.Users.find({}, {\n\t\t\tusername: 1\n\t\t}).forEach((user) => {\n\t\t\tconsole.log(`Adding: u.username ${ user.username } to all document`);\n\t\t\tRocketChat.models.Rooms.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tuid: user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tu: user\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tby: user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tu: user\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tuid: {\n\t\t\t\t\t$exists: 1\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t$unset: {\n\t\t\t\t\tuid: 1,\n\t\t\t\t\tby: 1\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 6,\n\tup() {\n\t\tconsole.log('Changing _id of #general channel room from XXX to GENERAL');\n\n\t\tconst room = RocketChat.models.Rooms.findOneByName('general');\n\n\t\tif (room && room._id !== 'GENERAL') {\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: 'GENERAL'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\trid: room._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: 'GENERAL'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\n\t\t\tdelete room._id;\n\n\t\t\tRocketChat.models.Rooms.upsert({\n\t\t\t\t_id: 'GENERAL'\n\t\t\t}, {\n\t\t\t\t$set: room\n\t\t\t});\n\t\t}\n\n\t\treturn console.log('End');\n\t}\n});\n","/* globals OEmbed */\n\nRocketChat.Migrations.add({\n\tversion: 7,\n\tup() {\n\t\tconsole.log('Populate urls in messages');\n\n\t\tconst query = RocketChat.models.Messages.find({\n\t\t\t'urls.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t});\n\n\t\tconst count = query.count();\n\n\t\tquery.forEach((message, index) => {\n\t\t\tconsole.log(`${ index + 1 } / ${ count }`);\n\n\t\t\tmessage.urls = message.urls.map((url) => {\n\t\t\t\tif (_.isString(url)) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\turl\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn url;\n\t\t\t});\n\n\t\t\treturn OEmbed.rocketUrlParser(message);\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 8,\n\tup() {\n\t\tconsole.log('Load old settings record');\n\t\tconst settings = RocketChat.models.Settings.findOne({\n\t\t\t_id: 'settings'\n\t\t});\n\n\t\tif (settings) {\n\t\t\tif (settings.CDN_PREFIX) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'CDN_PREFIX', value: settings.CDN_PREFIX, type: 'string', group: 'General'});\n\t\t\t}\n\n\t\t\tif (settings.ENV && settings.ENV.MAIL_URL) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'MAIL_URL', value: settings.ENV.MAIL_URL, type: 'string', group: 'SMTP'});\n\t\t\t}\n\n\t\t\tif (settings.denyUnverifiedEmails) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'Accounts_denyUnverifiedEmails', value: settings.denyUnverifiedEmails, type: 'boolean', group: 'Accounts'});\n\t\t\t}\n\n\t\t\tif (settings.public && settings.public.avatarStore && settings.public.avatarStore.type) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'avatarStore_type', value: settings.public.avatarStore.type, type: 'string', group: 'API'});\n\t\t\t}\n\n\t\t\tif (settings.public && settings.public.avatarStore && settings.public.avatarStore.path) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'avatarStore_path', value: settings.public.avatarStore.path, type: 'string', group: 'API'});\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Settings.remove({\n\t\t\t\t_id: 'settings'\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 9,\n\tup() {\n\t\t// Migrate existing source collection data to target collection\n\t\t// target collection is defined in collections.coffee using the new collection name\n\t\t// source collection is dropped after data migration\n\t\tconst toMigrate = [\n\t\t\t{\n\t\t\t\tsource: new Mongo.Collection('data.ChatRoom'),\n\t\t\t\ttarget: RocketChat.models.Rooms.model\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('data.ChatSubscription'),\n\t\t\t\ttarget: RocketChat.models.Subscriptions.model\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('data.ChatMessage'),\n\t\t\t\ttarget: RocketChat.models.Messages.model\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('settings'),\n\t\t\t\ttarget: RocketChat.models.Settings.model\n\t\t\t}, {\n\t\t\t\t// this collection may not exit\n\t\t\t\tsource: new Mongo.Collection('oembed_cache'),\n\t\t\t\ttarget: RocketChat.models.OEmbedCache.model\n\t\t\t}\n\t\t];\n\n\t\treturn toMigrate.forEach((collection) => {\n\t\t\tconst {target, source} = collection;\n\n\t\t\t// rawCollection available as of Meteor 1.0.4\n\t\t\tconsole.log(`Migrating data from: ${ source.rawCollection().collectionName } to: ${ target.rawCollection().collectionName }`);\n\n\t\t\tsource.find().forEach((doc) => {\n\t\t\t\t// use upsert to account for GENERAL room created by initialData\n\t\t\t\treturn target.upsert({\n\t\t\t\t\t_id: doc._id\n\t\t\t\t}, doc);\n\t\t\t});\n\n\t\t\tconst rawSource = source.rawCollection();\n\n\t\t\treturn Meteor.wrapAsync(rawSource.drop, rawSource)(function(err/*, res*/) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn console.log(`Error dropping ${ rawSource.collectionName } collection due to: ${ err.errmsg }`);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Note: the following would have been much easier, but didn't work.  The serverside\n\t\t\t// data was not published to the client for some reason.\n\t\t\t// newName = target.rawCollection().collectionName\n\t\t\t// Meteor.wrapAsync(rawSource.rename, rawSource )(newName, {dropTarget:true})\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 10,\n\tup() {\n\t\t/*\n\t\t * Remove duplicated usernames from rooms\n\t\t */\n\t\tlet count = 0;\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\t'usernames.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tusernames: 1\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconst newUsernames = _.uniq(room.usernames);\n\t\t\tif (newUsernames.length !== room.usernames.length) {\n\t\t\t\tcount++;\n\t\t\t\treturn RocketChat.models.Rooms.update({\n\t\t\t\t\t_id: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tusernames: newUsernames\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn console.log(`Removed duplicated usernames from ${ count } rooms`);\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 11,\n\tup() {\n\t\t/*\n\t\t * Set GENERAL room to be default\n\t\t */\n\t\tRocketChat.models.Rooms.update({\n\t\t\t_id: 'GENERAL'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'default': true\n\t\t\t}\n\t\t});\n\n\t\treturn console.log('Set GENERAL room to be default');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 12,\n\tup() {\n\t\t// Set oldest user as admin, if none exists yet\n\t\tconst admin = RocketChat.models.Users.findOneAdmin(true, {\n\t\t\tfields: {\n\t\t\t\t_id: 1\n\t\t\t}\n\t\t});\n\n\t\tif (!admin) {\n\t\t\t// get oldest user\n\t\t\tconst oldestUser = RocketChat.models.Users.findOne({}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tcreatedAt: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (oldestUser) {\n\t\t\t\tMeteor.users.update({\n\t\t\t\t\t_id: oldestUser._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tadmin: true\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn console.log(`Set ${ oldestUser.username } as admin for being the oldest user`);\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 13,\n\tup() {\n\t\t// Set all current users as active\n\t\tRocketChat.models.Users.setAllUsersActive(true);\n\t\treturn console.log('Set all users as active');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 14,\n\tup() {\n\t\t// Remove unused settings\n\t\tRocketChat.models.Settings.remove({_id: 'API_Piwik_URL'});\n\t\tRocketChat.models.Settings.remove({_id: 'API_Piwik_ID'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_Edit'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_Delete'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_KeepStatusHistory'});\n\n\t\tRocketChat.models.Settings.update({_id: 'Message_ShowEditedStatus'}, {\n\t\t\t$set: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Settings.update({_id: 'Message_ShowDeletedStatus'}, {\n\t\t\t$set: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\n\t\tconst metaKeys = [\n\t\t\t{\n\t\t\t\told: 'Meta:language',\n\t\t\t\tnew: 'Meta_language'\n\t\t\t}, {\n\t\t\t\told: 'Meta:fb:app_id',\n\t\t\t\tnew: 'Meta_fb_app_id'\n\t\t\t}, {\n\t\t\t\told: 'Meta:robots',\n\t\t\t\tnew: 'Meta_robots'\n\t\t\t}, {\n\t\t\t\told: 'Meta:google-site-verification',\n\t\t\t\tnew: 'Meta_google-site-verification'\n\t\t\t}, {\n\t\t\t\told: 'Meta:msvalidate.01',\n\t\t\t\tnew: 'Meta_msvalidate01'\n\t\t\t}\n\t\t];\n\n\t\tfor (const oldAndNew of metaKeys) {\n\t\t\tconst oldSetting = RocketChat.models.Settings.findOne({_id: oldAndNew.old});\n\t\t\tconst oldValue = oldSetting && oldSetting.value;\n\n\t\t\tconst newSetting = RocketChat.models.Settings.findOne({_id: oldAndNew.new});\n\t\t\tconst newValue = newSetting && newSetting.value;\n\n\t\t\tif (oldValue && newValue) {\n\t\t\t\tRocketChat.models.Settings.update({\n\t\t\t\t\t_id: oldAndNew.new\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: newValue\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: oldAndNew.old\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({\n\t\t\t_id: 'SMTP_Security'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 15,\n\tup() {\n\t\tconsole.log('Starting file migration');\n\t\tconst oldFilesCollection = new Mongo.Collection('cfs.Files.filerecord');\n\t\tconst oldGridFSCollection = new Mongo.Collection('cfs_gridfs.files.files');\n\t\tconst oldChunkCollection = new Mongo.Collection('cfs_gridfs.files.chunks');\n\t\tconst newFilesCollection = RocketChat.models.Uploads;\n\t\tconst newGridFSCollection = new Mongo.Collection('rocketchat_uploads.files');\n\t\tconst newChunkCollection = new Mongo.Collection('rocketchat_uploads.chunks');\n\n\t\toldFilesCollection.find({\n\t\t\t'copies.files.key': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((cfsRecord) => {\n\t\t\tconst nameParts = cfsRecord.original.name && cfsRecord.original.name.split('.');\n\t\t\tlet extension = '';\n\t\t\tlet url = `ufs/rocketchat_uploads/${ cfsRecord._id }`;\n\n\t\t\tconsole.log('migrating file', url);\n\n\t\t\tif (nameParts && nameParts.length > 1) {\n\t\t\t\textension = nameParts.pop();\n\t\t\t\turl = `${ url }.${ extension }`;\n\t\t\t}\n\n\t\t\tconst record = {\n\t\t\t\t_id: cfsRecord._id,\n\t\t\t\tname: cfsRecord.original.name || '',\n\t\t\t\tsize: cfsRecord.original.size,\n\t\t\t\ttype: cfsRecord.original.type,\n\t\t\t\tcomplete: true,\n\t\t\t\tuploading: false,\n\t\t\t\tstore: 'rocketchat_uploads',\n\t\t\t\textension,\n\t\t\t\tuserId: cfsRecord.userId,\n\t\t\t\tuploadedAt: cfsRecord.updatedAt,\n\t\t\t\turl: Meteor.absoluteUrl() + url\n\t\t\t};\n\n\t\t\tnewFilesCollection.insert(record);\n\n\t\t\tconst oldGridFsFile = oldGridFSCollection.findOne({\n\t\t\t\t_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key)\n\t\t\t});\n\n\t\t\tnewGridFSCollection.insert({\n\t\t\t\t_id: cfsRecord._id,\n\t\t\t\tfilename: cfsRecord._id,\n\t\t\t\tcontentType: oldGridFsFile.contentType,\n\t\t\t\tlength: oldGridFsFile.length,\n\t\t\t\tchunkSize: oldGridFsFile.chunkSize,\n\t\t\t\tuploadDate: oldGridFsFile.uploadDate,\n\t\t\t\taliases: null,\n\t\t\t\tmetadata: null,\n\t\t\t\tmd5: oldGridFsFile.md5\n\t\t\t});\n\n\t\t\toldChunkCollection.find({\n\t\t\t\tfiles_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key)\n\t\t\t}).forEach((oldChunk) => {\n\t\t\t\tnewChunkCollection.insert({\n\t\t\t\t\t_id: oldChunk._id,\n\t\t\t\t\tfiles_id: cfsRecord._id,\n\t\t\t\t\tn: oldChunk.n,\n\t\t\t\t\tdata: oldChunk.data\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.find({\n\t\t\t\t$or: [{\n\t\t\t\t\t'urls.url': `https://demo.rocket.chat/cfs/files/Files/${ cfsRecord._id }`\n\t\t\t\t}, {\n\t\t\t\t\t'urls.url': `https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`\n\t\t\t\t}]\n\t\t\t}).forEach((message) => {\n\t\t\t\tfor (const urlsItem of message.urls) {\n\t\t\t\t\tif (urlsItem.url === (`https://demo.rocket.chat/cfs/files/Files/${ cfsRecord._id }`) || urlsItem.url === (`https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`)) {\n\t\t\t\t\t\turlsItem.url = Meteor.absoluteUrl() + url;\n\t\t\t\t\t\tif (urlsItem.parsedUrl && urlsItem.parsedUrl.pathname) {\n\t\t\t\t\t\t\turlsItem.parsedUrl.pathname = `/${ url }`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmessage.msg = message.msg.replace(`https://demo.rocket.chat/cfs/files/Files/${ cfsRecord._id }`, Meteor.absoluteUrl() + url);\n\t\t\t\t\t\tmessage.msg = message.msg.replace(`https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`, Meteor.absoluteUrl() + url);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tRocketChat.models.Messages.update({_id: message._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\turls: message.urls,\n\t\t\t\t\t\tmsg: message.msg\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\toldFilesCollection.remove({_id: cfsRecord._id});\n\t\t\toldGridFSCollection.remove({_id: oldGridFsFile._id});\n\t\t\toldChunkCollection.remove({files_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key)});\n\t\t});\n\n\t\treturn console.log('End of file migration');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 16,\n\tup() {\n\t\treturn RocketChat.models.Messages.tryDropIndex({\n\t\t\t_hidden: 1\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 17,\n\tup() {\n\t\treturn RocketChat.models.Messages.tryDropIndex({\n\t\t\t_hidden: 1\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 18,\n\tup() {\n\t\tconst changes = {\n\t\t\tAccounts_Facebook: 'Accounts_OAuth_Facebook',\n\t\t\tAccounts_Facebook_id: 'Accounts_OAuth_Facebook_id',\n\t\t\tAccounts_Facebook_secret: 'Accounts_OAuth_Facebook_secret',\n\t\t\tAccounts_Google: 'Accounts_OAuth_Google',\n\t\t\tAccounts_Google_id: 'Accounts_OAuth_Google_id',\n\t\t\tAccounts_Google_secret: 'Accounts_OAuth_Google_secret',\n\t\t\tAccounts_Github: 'Accounts_OAuth_Github',\n\t\t\tAccounts_Github_id: 'Accounts_OAuth_Github_id',\n\t\t\tAccounts_Github_secret: 'Accounts_OAuth_Github_secret',\n\t\t\tAccounts_Gitlab: 'Accounts_OAuth_Gitlab',\n\t\t\tAccounts_Gitlab_id: 'Accounts_OAuth_Gitlab_id',\n\t\t\tAccounts_Gitlab_secret: 'Accounts_OAuth_Gitlab_secret',\n\t\t\tAccounts_Linkedin: 'Accounts_OAuth_Linkedin',\n\t\t\tAccounts_Linkedin_id: 'Accounts_OAuth_Linkedin_id',\n\t\t\tAccounts_Linkedin_secret: 'Accounts_OAuth_Linkedin_secret',\n\t\t\tAccounts_Meteor: 'Accounts_OAuth_Meteor',\n\t\t\tAccounts_Meteor_id: 'Accounts_OAuth_Meteor_id',\n\t\t\tAccounts_Meteor_secret: 'Accounts_OAuth_Meteor_secret',\n\t\t\tAccounts_Twitter: 'Accounts_OAuth_Twitter',\n\t\t\tAccounts_Twitter_id: 'Accounts_OAuth_Twitter_id',\n\t\t\tAccounts_Twitter_secret: 'Accounts_OAuth_Twitter_secret'\n\t\t};\n\n\t\tfor (const from of Object.keys(changes)) {\n\t\t\tconst to = changes[from];\n\t\t\tconst record = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: from\n\t\t\t});\n\n\t\t\tif (record) {\n\t\t\t\tdelete record._id;\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: to\n\t\t\t\t}, record);\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: from\n\t\t\t});\n\t\t}\n\n\t\treturn ServiceConfiguration.configurations.remove({});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 19,\n\tup() {\n\t\t/*\n\t\t * Migrate existing admin users to Role based admin functionality\n\t\t * 'admin' role applies to global scope\n\t\t */\n\n\t\tconst admins = Meteor.users.find({\n\t\t\tadmin: true\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tadmins.forEach((admin) => {\n\t\t\tRocketChat.authz.addUserRoles(admin._id, ['admin']);\n\t\t});\n\n\t\tMeteor.users.update({}, {\n\t\t\t$unset: {\n\t\t\t\tadmin: ''\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tlet usernames = _.pluck(admins, 'username').join(', ');\n\n\t\tconsole.log((`Migrate ${ usernames } from admin field to 'admin' role`).green);\n\n\t\t// Add 'user' role to all users\n\t\tconst users = Meteor.users.find().fetch();\n\t\tusers.forEach((user) => {\n\t\t\tRocketChat.authz.addUserRoles(user._id, ['user']);\n\t\t});\n\n\t\tusernames = _.pluck(users, 'username').join(', ');\n\t\tconsole.log((`Add ${ usernames } to 'user' role`).green);\n\n\t\t// Add 'moderator' role to channel/group creators\n\t\tconst rooms = RocketChat.models.Rooms.findByTypes(['c', 'p']).fetch();\n\t\treturn rooms.forEach((room) => {\n\t\t\tconst creator = room && room.u && room.u._id;\n\n\t\t\tif (creator) {\n\t\t\t\tif (Meteor.users.findOne({\n\t\t\t\t\t_id: creator\n\t\t\t\t})) {\n\t\t\t\t\treturn RocketChat.authz.addUserRoles(creator, ['moderator'], room._id);\n\t\t\t\t} else {\n\t\t\t\t\tRocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\t\t\treturn RocketChat.models.Rooms.removeById(room._id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 20,\n\tup() {\n\t\t/*\n\t\t * Migrate existing `rocketchat_uploads` documents to include the room Id\n\t\t * where the file was uploaded to. The room Id is retrieved from the message\n\t\t * document created after the file upload.\n\t\t */\n\n\t\t// list of channel messages which were created after uploading a file\n\t\tconst msgQuery = {\n\t\t\trid: {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'file._id': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t};\n\n\t\tconst msgOptions = {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\trid: 1,\n\t\t\t\t'file._id': 1\n\t\t\t}\n\t\t};\n\n\t\tconst cursorFileMessages = RocketChat.models.Messages.find(msgQuery, msgOptions);\n\t\tif (!cursorFileMessages.count()) {\n\t\t\treturn;\n\t\t}\n\n\t\tcursorFileMessages.fetch().forEach((msg) => {\n\t\t\treturn RocketChat.models.Uploads.update({\n\t\t\t\t_id: msg.file && msg.file._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: msg.rid\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t$multi: true\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('Updated rocketchat_uploads documents to include the room Id in which they were sent.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 21,\n\tup() {\n\t\t/*\n\t\t * Remove any i18nLabel from rocketchat_settings\n\t\t * They will be added again where necessary on next restart\n\t\t */\n\t\tRocketChat.models.Settings.update({\n\t\t\ti18nLabel: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\ti18nLabel: 1\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\treturn console.log('Removed i18nLabel from Settings. New labels will be added on next restart! Please restart your server.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 22,\n\tup() {\n\t\t/*\n\t\t * Update message edit field\n\t\t */\n\t\tRocketChat.models.Messages.upgradeEtsToEditAt();\n\n\t\treturn console.log('Updated old messages\\' ets edited timestamp to new editedAt timestamp.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 23,\n\tup() {\n\t\tRocketChat.models.Settings.remove({\n\t\t\t_id: 'Accounts_denyUnverifiedEmails'\n\t\t});\n\n\t\treturn console.log('Deleting not used setting Accounts_denyUnverifiedEmails');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 24,\n\tup() {\n\t\treturn RocketChat.models.Permissions.remove({\n\t\t\t_id: 'access-rocket-permissions'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 25,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: /Accounts_OAuth_Custom/\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tpersistent: true\n\t\t\t},\n\t\t\t$unset: {\n\t\t\t\thidden: true\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 26,\n\tup() {\n\t\treturn RocketChat.models.Messages.update({\n\t\t\tt: 'rm'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tmentions: []\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 27,\n\tup() {\n\n\t\tRocketChat.models.Users.update({}, {\n\t\t\t$rename: {\n\t\t\t\troles: '_roles'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tRocketChat.models.Users.find({\n\t\t\t_roles: {\n\t\t\t\t$exists: 1\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tfor (const scope of Object.keys(user._roles)) {\n\t\t\t\tconst roles = user._roles[scope];\n\t\t\t\tRocketChat.models.Roles.addUserRoles(user._id, roles, scope);\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.models.Users.update({}, {\n\t\t\t$unset: {\n\t\t\t\t_roles: 1\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 28,\n\tup() {\n\t\treturn RocketChat.models.Permissions.addRole('view-c-room', 'bot');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 29,\n\tup() {\n\t\tlet LDAP_Url = (RocketChat.models.Settings.findOne('LDAP_Url') || {}).value;\n\t\tconst LDAP_TLS = (RocketChat.models.Settings.findOne('LDAP_TLS') || {}).value;\n\t\tconst LDAP_DN = (RocketChat.models.Settings.findOne('LDAP_DN') || {}).value;\n\t\tconst LDAP_Bind_Search = (RocketChat.models.Settings.findOne('LDAP_Bind_Search') || {}).value;\n\n\t\tif (LDAP_Url && LDAP_Url.trim() !== '') {\n\t\t\tLDAP_Url = LDAP_Url.replace(/ldaps?:\\/\\//i, '');\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Host'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_Url\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_TLS === true) {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Encryption'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: 'tls'\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_DN && LDAP_DN.trim() !== '') {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Domain_Base'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_DN\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Username_Field'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Unique_Identifier_Field'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_Bind_Search && LDAP_Bind_Search.trim() !== '') {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Custom_Domain_Search'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_Bind_Search\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Use_Custom_Domain_Search'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: true\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_Url'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_TLS'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_DN'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_Bind_Search'});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 30,\n\tup() {\n\t\tconst WebRTC_STUN_Server = (RocketChat.models.Settings.findOne('WebRTC_STUN_Server') || {}).value;\n\t\tconst WebRTC_TURN_Server = (RocketChat.models.Settings.findOne('WebRTC_TURN_Server') || {}).value;\n\t\tconst WebRTC_TURN_Username = (RocketChat.models.Settings.findOne('WebRTC_TURN_Username') || {}).value;\n\t\tconst WebRTC_TURN_Password = (RocketChat.models.Settings.findOne('WebRTC_TURN_Password') || {}).value;\n\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_STUN_Server'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Server'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Username'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Password'});\n\n\t\tif (WebRTC_STUN_Server === 'stun:stun.l.google.com:19302' && WebRTC_TURN_Server === 'turn:numb.viagenie.ca:3478' && WebRTC_TURN_Username === 'team@rocket.chat' && WebRTC_TURN_Password === 'demo') {\n\t\t\treturn;\n\t\t}\n\n\t\tlet servers = '';\n\t\tif (WebRTC_STUN_Server) {\n\t\t\tservers += WebRTC_STUN_Server;\n\t\t}\n\n\t\tif (WebRTC_TURN_Server) {\n\t\t\tservers += ', ';\n\t\t\tif (WebRTC_TURN_Username != null) {\n\t\t\t\tservers += `${ encodeURIComponent(WebRTC_TURN_Username) }:${ encodeURIComponent(WebRTC_TURN_Password) }@`;\n\t\t\t}\n\t\t\tservers += WebRTC_TURN_Server;\n\t\t}\n\n\t\tif (servers !== '') {\n\t\t\treturn RocketChat.models.Settings.upsert({_id: 'WebRTC_Servers'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: servers\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 31,\n\tup() {\n\t\tconst changes = {\n\t\t\tAPI_Analytics: 'GoogleTagManager_id'\n\t\t};\n\n\t\tfor (const from of Object.keys(changes)) {\n\t\t\tconst to = changes[from];\n\t\t\tconst record = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: from\n\t\t\t});\n\n\t\t\tif (record) {\n\t\t\t\tdelete record._id;\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: to\n\t\t\t\t}, record);\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: from\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 32,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: /Accounts_OAuth_Custom_/\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tgroup: 'OAuth'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 33,\n\tup() {\n\t\tconst scriptAlert = '/**\\n * This script is out-of-date, convert to the new format\\n * (https://rocket.chat/docs/administrator-guides/integrations)\\n**/\\n\\n';\n\n\t\tconst integrations = RocketChat.models.Integrations.find({\n\t\t\t$or: [\n\t\t\t\t{\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprocessIncomingRequestScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprepareOutgoingRequestScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprocessOutgoingResponseScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t}).fetch();\n\n\t\tintegrations.forEach(function(integration) {\n\t\t\tlet script = '';\n\t\t\tif (integration.processIncomingRequestScript) {\n\t\t\t\tscript += `${ integration.processIncomingRequestScript }\\n\\n`;\n\t\t\t}\n\t\t\tif (integration.prepareOutgoingRequestScript) {\n\t\t\t\tscript += `${ integration.prepareOutgoingRequestScript }\\n\\n`;\n\t\t\t}\n\t\t\tif (integration.processOutgoingResponseScript) {\n\t\t\t\tscript += `${ integration.processOutgoingResponseScript }\\n\\n`;\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Integrations.update(integration._id, {\n\t\t\t\t$set: {\n\t\t\t\t\tscript: scriptAlert + script.replace(/^/gm, '// ')\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tlet update = {\n\t\t\t$unset: {\n\t\t\t\tprocessIncomingRequestScript: 1,\n\t\t\t\tprepareOutgoingRequestScript: 1,\n\t\t\t\tprocessOutgoingResponseScript: 1\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update({}, update, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tupdate = {\n\t\t\t$set: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update({\n\t\t\tenabled: {\n\t\t\t\t$exists: false\n\t\t\t}\n\t\t}, update, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 34,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: 'Layout_Login_Header',\n\t\t\tvalue: '<a class=\"logo\" href=\"/\"><img src=\"/assets/logo/logo.svg?v=3\" /></a>'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tvalue: '<a class=\"logo\" href=\"/\"><img src=\"/assets/logo?v=3\" /></a>'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 35,\n\tup() {\n\t\treturn RocketChat.models.Messages.update({\n\t\t\t'file._id': {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'attachments.title_link': {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'attachments.title_link_download': {\n\t\t\t\t$exists: false\n\t\t\t}\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'attachments.$.title_link_download': true\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","import url from 'url';\n\nRocketChat.Migrations.add({\n\tversion: 36,\n\tup() {\n\t\tconst loginHeader = RocketChat.models.Settings.findOne({\n\t\t\t_id: 'Layout_Login_Header'\n\t\t});\n\n\t\tif (!loginHeader || !loginHeader.value) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst match = loginHeader.value.match(/<img\\ssrc=['\"]([^'\"]+)/);\n\n\t\tif (match && match.length === 2) {\n\t\t\tlet requestUrl = match[1];\n\t\t\tif (requestUrl[0] === '/') {\n\t\t\t\trequestUrl = url.resolve(Meteor.absoluteUrl(), requestUrl);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tMeteor.startup(function() {\n\t\t\t\t\treturn Meteor.setTimeout(function() {\n\t\t\t\t\t\tconst result = HTTP.get(requestUrl, {\n\t\t\t\t\t\t\tnpmRequestOptions: {\n\t\t\t\t\t\t\t\tencoding: 'binary'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (result.statusCode === 200) {\n\t\t\t\t\t\t\treturn RocketChat.Assets.setAsset(result.content, result.headers['content-type'], 'logo');\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 30000);\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t}\n\n\t\treturn RocketChat.models.Settings.remove({\n\t\t\t_id: 'Layout_Login_Header'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 37,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Find permission add-user (changed it to create-user)\n\t\t\tconst addUserPermission = RocketChat.models.Permissions.findOne('add-user');\n\n\t\t\tif (addUserPermission) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'create-user' }, { $set: { roles: addUserPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user' });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 38,\n\tup() {\n\t\tif (RocketChat && RocketChat.settings && RocketChat.settings.get) {\n\t\t\tconst allowPinning = RocketChat.settings.get('Message_AllowPinningByAnyone');\n\n\t\t\t// If public pinning was allowed, add pinning permissions to 'users', else leave it to 'owners' and 'moderators'\n\t\t\tif (allowPinning) {\n\t\t\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\t\t\t\t\tRocketChat.models.Permissions.update({ _id: 'pin-message' }, { $addToSet: { roles: 'user' } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 39,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst footer = RocketChat.models.Settings.findOne({ _id: 'Layout_Sidenav_Footer' });\n\n\t\t\t// Replace footer octicons with icons\n\t\t\tif (footer && footer.value !== '') {\n\t\t\t\tlet footerValue = footer.value.replace('octicon octicon-pencil', 'icon-pencil');\n\t\t\t\tfooterValue = footerValue.replace('octicon octicon-heart', 'icon-heart');\n\t\t\t\tfooterValue = footerValue.replace('octicon octicon-mark-github', 'icon-github-circled');\n\t\t\t\tRocketChat.models.Settings.update({ _id: 'Layout_Sidenav_Footer' }, { $set: { value: footerValue, packageValue: footerValue } });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 40,\n\tup() {\n\t\tRocketChat.models.Settings.find({ _id: /Accounts_OAuth_Custom_/, i18nLabel: 'Accounts_OAuth_Custom_Enable' }).forEach(function(customOauth) {\n\t\t\tconst parts = customOauth._id.split('_');\n\t\t\tconst name = parts[3];\n\t\t\tconst id = `Accounts_OAuth_Custom_${ name }_token_sent_via`;\n\t\t\tif (!RocketChat.models.Settings.findOne({ _id: id })) {\n\t\t\t\tRocketChat.models.Settings.insert({\n\t\t\t\t\t'_id': id,\n\t\t\t\t\t'type': 'select',\n\t\t\t\t\t'group': 'OAuth',\n\t\t\t\t\t'section': `Custom OAuth: ${ name }`,\n\t\t\t\t\t'i18nLabel': 'Accounts_OAuth_Custom_Token_Sent_Via',\n\t\t\t\t\t'persistent': true,\n\t\t\t\t\t'values': [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'key': 'header',\n\t\t\t\t\t\t\t'i18nLabel': 'Header'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'key': 'payload',\n\t\t\t\t\t\t\t'i18nLabel': 'Payload'\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t'packageValue': 'payload',\n\t\t\t\t\t'valueSource': 'packageValue',\n\t\t\t\t\t'ts': new Date(),\n\t\t\t\t\t'hidden': false,\n\t\t\t\t\t'blocked': false,\n\t\t\t\t\t'sorter': 255,\n\t\t\t\t\t'i18nDescription': `Accounts_OAuth_Custom_${ name }_token_sent_via_Description`,\n\t\t\t\t\t'createdAt': new Date(),\n\t\t\t\t\t'value': 'payload'\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 41,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ bot: true }, { $set: { type: 'bot' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'profile.guest': true }, { $set: { type: 'visitor' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ type: { $exists: false } }, { $set: { type: 'user' } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 42,\n\tup() {\n\t\tconst files = RocketChat.__migration_assets_files = new Mongo.Collection('assets.files');\n\t\tconst chunks = RocketChat.__migration_assets_chunks = new Mongo.Collection('assets.chunks');\n\t\tconst list = {\n\t\t\t'favicon.ico': 'favicon_ico',\n\t\t\t'favicon.svg': 'favicon',\n\t\t\t'favicon_64.png': 'favicon_64',\n\t\t\t'favicon_96.png': 'favicon_96',\n\t\t\t'favicon_128.png': 'favicon_128',\n\t\t\t'favicon_192.png': 'favicon_192',\n\t\t\t'favicon_256.png': 'favicon_256'\n\t\t};\n\n\t\tfor (const from of Object.keys(list)) {\n\t\t\tconst to = list[from];\n\n\t\t\tconst query = {\n\t\t\t\t_id: to\n\t\t\t};\n\n\t\t\tif (!files.findOne(query)) {\n\t\t\t\tconst oldFile = files.findOne({\n\t\t\t\t\t_id: from\n\t\t\t\t});\n\n\t\t\t\tif (oldFile) {\n\t\t\t\t\tconst extension = RocketChat.Assets.mime.extension(oldFile.contentType);\n\t\t\t\t\tRocketChat.settings.removeById(`Assets_${ from }`);\n\t\t\t\t\tRocketChat.settings.updateById(`Assets_${ to }`, {\n\t\t\t\t\t\turl: `/assets/${ to }.${ extension }`,\n\t\t\t\t\t\tdefaultUrl: RocketChat.Assets.assets[to].defaultUrl\n\t\t\t\t\t});\n\n\t\t\t\t\toldFile._id = to;\n\t\t\t\t\toldFile.filename = to;\n\t\t\t\t\tfiles.insert(oldFile);\n\t\t\t\t\tfiles.remove({\n\t\t\t\t\t\t_id: from\n\t\t\t\t\t});\n\n\t\t\t\t\tchunks.update({\n\t\t\t\t\t\tfiles_id: from\n\t\t\t\t\t}, {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\tfiles_id: to\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\tmulti: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 43,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Permissions) {\n\t\t\tRocketChat.models.Permissions.update({ _id: 'pin-message' }, { $addToSet: { roles: 'admin' } });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 44,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.find({ $or: [ { 'settings.preferences.disableNewRoomNotification': { $exists: 1 } }, { 'settings.preferences.disableNewMessageNotification': { $exists: 1 } } ] }).forEach(function(user) {\n\t\t\t\tconst newRoomNotification = !(user && user.settings && user.settings.preferences && user.settings.preferences.disableNewRoomNotification);\n\t\t\t\tconst newMessageNotification = !(user && user.settings && user.settings.preferences && user.settings.preferences.disableNewMessageNotification);\n\t\t\t\tRocketChat.models.Users.update({ _id: user._id }, { $unset: { 'settings.preferences.disableNewRoomNotification': 1, 'settings.preferences.disableNewMessageNotification': 1 }, $set: { 'settings.preferences.newRoomNotification': newRoomNotification, 'settings.preferences.newMessageNotification': newMessageNotification } });\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst optOut = RocketChat.models.Settings.findOne({ _id: 'Statistics_opt_out' });\n\t\t\tif (optOut) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Statistics_opt_out' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'Statistics_reporting' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !optOut.value ? true : false,\n\t\t\t\t\t\ti18nDescription: 'Statistics_reporting_Description',\n\t\t\t\t\t\tpackageValue: true,\n\t\t\t\t\t\ti18nLabel: 'Statistics_reporting'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst favoriteRooms = RocketChat.models.Settings.findOne({ _id: 'Disable_Favorite_Rooms' });\n\t\t\tif (favoriteRooms) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Disable_Favorite_Rooms' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'Favorite_Rooms' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !favoriteRooms.value ? true : false,\n\t\t\t\t\t\ti18nDescription: 'Favorite_Rooms_Description',\n\t\t\t\t\t\tpackageValue: true,\n\t\t\t\t\t\ti18nLabel: 'Favorite_Rooms'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 45,\n\tup() {\n\n\t\t// finds the latest created visitor\n\t\tconst lastVisitor = RocketChat.models.Users.find({ type: 'visitor' }, { fields: { username: 1 }, sort: { createdAt: -1 }, limit: 1 }).fetch();\n\n\t\tif (lastVisitor && lastVisitor.length > 0) {\n\t\t\tconst lastNumber = lastVisitor[0].username.replace(/^guest\\-/, '');\n\n\t\t\tRocketChat.settings.add('Livechat_guest_count', (parseInt(lastNumber) + 1), { type: 'int', group: 'Livechat' });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 46,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ type: { $exists: false } }, { $set: { type: 'user' } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 47,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst autolinkerUrls = RocketChat.models.Settings.findOne({ _id: 'AutoLinker_Urls' });\n\t\t\tif (autolinkerUrls) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'AutoLinker_Urls' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_Scheme' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_Scheme'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_www' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_www'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_TLD' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_TLD'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 48,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\tconst RocketBot_Enabled = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: 'RocketBot_Enabled'\n\t\t\t});\n\t\t\tif (RocketBot_Enabled) {\n\t\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t\t_id: 'RocketBot_Enabled'\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: 'InternalHubot_Enabled'\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: RocketBot_Enabled.value\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst RocketBot_Name = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: 'RocketBot_Name'\n\t\t\t});\n\t\t\tif (RocketBot_Name) {\n\t\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t\t_id: 'RocketBot_Name'\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: 'InternalHubot_Username'\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: RocketBot_Name.value\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 49,\n\tup() {\n\n\t\tlet count = 1;\n\n\t\tRocketChat.models.Rooms.find({ t: 'l' }, { sort: { ts: 1 }, fields: { _id: 1 } }).forEach(function(room) {\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, { $set: { code: count } });\n\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, { $set: { code: count } }, { multi: true });\n\t\t\tcount++;\n\t\t});\n\n\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_Room_Count' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: count,\n\t\t\t\ttype: 'int',\n\t\t\t\tgroup: 'Livechat'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 50,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1_name_1_t_1');\n\t\tRocketChat.models.Subscriptions.tryEnsureIndex({ 'u._id': 1, 'name': 1, 't': 1 });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 51,\n\tup() {\n\t\tRocketChat.models.Rooms.find({ t: 'l', 'v.token': { $exists: true }, label: { $exists: false }}).forEach(function(room) {\n\t\t\tconst user = RocketChat.models.Users.findOne({ 'profile.token': room.v.token });\n\t\t\tif (user) {\n\t\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tlabel: user.name || user.username,\n\t\t\t\t\t\t'v._id': user._id\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tname: user.name || user.username\n\t\t\t\t\t}\n\t\t\t\t}, { multi: true });\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 52,\n\tup() {\n\t\tRocketChat.models.Users.update({ _id: 'rocket.cat' }, { $addToSet: { roles: 'bot' } });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 53,\n\tup() {\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Header', value: '' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: '<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" bgcolor=\"#f3f3f3\" style=\"color:#4a4a4a;font-family: Helvetica,Arial,sans-serif;font-size:14px;line-height:20px;border-collapse:callapse;border-spacing:0;margin:0 auto\"><tr><td style=\"padding:1em\"><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" width=\"100%\" style=\"width:100%;margin:0 auto;max-width:800px\"><tr><td bgcolor=\"#ffffff\" style=\"background-color:#ffffff; border: 1px solid #DDD; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\"><table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"background-color: #04436a;\"><h1 style=\"font-family: Helvetica,Arial,sans-serif; padding: 0 1em; margin: 0; line-height: 70px; color: #FFF;\">[Site_Name]</h1></td></tr><tr><td style=\"padding: 1em; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\">'\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Footer', value: '' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: '</td></tr></table></td></tr><tr><td border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family: Helvetica,Arial,sans-serif; max-width: 800px; margin: 0 auto; padding: 1.5em; text-align: center; font-size: 8pt; color: #999;\">Powered by <a href=\"https://rocket.chat\" target=\"_blank\">Rocket.Chat</a></td></tr></table></td></tr></table>'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 54,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\t// Set default message viewMode to 'normal' or 'cozy' depending on the users' current settings and remove the field 'compactView'\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.compactView': true }, { $set: { 'settings.preferences.viewMode': 1 }, $unset: { 'settings.preferences.compactView': 1 } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.viewMode': { $ne: 1 } }, { $set: { 'settings.preferences.viewMode': 0 } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 55,\n\tup() {\n\t\tRocketChat.models.Rooms.find({ 'topic': { $exists: 1, $ne: '' } }, { topic: 1 }).forEach(function(room) {\n\t\t\tconst topic = s.escapeHTML(room.topic);\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, { $set: { topic }});\n\t\t\tRocketChat.models.Messages.update({ t: 'room_changed_topic', rid: room._id }, { $set: { msg: topic }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 56,\n\tup() {\n\t\tRocketChat.models.Messages.find({ _id: /\\./ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/(.*)\\.S?(.*)/, 'slack-$1-$2');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 57,\n\tup() {\n\t\tRocketChat.models.Messages.find({ _id: /slack-([a-zA-Z0-9]+)S([0-9]+-[0-9]+)/ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/slack-([a-zA-Z0-9]+)S([0-9]+-[0-9]+)/, 'slack-$1-$2');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\n\t\tRocketChat.models.Messages.find({ _id: /slack-slack/ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace('slack-slack', 'slack');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\n\t\tRocketChat.models.Messages.find({ _id: /\\./ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/(.*)\\.?S(.*)/, 'slack-$1-$2');\n\t\t\tmessage._id = message._id.replace(/\\./g, '-');\n\t\t\tRocketChat.models.Messages.remove({ _id: message._id });\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 58,\n\tup() {\n\t\tRocketChat.models.Settings.update({ _id: 'Push_gateway', value: 'https://rocket.chat' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: 'https://gateway.rocket.chat',\n\t\t\t\tpackageValue: 'https://gateway.rocket.chat'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 59,\n\tup() {\n\t\tconst users = RocketChat.models.Users.find({}, { sort: { createdAt: 1 }, limit: 1 }).fetch();\n\t\tif (users && users.length > 0) {\n\t\t\tconst createdAt = users[0].createdAt;\n\t\t\tRocketChat.models.Settings.update({ createdAt: { $exists: 0 } }, { $set: { createdAt } }, { multi: true });\n\t\t\tRocketChat.models.Statistics.update({ installedAt: { $exists: 0 } }, { $set: { installedAt: createdAt } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 60,\n\tup() {\n\t\tlet subscriptions = RocketChat.models.Subscriptions.find({ $or: [ { name: { $exists: 0 } }, { name: { $not: { $type: 2 } } } ] }).fetch();\n\t\tif (subscriptions && subscriptions.length > 0) {\n\t\t\tRocketChat.models.Subscriptions.remove({ _id: { $in: _.pluck(subscriptions, '_id') } });\n\t\t}\n\n\t\tsubscriptions = RocketChat.models.Subscriptions.find().forEach(function(subscription) {\n\t\t\tconst user = RocketChat.models.Users.findOne({ _id: subscription && subscription.u && subscription.u._id });\n\t\t\tif (!user) {\n\t\t\t\tRocketChat.models.Subscriptions.remove({ _id: subscription._id });\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 61,\n\tup() {\n\t\tRocketChat.models.Users.find({ active: false }).forEach(function(user) {\n\t\t\tRocketChat.models.Subscriptions.setArchivedByUsername(user.username, true);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 62,\n\tup() {\n\t\tRocketChat.models.Settings.remove({ _id: 'Atlassian Crowd', type: 'group' });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 63,\n\tup() {\n\t\tconst forward = RocketChat.models.Settings.findOne({ _id:'Livechat_forward_open_chats' });\n\t\tconst timeout = RocketChat.models.Settings.findOne({ _id:'Livechat_forward_open_chats_timeout' });\n\n\t\tif (forward && forward.value) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_agent_leave_action' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: 'forward',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tgroup: 'Livechat'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (timeout && timeout.value !== 60) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_agent_leave_action_timeout' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: timeout.value,\n\t\t\t\t\ttype: 'int',\n\t\t\t\t\tgroup: 'Livechat'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'Livechat_forward_open_chats' });\n\t\tRocketChat.models.Settings.remove({ _id: 'Livechat_forward_open_chats_timeout' });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 64,\n\tup() {\n\t\tRocketChat.models.Messages.find({ 't': 'room_changed_topic', 'msg': /</ }, { msg: 1 }).forEach(function(message) {\n\t\t\tconst msg = s.escapeHTML(message.msg);\n\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { msg }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 65,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\t// New color settings - start with old settings as defaults\n\t\t\tconst replace1 = RocketChat.models.Settings.findOne({ _id: 'theme-color-quaternary-font-color' });\n\t\t\tconst replace2 = RocketChat.models.Settings.findOne({ _id: 'theme-color-input-font-color' });\n\t\t\tconst replace3 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-online' });\n\t\t\tconst replace4 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-away' });\n\t\t\tconst replace5 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-busy' });\n\t\t\tconst replace6 = RocketChat.models.Settings.findOne({ _id: 'theme-color-info-active-font-color' });\n\t\t\tif (replace1) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-secondary-action-color' }, { $set: { value: replace1.value } });\n\t\t\t}\n\t\t\tif (replace2) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-component-color' }, { $set: { value: replace2.value } });\n\t\t\t}\n\t\t\tif (replace3) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-success-color' }, { $set: { value: replace3.value } });\n\t\t\t}\n\t\t\tif (replace4) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-pending-color' }, { $set: { value: replace4.value } });\n\t\t\t}\n\t\t\tif (replace5) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-error-color' }, { $set: { value: replace5.value } });\n\t\t\t}\n\t\t\tif (replace6) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-selection-color' }, { $set: { value: replace6.value } });\n\t\t\t}\n\n\t\t\t// Renamed color settings\n\t\t\tconst oldColor = RocketChat.models.Settings.findOne({ _id: 'theme-color-action-buttons-color' });\n\t\t\tif (oldColor) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-action-buttons-color' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-primary-action-color' }, { $set: { value: oldColor.value } });\n\t\t\t}\n\n\t\t\t// Removed color settings\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-quaternary-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-active-channel-background-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-active-channel-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-blockquote-background' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-clean-buttons-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-background' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-border' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-info-active-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-input-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-message-hover-background-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-smallprint-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-smallprint-hover-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-unread-notification-color' });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 66,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\t// New color settings - start with old settings as defaults\n\t\t\tconst replace1 = RocketChat.models.Settings.findOne({ _id: 'theme-color-tertiary-background-color' });\n\t\t\tif (replace1) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-component-color' }, { $set: { value: replace1.value } });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 67,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.LivechatDepartment) {\n\t\t\tRocketChat.models.LivechatDepartment.model.update({}, {\n\t\t\t\t$set: {\n\t\t\t\t\tshowOnRegistration: true\n\t\t\t\t}\n\t\t\t}, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 68,\n\tup() {\n\t\tconst GoogleSiteVerification_id = RocketChat.models.Settings.findOne({ _id: 'GoogleSiteVerification_id' });\n\n\t\tif (GoogleSiteVerification_id && GoogleSiteVerification_id.value) {\n\t\t\tRocketChat.models.Settings.update({ _id: 'Meta_google-site-verification' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: GoogleSiteVerification_id.value\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'GoogleSiteVerification_id' });\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 69,\n\tup() {\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-custom-scrollbar-color',\n\t\t\t'value': 'rgba(255, 255, 255, 0.05)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-darker'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-info-font-color',\n\t\t\t'value': '#aaaaaa'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@secondary-font-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-link-font-color',\n\t\t\t'value': '#008ce3'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@primary-action-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-away',\n\t\t\t'value': '#fcb316'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@pending-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-busy',\n\t\t\t'value': '#d30230'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@error-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-offline',\n\t\t\t'value': 'rgba(150, 150, 150, 0.50)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-darker'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-online',\n\t\t\t'value': '#35ac19'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@success-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-tertiary-background-color',\n\t\t\t'value': '#eaeaea'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@component-color'\n\t\t\t}\n\t\t});\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-tertiary-font-color',\n\t\t\t'value': 'rgba(255, 255, 255, 0.6)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-lightest'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 70,\n\tup() {\n\t\tconst settings = RocketChat.models.Settings.find({ _id: /^Accounts_OAuth_Custom_.+/ }).fetch();\n\t\tfor (const setting of settings) {\n\t\t\tconst _id = setting._id;\n\t\t\tsetting._id = setting._id.replace(/Accounts_OAuth_Custom_([A-Za-z0-9]+)_(.+)/, 'Accounts_OAuth_Custom-$1-$2');\n\t\t\tsetting._id = setting._id.replace(/Accounts_OAuth_Custom_([A-Za-z0-9]+)/, 'Accounts_OAuth_Custom-$1');\n\n\t\t\tRocketChat.models.Settings.remove({ _id });\n\t\t\tRocketChat.models.Settings.insert(setting);\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 71,\n\tup() {\n\t\t//Removes the reactions on messages which are the system type \"rm\" ;)\n\t\tRocketChat.models.Messages.find({ 't': 'rm', 'reactions': { $exists: true, $not: {$size: 0} } }, { t: 1 }).forEach(function(message) {\n\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { reactions: [] }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 72,\n\tup() {\n\t\tRocketChat.models.Users.find({ type: 'visitor', 'emails.address': { $exists: true } }, { emails: 1 }).forEach(function(visitor) {\n\t\t\tRocketChat.models.Users.update({ _id: visitor._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvisitorEmails: visitor.emails\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\temails: 1\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 73,\n\tup() {\n\t\tRocketChat.models.Users.find({ 'oauth.athorizedClients': { $exists: true } }, { oauth: 1 }).forEach(function(user) {\n\t\t\tRocketChat.models.Users.update({ _id: user._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\t'oauth.authorizedClients': user.oauth.athorizedClients\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\t'oauth.athorizedClients': 1\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 74,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_64'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_96'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_128'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_256'});\n\t\t\tRocketChat.models.Settings.update({_id: 'Assets_favicon_192'}, {\n\t\t\t\t$set: {\n\t\t\t\t\ti18nLabel: 'android-chrome 192x192 (png)'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 71.1,\n\tup() {\n\t\tServiceConfiguration.configurations.remove({});\n\t}\n});\n\nRocketChat.Migrations.add({\n\tversion: 75,\n\tup() {\n\t\tServiceConfiguration.configurations.remove({});\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 76,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.find({section: 'Colors (alphas)'}).forEach((setting) => {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: setting._id });\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 77,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Rooms) {\n\t\t\tRocketChat.models.Rooms.find({\n\t\t\t\tt: 'l',\n\t\t\t\t'v._id': { $exists: true },\n\t\t\t\t'v.username': { $exists: false }\n\t\t\t}, { fields: { 'v._id': 1 } }).forEach(function(room) {\n\t\t\t\tconst user = RocketChat.models.Users.findOne({ _id: room.v._id }, { username: 1 });\n\n\t\t\t\tif (user && user.username) {\n\t\t\t\t\tRocketChat.models.Rooms.update({\n\t\t\t\t\t\t_id: room._id\n\t\t\t\t\t}, {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\t'v.username': user.username\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 78,\n\tup() {\n\t\tRocketChat.models.Permissions.update({ _id: { $in: ['create-c', 'create-d', 'create-p'] }}, { $addToSet: { roles: 'bot' }}, { multi: true });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 79,\n\tup() {\n\t\tconst integrations = RocketChat.models.Integrations.find({type: 'webhook-incoming'}).fetch();\n\n\t\tfor (const integration of integrations) {\n\t\t\tif (typeof integration.channel === 'string') {\n\t\t\t\tRocketChat.models.Integrations.update({_id: integration._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tchannel: integration.channel.split(',').map(channel => channel.trim())\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 80,\n\tup() {\n\t\tconst query = {\n\t\t\ttype: 'webhook-outgoing',\n\t\t\t$or: [{\n\t\t\t\tchannel: []\n\t\t\t}, {\n\t\t\t\tchannel: ''\n\t\t\t}, {\n\t\t\t\tchannel: {\n\t\t\t\t\t$exists: false\n\t\t\t\t}\n\t\t\t}]\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tchannel: ['all_public_channels']\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update(query, update, {multi: true});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 81,\n\tup() {\n\t\tRocketChat.models.OAuthApps.update({ _id: 'zapier' }, {\n\t\t\t$set: {\n\t\t\t\tactive: true,\n\t\t\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/App32270API/'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 82,\n\tup() {\n\t\tconst admins = RocketChat.authz.getUsersInRole('admin').fetch();\n\t\tif (admins.length === 1 && admins[0]._id === 'rocket.cat') {\n\t\t\tRocketChat.authz.removeUserFromRoles('rocket.cat', 'admin');\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 83,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings && RocketChat.models.Users) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'InternalHubot_Username' });\n\t\t\tif (setting && setting.value) {\n\t\t\t\tconst username = setting.value;\n\t\t\t\tconst user = RocketChat.models.Users.findOne({ username });\n\t\t\t\tif (!user && setting.value === 'Rocket.Cat') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'InternalHubot_Username' }, { $set: { value: 'rocket.cat', packageValue: 'rocket.cat' } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 84,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Update permission name, copy values from old name\n\t\t\tconst oldPermission = RocketChat.models.Permissions.findOne('add-user-to-room');\n\t\t\tif (oldPermission && oldPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'add-user-to-joined-room' }, { $set: { roles: oldPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user-to-room' });\n\t\t\t}\n\t\t}\n\t},\n\n\tdown() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Revert permission name, copy values from updated name\n\t\t\tconst newPermission = RocketChat.models.Permissions.findOne('add-user-to-joined-room');\n\t\t\tif (newPermission && newPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'add-user-to-room' }, { $set: { roles: newPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user-to-joined-room' });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 85,\n\tup() {\n\t\tconst query = {\n\t\t\tt: 'p',\n\t\t\tusernames: {$size: 2},\n\t\t\tu: {$exists: false},\n\t\t\tname: {$exists: false}\n\t\t};\n\n\t\tconst rooms = RocketChat.models.Rooms.find(query).fetch();\n\n\t\tif (rooms.length > 0) {\n\t\t\tconst rids = rooms.map(room => room._id);\n\t\t\tRocketChat.models.Rooms.update({_id: {$in: rids}}, {$set: {t: 'd'}}, {multi: true});\n\t\t\tRocketChat.models.Subscriptions.update({rid: {$in: rids}}, {$set: {t: 'd'}}, {multi: true});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 86,\n\tup() {\n\t\t// Disabled this migration for it was not updating any user\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 87,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newMessageNotification': false }, { $set: { 'settings.preferences.newMessageNotification': 'none' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newMessageNotification': true }, { $unset: { 'settings.preferences.newMessageNotification': 1 } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newRoomNotification': false }, { $set: { 'settings.preferences.newRoomNotification': 'none' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newRoomNotification': true }, { $unset: { 'settings.preferences.newRoomNotification': 1 } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 88,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Layout_Sidenav_Footer' });\n\t\t\tif (setting && setting.value && setting.packageValue) {\n\t\t\t\tif (setting.value === '<img style=\"left: 10px; position: absolute;\" src=\"/assets/logo.png\" />') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'Layout_Sidenav_Footer' }, { $set: { value: setting.packageValue } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 89,\n\tup() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing' }, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { event: 'sendMessage', retryFailedCalls: true, retryCount: 6, retryDelay: 'powers-of-ten' }});\n\t\t});\n\t},\n\tdown() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing', event: { $ne: 'sendMessage' }}, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { enabled: false }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 90,\n\tup() {\n\t\tRocketChat.models.Settings.remove({ _id: 'Piwik', type: 'group' });\n\n\t\tconst settings = RocketChat.models.Settings.find({$or: [{_id: 'PiwikAnalytics_url', value: {$ne: null}}, {_id: 'PiwikAnalytics_siteId', value: {$ne: null}}]}).fetch();\n\n\t\tif (settings && settings.length === 2) {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'PiwikAnalytics_enabled'}, {$set: {value: true}});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 91,\n\tup() {\n\t\tconst query = {\n\t\t\t'services.linkedin': {\n\t\t\t\t$exists: 1\n\t\t\t},\n\t\t\t$or: [{\n\t\t\t\tname: {\n\t\t\t\t\t$exists: 0\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tname: null\n\t\t\t}]\n\t\t};\n\n\t\tRocketChat.models.Users.find(query, {'services.linkedin.firstName': 1, username: 1}).forEach((user) => {\n\t\t\tconst name = `${ user.services.linkedin.firstName } ${ user.services.linkedin.lastName }`;\n\n\t\t\tRocketChat.models.Users.setName(user._id, name);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 92,\n\tup() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing', 'event': 'sendMessage' }, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { runOnEdits: true }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 93,\n\tup() {\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_AllowAnonymousAccess' });\n\t\t\tif (setting && setting.value === true) {\n\t\t\t\tRocketChat.models.Settings.update({ _id: 'Accounts_AllowAnonymousRead' }, { $set: { value: setting.value } });\n\t\t\t}\n\t\t}\n\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: [\n\t\t\t\t\t'view-c-room',\n\t\t\t\t\t'view-history',\n\t\t\t\t\t'view-joined-room',\n\t\t\t\t\t'view-p-room',\n\t\t\t\t\t'preview-c-room'\n\t\t\t\t]\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\troles: 'anonymous'\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Permissions.update(query, update, { multi: true });\n\t}\n});\n","if (RocketChat.Migrations.getVersion() !== 0) {\n\tRocketChat.Migrations.migrateTo('latest');\n} else {\n\tconst control = RocketChat.Migrations._getControl();\n\tcontrol.version = _.last(RocketChat.Migrations._list).version;\n\tRocketChat.Migrations._setControl(control);\n}\n","if (Meteor.AppCache) {\n\tMeteor.AppCache.config({\n\t\tonlineOnly: ['/elements/', '/landing/', '/moment-locales/', '/scripts/']\n\t});\n}\n","import getFileType from 'file-type';\n\nMeteor.startup(function() {\n\tlet storeType = 'GridFS';\n\n\tif (RocketChat.settings.get('Accounts_AvatarStoreType')) {\n\t\tstoreType = RocketChat.settings.get('Accounts_AvatarStoreType');\n\t}\n\n\tconst RocketChatStore = RocketChatFile[storeType];\n\n\tif (!RocketChatStore) {\n\t\tthrow new Error(`Invalid RocketChatStore type [${ storeType }]`);\n\t}\n\n\tconsole.log((`Using ${ storeType } for Avatar storage`).green);\n\n\tfunction transformWrite(file, readStream, writeStream) {\n\t\tif (RocketChatFile.enabled === false || RocketChat.settings.get('Accounts_AvatarResize') !== true) {\n\t\t\treturn readStream.pipe(writeStream);\n\t\t}\n\t\tconst height = RocketChat.settings.get('Accounts_AvatarSize');\n\t\tconst width = height;\n\t\treturn RocketChatFile.gm(readStream, file.fileName).background('#ffffff').resize(width, `${ height }^`).gravity('Center').crop(width, height).extent(width, height).stream('jpeg').pipe(writeStream);\n\t}\n\n\tlet path = '~/uploads';\n\tif (RocketChat.settings.get('Accounts_AvatarStorePath') && RocketChat.settings.get('Accounts_AvatarStorePath').trim() !== '') {\n\t\tpath = RocketChat.settings.get('Accounts_AvatarStorePath');\n\t}\n\n\tthis.RocketChatFileAvatarInstance = new RocketChatStore({\n\t\tname: 'avatars',\n\t\tabsolutePath: path,\n\t\ttransformWrite\n\t});\n\n\treturn WebApp.connectHandlers.use('/avatar/', Meteor.bindEnvironment(function(req, res/*, next*/) {\n\t\tconst params = {\n\t\t\tusername: decodeURIComponent(req.url.replace(/^\\//, '').replace(/\\?.*$/, ''))\n\t\t};\n\n\t\tlet username = params.username.replace(/\\.jpg$/, '').replace(/^@/, '');\n\n\t\tif (_.isEmpty(params.username)) {\n\t\t\tres.writeHead(403);\n\t\t\tres.write('Forbidden');\n\t\t\tres.end();\n\t\t\treturn;\n\t\t}\n\n\t\tlet file;\n\n\t\tif (params.username[0] !== '@') {\n\t\t\tif (Meteor.settings && Meteor.settings.public && Meteor.settings.public.sandstorm) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneByUsername(username);\n\t\t\t\tif (user && user.services && user.services.sandstorm && user.services.sandstorm.picture) {\n\t\t\t\t\tres.setHeader('Location', user.services.sandstorm.picture);\n\t\t\t\t\tres.writeHead(302);\n\t\t\t\t\tres.end();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfile = RocketChatFileAvatarInstance.getFileWithReadStream(encodeURIComponent(`${ username }.jpg`));\n\t\t}\n\n\t\tres.setHeader('Content-Disposition', 'inline');\n\t\tif (!file) {\n\t\t\tres.setHeader('Content-Type', 'image/svg+xml');\n\t\t\tres.setHeader('Cache-Control', 'public, max-age=0');\n\t\t\tres.setHeader('Expires', '-1');\n\t\t\tres.setHeader('Last-Modified', 'Thu, 01 Jan 2015 00:00:00 GMT');\n\n\t\t\tconst reqModifiedHeader = req.headers['if-modified-since'];\n\n\t\t\tif (reqModifiedHeader) {\n\t\t\t\tif (reqModifiedHeader === 'Thu, 01 Jan 2015 00:00:00 GMT') {\n\t\t\t\t\tres.writeHead(304);\n\t\t\t\t\tres.end();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst colors = ['#F44336', '#E91E63', '#9C27B0', '#673AB7', '#3F51B5', '#2196F3', '#03A9F4', '#00BCD4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFC107', '#FF9800', '#FF5722', '#795548', '#9E9E9E', '#607D8B'];\n\n\t\t\tif (RocketChat.settings.get('UI_Use_Name_Avatar')) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneByUsername(username, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tname: 1\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (user && user.name) {\n\t\t\t\t\tusername = user.name;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet color = '';\n\t\t\tlet initials = '';\n\n\t\t\tif (username === '?') {\n\t\t\t\tcolor = '#000';\n\t\t\t\tinitials = username;\n\t\t\t} else {\n\t\t\t\tconst position = username.length % colors.length;\n\n\t\t\t\tcolor = colors[position];\n\t\t\t\tusername = username.replace(/[^A-Za-z0-9]/g, '.').replace(/\\.+/g, '.').replace(/(^\\.)|(\\.$)/g, '');\n\n\t\t\t\tconst usernameParts = username.split('.');\n\n\t\t\t\tinitials = usernameParts.length > 1 ? _.first(usernameParts)[0] + _.last(usernameParts)[0] : username.replace(/[^A-Za-z0-9]/g, '').substr(0, 2);\n\t\t\t\tinitials = initials.toUpperCase();\n\t\t\t}\n\n\t\t\tconst svg = `<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" standalone=\\\"no\\\"?>\\n<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" pointer-events=\\\"none\\\" width=\\\"50\\\" height=\\\"50\\\" style=\\\"width: 50px; height: 50px; background-color: ${ color };\\\">\\n\t<text text-anchor=\\\"middle\\\" y=\\\"50%\\\" x=\\\"50%\\\" dy=\\\"0.36em\\\" pointer-events=\\\"auto\\\" fill=\\\"#ffffff\\\" font-family=\\\"Helvetica, Arial, Lucida Grande, sans-serif\\\" style=\\\"font-weight: 400; font-size: 28px;\\\">\\n\t\t${ initials }\\n\t</text>\\n</svg>`;\n\t\t\tres.write(svg);\n\t\t\tres.end();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst reqModifiedHeader = req.headers['if-modified-since'];\n\t\tif (reqModifiedHeader) {\n\t\t\tif (reqModifiedHeader === (file.uploadDate && file.uploadDate.toUTCString())) {\n\t\t\t\tres.setHeader('Last-Modified', reqModifiedHeader);\n\t\t\t\tres.writeHead(304);\n\t\t\t\tres.end();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tres.setHeader('Cache-Control', 'public, max-age=0');\n\t\tres.setHeader('Expires', '-1');\n\t\tres.setHeader('Last-Modified', (file.uploadDate && file.uploadDate.toUTCString()) || new Date().toUTCString());\n\t\tres.setHeader('Content-Length', file.length);\n\n\t\tif (file.contentType) {\n\t\t\tres.setHeader('Content-Type', file.contentType);\n\t\t} else {\n\t\t\tfile.readStream.once('data', function(chunk) {\n\t\t\t\tconst fileType = getFileType(chunk);\n\t\t\t\tif (fileType) {\n\t\t\t\t\treturn res.setHeader('Content-Type', fileType.mime);\n\t\t\t\t} else {\n\t\t\t\t\treturn res.setHeader('Content-Type', 'image/jpeg');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfile.readStream.pipe(res);\n\t}));\n});\n","/* global SyncedCron */\n\nconst logger = new Logger('SyncedCron');\n\nSyncedCron.config({\n\tlogger(opts) {\n\t\treturn logger[opts.level].call(logger, opts.message);\n\t},\n\tcollectionName: 'rocketchat_cron_history'\n});\n\nfunction generateStatistics() {\n\tconst statistics = RocketChat.statistics.save();\n\n\tstatistics.host = Meteor.absoluteUrl();\n\n\tif (RocketChat.settings.get('Statistics_reporting')) {\n\t\ttry {\n\t\t\tHTTP.post('https://collector.rocket.chat/', {\n\t\t\t\tdata: statistics\n\t\t\t});\n\t\t} catch (error) {\n\t\t\t/*error*/\n\t\t\tlogger.warn('Failed to send usage report');\n\t\t}\n\t}\n}\n\nfunction cleanupOEmbedCache() {\n\treturn Meteor.call('OEmbedCacheCleanup');\n}\n\nMeteor.startup(function() {\n\treturn Meteor.defer(function() {\n\t\tgenerateStatistics();\n\n\t\tSyncedCron.add({\n\t\t\tname: 'Generate and save statistics',\n\t\t\tschedule(parser) {\n\t\t\t\treturn parser.cron(`${ new Date().getMinutes() } * * * *`);\n\t\t\t},\n\t\t\tjob: generateStatistics\n\t\t});\n\n\t\tSyncedCron.add({\n\t\t\tname: 'Cleanup OEmbed cache',\n\t\t\tschedule(parser) {\n\t\t\t\tconst now = new Date();\n\t\t\t\treturn parser.cron(`${ now.getMinutes() } ${ now.getHours() } * * *`);\n\t\t\t},\n\t\t\tjob: cleanupOEmbedCache\n\t\t});\n\t\treturn SyncedCron.start();\n\t});\n});\n","function flat(obj, newObj = {}, path = '') {\n\tfor (const key of Object.keys(obj)) {\n\t\tconst value = obj[key];\n\n\t\tif (_.isObject(value)) {\n\t\t\tflat(value, newObj, `${ key }.`);\n\t\t} else {\n\t\t\tnewObj[path + key] = value;\n\t\t}\n\t}\n\n\treturn newObj;\n}\n\nRocketChat.i18nValidation = function i18nValidation() {\n\tconst l = {};\n\tconst keys = {};\n\tconst errors = [];\n\tconst langs = Object.keys(TAPi18next.options.resStore);\n\n\tfor (const lang of Object.keys(TAPi18next.options.resStore)) {\n\t\tconst value = TAPi18next.options.resStore[lang];\n\n\t\tl[lang] = flat(value);\n\n\t\tfor (const key of Object.keys(l[lang])) {\n\t\t\tif (keys[key] == null) {\n\t\t\t\tkeys[key] = [];\n\t\t\t}\n\t\t\tkeys[key].push(lang);\n\t\t}\n\t}\n\n\tlet len = 0;\n\tfor (const key of Object.keys(keys)) {\n\t\tconst present = keys[key];\n\n\t\tif (!(present.length !== langs.length)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst error = (`${ _.difference(langs, present).join(',') }: missing translation for `).red + key.white + (`. Present in [${ present.join(',') }]`).red;\n\n\t\terrors.push(error);\n\n\t\tif (error.length > len) {\n\t\t\tlen = error.length;\n\t\t}\n\t}\n\n\tif (errors.length > 0) {\n\t\tconsole.log('+'.red + s.rpad('', len - 28, '-').red + '+'.red);\n\n\t\tfor (const error of errors) {\n\t\t\tconsole.log('|'.red, s.rpad(`${ error }`, len).red, '|'.red);\n\t\t}\n\n\t\treturn console.log('+'.red + s.rpad('', len - 28, '-').red + '+'.red);\n\t}\n};\n\n// Meteor.startup(function() {\n// \tRocketChat.i18nValidation();\n// });\n","Meteor.startup(function() {\n\tMeteor.defer(function() {\n\t\tif (!RocketChat.models.Rooms.findOneById('GENERAL')) {\n\t\t\tRocketChat.models.Rooms.createWithIdTypeAndName('GENERAL', 'c', 'general', {\n\t\t\t\t'default': true\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.models.Users.db.findOneById('rocket.cat')) {\n\t\t\tRocketChat.models.Users.create({\n\t\t\t\t_id: 'rocket.cat',\n\t\t\t\tname: 'Rocket.Cat',\n\t\t\t\tusername: 'rocket.cat',\n\t\t\t\tstatus: 'online',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'bot'\n\t\t\t});\n\n\t\t\tRocketChat.authz.addUserRoles('rocket.cat', 'bot');\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(new Buffer(Assets.getBinary('avatars/rocketcat.png'), 'utf8'));\n\n\t\t\tRocketChatFileAvatarInstance.deleteFile('rocket.cat.jpg');\n\n\t\t\tconst ws = RocketChatFileAvatarInstance.createWriteStream('rocket.cat.jpg', 'image/png');\n\n\t\t\tws.on('end', Meteor.bindEnvironment(function() {\n\t\t\t\treturn RocketChat.models.Users.setAvatarOrigin('rocket.cat', 'local');\n\t\t\t}));\n\n\t\t\trs.pipe(ws);\n\t\t}\n\n\t\tif (process.env.ADMIN_PASS) {\n\t\t\tif (_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\t\tconsole.log('Inserting admin user:'.green);\n\t\t\t\tconst adminUser = {\n\t\t\t\t\tname: 'Administrator',\n\t\t\t\t\tusername: 'admin',\n\t\t\t\t\tstatus: 'offline',\n\t\t\t\t\tstatusDefault: 'online',\n\t\t\t\t\tutcOffset: 0,\n\t\t\t\t\tactive: true\n\t\t\t\t};\n\n\t\t\t\tif (process.env.ADMIN_NAME) {\n\t\t\t\t\tadminUser.name = process.env.ADMIN_NAME;\n\t\t\t\t}\n\n\t\t\t\tconsole.log((`Name: ${ adminUser.name }`).green);\n\n\t\t\t\tif (process.env.ADMIN_EMAIL) {\n\t\t\t\t\tconst re = /^[^@].*@[^@]+$/i;\n\n\t\t\t\t\tif (re.test(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\t\tif (!RocketChat.models.Users.findOneByEmailAddress(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\t\t\tadminUser.emails = [{\n\t\t\t\t\t\t\t\taddress: process.env.ADMIN_EMAIL,\n\t\t\t\t\t\t\t\tverified: true\n\t\t\t\t\t\t\t}];\n\n\t\t\t\t\t\t\tconsole.log((`Email: ${ process.env.ADMIN_EMAIL }`).green);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Email provided already exists; Ignoring environment variables ADMIN_EMAIL'.red);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Email provided is invalid; Ignoring environment variables ADMIN_EMAIL'.red);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (process.env.ADMIN_USERNAME) {\n\t\t\t\t\tlet nameValidation;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (nameValidation.test(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\t\tif (RocketChat.checkUsernameAvailability(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\t\t\tadminUser.username = process.env.ADMIN_USERNAME;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Username provided already exists; Ignoring environment variables ADMIN_USERNAME'.red);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Username provided is invalid; Ignoring environment variables ADMIN_USERNAME'.red);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconsole.log((`Username: ${ adminUser.username }`).green);\n\n\t\t\t\tadminUser.type = 'user';\n\n\t\t\t\tconst id = RocketChat.models.Users.create(adminUser);\n\n\t\t\t\tAccounts.setPassword(id, process.env.ADMIN_PASS);\n\n\t\t\t\tconsole.log((`Password: ${ process.env.ADMIN_PASS }`).green);\n\n\t\t\t\tRocketChat.authz.addUserRoles(id, 'admin');\n\t\t\t} else {\n\t\t\t\tconsole.log('Users with admin role already exist; Ignoring environment variables ADMIN_PASS'.red);\n\t\t\t}\n\t\t}\n\n\t\tif (typeof process.env.INITIAL_USER === 'string' && process.env.INITIAL_USER.length > 0) {\n\t\t\ttry {\n\t\t\t\tconst initialUser = JSON.parse(process.env.INITIAL_USER);\n\n\t\t\t\tif (!initialUser._id) {\n\t\t\t\t\tconsole.log('No _id provided; Ignoring environment variable INITIAL_USER'.red);\n\t\t\t\t} else if (!RocketChat.models.Users.findOneById(initialUser._id)) {\n\t\t\t\t\tconsole.log('Inserting initial user:'.green);\n\t\t\t\t\tconsole.log(JSON.stringify(initialUser, null, 2).green);\n\t\t\t\t\tRocketChat.models.Users.create(initialUser);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('Error processing environment variable INITIAL_USER'.red, e);\n\t\t\t}\n\t\t}\n\n\t\tif (_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\tconst oldestUser = RocketChat.models.Users.findOne({\n\t\t\t\t_id: {\n\t\t\t\t\t$ne: 'rocket.cat'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tcreatedAt: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (oldestUser) {\n\t\t\t\tRocketChat.authz.addUserRoles(oldestUser._id, 'admin');\n\t\t\t\tconsole.log(`No admins are found. Set ${ oldestUser.username } as admin for being the oldest user`);\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.models.Users.removeById('rocketchat.internal.admin.test');\n\n\t\tif (process.env.TEST_MODE === 'true') {\n\t\t\tconsole.log('Inserting admin test user:'.green);\n\n\t\t\tconst adminUser = {\n\t\t\t\t_id: 'rocketchat.internal.admin.test',\n\t\t\t\tname: 'RocketChat Internal Admin Test',\n\t\t\t\tusername: 'rocketchat.internal.admin.test',\n\t\t\t\temails: [\n\t\t\t\t\t{\n\t\t\t\t\t\taddress: 'rocketchat.internal.admin.test@rocket.chat',\n\t\t\t\t\t\tverified: true\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tstatus: 'offline',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'user'\n\t\t\t};\n\n\t\t\tconsole.log((`Name: ${ adminUser.name }`).green);\n\t\t\tconsole.log((`Email: ${ adminUser.emails[0].address }`).green);\n\t\t\tconsole.log((`Username: ${ adminUser.username }`).green);\n\t\t\tconsole.log((`Password: ${ adminUser._id }`).green);\n\n\t\t\tif (RocketChat.models.Users.db.findOneByEmailAddress(adminUser.emails[0].address)) {\n\t\t\t\tthrow new Meteor.Error(`Email ${ adminUser.emails[0].address } already exists`, 'Rocket.Chat can\\'t run in test mode');\n\t\t\t}\n\n\t\t\tif (!RocketChat.checkUsernameAvailability(adminUser.username)) {\n\t\t\t\tthrow new Meteor.Error(`Username ${ adminUser.username } already exists`, 'Rocket.Chat can\\'t run in test mode');\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.create(adminUser);\n\n\t\t\tAccounts.setPassword(adminUser._id, adminUser._id);\n\n\t\t\tRocketChat.authz.addUserRoles(adminUser._id, 'admin');\n\n\t\t\treturn RocketChat.addUserToDefaultChannels(adminUser, true);\n\t\t}\n\t});\n});\n","/* globals InstanceStatus, UserPresence, UserPresenceMonitor */\n\nMeteor.startup(function() {\n\tconst instance = {\n\t\thost: 'localhost',\n\t\tport: String(process.env.PORT).trim()\n\t};\n\n\tif (process.env.INSTANCE_IP) {\n\t\tinstance.host = String(process.env.INSTANCE_IP).trim();\n\t}\n\n\tInstanceStatus.registerInstance('rocket.chat', instance);\n\n\tUserPresence.start();\n\n\treturn UserPresenceMonitor.start();\n});\n","Meteor.startup(function() {\n\tRocketChat.roomTypes.setPublish('c', function(identifier) {\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\ttopic: 1,\n\t\t\t\tannouncement: 1,\n\t\t\t\tmuted: 1,\n\t\t\t\tarchived: 1,\n\t\t\t\tro: 1,\n\t\t\t\treactWhenReadOnly: 1,\n\t\t\t\tjitsiTimeout: 1,\n\t\t\t\tdescription: 1,\n\t\t\t\tsysMes: 1,\n\t\t\t\tjoinCodeRequired: 1\n\t\t\t}\n\t\t};\n\n\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-join-code')) {\n\t\t\toptions.fields.joinCode = 1;\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-c-room')) {\n\t\t\treturn RocketChat.models.Rooms.findByTypeAndName('c', identifier, options);\n\t\t} else if (RocketChat.authz.hasPermission(this.userId, 'view-joined-room')) {\n\t\t\tconst roomId = RocketChat.models.Subscriptions.findByTypeNameAndUserId('c', identifier, this.userId).fetch();\n\t\t\tif (roomId.length > 0) {\n\t\t\t\treturn RocketChat.models.Rooms.findById(roomId[0].rid, options);\n\t\t\t}\n\t\t}\n\n\t\treturn this.ready();\n\t});\n\n\tRocketChat.roomTypes.setPublish('p', function(identifier) {\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\ttopic: 1,\n\t\t\t\tannouncement: 1,\n\t\t\t\tmuted: 1,\n\t\t\t\tarchived: 1,\n\t\t\t\tro: 1,\n\t\t\t\treactWhenReadOnly: 1,\n\t\t\t\tjitsiTimeout: 1,\n\t\t\t\tdescription: 1,\n\t\t\t\tsysMes: 1\n\t\t\t}\n\t\t};\n\n\t\tconst user = RocketChat.models.Users.findOneById(this.userId, {\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.models.Rooms.findByTypeAndNameContainingUsername('p', identifier, user.username, options);\n\t});\n\n\treturn RocketChat.roomTypes.setPublish('d', function(identifier) {\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\ttopic: 1,\n\t\t\t\tjitsiTimeout: 1\n\t\t\t}\n\t\t};\n\n\t\tconst user = RocketChat.models.Users.findOneById(this.userId, {\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t});\n\n\t\tif (RocketChat.authz.hasAtLeastOnePermission(this.userId, ['view-d-room', 'view-joined-room'])) {\n\t\t\treturn RocketChat.models.Rooms.findByTypeContainingUsernames('d', [user.username, identifier], options);\n\t\t}\n\n\t\treturn this.ready();\n\t});\n});\n","/* globals MongoInternals, SystemLogger */\n\nimport fs from 'fs';\nimport path from 'path';\nimport semver from 'semver';\n\nMeteor.startup(function() {\n\tlet oplogState = 'Disabled';\n\tif (MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle && MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle.onOplogEntry) {\n\t\toplogState = 'Enabled';\n\t\tif (RocketChat.settings.get('Force_Disable_OpLog_For_Cache') === true) {\n\t\t\toplogState += ' (Disabled for Cache Sync)';\n\t\t}\n\t}\n\n\tconst desiredNodeVersion = semver.clean(fs.readFileSync(path.join(process.cwd(), '../../.node_version.txt')).toString());\n\tconst desiredNodeVersionMajor = String(semver.parse(desiredNodeVersion).major);\n\n\treturn Meteor.setTimeout(function() {\n\t\tlet msg = [\n\t\t\t`Rocket.Chat Version: ${ RocketChat.Info.version }`,\n\t\t\t`     NodeJS Version: ${ process.versions.node } - ${ process.arch }`,\n\t\t\t`           Platform: ${ process.platform }`,\n\t\t\t`       Process Port: ${ process.env.PORT }`,\n\t\t\t`           Site URL: ${ RocketChat.settings.get('Site_Url') }`,\n\t\t\t`   ReplicaSet OpLog: ${ oplogState }`\n\t\t];\n\n\t\tif (RocketChat.Info.commit && RocketChat.Info.commit.hash) {\n\t\t\tmsg.push(`        Commit Hash: ${ RocketChat.Info.commit.hash.substr(0, 10) }`);\n\t\t}\n\n\t\tif (RocketChat.Info.commit && RocketChat.Info.commit.branch) {\n\t\t\tmsg.push(`      Commit Branch: ${ RocketChat.Info.commit.branch }`);\n\t\t}\n\n\t\tmsg = msg.join('\\n');\n\n\t\tif (semver.satisfies(process.versions.node, desiredNodeVersionMajor)) {\n\t\t\treturn SystemLogger.startup_box(msg, 'SERVER RUNNING');\n\t\t}\n\n\t\tmsg += ['', '', 'YOUR CURRENT NODEJS VERSION IS NOT SUPPORTED,', `PLEASE UPGRADE / DOWNGRADE TO VERSION ${ desiredNodeVersionMajor }.X.X`].join('\\n');\n\n\t\tSystemLogger.error_box(msg, 'SERVER ERROR');\n\n\t\treturn process.exit();\n\t}, 100);\n});\n","const orig_updateOrCreateUserFromExternalService = Accounts.updateOrCreateUserFromExternalService;\n\nAccounts.updateOrCreateUserFromExternalService = function (serviceName, serviceData = {} /*, options*/) {\n    const services = [\n        'facebook',\n        'github',\n        'gitlab',\n        'google',\n        'meteor-developer',\n        'linkedin',\n        'twitter',\n        'sandstorm'\n    ];\n\n    if (services.includes(serviceName) === false && serviceData._OAuthCustom !== true) {\n        return;\n    }\n\n    if (serviceName === 'meteor-developer') {\n        if (Array.isArray(serviceData.emails)) {\n            serviceData.email = serviceData.emails.sort(a => a.primary !== true).filter(item => item.verified === true)[0];\n        }\n    }\n\n    if (serviceName === 'linkedin') {\n        serviceData.email = serviceData.emailAddress;\n    }\n\n    if (serviceData.email) {\n        const user = RocketChat.models.Users.findOneByEmailAddress(serviceData.email);\n        if (user != null) {\n            const findQuery = {\n                address: serviceData.email,\n                verified: true\n            };\n\n            if (!_.findWhere(user.emails, findQuery)) {\n                RocketChat.models.Users.resetPasswordAndSetRequirePasswordChange(user._id, true, 'This_email_has_already_been_used_and_has_not_been_verified__Please_change_your_password');\n            }\n\n            RocketChat.models.Users.setServiceId(user._id, serviceName, serviceData.id);\n            RocketChat.models.Users.setEmailVerified(user._id, serviceData.email);\n        }\n    }\n\n    return orig_updateOrCreateUserFromExternalService.apply(this, arguments);\n};\n","Meteor.methods({\n\tOEmbedCacheCleanup() {\n\t\tif (Meteor.userId() && !RocketChat.authz.hasRole(Meteor.userId(), 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'OEmbedCacheCleanup'\n\t\t\t});\n\t\t}\n\n\t\tconst date = new Date();\n\t\tconst expirationDays = RocketChat.settings.get('API_EmbedCacheExpirationDays');\n\t\tdate.setDate(date.getDate() - expirationDays);\n\t\tRocketChat.models.OEmbedCache.removeAfterDate(date);\n\t\treturn {\n\t\t\tmessage: 'cache_cleared'\n\t\t};\n\t}\n});\n","Meteor.methods({\n\taddAllUserToRoom(rid, activeUsersOnly = false) {\n\n\t\tcheck (rid, String);\n\t\tcheck (activeUsersOnly, Boolean);\n\n\t\tif (RocketChat.authz.hasRole(this.userId, 'admin') === true) {\n\t\t\tconst userCount = RocketChat.models.Users.find().count();\n\t\t\tif (userCount > RocketChat.settings.get('API_User_Limit')) {\n\t\t\t\tthrow new Meteor.Error('error-user-limit-exceeded', 'User Limit Exceeded', {\n\t\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\t\tif (room == null) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst userFilter = {};\n\t\t\tif (activeUsersOnly === true) {\n\t\t\t\tuserFilter.active = true;\n\t\t\t}\n\n\t\t\tconst users = RocketChat.models.Users.find(userFilter).fetch();\n\t\t\tconst now = new Date();\n\t\t\tusers.forEach(function(user) {\n\t\t\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\t\t\t\tif (subscription != null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tRocketChat.callbacks.run('beforeJoinRoom', user, room);\n\t\t\t\tRocketChat.models.Rooms.addUsernameById(rid, user.username);\n\t\t\t\tRocketChat.models.Subscriptions.createWithRoomAndUser(room, user, {\n\t\t\t\t\tts: now,\n\t\t\t\t\topen: true,\n\t\t\t\t\talert: true,\n\t\t\t\t\tunread: 1\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Messages.createUserJoinWithRoomIdAndUser(rid, user, {\n\t\t\t\t\tts: now\n\t\t\t\t});\n\t\t\t\tMeteor.defer(function() {});\n\t\t\t\treturn RocketChat.callbacks.run('afterJoinRoom', user, room);\n\t\t\t});\n\t\t\treturn true;\n\t\t} else {\n\t\t\tthrow (new Meteor.Error(403, 'Access to Method Forbidden', {\n\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t}));\n\t\t}\n\t}\n});\n","Meteor.methods({\n\taddRoomModerator(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-moderator', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('moderator') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-moderator', 'User is already a moderator', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'moderator');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'moderator'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'moderator',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: fromUser.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\taddRoomOwner(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-owner', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('owner') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-owner', 'User is already an owner', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'owner');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'owner'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'owner',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tafterVerifyEmail() {\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'afterVerifyEmail'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tconst verifiedEmail = _.find(user.emails, (email) => email.verified);\n\n\t\tif (verifiedEmail) {\n\t\t\tRocketChat.models.Roles.addUserRoles(user._id, 'user');\n\t\t\tRocketChat.models.Roles.removeUserRoles(user._id, 'anonymous');\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tcanAccessRoom(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, Match.Maybe(String));\n\n\t\tlet user;\n\n\t\tif (!userId && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (userId) {\n\t\t\tuser = RocketChat.models.Users.findOneById(userId, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!user || !user.username) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (!rid) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\tif (room) {\n\t\t\tif (RocketChat.authz.canAccessRoom.call(this, room, user)) {\n\t\t\t\tif (user) {\n\t\t\t\t\troom.username = user.username;\n\t\t\t\t}\n\t\t\t\treturn room;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tchannelsList(filter, channelType, limit, sort) {\n\t\tthis.unblock();\n\n\t\tcheck(filter, String);\n\t\tcheck(channelType, String);\n\t\tcheck(limit, Match.Optional(Number));\n\t\tcheck(sort, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'channelsList'\n\t\t\t});\n\t\t}\n\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1\n\t\t\t},\n\t\t\tsort: {\n\t\t\t\tmsgs: -1\n\t\t\t}\n\t\t};\n\n\t\tif (_.isNumber(limit)) {\n\t\t\toptions.limit = limit;\n\t\t}\n\n\t\tif (_.trim(sort)) {\n\t\t\tswitch (sort) {\n\t\t\t\tcase 'name':\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tname: 1\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'msgs':\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tmsgs: -1\n\t\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tconst roomTypes = [];\n\n\t\tif (channelType !== 'private') {\n\t\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room')) {\n\t\t\t\troomTypes.push({\n\t\t\t\t\ttype: 'c'\n\t\t\t\t});\n\t\t\t} else if (RocketChat.authz.hasPermission(Meteor.userId(), 'view-joined-room')) {\n\t\t\t\tconst roomIds = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('c', Meteor.userId()).fetch(), 'rid');\n\t\t\t\troomTypes.push({\n\t\t\t\t\ttype: 'c',\n\t\t\t\t\tids: roomIds\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (channelType !== 'public' && RocketChat.authz.hasPermission(Meteor.userId(), 'view-p-room')) {\n\t\t\tconst userPref = Meteor.user() && Meteor.user().settings && Meteor.user().settings.preferences && Meteor.user().settings.preferences.mergeChannels;\n\t\t\tconst globalPref = RocketChat.settings.get('UI_Merge_Channels_Groups');\n\t\t\tconst mergeChannels = userPref || globalPref;\n\n\t\t\tif (mergeChannels) {\n\t\t\t\troomTypes.push({\n\t\t\t\t\ttype: 'p',\n\t\t\t\t\tusername: Meteor.user().username\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (roomTypes.length) {\n\t\t\tif (filter) {\n\t\t\t\treturn {\n\t\t\t\t\tchannels: RocketChat.models.Rooms.findByNameContainingTypesWithUsername(filter, roomTypes, options).fetch()\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tchannels: RocketChat.models.Rooms.findContainingTypesWithUsername(roomTypes, options).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tchannels: []\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tcreateDirectMessage(username) {\n\t\tcheck(username, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst me = Meteor.user();\n\n\t\tif (!me.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tif (me.username === username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'create-d')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst to = RocketChat.models.Users.findOneByUsername(username);\n\n\t\tif (!to) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst rid = [me._id, to._id].sort().join('');\n\n\t\tconst now = new Date();\n\n\t\t// Make sure we have a room\n\t\tRocketChat.models.Rooms.upsert({\n\t\t\t_id: rid\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tusernames: [me.username, to.username]\n\t\t\t},\n\t\t\t$setOnInsert: {\n\t\t\t\tt: 'd',\n\t\t\t\tmsgs: 0,\n\t\t\t\tts: now\n\t\t\t}\n\t\t});\n\n\t\t// Make user I have a subcription to this room\n\t\tconst upsertSubscription = {\n\t\t\t$set: {\n\t\t\t\tts: now,\n\t\t\t\tls: now,\n\t\t\t\topen: true\n\t\t\t},\n\t\t\t$setOnInsert: {\n\t\t\t\tname: to.username,\n\t\t\t\tt: 'd',\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tu: {\n\t\t\t\t\t_id: me._id,\n\t\t\t\t\tusername: me.username\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (to.active === false) {\n\t\t\tupsertSubscription.$set.archived = true;\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.upsert({\n\t\t\trid,\n\t\t\t$and: [{'u._id': me._id}] // work around to solve problems with upsert and dot\n\t\t}, upsertSubscription);\n\n\t\tRocketChat.models.Subscriptions.upsert({\n\t\t\trid,\n\t\t\t$and: [{'u._id': to._id}] // work around to solve problems with upsert and dot\n\t\t}, {\n\t\t\t$setOnInsert: {\n\t\t\t\tname: me.username,\n\t\t\t\tt: 'd',\n\t\t\t\topen: false,\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tu: {\n\t\t\t\t\t_id: to._id,\n\t\t\t\t\tusername: to.username\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\trid\n\t\t};\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'createDirectMessage',\n\tconnectionId() {\n\t\treturn true;\n\t}\n}, 10, 60000);\n","/* global FileUpload */\nMeteor.methods({\n\tdeleteFileMessage(fileID) {\n\t\tcheck(fileID, String);\n\n\t\tconst msg = RocketChat.models.Messages.getMessageByFileId(fileID);\n\n\t\tif (msg) {\n\t\t\treturn Meteor.call('deleteMessage', msg);\n\t\t}\n\n\t\treturn FileUpload.delete(fileID);\n\t}\n});\n","Meteor.methods({\n\tdeleteUser(userId) {\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'delete-user') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tconst adminCount = Meteor.users.find({roles: 'admin'}).count();\n\n\t\tconst userIsAdmin = user.roles.indexOf('admin') > -1;\n\n\t\tif (adminCount === 1 && userIsAdmin) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Leaving the app without admins is not allowed', {\n\t\t\t\tmethod: 'deleteUser',\n\t\t\t\taction: 'Remove_last_admin'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.deleteUser(userId);\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\teraseRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(fromId, `delete-${ room.t }`, rid)) {\n\t\t\tRocketChat.models.Messages.removeByRoomId(rid);\n\t\t\tRocketChat.models.Subscriptions.removeByRoomId(rid);\n\t\t\treturn RocketChat.models.Rooms.removeById(rid);\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\t}\n});\n","/* global Gravatar */\n\nfunction getAvatarSuggestionForUser(user) {\n\tcheck(user, Object);\n\n\tconst avatars = [];\n\n\tif (user.services.facebook && user.services.facebook.id && RocketChat.settings.get('Accounts_OAuth_Facebook')) {\n\t\tavatars.push({\n\t\t\tservice: 'facebook',\n\t\t\turl: `https://graph.facebook.com/${ user.services.facebook.id }/picture?type=large`\n\t\t});\n\t}\n\n\tif (user.services.google && user.services.google.picture && user.services.google.picture !== 'https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg' && RocketChat.settings.get('Accounts_OAuth_Google')) {\n\t\tavatars.push({\n\t\t\tservice: 'google',\n\t\t\turl: user.services.google.picture\n\t\t});\n\t}\n\n\tif (user.services.github && user.services.github.username && RocketChat.settings.get('Accounts_OAuth_Github')) {\n\t\tavatars.push({\n\t\t\tservice: 'github',\n\t\t\turl: `https://avatars.githubusercontent.com/${ user.services.github.username }?s=200`\n\t\t});\n\t}\n\n\tif (user.services.linkedin && user.services.linkedin.pictureUrl && RocketChat.settings.get('Accounts_OAuth_Linkedin')) {\n\t\tavatars.push({\n\t\t\tservice: 'linkedin',\n\t\t\turl: user.services.linkedin.pictureUrl\n\t\t});\n\t}\n\n\tif (user.services.twitter && user.services.twitter.profile_image_url_https && RocketChat.settings.get('Accounts_OAuth_Twitter')) {\n\t\tavatars.push({\n\t\t\tservice: 'twitter',\n\t\t\turl: user.services.twitter.profile_image_url_https.replace(/_normal|_bigger/, '')\n\t\t});\n\t}\n\n\tif (user.services.gitlab && user.services.gitlab.avatar_url && RocketChat.settings.get('Accounts_OAuth_Gitlab')) {\n\t\tavatars.push({\n\t\t\tservice: 'gitlab',\n\t\t\turl: user.services.gitlab.avatar_url\n\t\t});\n\t}\n\n\tif (user.services.sandstorm && user.services.sandstorm.picture && Meteor.settings['public'].sandstorm) {\n\t\tavatars.push({\n\t\t\tservice: 'sandstorm',\n\t\t\turl: user.services.sandstorm.picture\n\t\t});\n\t}\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tfor (const email of user.emails) {\n\t\t\tif (email.verified === true) {\n\t\t\t\tavatars.push({\n\t\t\t\t\tservice: 'gravatar',\n\t\t\t\t\turl: Gravatar.imageUrl(email.address, {\n\t\t\t\t\t\t'default': '404',\n\t\t\t\t\t\tsize: 200,\n\t\t\t\t\t\tsecure: true\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (email.verified !== true) {\n\t\t\t\tavatars.push({\n\t\t\t\t\tservice: 'gravatar',\n\t\t\t\t\turl: Gravatar.imageUrl(email.address, {\n\t\t\t\t\t\t'default': '404',\n\t\t\t\t\t\tsize: 200,\n\t\t\t\t\t\tsecure: true\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tconst validAvatars = {};\n\tfor (const avatar of avatars) {\n\t\ttry {\n\t\t\tconst result = HTTP.get(avatar.url, {\n\t\t\t\tnpmRequestOptions: {\n\t\t\t\t\tencoding: 'binary'\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (result.statusCode === 200) {\n\t\t\t\tlet blob = `data:${ result.headers['content-type'] };base64,`;\n\t\t\t\tblob += Buffer.from(result.content, 'binary').toString('base64');\n\t\t\t\tavatar.blob = blob;\n\t\t\t\tavatar.contentType = result.headers['content-type'];\n\t\t\t\tvalidAvatars[avatar.service] = avatar;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// error;\n\t\t}\n\t}\n\treturn validAvatars;\n}\n\nthis.getAvatarSuggestionForUser = getAvatarSuggestionForUser;\n\nMeteor.methods({\n\tgetAvatarSuggestion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getAvatarSuggestion'\n\t\t\t});\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst user = Meteor.user();\n\n\t\treturn getAvatarSuggestionForUser(user);\n\t}\n});\n","Meteor.methods({\n\tgetRoomIdByNameOrId(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid) || RocketChat.models.Rooms.findOneByName(rid);\n\n\t\tif (room == null) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tif (user && user.username && room.usernames.indexOf(user.username) !== -1) {\n\t\t\treturn room._id;\n\t\t}\n\n\t\tif (room.t !== 'c' || RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\treturn room._id;\n\t}\n});\n","Meteor.methods({\n\tgetTotalChannels() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getTotalChannels'\n\t\t\t});\n\t\t}\n\n\t\tconst query = {\n\t\t\tt: 'c'\n\t\t};\n\t\treturn RocketChat.models.Rooms.find(query).count();\n\t}\n});\n","/* global slugify */\n\nfunction slug(text) {\n\ttext = slugify(text, '.');\n\treturn text.replace(/[^0-9a-z-_.]/g, '');\n}\n\nfunction usernameIsAvaliable(username) {\n\tif (username.length < 1) {\n\t\treturn false;\n\t}\n\n\tif (username === 'all') {\n\t\treturn false;\n\t}\n\n\treturn !RocketChat.models.Users.findOneByUsername({\n\t\t$regex: new RegExp(`^${ username }$`, 'i')\n\t});\n}\n\nfunction generateSuggestion(user) {\n\tlet usernames = [];\n\tlet username = undefined;\n\n\tif (Meteor.settings['public'].sandstorm) {\n\t\tusernames.push(user.services.sandstorm.preferredHandle);\n\t}\n\n\tif (Match.test(user && user.name, String)) {\n\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\tusernames.push(slug(user.name));\n\t\t} else {\n\t\t\tusernames.push(user.name);\n\t\t}\n\n\t\tconst nameParts = user.name.split(' ');\n\n\t\tif (nameParts.length > 1) {\n\t\t\tconst first = nameParts[0];\n\t\t\tconst last = nameParts[nameParts.length - 1];\n\n\t\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\t\tusernames.push(slug(first[0] + last));\n\t\t\t\tusernames.push(slug(first + last[0]));\n\t\t\t} else {\n\t\t\t\tusernames.push(first[0] + last);\n\t\t\t\tusernames.push(first + last[0]);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.profile && user.profile.name) {\n\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\tusernames.push(slug(user.profile.name));\n\t\t} else {\n\t\t\tusernames.push(user.profile.name);\n\t\t}\n\t}\n\n\tif (Array.isArray(user.services)) {\n\t\tlet services = user.services.map((service) => {\n\t\t\treturn _.values(_.pick(service, 'name', 'username', 'firstName', 'lastName'));\n\t\t});\n\n\t\tservices = _.uniq(_.flatten(services));\n\n\t\tfor (const service of services) {\n\t\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\t\tusernames.push(slug(service));\n\t\t\t} else {\n\t\t\t\tusernames.push(service);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tfor (const email of user.emails) {\n\t\t\tif (email.address && email.verified === true) {\n\t\t\t\tusernames.push(slug(email.address.replace(/@.+$/, '')));\n\t\t\t\tusernames.push(slug(email.address.replace(/(.+)@(\\w+).+/, '$1.$2')));\n\t\t\t}\n\t\t}\n\t}\n\n\tusernames = _.compact(usernames);\n\n\tfor (const item of usernames) {\n\t\tif (usernameIsAvaliable(item)) {\n\t\t\treturn item;\n\t\t}\n\t}\n\n\tif (usernames.length === 0 || usernames[0].length === 0) {\n\t\tusernames.push(RocketChat.settings.get('Accounts_DefaultUsernamePrefixSuggestion'));\n\t}\n\n\tlet index = 0;\n\twhile (!username) {\n\t\tindex++;\n\t\tif (usernameIsAvaliable(`${ usernames[0] }-${ index }`)) {\n\t\t\tusername = `${ usernames[0] }-${ index }`;\n\t\t}\n\t}\n\n\tif (usernameIsAvaliable(username)) {\n\t\treturn username;\n\t}\n}\n\nRocketChat.generateUsernameSuggestion = generateSuggestion;\n\nMeteor.methods({\n\tgetUsernameSuggestion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getUsernameSuggestion'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\treturn generateSuggestion(user);\n\t}\n});\n","Meteor.methods({\n\tgetUsersOfRoom(roomId, showAll) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tconst room = Meteor.call('canAccessRoom', roomId, Meteor.userId());\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tconst filter = (record) => {\n\t\t\tif (!record._user) {\n\t\t\t\tconsole.log('Subscription without user', record._id);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (showAll === true) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn record._user.status !== 'offline';\n\t\t};\n\n\t\tconst map = (record) => {\n\t\t\treturn {\n\t\t\t\t_id: record._user._id,\n\t\t\t\tusername: record._user.username,\n\t\t\t\tname: record._user.name\n\t\t\t};\n\t\t};\n\n\t\tconst records = RocketChat.models.Subscriptions.findByRoomId(roomId).fetch();\n\n\t\treturn {\n\t\t\ttotal: records.length,\n\t\t\trecords: records.filter(filter).map(map)\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tgroupsList(nameFilter, limit, sort) {\n\n\t\tcheck(nameFilter, Match.Optional(String));\n\t\tcheck(limit, Match.Optional(Number));\n\t\tcheck(sort, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'groupsList' });\n\t\t}\n\n\t\tconst options = {\n\t\t\tfields: { name: 1 },\n\t\t\tsort: { name: 1 }\n\t\t};\n\n\t\t//Verify the limit param is a number\n\t\tif (_.isNumber(limit)) {\n\t\t\toptions.limit = limit;\n\t\t}\n\n\t\t//Verify there is a sort option and it's a string\n\t\tif (_.trim(sort)) {\n\t\t\tswitch (sort) {\n\t\t\t\tcase 'name':\n\t\t\t\t\toptions.sort = { name: 1 };\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'msgs':\n\t\t\t\t\toptions.sort = { msgs: -1 };\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t//Determine if they are searching or not, base it upon the name field\n\t\tif (nameFilter) {\n\t\t\treturn { groups: RocketChat.models.Rooms.findByTypeAndNameContainingUsername('p', new RegExp(s.trim(s.escapeRegExp(nameFilter)), 'i'), Meteor.user().username, options).fetch() };\n\t\t} else {\n\t\t\tconst roomIds = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('p', Meteor.userId()).fetch(), 'rid');\n\t\t\treturn { groups: RocketChat.models.Rooms.findByIds(roomIds, options).fetch() };\n\t\t}\n\t}\n});\n","Meteor.methods({\n\thideRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'hideRoom'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.hideByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","const hideMessagesOfType = [];\n\nRocketChat.settings.get(/Message_HideType_.+/, function(key, value) {\n\tconst type = key.replace('Message_HideType_', '');\n\tconst types = type === 'mute_unmute' ? ['user-muted', 'user-unmuted'] : [type];\n\n\treturn types.forEach((type) => {\n\t\tconst index = hideMessagesOfType.indexOf(type);\n\n\t\tif (value === true && index === -1) {\n\t\t\treturn hideMessagesOfType.push(type);\n\t\t}\n\n\t\tif (index > -1) {\n\t\t\treturn hideMessagesOfType.splice(index, 1);\n\t\t}\n\t});\n});\n\nMeteor.methods({\n\tloadHistory(rid, end, limit = 20, ls) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId() && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadHistory'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tconst room = Meteor.call('canAccessRoom', rid, fromId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst canAnonymous = RocketChat.settings.get('Accounts_AllowAnonymousRead');\n\t\tconst canPreview = RocketChat.authz.hasPermission(fromId, 'preview-c-room');\n\t\tif (room.t === 'c' && !canAnonymous && !canPreview && room.usernames.indexOf(room.username) === -1) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tlet records;\n\t\tif (end != null) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestampNotContainingTypes(rid, end, hideMessagesOfType, options).fetch();\n\t\t} else {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdNotContainingTypes(rid, hideMessagesOfType, options).fetch();\n\t\t}\n\n\t\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\t\tconst messages = records.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\tif (message.u && message.u._id && UI_Use_Real_Name) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(message.u._id);\n\t\t\t\tmessage.u.name = user && user.name;\n\t\t\t}\n\t\t\treturn message;\n\t\t});\n\n\t\tlet unreadNotLoaded = 0;\n\t\tlet firstUnread;\n\n\t\tif (ls != null) {\n\t\t\tconst firstMessage = messages[messages.length - 1];\n\n\t\t\tif ((firstMessage != null ? firstMessage.ts : undefined) > ls) {\n\t\t\t\tdelete options.limit;\n\n\t\t\t\tconst unreadMessages = RocketChat.models.Messages.findVisibleByRoomIdBetweenTimestampsNotContainingTypes(rid, ls, firstMessage.ts, hideMessagesOfType, {\n\t\t\t\t\tlimit: 1,\n\t\t\t\t\tsort: {\n\t\t\t\t\t\tts: 1\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfirstUnread = unreadMessages.fetch()[0];\n\t\t\t\tunreadNotLoaded = unreadMessages.count();\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tmessages,\n\t\t\tfirstUnread,\n\t\t\tunreadNotLoaded\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tloadLocale(locale) {\n\t\tcheck(locale, String);\n\n\t\ttry {\n\t\t\treturn Assets.getText(`moment-locales/${ locale.toLowerCase() }.js`);\n\t\t} catch (error) {\n\t\t\treturn console.log(error);\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tloadMissedMessages(rid, start) {\n\t\tcheck(rid, String);\n\t\tcheck(start, Date);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadMissedMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t}\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\t'editedAt': 0\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, start, options).fetch();\n\t}\n});\n","Meteor.methods({\n\tloadNextMessages(rid, end, limit = 20) {\n\t\tcheck(rid, String);\n\t\tcheck(limit, Number);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadNextMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: 1\n\t\t\t},\n\t\t\tlimit\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tlet records;\n\t\tif (end) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, end, options).fetch();\n\t\t} else {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomId(rid, options).fetch();\n\t\t}\n\n\t\tconst messages = records.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\treturn {\n\t\t\tmessages\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tloadSurroundingMessages(message, limit = 50) {\n\t\tcheck(message, Object);\n\t\tcheck(limit, Number);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadSurroundingMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!message._id) {\n\t\t\treturn false;\n\t\t}\n\n\t\tmessage = RocketChat.models.Messages.findOneById(message._id);\n\n\t\tif (!message || !message.rid) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', message.rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlimit = limit - 1;\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit: Math.ceil(limit / 2)\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tconst recordsBefore = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestamp(message.rid, message.ts, options).fetch();\n\n\t\tconst messages = recordsBefore.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tconst moreBefore = messages.length === options.limit;\n\n\t\tmessages.push(message);\n\n\t\toptions.sort = {\n\t\t\tts: 1\n\t\t};\n\n\t\toptions.limit = Math.floor(limit / 2);\n\n\t\tconst recordsAfter = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(message.rid, message.ts, options).fetch();\n\t\tconst afterMessages = recordsAfter.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tconst moreAfter = afterMessages.length === options.limit;\n\n\t\treturn {\n\t\t\tmessages: messages.concat(afterMessages),\n\t\t\tmoreBefore,\n\t\t\tmoreAfter\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tlogoutCleanUp(user) {\n\t\tcheck(user, Object);\n\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.callbacks.run('afterLogoutCleanUp', user);\n\t\t});\n\t}\n});\n","Meteor.methods({\n\tmessageSearch(text, rid, limit) {\n\t\tconst result = {\n\t\t\tmessages: [],\n\t\t\tusers: [],\n\t\t\tchannels: []\n\t\t};\n\t\tconst query = {};\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit: limit || 20\n\t\t};\n\n\t\tcheck(text, String);\n\t\tcheck(rid, String);\n\t\tcheck(limit, Match.Optional(Number));\n\n\t\tconst currentUserId = Meteor.userId();\n\t\tif (!currentUserId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'messageSearch'\n\t\t\t});\n\t\t}\n\t\tconst currentUserName = Meteor.user().username;\n\t\tconst currentUserTimezoneOffset = Meteor.user().utcOffset;\n\n\t\t// I would place these methods at the bottom of the file for clarity but travis doesn't appreciate that.\n\t\t// (no-use-before-define)\n\n\t\tfunction filterStarred() {\n\t\t\tquery['starred._id'] = currentUserId;\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterUrl() {\n\t\t\tquery['urls.0'] = {\n\t\t\t\t$exists: true\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterPinned() {\n\t\t\tquery.pinned = true;\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterLocation() {\n\t\t\tquery.location = {\n\t\t\t\t$exist: true\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterBeforeDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tconst beforeDate = new Date(year, month, day);\n\t\t\tbeforeDate.setHours(beforeDate.getUTCHours() + beforeDate.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tquery.ts = {\n\t\t\t\t$lte: beforeDate\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterAfterDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tday++;\n\t\t\tconst afterDate = new Date(year, month, day);\n\t\t\tafterDate.setUTCHours(afterDate.getUTCHours() + afterDate.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tif (query.ts) {\n\t\t\t\tquery.ts.$gte = afterDate;\n\t\t\t} else {\n\t\t\t\tquery.ts = {\n\t\t\t\t\t$gte: afterDate\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterOnDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tconst date = new Date(year, month, day);\n\t\t\tdate.setUTCHours(date.getUTCHours() + date.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tconst dayAfter = new Date(date);\n\t\t\tdayAfter.setDate(dayAfter.getDate() + 1);\n\t\t\tdelete query.ts;\n\t\t\tquery.ts = {\n\t\t\t\t$gte: date,\n\t\t\t\t$lt: dayAfter\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction sortByTimestamp(_, direction) {\n\t\t\tif (direction.startsWith('asc')) {\n\t\t\t\toptions.sort.ts = 1;\n\t\t\t} else if (direction.startsWith('desc')) {\n\t\t\t\toptions.sort.ts = -1;\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\t/*\n\t\t text = 'from:rodrigo mention:gabriel chat'\n\t\t */\n\n\t\t// Query for senders\n\t\tconst from = [];\n\t\ttext = text.replace(/from:([a-z0-9.-_]+)/ig, function(match, username) {\n\t\t\tif (username === 'me' && !from.includes(currentUserName)) {\n\t\t\t\tusername = currentUserName;\n\t\t\t}\n\t\t\tfrom.push(username);\n\t\t\treturn '';\n\t\t});\n\t\tif (from.length > 0) {\n\t\t\tquery['u.username'] = {\n\t\t\t\t$regex: from.join('|'),\n\t\t\t\t$options: 'i'\n\t\t\t};\n\t\t}\n\t\t// Query for senders\n\t\tconst mention = [];\n\t\ttext = text.replace(/mention:([a-z0-9.-_]+)/ig, function(match, username) {\n\t\t\tmention.push(username);\n\t\t\treturn '';\n\t\t});\n\t\tif (mention.length > 0) {\n\t\t\tquery['mentions.username'] = {\n\t\t\t\t$regex: mention.join('|'),\n\t\t\t\t$options: 'i'\n\t\t\t};\n\t\t}\n\t\t// Filter on messages that are starred by the current user.\n\t\ttext = text.replace(/has:star/g, filterStarred);\n\t\t// Filter on messages that have an url.\n\t\ttext = text.replace(/has:url|has:link/g, filterUrl);\n\t\t// Filter on pinned messages.\n\t\ttext = text.replace(/is:pinned|has:pin/g, filterPinned);\n\t\t// Filter on messages which have a location attached.\n\t\ttext = text.replace(/has:location|has:map/g, filterLocation);\n\t\t// Filtering before/after/on a date\n\t\t// matches dd-MM-yyyy, dd/MM/yyyy, dd-MM-yyyy, prefixed by before:, after: and on: respectively.\n\t\t// Example: before:15/09/2016 after: 10-08-2016\n\t\t// if \"on:\" is set, \"before:\" and \"after:\" are ignored.\n\t\ttext = text.replace(/before:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterBeforeDate);\n\t\ttext = text.replace(/after:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterAfterDate);\n\t\ttext = text.replace(/on:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterOnDate);\n\t\t// Sort order\n\t\ttext = text.replace(/(?:order|sort):(asc|ascend|ascending|desc|descend|descending)/g, sortByTimestamp);\n\n\t\t// Query in message text\n\t\ttext = text.trim().replace(/\\s\\s/g, ' ');\n\t\tif (text !== '') {\n\t\t\tif (/^\\/.+\\/[imxs]*$/.test(text)) {\n\t\t\t\tconst r = text.split('/');\n\t\t\t\tquery.msg = {\n\t\t\t\t\t$regex: r[1],\n\t\t\t\t\t$options: r[2]\n\t\t\t\t};\n\t\t\t} else if (RocketChat.settings.get('Message_AlwaysSearchRegExp')) {\n\t\t\t\tquery.msg = {\n\t\t\t\t\t$regex: text,\n\t\t\t\t\t$options: 'i'\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tquery.$text = {\n\t\t\t\t\t$search: text\n\t\t\t\t};\n\t\t\t\toptions.fields = {\n\t\t\t\t\tscore: {\n\t\t\t\t\t\t$meta: 'textScore'\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tif (Object.keys(query).length > 0) {\n\t\t\tquery.t = {\n\t\t\t\t$ne: 'rm'  //hide removed messages (useful when searching for user messages)\n\t\t\t};\n\t\t\tquery._hidden = {\n\t\t\t\t$ne: true  // don't return _hidden messages\n\t\t\t};\n\t\t\tif (rid != null) {\n\t\t\t\tquery.rid = rid;\n\t\t\t\tif (Meteor.call('canAccessRoom', rid, currentUserId) !== false) {\n\t\t\t\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\t\t\t\toptions.fields = {\n\t\t\t\t\t\t\t'editedAt': 0\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tresult.messages = RocketChat.models.Messages.find(query, options).fetch();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n});\n","Meteor.methods({\n\tmigrateTo(version) {\n\t\tcheck(version, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'migrateTo'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tif (!user || RocketChat.authz.hasPermission(user._id, 'run-migration') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'migrateTo'\n\t\t\t});\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tRocketChat.Migrations.migrateTo(version);\n\n\t\treturn version;\n\t},\n\n\tgetMigrationVersion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getMigrationVersion'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.Migrations.getVersion();\n\t}\n});\n","Meteor.methods({\n\tmuteUserInRoom(data) {\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'mute-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (['c', 'p'].includes(room.t) === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-room-type', `${ room.t } is not a valid room type`, {\n\t\t\t\tmethod: 'muteUserInRoom',\n\t\t\t\ttype: room.t\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(room.usernames) === false || room.usernames.includes(data.username) === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst mutedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tRocketChat.models.Rooms.muteUsernameByRoomId(data.rid, mutedUser.username);\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserMutedWithRoomIdAndUser(data.rid, mutedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\topenRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'openRoom'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.openByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","Meteor.methods({\n\treadMessages(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'readMessages'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.setAsReadByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","Meteor.methods({\n\tregisterUser(formData) {\n\t\tconst AllowAnonymousRead = RocketChat.settings.get('Accounts_AllowAnonymousRead');\n\t\tconst AllowAnonymousWrite = RocketChat.settings.get('Accounts_AllowAnonymousWrite');\n\t\tif (AllowAnonymousRead === true && AllowAnonymousWrite === true && formData.email == null) {\n\t\t\tconst userId = Accounts.insertUserDoc({}, {\n\t\t\t\tglobalRoles: [\n\t\t\t\t\t'anonymous'\n\t\t\t\t]\n\t\t\t});\n\n\t\t\tconst { id, token } = Accounts._loginUser(this, userId);\n\n\t\t\treturn { id, token };\n\t\t} else {\n\t\t\tcheck(formData, Match.ObjectIncluding({\n\t\t\t\temail: String,\n\t\t\t\tpass: String,\n\t\t\t\tname: String,\n\t\t\t\tsecretURL: Match.Optional(String)\n\t\t\t}));\n\t\t}\n\n\t\tif (RocketChat.settings.get('Accounts_RegistrationForm') === 'Disabled') {\n\t\t\tthrow new Meteor.Error('error-user-registration-disabled', 'User registration is disabled', { method: 'registerUser' });\n\t\t} else if (RocketChat.settings.get('Accounts_RegistrationForm') === 'Secret URL' && (!formData.secretURL || formData.secretURL !== RocketChat.settings.get('Accounts_RegistrationForm_SecretURL'))) {\n\t\t\tthrow new Meteor.Error ('error-user-registration-secret', 'User registration is only allowed via Secret URL', { method: 'registerUser' });\n\t\t}\n\n\t\tRocketChat.validateEmailDomain(formData.email);\n\n\t\tconst userData = {\n\t\t\temail: s.trim(formData.email.toLowerCase()),\n\t\t\tpassword: formData.pass\n\t\t};\n\n\t\t// Check if user has already been imported and never logged in. If so, set password and let it through\n\t\tconst importedUser = RocketChat.models.Users.findOneByEmailAddress(s.trim(formData.email.toLowerCase()));\n\t\tlet userId;\n\t\tif (importedUser && importedUser.importIds && importedUser.importIds.length && !importedUser.lastLogin) {\n\t\t\tAccounts.setPassword(importedUser._id, userData.password);\n\t\t\tuserId = importedUser._id;\n\t\t} else {\n\t\t\tuserId = Accounts.createUser(userData);\n\t\t}\n\n\t\tRocketChat.models.Users.setName(userId, s.trim(formData.name));\n\n\t\tRocketChat.saveCustomFields(userId, formData);\n\n\t\ttry {\n\t\t\tif (RocketChat.settings.get('Verification_Customized')) {\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email_Subject') || '');\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email') || '');\n\t\t\t\tAccounts.emailTemplates.verifyEmail.subject = () => subject;\n\t\t\t\tAccounts.emailTemplates.verifyEmail.html = (userModel, url) => html.replace(/\\[Verification_Url]/g, url);\n\t\t\t}\n\n\t\t\tAccounts.sendVerificationEmail(userId, userData.email);\n\t\t} catch (error) {\n\t\t\t// throw new Meteor.Error 'error-email-send-failed', 'Error trying to send email: ' + error.message, { method: 'registerUser', message: error.message }\n\t\t}\n\n\t\treturn userId;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomModerator(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-moderator', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === false || subscription.roles.includes('moderator') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-moderator', 'User is not a moderator', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'moderator');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'moderator'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'moderator',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomOwner(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-owner', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === false || subscription.roles.includes('owner') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-owner', 'User is not an owner', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', rid).count();\n\n\t\tif (numOwners === 1) {\n\t\t\tthrow new Meteor.Error('error-remove-last-owner', 'This is the last owner. Please set a new owner before removing this one.', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'owner');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'owner'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'owner',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveUserFromRoom(data) {\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!fromId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'remove-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room || room.t === 'd') {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(room.usernames) === false || room.usernames.includes(data.username) === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst removedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tif (RocketChat.authz.hasRole(removedUser._id, 'owner', room._id)) {\n\t\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', room._id).fetch().length;\n\n\t\t\tif (numOwners === 1) {\n\t\t\t\tthrow new Meteor.Error('error-you-are-last-owner', 'You are the last owner. Please set new owner before leaving the room.', {\n\t\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.models.Rooms.removeUsernameById(data.rid, data.username);\n\n\t\tRocketChat.models.Subscriptions.removeByRoomIdAndUserId(data.rid, removedUser._id);\n\n\t\tif (['c', 'p'].includes(room.t) === true) {\n\t\t\tRocketChat.authz.removeUserFromRoles(removedUser._id, ['moderator', 'owner'], data.rid);\n\t\t}\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserRemovedWithRoomIdAndUser(data.rid, removedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\treportMessage(messageId, description) {\n\t\tcheck(messageId, String);\n\t\tcheck(description, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\tif ((description == null) || description.trim() === '') {\n\t\t\tthrow new Meteor.Error('error-invalid-description', 'Invalid description', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst message = RocketChat.models.Messages.findOneById(messageId);\n\t\tif (!message) {\n\t\t\tthrow new Meteor.Error('error-invalid-message_id', 'Invalid message id', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Reports.createWithMessageDescriptionAndUserId(message, description, Meteor.userId());\n\t}\n});\n","Meteor.methods({\n\tresetAvatar() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'resetAvatar'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'resetAvatar'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tRocketChatFileAvatarInstance.deleteFile(`${ user.username }.jpg`);\n\t\tRocketChat.models.Users.unsetAvatarOrigin(user._id);\n\t\tRocketChat.Notifications.notifyLogged('updateAvatar', {\n\t\t\tusername: user.username\n\t\t});\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'resetAvatar',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 60000);\n","Meteor.methods({\n\tsaveUserPreferences(settings) {\n\t\tcheck(settings, Object);\n\n\t\tif (Meteor.userId()) {\n\t\t\tconst preferences = {};\n\n\t\t\tif (settings.language != null) {\n\t\t\t\tRocketChat.models.Users.setLanguage(Meteor.userId(), settings.language);\n\t\t\t}\n\n\t\t\tif (settings.newRoomNotification) {\n\t\t\t\tpreferences.newRoomNotification = settings.newRoomNotification;\n\t\t\t}\n\n\t\t\tif (settings.newMessageNotification) {\n\t\t\t\tpreferences.newMessageNotification = settings.newMessageNotification;\n\t\t\t}\n\n\t\t\tif (settings.useEmojis) {\n\t\t\t\tpreferences.useEmojis = settings.useEmojis === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.convertAsciiEmoji) {\n\t\t\t\tpreferences.convertAsciiEmoji = settings.convertAsciiEmoji === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.saveMobileBandwidth) {\n\t\t\t\tpreferences.saveMobileBandwidth = settings.saveMobileBandwidth === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.collapseMediaByDefault) {\n\t\t\t\tpreferences.collapseMediaByDefault = settings.collapseMediaByDefault === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.unreadRoomsMode) {\n\t\t\t\tpreferences.unreadRoomsMode = settings.unreadRoomsMode === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.autoImageLoad) {\n\t\t\t\tpreferences.autoImageLoad = settings.autoImageLoad === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.emailNotificationMode) {\n\t\t\t\tpreferences.emailNotificationMode = settings.emailNotificationMode;\n\t\t\t}\n\n\t\t\tif (settings.mergeChannels !== '-1') {\n\t\t\t\tpreferences.mergeChannels = settings.mergeChannels === '1';\n\t\t\t} else {\n\t\t\t\tdelete preferences.mergeChannels;\n\t\t\t}\n\n\t\t\tif (settings.unreadAlert) {\n\t\t\t\tpreferences.unreadAlert = settings.unreadAlert === '1' ? true : false;\n\t\t\t}\n\n\t\t\tpreferences.desktopNotificationDuration = settings.desktopNotificationDuration - 0;\n\t\t\tpreferences.viewMode = settings.viewMode || 0;\n\t\t\tpreferences.hideUsernames = settings.hideUsernames === '1';\n\t\t\tpreferences.hideRoles = settings.hideRoles === '1';\n\t\t\tpreferences.hideAvatars = settings.hideAvatars === '1';\n\t\t\tpreferences.hideFlexTab = settings.hideFlexTab === '1';\n\t\t\tpreferences.highlights = settings.highlights;\n\t\t\tpreferences.sendOnEnter = settings.sendOnEnter;\n\n\t\t\tRocketChat.models.Users.setPreferences(Meteor.userId(), preferences);\n\n\t\t\treturn true;\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tsaveUserProfile(settings, customFields) {\n\t\tcheck(settings, Object);\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserProfileChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t});\n\t\t}\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tfunction checkPassword(user = {}, typedPassword) {\n\t\t\tif (!(user.services && user.services.password && user.services.password.bcrypt && user.services.password.bcrypt.trim())) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst passCheck = Accounts._checkPassword(user, {\n\t\t\t\tdigest: typedPassword,\n\t\t\t\talgorithm: 'sha-256'\n\t\t\t});\n\n\t\t\tif (passCheck.error) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tif (settings.realname) {\n\t\t\tRocketChat.setRealName(Meteor.userId(), settings.realname);\n\t\t}\n\n\t\tif (settings.username) {\n\t\t\tMeteor.call('setUsername', settings.username);\n\t\t}\n\n\t\tif (settings.email) {\n\t\t\tif (!checkPassword(user, settings.typedPassword)) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', {\n\t\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tMeteor.call('setEmail', settings.email);\n\t\t}\n\n\t\t// Should be the last chack to prevent error when trying to check password for users without password\n\t\tif ((settings.newPassword) && RocketChat.settings.get('Accounts_AllowPasswordChange') === true) {\n\t\t\tif (!checkPassword(user, settings.typedPassword)) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', {\n\t\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tAccounts.setPassword(Meteor.userId(), settings.newPassword, {\n\t\t\t\tlogout: false\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Users.setProfile(Meteor.userId(), {});\n\n\t\tRocketChat.saveCustomFields(Meteor.userId(), customFields);\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tsendConfirmationEmail(email) {\n\t\tcheck(email, String);\n\t\temail = email.trim();\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email);\n\n\t\tif (user) {\n\t\t\tif (RocketChat.settings.get('Verification_Customized')) {\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email_Subject') || '');\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email') || '');\n\n\t\t\t\tAccounts.emailTemplates.verifyEmail.subject = function(/*userModel*/) {\n\t\t\t\t\treturn subject;\n\t\t\t\t};\n\n\t\t\t\tAccounts.emailTemplates.verifyEmail.html = function(userModel, url) {\n\t\t\t\t\treturn html.replace(/\\[Verification_Url]/g, url);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tAccounts.sendVerificationEmail(user._id, email);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, {\n\t\t\t\t\tmethod: 'registerUser',\n\t\t\t\t\tmessage: error.message\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\tsendForgotPasswordEmail(email) {\n\t\tcheck(email, String);\n\n\t\temail = email.trim();\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email);\n\n\t\tif (user) {\n\t\t\tconst regex = new RegExp(`^${ s.escapeRegExp(email) }$`, 'i');\n\t\t\temail = (user.emails || []).map(item => item.address).find(userEmail => regex.test(userEmail));\n\n\t\t\tif (RocketChat.settings.get('Forgot_Password_Customized')) {\n\t\t\t\tconst data = { name: user.name, email };\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Forgot_Password_Email_Subject') || '', data);\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Forgot_Password_Email') || '', data);\n\n\t\t\t\tAccounts.emailTemplates.resetPassword.subject = function(/*userModel*/) {\n\t\t\t\t\treturn subject;\n\t\t\t\t};\n\n\t\t\t\tAccounts.emailTemplates.resetPassword.html = function(userModel, url) {\n\t\t\t\t\turl = url.replace('/#/', '/');\n\t\t\t\t\treturn html.replace(/\\[Forgot_Password_Url]/g, url);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tAccounts.sendResetPasswordEmail(user._id, email);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, {\n\t\t\t\t\tmethod: 'registerUser',\n\t\t\t\t\tmessage: error.message\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\tsetAvatarFromService(dataURI, contentType, service) {\n\t\tcheck(dataURI, String);\n\t\tcheck(contentType, Match.Optional(String));\n\t\tcheck(service, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setAvatarFromService'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setAvatarFromService'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\treturn RocketChat.setUserAvatar(user, dataURI, contentType, service);\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'setAvatarFromService',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 5000);\n","Meteor.methods({\n\tsetUserActiveStatus(userId, active) {\n\t\tcheck(userId, String);\n\t\tcheck(active, Boolean);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setUserActiveStatus'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'edit-other-user-active-status') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setUserActiveStatus'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (user) {\n\t\t\tRocketChat.models.Users.setUserActive(userId, active);\n\n\t\t\tif (user.username) {\n\t\t\t\tRocketChat.models.Subscriptions.setArchivedByUsername(user.username, !active);\n\t\t\t}\n\n\t\t\tif (active === false) {\n\t\t\t\tRocketChat.models.Users.unsetLoginTokens(userId);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\tsetUserPassword(password) {\n\t\tcheck(password, String);\n\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setUserPassword'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (user && user.requirePasswordChange !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setUserPassword'\n\t\t\t});\n\t\t}\n\n\t\tAccounts.setPassword(userId, password, {\n\t\t\tlogout: false\n\t\t});\n\n\t\treturn RocketChat.models.Users.unsetRequirePasswordChange(userId);\n\t}\n});\n","Meteor.methods({\n\ttoggleFavorite(rid, f) {\n\t\tcheck(rid, String);\n\n\t\tcheck(f, Match.Optional(Boolean));\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'toggleFavorite'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.setFavoriteByRoomIdAndUserId(rid, Meteor.userId(), f);\n\t}\n});\n","Meteor.methods({\n\tunmuteUserInRoom(data) {\n\t\tconst fromId = Meteor.userId();\n\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'mute-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (['c', 'p'].includes(room.t) === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-room-type', `${ room.t } is not a valid room type`, {\n\t\t\t\tmethod: 'unmuteUserInRoom',\n\t\t\t\ttype: room.t\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(room.usernames) === false || room.usernames.includes(data.username) === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst unmutedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tRocketChat.models.Rooms.unmuteUsernameByRoomId(data.rid, unmutedUser.username);\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserUnmutedWithRoomIdAndUser(data.rid, unmutedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tuserSetUtcOffset(utcOffset) {\n\t\tcheck(utcOffset, Number);\n\n\t\tif (this.userId == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.unblock();\n\n\t\treturn RocketChat.models.Users.setUtcOffset(this.userId, utcOffset);\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'userSetUtcOffset',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 60000);\n","Meteor.publish('activeUsers', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Users.findUsersNotOffline({\n\t\tfields: {\n\t\t\tusername: 1,\n\t\t\tstatus: 1,\n\t\t\tutcOffset: 1\n\t\t}\n\t});\n});\n","Meteor.publish('channelAndPrivateAutocomplete', function(selector) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\tconst pub = this;\n\tconst options = {\n\t\tfields: {\n\t\t\t_id: 1,\n\t\t\tname: 1\n\t\t},\n\t\tlimit: 10,\n\t\tsort: {\n\t\t\tname: 1\n\t\t}\n\t};\n\n\tconst cursorHandle = RocketChat.models.Rooms.findByNameStartingAndTypes(selector.name, ['c', 'p'], options).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('autocompleteRecords', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('autocompleteRecords', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('autocompleteRecords', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\tthis.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n","Meteor.publish('fullUserData', function(filter, limit) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst result = RocketChat.getFullUserData({\n\t\tuserId: this.userId,\n\t\tfilter,\n\t\tlimit\n\t});\n\n\tif (!result) {\n\t\treturn this.ready();\n\t}\n\n\treturn result;\n});\n","Meteor.publish('messages', function(rid/*, start*/) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst publication = this;\n\n\tif (typeof rid !== 'string') {\n\t\treturn this.ready();\n\t}\n\n\tif (!Meteor.call('canAccessRoom', rid, this.userId)) {\n\t\treturn this.ready();\n\t}\n\n\tconst cursor = RocketChat.models.Messages.findVisibleByRoomId(rid, {\n\t\tsort: {\n\t\t\tts: -1\n\t\t},\n\t\tlimit: 50\n\t});\n\n\tconst cursorHandle = cursor.observeChanges({\n\t\tadded(_id, record) {\n\t\t\trecord.starred = _.findWhere(record.starred, {\n\t\t\t\t_id: publication.userId\n\t\t\t});\n\t\t\treturn publication.added('rocketchat_message', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\trecord.starred = _.findWhere(record.starred, {\n\t\t\t\t_id: publication.userId\n\t\t\t});\n\t\t\treturn publication.changed('rocketchat_message', _id, record);\n\t\t}\n\t});\n\n\tconst cursorDelete = RocketChat.models.Messages.findInvisibleByRoomId(rid, {\n\t\tfields: {\n\t\t\t_id: 1\n\t\t}\n\t});\n\n\tconst cursorDeleteHandle = cursorDelete.observeChanges({\n\t\tadded(_id/*, record*/) {\n\t\t\treturn publication.added('rocketchat_message', _id, {\n\t\t\t\t_hidden: true\n\t\t\t});\n\t\t},\n\t\tchanged(_id/*, record*/) {\n\t\t\treturn publication.added('rocketchat_message', _id, {\n\t\t\t\t_hidden: true\n\t\t\t});\n\t\t}\n\t});\n\n\tthis.ready();\n\n\treturn this.onStop(function() {\n\t\tcursorHandle.stop();\n\t\treturn cursorDeleteHandle.stop();\n\t});\n});\n","Meteor.publish('privateHistory', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Rooms.findByContainingUsername(RocketChat.models.Users.findOneById(this.userId).username, {\n\t\tfields: {\n\t\t\tt: 1,\n\t\t\tname: 1,\n\t\t\tmsgs: 1,\n\t\t\tts: 1,\n\t\t\tlm: 1,\n\t\t\tcl: 1\n\t\t}\n\t});\n});\n","const options = {\n\tfields: {\n\t\t_id: 1,\n\t\tname: 1,\n\t\tt: 1,\n\t\tcl: 1,\n\t\tu: 1,\n\t\t// usernames: 1,\n\t\ttopic: 1,\n\t\tannouncement: 1,\n\t\tmuted: 1,\n\t\tarchived: 1,\n\t\tjitsiTimeout: 1,\n\t\tdescription: 1,\n\t\tdefault: 1,\n\n\t\t// @TODO create an API to register this fields based on room type\n\t\tlivechatData: 1,\n\t\ttags: 1,\n\t\tsms: 1,\n\t\tcode: 1,\n\t\topen: 1,\n\t\tv: 1,\n\t\tlabel: 1,\n\t\tro: 1,\n\t\tsentiment: 1\n\t}\n};\n\n\nconst roomMap = (record) => {\n\tif (record._room) {\n\t\treturn _.pick(record._room, ...Object.keys(options.fields));\n\t}\n\tconsole.log('Empty Room for Subscription', record);\n\treturn {};\n};\n\n\nMeteor.methods({\n\t'rooms/get'(updatedAt) {\n\t\tif (!Meteor.userId()) {\n\t\t\tif (RocketChat.settings.get('Accounts_AllowAnonymousRead') === true) {\n\t\t\t\treturn RocketChat.models.Rooms.findByDefaultAndTypes(true, ['c'], options).fetch();\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: RocketChat.models.Rooms.findBySubscriptionUserIdUpdatedAfter(Meteor.userId(), updatedAt, options).fetch(),\n\t\t\t\tremove: RocketChat.models.Rooms.trashFindDeletedAfter(updatedAt, {}, {fields: {_id: 1, _deletedAt: 1}}).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.models.Rooms.findBySubscriptionUserId(Meteor.userId(), options).fetch();\n\t},\n\n\tgetRoomByTypeAndName(type, name) {\n\t\tif (!Meteor.userId() && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tconst roomFind = RocketChat.roomTypes.getRoomFind(type);\n\n\t\tlet room;\n\n\t\tif (roomFind) {\n\t\t\troom = roomFind.call(this, name);\n\t\t} else {\n\t\t\troom = RocketChat.models.Rooms.findByTypeAndName(type, name).fetch();\n\t\t}\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', room._id, Meteor.userId())) {\n\t\t\tthrow new Meteor.Error('error-no-permission', 'No permission', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\treturn roomMap({_room: room});\n\t}\n});\n\nRocketChat.models.Rooms.cache.on('sync', (type, room/*, diff*/) => {\n\tconst records = RocketChat.models.Subscriptions.findByRoomId(room._id).fetch();\n\tfor (const record of records) {\n\t\tRocketChat.Notifications.notifyUserInThisInstance(record.u._id, 'rooms-changed', type, roomMap({_room: room}));\n\t}\n});\n\nRocketChat.models.Subscriptions.on('changed', (type, subscription/*, diff*/) => {\n\tif (type === 'inserted') {\n\t\tconst room = RocketChat.models.Rooms.findOneById(subscription.rid);\n\t\tif (room) {\n\t\t\tRocketChat.Notifications.notifyUserInThisInstance(subscription.u._id, 'rooms-changed', type, roomMap({_room: room}));\n\t\t}\n\t}\n});\n","Meteor.publish('roomFiles', function(rid, limit = 50) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst pub = this;\n\n\tconst cursorFileListHandle = RocketChat.models.Uploads.findNotHiddenFilesOfRoom(rid, limit).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('room_files', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('room_files', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('room_files', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\treturn this.onStop(function() {\n\t\treturn cursorFileListHandle.stop();\n\t});\n});\n","Meteor.publish('roomSubscriptionsByRole', function(rid, role) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Subscriptions.findByRoomIdAndRoles(rid, role, {\n\t\tfields: {\n\t\t\trid: 1,\n\t\t\tname: 1,\n\t\t\troles: 1,\n\t\t\tu: 1\n\t\t},\n\t\tsort: {\n\t\t\tname: 1\n\t\t}\n\t});\n});\n","Meteor.methods({\n\tspotlight(text, usernames, type = {users: true, rooms: true}) {\n\t\tconst result = {\n\t\t\tusers: [],\n\t\t\trooms: []\n\t\t};\n\n\t\tconst roomOptions = {\n\t\t\tlimit: 5,\n\t\t\tfields: {\n\t\t\t\tt: 1,\n\t\t\t\tname: 1\n\t\t\t},\n\t\t\tsort: {\n\t\t\t\tname: 1\n\t\t\t}\n\t\t};\n\n\t\tconst regex = new RegExp(s.trim(s.escapeRegExp(text)), 'i');\n\n\t\tif (this.userId == null) {\n\t\t\tif (RocketChat.settings.get('Accounts_AllowAnonymousRead') === true) {\n\t\t\t\tresult.rooms = RocketChat.models.Rooms.findByNameAndTypeNotDefault(regex, 'c', roomOptions).fetch();\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\n\t\tif (type.users === true && RocketChat.authz.hasPermission(this.userId, 'view-d-room')) {\n\t\t\tconst userOptions = {\n\t\t\t\tlimit: 5,\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tname: 1,\n\t\t\t\t\tstatus: 1\n\t\t\t\t},\n\t\t\t\tsort: {}\n\t\t\t};\n\n\t\t\tif (RocketChat.settings.get('UI_Use_Real_Name')) {\n\t\t\t\tuserOptions.sort.name = 1;\n\t\t\t} else {\n\t\t\t\tuserOptions.sort.username = 1;\n\t\t\t}\n\n\t\t\tresult.users = RocketChat.models.Users.findByActiveUsersExcept(text, usernames, userOptions).fetch();\n\t\t}\n\n\t\tif (type.rooms === true && RocketChat.authz.hasPermission(this.userId, 'view-c-room')) {\n\t\t\tconst username = RocketChat.models.Users.findOneById(this.userId, {\n\t\t\t\tusername: 1\n\t\t\t}).username;\n\n\t\t\tresult.rooms = RocketChat.models.Rooms.findByNameAndTypeNotContainingUsername(regex, 'c', username, roomOptions).fetch();\n\t\t}\n\t\treturn result;\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'spotlight',\n\tuserId(/*userId*/) {\n\t\treturn true;\n\t}\n}, 100, 100000);\n","const fields = {\n\tt: 1,\n\tts: 1,\n\tls: 1,\n\tname: 1,\n\tfname: 1,\n\trid: 1,\n\tcode: 1,\n\tf: 1,\n\tu: 1,\n\topen: 1,\n\talert: 1,\n\troles: 1,\n\tunread: 1,\n\tarchived: 1,\n\taudioNotification: 1,\n\tdesktopNotifications: 1,\n\tdesktopNotificationDuration: 1,\n\tmobilePushNotifications: 1,\n\temailNotifications: 1,\n\tunreadAlert: 1,\n\t_updatedAt: 1,\n\tblocked: 1,\n\tblocker: 1,\n\tautoTranslate: 1,\n\tautoTranslateLanguage: 1,\n\tdisableNotifications: 1,\n\thideUnreadStatus: 1\n};\n\nMeteor.methods({\n\t'subscriptions/get'(updatedAt) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst options = {\n\t\t\tfields\n\t\t};\n\n\t\tconst records = RocketChat.models.Subscriptions.findByUserId(Meteor.userId(), options).fetch();\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: records.filter(function(record) {\n\t\t\t\t\treturn record._updatedAt > updatedAt;\n\t\t\t\t}),\n\t\t\t\tremove: RocketChat.models.Subscriptions.trashFindDeletedAfter(updatedAt, {\n\t\t\t\t\t'u._id': Meteor.userId()\n\t\t\t\t}, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\t_id: 1,\n\t\t\t\t\t\t_deletedAt: 1\n\t\t\t\t\t}\n\t\t\t\t}).fetch()\n\t\t\t};\n\t\t}\n\t\treturn records;\n\t}\n});\n\nRocketChat.models.Subscriptions.on('changed', function(type, subscription) {\n\tRocketChat.Notifications.notifyUserInThisInstance(subscription.u._id, 'subscriptions-changed', type, RocketChat.models.Subscriptions.processQueryOptionsOnResult(subscription, {\n\t\tfields\n\t}));\n});\n\n// TODO needs improvement\n// We are sending the record again cuz any update on subscription will send the record without the fname (join)\n// Then we need to sent it again listening to the join event.\nRocketChat.models.Subscriptions.on('join:fname:inserted', function(subscription/*, user*/) {\n\tRocketChat.Notifications.notifyUserInThisInstance(subscription.u._id, 'subscriptions-changed', 'changed', RocketChat.models.Subscriptions.processQueryOptionsOnResult(subscription, {\n\t\tfields\n\t}));\n});\n","Meteor.publish('userAutocomplete', function(selector) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (!_.isObject(selector)) {\n\t\treturn this.ready();\n\t}\n\n\tconst options = {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tusername: 1,\n\t\t\tstatus: 1\n\t\t},\n\t\tsort: {\n\t\t\tusername: 1\n\t\t},\n\t\tlimit: 10\n\t};\n\n\tconst pub = this;\n\tconst exceptions = selector.exceptions || [];\n\n\tconst cursorHandle = RocketChat.models.Users.findActiveByUsernameOrNameRegexWithExceptions(selector.term, exceptions, options).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('autocompleteRecords', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('autocompleteRecords', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('autocompleteRecords', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\tthis.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n","Meteor.publish('userChannels', function(userId) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Subscriptions.findByUserId(userId, {\n\t\tfields: {\n\t\t\trid: 1,\n\t\t\tname: 1,\n\t\t\tt: 1,\n\t\t\tu: 1\n\t\t},\n\t\tsort: {\n\t\t\tt: 1,\n\t\t\tname: 1\n\t\t}\n\t});\n});\n","Meteor.publish('userData', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Users.find(this.userId, {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tusername: 1,\n\t\t\tstatus: 1,\n\t\t\tstatusDefault: 1,\n\t\t\tstatusConnection: 1,\n\t\t\tavatarOrigin: 1,\n\t\t\tutcOffset: 1,\n\t\t\tlanguage: 1,\n\t\t\tsettings: 1,\n\t\t\troles: 1,\n\t\t\tactive: 1,\n\t\t\tdefaultRoom: 1,\n\t\t\tcustomFields: 1,\n\t\t\t'services.github': 1,\n\t\t\t'services.gitlab': 1,\n\t\t\trequirePasswordChange: 1,\n\t\t\trequirePasswordChangeReason: 1,\n\t\t\t'services.password.bcrypt': 1,\n\t\t\t'services.totp.enabled': 1,\n\t\t\tstatusLivechat: 1\n\t\t}\n\t});\n});\n","const msgStream = new Meteor.Streamer('room-messages');\nthis.msgStream = msgStream;\n\nmsgStream.allowWrite('none');\n\nmsgStream.allowRead(function(eventName) {\n\ttry {\n\t\tconst room = Meteor.call('canAccessRoom', eventName, this.userId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (room.t === 'c' && !RocketChat.authz.hasPermission(this.userId, 'preview-c-room') && room.usernames.indexOf(room.username) === -1) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (error) {\n\t\t/*error*/\n\t\treturn false;\n\t}\n});\n\nmsgStream.allowRead('__my_messages__', 'all');\n\nmsgStream.allowEmit('__my_messages__', function(eventName, msg, options) {\n\ttry {\n\t\tconst room = Meteor.call('canAccessRoom', msg.rid, this.userId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\toptions.roomParticipant = room.usernames.indexOf(room.username) > -1;\n\t\toptions.roomType = room.t;\n\n\t\treturn true;\n\t} catch (error) {\n\t\t/*error*/\n\t\treturn false;\n\t}\n});\n\nMeteor.startup(function() {\n\tfunction publishMessage(type, record) {\n\t\tif (record._hidden !== true && (record.imported == null)) {\n\t\t\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\t\t\tif (record.u && record.u._id && UI_Use_Real_Name) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(record.u._id);\n\t\t\t\trecord.u.name = user && user.name;\n\t\t\t}\n\t\t\tmsgStream.emitWithoutBroadcast('__my_messages__', record, {});\n\t\t\treturn msgStream.emitWithoutBroadcast(record.rid, record);\n\t\t}\n\t}\n\n\treturn RocketChat.models.Messages._db.on('change', function({action, id, data/*, oplog*/}) {\n\t\tswitch (action) {\n\t\t\tcase 'insert':\n\t\t\t\tdata._id = id;\n\t\t\t\tpublishMessage('inserted', data);\n\t\t\t\tbreak;\n\t\t\tcase 'update:record':\n\t\t\t\tpublishMessage('updated', data);\n\t\t\t\tbreak;\n\t\t\tcase 'update:diff':\n\t\t\t\tpublishMessage('updated', RocketChat.models.Messages.findOne({\n\t\t\t\t\t_id: id\n\t\t\t\t}));\n\t\t\t\tbreak;\n\t\t}\n\t});\n});\n","/* global InstanceStatus, DDP, LoggerManager */\n\nimport {DDPCommon} from 'meteor/ddp-common';\n\nprocess.env.PORT = String(process.env.PORT).trim();\nprocess.env.INSTANCE_IP = String(process.env.INSTANCE_IP).trim();\n\nconst connections = {};\nthis.connections = connections;\n\nconst logger = new Logger('StreamBroadcast', {\n\tsections: {\n\t\tconnection: 'Connection',\n\t\tauth: 'Auth',\n\t\tstream: 'Stream'\n\t}\n});\n\nfunction _authorizeConnection(instance) {\n\tlogger.auth.info(`Authorizing with ${ instance }`);\n\n\treturn connections[instance].call('broadcastAuth', InstanceStatus.id(), connections[instance].instanceId, function(err, ok) {\n\t\tif (err != null) {\n\t\t\treturn logger.auth.error(`broadcastAuth error ${ instance } ${ InstanceStatus.id() } ${ connections[instance].instanceId }`, err);\n\t\t}\n\n\t\tconnections[instance].broadcastAuth = ok;\n\t\treturn logger.auth.info(`broadcastAuth with ${ instance }`, ok);\n\t});\n}\n\nfunction authorizeConnection(instance) {\n\tconst query = {\n\t\t_id: InstanceStatus.id()\n\t};\n\n\tif (!InstanceStatus.getCollection().findOne(query)) {\n\t\treturn Meteor.setTimeout(function() {\n\t\t\treturn authorizeConnection(instance);\n\t\t}, 500);\n\t}\n\n\treturn _authorizeConnection(instance);\n}\n\nfunction startMatrixBroadcast() {\n\tconst query = {\n\t\t'extraInformation.port': {\n\t\t\t$exists: true\n\t\t}\n\t};\n\n\tconst options = {\n\t\tsort: {\n\t\t\t_createdAt: -1\n\t\t}\n\t};\n\n\treturn InstanceStatus.getCollection().find(query, options).observe({\n\t\tadded(record) {\n\t\t\tlet instance = `${ record.extraInformation.host }:${ record.extraInformation.port }`;\n\n\t\t\tif (record.extraInformation.port === process.env.PORT && record.extraInformation.host === process.env.INSTANCE_IP) {\n\t\t\t\tlogger.auth.info('prevent self connect', instance);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (record.extraInformation.host === process.env.INSTANCE_IP && RocketChat.isDocker() === false) {\n\t\t\t\tinstance = `localhost:${ record.extraInformation.port }`;\n\t\t\t}\n\n\t\t\tif (connections[instance] && connections[instance].instanceRecord) {\n\t\t\t\tif (connections[instance].instanceRecord._createdAt < record._createdAt) {\n\t\t\t\t\tconnections[instance].disconnect();\n\t\t\t\t\tdelete connections[instance];\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlogger.connection.info('connecting in', instance);\n\n\t\t\tconnections[instance] = DDP.connect(instance, {\n\t\t\t\t_dontPrintErrors: LoggerManager.logLevel < 2\n\t\t\t});\n\n\t\t\tconnections[instance].instanceRecord = record;\n\t\t\tconnections[instance].instanceId = record._id;\n\n\t\t\treturn connections[instance].onReconnect = function() {\n\t\t\t\treturn authorizeConnection(instance);\n\t\t\t};\n\t\t},\n\n\t\tremoved(record) {\n\t\t\tlet instance = `${ record.extraInformation.host }:${ record.extraInformation.port }`;\n\n\t\t\tif (record.extraInformation.host === process.env.INSTANCE_IP && RocketChat.isDocker() === false) {\n\t\t\t\tinstance = `localhost:${ record.extraInformation.port }`;\n\t\t\t}\n\n\t\t\tconst query = {\n\t\t\t\t'extraInformation.host': record.extraInformation.host,\n\t\t\t\t'extraInformation.port': record.extraInformation.port\n\t\t\t};\n\n\t\t\tif (connections[instance] && !InstanceStatus.getCollection().findOne(query)) {\n\t\t\t\tlogger.connection.info('disconnecting from', instance);\n\t\t\t\tconnections[instance].disconnect();\n\t\t\t\treturn delete connections[instance];\n\t\t\t}\n\t\t}\n\t});\n}\n\nMeteor.methods({\n\tbroadcastAuth(remoteId, selfId) {\n\t\tcheck(selfId, String);\n\t\tcheck(remoteId, String);\n\n\t\tthis.unblock();\n\n\t\tconst query = {\n\t\t\t_id: remoteId\n\t\t};\n\n\t\tif (selfId === InstanceStatus.id() && remoteId !== InstanceStatus.id() && (InstanceStatus.getCollection().findOne(query))) {\n\t\t\tthis.connection.broadcastAuth = true;\n\t\t}\n\n\t\treturn this.connection.broadcastAuth === true;\n\t},\n\n\tstream(streamName, eventName, args) {\n\t\tif (!this.connection) {\n\t\t\treturn 'self-not-authorized';\n\t\t}\n\n\t\tif (this.connection.broadcastAuth !== true) {\n\t\t\treturn 'not-authorized';\n\t\t}\n\n\t\tif (!Meteor.StreamerCentral.instances[streamName]) {\n\t\t\treturn 'stream-not-exists';\n\t\t}\n\n\t\tMeteor.StreamerCentral.instances[streamName]._emit(eventName, args);\n\t}\n});\n\nfunction startStreamCastBroadcast(value) {\n\tconst instance = 'StreamCast';\n\n\tlogger.connection.info('connecting in', instance, value);\n\n\tconst connection = DDP.connect(value, {\n\t\t_dontPrintErrors: LoggerManager.logLevel < 2\n\t});\n\n\tconnections[instance] = connection;\n\tconnection.instanceId = instance;\n\tconnection.onReconnect = function() {\n\t\treturn authorizeConnection(instance);\n\t};\n\n\tconnection._stream.on('message', function(raw_msg) {\n\t\tconst msg = DDPCommon.parseDDP(raw_msg);\n\t\tif (!msg || msg.msg !== 'changed' || !msg.collection || !msg.fields) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst {streamName, eventName, args} = msg.fields;\n\n\t\tif (!streamName || !eventName || !args) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (connection.broadcastAuth !== true) {\n\t\t\treturn 'not-authorized';\n\t\t}\n\n\t\tif (!Meteor.StreamerCentral.instances[streamName]) {\n\t\t\treturn 'stream-not-exists';\n\t\t}\n\n\t\treturn Meteor.StreamerCentral.instances[streamName]._emit(eventName, args);\n\t});\n\n\treturn connection.subscribe('stream');\n}\n\nfunction startStreamBroadcast() {\n\tif (!process.env.INSTANCE_IP) {\n\t\tprocess.env.INSTANCE_IP = 'localhost';\n\t}\n\n\tlogger.info('startStreamBroadcast');\n\n\tRocketChat.settings.get('Stream_Cast_Address', function(key, value) {\n\t\t// var connection, fn, instance;\n\t\tconst fn = function(instance, connection) {\n\t\t\tconnection.disconnect();\n\t\t\treturn delete connections[instance];\n\t\t};\n\n\t\tfor (const instance of Object.keys(connections)) {\n\t\t\tconst connection = connections[instance];\n\t\t\tfn(instance, connection);\n\t\t}\n\n\t\tif (value && value.trim() !== '') {\n\t\t\treturn startStreamCastBroadcast(value);\n\t\t} else {\n\t\t\treturn startMatrixBroadcast();\n\t\t}\n\t});\n\n\tfunction broadcast(streamName, eventName, args/*, userId*/) {\n\t\tconst fromInstance = `${ process.env.INSTANCE_IP }:${ process.env.PORT }`;\n\t\tconst results = [];\n\n\t\tfor (const instance of Object.keys(connections)) {\n\t\t\tconst connection = connections[instance];\n\n\t\t\tif (connection.status().connected === true) {\n\t\t\t\tconnection.call('stream', streamName, eventName, args, function(error, response) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tlogger.error('Stream broadcast error', error);\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch (response) {\n\t\t\t\t\t\tcase 'self-not-authorized':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } to self is not authorized`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\treturn logger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t\tcase 'not-authorized':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } not authorized`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\tlogger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t\t\treturn authorizeConnection(instance);\n\t\t\t\t\t\tcase 'stream-not-exists':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } does not exist`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\treturn logger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\treturn Meteor.StreamerCentral.on('broadcast', function(streamName, eventName, args) {\n\t\treturn broadcast(streamName, eventName, args);\n\t});\n}\n\nMeteor.startup(function() {\n\treturn startStreamBroadcast();\n});\n\nMeteor.methods({\n\t'instances/get'() {\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'view-statistics')) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'List instances is not allowed', {\n\t\t\t\tmethod: 'instances/get'\n\t\t\t});\n\t\t}\n\n\t\treturn Object.keys(connections).map(address => {\n\t\t\tconst conn = connections[address];\n\t\t\treturn Object.assign({ address, currentStatus: conn._stream.currentStatus }, _.pick(conn, 'instanceRecord', 'broadcastAuth'));\n\t\t});\n\t}\n});\n","RegExp.escape = function(s) {\n\treturn s.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n};\n","/* globals UploadFS, FileUpload */\nimport { Cookies } from 'meteor/ostrio:cookies';\n\nif (UploadFS) {\n\tconst initFileStore = function() {\n\t\tconst cookie = new Cookies();\n\t\tif (Meteor.isClient) {\n\t\t\tdocument.cookie = `rc_uid=${ escape(Meteor.userId()) }; path=/`;\n\t\t\tdocument.cookie = `rc_token=${ escape(Accounts._storedLoginToken()) }; path=/`;\n\t\t}\n\n\t\tMeteor.fileStore = new UploadFS.store.GridFS({\n\t\t\tcollection: RocketChat.models.Uploads.model,\n\t\t\tname: 'rocketchat_uploads',\n\t\t\tcollectionName: 'rocketchat_uploads',\n\t\t\tfilter: new UploadFS.Filter({\n\t\t\t\tonCheck: FileUpload.validateFileUpload\n\t\t\t}),\n\t\t\ttransformWrite(readStream, writeStream, fileId, file) {\n\t\t\t\tif (RocketChatFile.enabled === false || !/^image\\/.+/.test(file.type)) {\n\t\t\t\t\treturn readStream.pipe(writeStream);\n\t\t\t\t}\n\n\t\t\t\tlet stream = undefined;\n\n\t\t\t\tconst identify = function(err, data) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn stream.pipe(writeStream);\n\t\t\t\t\t}\n\n\t\t\t\t\tfile.identify = {\n\t\t\t\t\t\tformat: data.format,\n\t\t\t\t\t\tsize: data.size\n\t\t\t\t\t};\n\n\t\t\t\t\tif (data.Orientation && !['', 'Unknown', 'Undefined'].includes(data.Orientation)) {\n\t\t\t\t\t\tRocketChatFile.gm(stream).autoOrient().stream().pipe(writeStream);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstream.pipe(writeStream);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tstream = RocketChatFile.gm(readStream).identify(identify).stream();\n\t\t\t},\n\n\t\t\tonRead(fileId, file, req, res) {\n\t\t\t\tif (RocketChat.settings.get('FileUpload_ProtectFiles')) {\n\t\t\t\t\tlet uid;\n\t\t\t\t\tlet token;\n\n\t\t\t\t\tif (req && req.headers && req.headers.cookie) {\n\t\t\t\t\t\tconst rawCookies = req.headers.cookie;\n\n\t\t\t\t\t\tif (rawCookies) {\n\t\t\t\t\t\t\tuid = cookie.get('rc_uid', rawCookies) ;\n\t\t\t\t\t\t\ttoken = cookie.get('rc_token', rawCookies);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!uid) {\n\t\t\t\t\t\tuid = req.query.rc_uid;\n\t\t\t\t\t\ttoken = req.query.rc_token;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!uid || !token || !RocketChat.models.Users.findOneByIdAndLoginToken(uid, token)) {\n\t\t\t\t\t\tres.writeHead(403);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tres.setHeader('content-disposition', `attachment; filename=\"${ encodeURIComponent(file.name) }\"`);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t};\n\n\tMeteor.startup(function() {\n\t\tif (Meteor.isServer) {\n\t\t\tinitFileStore();\n\t\t} else {\n\t\t\tTracker.autorun(function(c) {\n\t\t\t\tif (Meteor.userId() && RocketChat.settings.cachedCollection.ready.get()) {\n\t\t\t\t\tinitFileStore();\n\t\t\t\t\tc.stop();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n}\n","this.i18n_status_func = function(key, options) {\n\treturn TAPi18n.__(key, options);\n};\n","/* globals mixin */\n\n// This will add underscore.string methods to Underscore.js\n// except for include, contains, reverse and join that are\n// dropped because they collide with the functions already\n// defined by Underscore.js.\n\nmixin = function(obj) {\n\t_.each(_.functions(obj), function(name) {\n\t\tif (!_[name] && !_.prototype[name]) {\n\t\t\t_[name] = obj[name];\n\t\t}\n\t});\n};\n\nmixin(s.exports());\n"]}