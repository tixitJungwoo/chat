{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:markdown/markdown.js","meteor://ðŸ’»app/packages/rocketchat:markdown/markdowncode.js"],"names":["MarkdownClass","parse","text","parseNotEscaped","_","escapeHTML","msg","schemes","RocketChat","settings","get","split","join","replace","RegExp","match","title","url","target","indexOf","Meteor","absoluteUrl","window","rocketDebug","undefined","console","log","Markdown","MarkdownMessage","message","trim","html","callbacks","add","priority","HIGH","isClient","Blaze","registerHelper","hljs","module","watch","require","v","MarkdownCode","s","tokens","handle_codeblocks","handle_inlinecode","p1","p2","p3","token","Random","id","push","noHtml","count","length","msgParts","index","part","codeMatch","code","lang","result","singleLine","unescapeHTML","Array","from","listLanguages","includes","highlightAuto","highlight","language","value","stripTags","MarkdownCodeCB"],"mappings":"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","file":"/packages/rocketchat_markdown.js","sourcesContent":["/*\n * Markdown is a named function that will parse markdown syntax\n * @param {Object} message - The message object\n */\n\nclass MarkdownClass {\n\tparse(text) {\n\t\treturn this.parseNotEscaped(_.escapeHTML(text));\n\t}\n\n\tparseNotEscaped(msg) {\n\t\tconst schemes = RocketChat.settings.get('Markdown_SupportSchemesForLink').split(',').join('|');\n\n\t\t// Support ![alt text](http://image url)\n\t\tmsg = msg.replace(new RegExp(`!\\\\[([^\\\\]]+)\\\\]\\\\(((?:${ schemes }):\\\\/\\\\/[^\\\\)]+)\\\\)`, 'gm'), function(match, title, url) {\n\t\t\tconst target = url.indexOf(Meteor.absoluteUrl()) === 0 ? '' : '_blank';\n\t\t\treturn `<a href=\"${ _.escapeHTML(url) }\" title=\"${ _.escapeHTML(title) }\" target=\"${ _.escapeHTML(target) }\"><div class=\"inline-image\" style=\"background-image: url(${ _.escapeHTML(url) });\"></div></a>`;\n\t\t});\n\n\t\t// Support [Text](http://link)\n\t\tmsg = msg.replace(new RegExp(`\\\\[([^\\\\]]+)\\\\]\\\\(((?:${ schemes }):\\\\/\\\\/[^\\\\)]+)\\\\)`, 'gm'), function(match, title, url) {\n\t\t\tconst target = url.indexOf(Meteor.absoluteUrl()) === 0 ? '' : '_blank';\n\t\t\treturn `<a href=\"${ _.escapeHTML(url) }\" target=\"${ _.escapeHTML(target) }\">${ _.escapeHTML(title) }</a>`;\n\t\t});\n\n\t\t// Support <http://link|Text>\n\t\tmsg = msg.replace(new RegExp(`(?:<|&lt;)((?:${ schemes }):\\\\/\\\\/[^\\\\|]+)\\\\|(.+?)(?=>|&gt;)(?:>|&gt;)`, 'gm'), (match, url, title) => {\n\t\t\tconst target = url.indexOf(Meteor.absoluteUrl()) === 0 ? '' : '_blank';\n\t\t\treturn `<a href=\"${ _.escapeHTML(url) }\" target=\"${ _.escapeHTML(target) }\">${ _.escapeHTML(title) }</a>`;\n\t\t});\n\n\t\tif (RocketChat.settings.get('Markdown_Headers')) {\n\t\t\t// Support # Text for h1\n\t\t\tmsg = msg.replace(/^# (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h1>$1</h1>');\n\n\t\t\t// Support # Text for h2\n\t\t\tmsg = msg.replace(/^## (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h2>$1</h2>');\n\n\t\t\t// Support # Text for h3\n\t\t\tmsg = msg.replace(/^### (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h3>$1</h3>');\n\n\t\t\t// Support # Text for h4\n\t\t\tmsg = msg.replace(/^#### (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h4>$1</h4>');\n\t\t}\n\n\t\t// Support *text* to make bold\n\t\tmsg = msg.replace(/(^|&gt;|[ >_~`])\\*{1,2}([^\\*\\r\\n]+)\\*{1,2}([<_~`]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">*</span><strong>$2</strong><span class=\"copyonly\">*</span>$3');\n\n\t\t// Support _text_ to make italics\n\t\tmsg = msg.replace(/(^|&gt;|[ >*~`])\\_([^\\_\\r\\n]+)\\_([<*~`]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">_</span><em>$2</em><span class=\"copyonly\">_</span>$3');\n\n\t\t// Support ~text~ to strike through text\n\t\tmsg = msg.replace(/(^|&gt;|[ >_*`])\\~{1,2}([^~\\r\\n]+)\\~{1,2}([<_*`]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">~</span><strike>$2</strike><span class=\"copyonly\">~</span>$3');\n\n\t\t// Support for block quote\n\t\t// >>>\n\t\t// Text\n\t\t// <<<\n\t\tmsg = msg.replace(/(?:&gt;){3}\\n+([\\s\\S]*?)\\n+(?:&lt;){3}/g, '<blockquote class=\"background-transparent-darker-before\"><span class=\"copyonly\">&gt;&gt;&gt;</span>$1<span class=\"copyonly\">&lt;&lt;&lt;</span></blockquote>');\n\n\t\t// Support >Text for quote\n\t\tmsg = msg.replace(/^&gt;(.*)$/gm, '<blockquote class=\"background-transparent-darker-before\"><span class=\"copyonly\">&gt;</span>$1</blockquote>');\n\n\t\t// Remove white-space around blockquote (prevent <br>). Because blockquote is block element.\n\t\tmsg = msg.replace(/\\s*<blockquote class=\"background-transparent-darker-before\">/gm, '<blockquote class=\"background-transparent-darker-before\">');\n\t\tmsg = msg.replace(/<\\/blockquote>\\s*/gm, '</blockquote>');\n\n\t\t// Remove new-line between blockquotes.\n\t\tmsg = msg.replace(/<\\/blockquote>\\n<blockquote/gm, '</blockquote><blockquote');\n\n\t\tif (typeof window !== 'undefined' && window !== null ? window.rocketDebug : undefined) { console.log('Markdown', msg); }\n\n\t\treturn msg;\n\t}\n}\n\nconst Markdown = new MarkdownClass;\nRocketChat.Markdown = Markdown;\n\n// renderMessage already did html escape\nconst MarkdownMessage = (message) => {\n\tif (_.trim(message != null ? message.html : undefined)) {\n\t\tmessage.html = Markdown.parseNotEscaped(message.html);\n\t}\n\n\treturn message;\n};\n\nRocketChat.callbacks.add('renderMessage', MarkdownMessage, RocketChat.callbacks.priority.HIGH, 'markdown');\n\nif (Meteor.isClient) {\n\tBlaze.registerHelper('RocketChatMarkdown', text => Markdown.parse(text));\n}\n","/*\n * MarkdownCode is a named function that will parse `inline code` and ```codeblock``` syntaxes\n * @param {Object} message - The message object\n */\nimport hljs from 'highlight.js';\n\nclass MarkdownCode {\n\tconstructor(message) {\n\n\t\tif (s.trim(message.html)) {\n\t\t\tif (message.tokens == null) {\n\t\t\t\tmessage.tokens = [];\n\t\t\t}\n\n\t\t\tMarkdownCode.handle_codeblocks(message);\n\t\t\tMarkdownCode.handle_inlinecode(message);\n\n\t\t\tif (window && window.rocketDebug) {\n\t\t\t\tconsole.log('Markdown', message);\n\t\t\t}\n\t\t}\n\n\t\treturn message;\n\t}\n\n\tstatic handle_inlinecode(message) {\n\t\t// Support `text`\n\t\treturn message.html = message.html.replace(/(^|&gt;|[ >_*~])\\`([^`\\r\\n]+)\\`([<_*~]|\\B|\\b|$)/gm, (match, p1, p2, p3) => {\n\t\t\tconst token = `=!=${ Random.id() }=!=`;\n\n\t\t\tmessage.tokens.push({\n\t\t\t\ttoken,\n\t\t\t\ttext: `${ p1 }<span class=\\\"copyonly\\\">\\`</span><span><code class=\\\"code-colors inline\\\">${ p2 }</code></span><span class=\\\"copyonly\\\">\\`</span>${ p3 }`,\n\t\t\t\tnoHtml: match\n\t\t\t});\n\n\t\t\treturn token;\n\t\t});\n\t}\n\n\tstatic handle_codeblocks(message) {\n\t\t// Count occurencies of ```\n\t\tconst count = (message.html.match(/```/g) || []).length;\n\n\t\tif (count) {\n\n\t\t\t// Check if we need to add a final ```\n\t\t\tif ((count % 2) > 0) {\n\t\t\t\tmessage.html = `${ message.html }\\n\\`\\`\\``;\n\t\t\t\tmessage.msg = `${ message.msg }\\n\\`\\`\\``;\n\t\t\t}\n\n\t\t\t// Separate text in code blocks and non code blocks\n\t\t\tconst msgParts = message.html.split(/(^.*)(```(?:[a-zA-Z]+)?(?:(?:.|\\n)*?)```)(.*\\n?)$/gm);\n\n\t\t\tfor (let index = 0; index < msgParts.length; index++) {\n\t\t\t\t// Verify if this part is code\n\t\t\t\tconst part = msgParts[index];\n\t\t\t\tconst codeMatch = part.match(/^```(.*[\\n\\ ]?)([\\s\\S]*?)```+?$/);\n\n\t\t\t\tif (codeMatch != null) {\n\t\t\t\t\t// Process highlight if this part is code\n\t\t\t\t\tlet code;\n\t\t\t\t\tlet lang;\n\t\t\t\t\tlet result;\n\t\t\t\t\tconst singleLine = codeMatch[0].indexOf('\\n') === -1;\n\n\t\t\t\t\tif (singleLine) {\n\t\t\t\t\t\tlang = '';\n\t\t\t\t\t\tcode = _.unescapeHTML(codeMatch[1] + codeMatch[2]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlang = codeMatch[1];\n\t\t\t\t\t\tcode = _.unescapeHTML(codeMatch[2]);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (s.trim(lang) === '') {\n\t\t\t\t\t\tlang = '';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!Array.from(hljs.listLanguages()).includes(s.trim(lang))) {\n\t\t\t\t\t\tresult = hljs.highlightAuto((lang + code));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult = hljs.highlight(s.trim(lang), code);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst token = `=!=${ Random.id() }=!=`;\n\n\t\t\t\t\tmessage.tokens.push({\n\t\t\t\t\t\thighlight: true,\n\t\t\t\t\t\ttoken,\n\t\t\t\t\t\ttext: `<pre><code class='code-colors hljs ${ result.language }'><span class='copyonly'>\\`\\`\\`<br></span>${ result.value }<span class='copyonly'><br>\\`\\`\\`</span></code></pre>`,\n\t\t\t\t\t\tnoHtml: `\\`\\`\\`\\n${ s.stripTags(result.value) }\\n\\`\\`\\``\n\t\t\t\t\t});\n\n\t\t\t\t\tmsgParts[index] = token;\n\t\t\t\t} else {\n\t\t\t\t\tmsgParts[index] = part;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Re-mount message\n\t\t\treturn message.html = msgParts.join('');\n\t\t}\n\t}\n}\n\nRocketChat.MarkdownCode = MarkdownCode;\n\nconst MarkdownCodeCB = (message) => new MarkdownCode(message);\n\n// MarkdownCode gets higher priority over Markdown so it's possible place a callback in between (katex for exmaple)\nRocketChat.callbacks.add('renderMessage', MarkdownCodeCB, RocketChat.callbacks.priority.HIGH - 2, 'markdowncode');\n"]}