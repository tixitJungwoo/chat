{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:push-notifications/client/views/pushNotificationsFlexTab.js","meteor://ðŸ’»app/packages/rocketchat:push-notifications/client/tabBar.js"],"names":["toastr","module","watch","require","v","Template","pushNotificationsFlexTab","helpers","audioAssets","RocketChat","CustomSounds","getList","audioNotification","sub","ChatSubscription","findOne","rid","Session","get","fields","disableNotifications","hideUnreadStatus","desktopNotifications","mobilePushNotifications","emailNotifications","showEmailMentions","t","unreadAlert","unreadAlertText","audioValue","audio","asset","_","findWhere","_id","name","subValue","field","desktopNotificationDuration","editing","instance","emailVerified","Meteor","user","emails","verified","onCreated","ReactiveVar","validateSetting","value","$","val","indexOf","error","saveSetting","duration","call","err","handleError","undefined","set","events","e","keyCode","preventDefault","currentTarget","data","setTimeout","focus","select","$audio","play","settings","preferences","newMessageNotification","attr","startup","TabBar","addButton","groups","id","i18nTitle","icon","template","order"],"mappings":"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","file":"/packages/rocketchat_push-notifications.js","sourcesContent":["import toastr from 'toastr';\n/* globals ChatSubscription */\n\nTemplate.pushNotificationsFlexTab.helpers({\n\taudioAssets() {\n\t\treturn RocketChat.CustomSounds && RocketChat.CustomSounds.getList && RocketChat.CustomSounds.getList() || [];\n\t},\n\taudioNotification() {\n\t\tconst sub = ChatSubscription.findOne({\n\t\t\trid: Session.get('openedRoom')\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\taudioNotification: 1\n\t\t\t}\n\t\t});\n\t\treturn sub ? sub.audioNotification || '' : '';\n\t},\n\tdisableNotifications() {\n\t\tconst sub = ChatSubscription.findOne({\n\t\t\trid: Session.get('openedRoom')\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tdisableNotifications: 1\n\t\t\t}\n\t\t});\n\t\treturn sub ? sub.disableNotifications || false : false;\n\t},\n\thideUnreadStatus() {\n\t\tconst sub = ChatSubscription.findOne({\n\t\t\trid: Session.get('openedRoom')\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\thideUnreadStatus: 1\n\t\t\t}\n\t\t});\n\t\treturn sub ? sub.hideUnreadStatus || false : false;\n\t},\n\tdesktopNotifications() {\n\t\tconst sub = ChatSubscription.findOne({\n\t\t\trid: Session.get('openedRoom')\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tdesktopNotifications: 1\n\t\t\t}\n\t\t});\n\t\treturn sub ? sub.desktopNotifications : '';\n\t},\n\tmobilePushNotifications() {\n\t\tconst sub = ChatSubscription.findOne({\n\t\t\trid: Session.get('openedRoom')\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tmobilePushNotifications: 1\n\t\t\t}\n\t\t});\n\t\treturn sub ? sub.mobilePushNotifications : '';\n\t},\n\temailNotifications() {\n\t\tconst sub = ChatSubscription.findOne({\n\t\t\trid: Session.get('openedRoom')\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\temailNotifications: 1\n\t\t\t}\n\t\t});\n\t\treturn sub ? sub.emailNotifications : '';\n\t},\n\tshowEmailMentions() {\n\t\tconst sub = ChatSubscription.findOne({\n\t\t\trid: Session.get('openedRoom')\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tt: 1\n\t\t\t}\n\t\t});\n\t\treturn sub && sub.t !== 'd';\n\t},\n\tunreadAlert() {\n\t\tconst sub = ChatSubscription.findOne({\n\t\t\trid: Session.get('openedRoom')\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tunreadAlert: 1\n\t\t\t}\n\t\t});\n\t\treturn sub ? sub.unreadAlert : 'default';\n\t},\n\tunreadAlertText() {\n\t\tconst sub = ChatSubscription.findOne({\n\t\t\trid: Session.get('openedRoom')\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tunreadAlert: 1\n\t\t\t}\n\t\t});\n\t\tif (sub) {\n\t\t\tswitch (sub.unreadAlert) {\n\t\t\t\tcase 'all':\n\t\t\t\t\treturn t('On');\n\t\t\t\tcase 'nothing':\n\t\t\t\t\treturn t('Off');\n\t\t\t}\n\t\t}\n\t\treturn t('Use_account_preference');\n\t},\n\taudioValue() {\n\t\tconst sub = ChatSubscription.findOne({\n\t\t\trid: Session.get('openedRoom')\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\taudioNotification: 1\n\t\t\t}\n\t\t});\n\t\tconst audio = sub ? sub.audioNotification || '': '';\n\t\tif (audio === 'none') {\n\t\t\treturn t('None');\n\t\t} else if (audio === '') {\n\t\t\treturn t('Use_account_preference');\n\t\t} else if (audio === 'chime') {\n\t\t\treturn 'Chime';\n\t\t} else {\n\t\t\tconst audioAssets = RocketChat.CustomSounds && RocketChat.CustomSounds.getList && RocketChat.CustomSounds.getList() || [];\n\t\t\tconst asset = _.findWhere(audioAssets, { _id: audio });\n\t\t\treturn asset && asset.name;\n\t\t}\n\t},\n\tsubValue(field) {\n\t\tconst sub = ChatSubscription.findOne({\n\t\t\trid: Session.get('openedRoom')\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tt: 1,\n\t\t\t\t[field]: 1\n\t\t\t}\n\t\t});\n\t\tif (sub) {\n\t\t\tswitch (sub[field]) {\n\t\t\t\tcase 'all':\n\t\t\t\t\treturn t('All_messages');\n\t\t\t\tcase 'nothing':\n\t\t\t\t\treturn t('Nothing');\n\t\t\t\tcase 'default':\n\t\t\t\t\treturn t('Use_account_preference');\n\t\t\t\tcase 'mentions':\n\t\t\t\t\treturn t('Mentions');\n\t\t\t\tdefault:\n\t\t\t\t\tif (field === 'emailNotifications') {\n\t\t\t\t\t\treturn t('Use_account_preference');\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn t('Mentions');\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tdesktopNotificationDuration() {\n\t\tconst sub = ChatSubscription.findOne({\n\t\t\trid: Session.get('openedRoom')\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tdesktopNotificationDuration: 1\n\t\t\t}\n\t\t});\n\t\tif (!sub) {\n\t\t\treturn false;\n\t\t}\n\t\t// Convert to Number\n\t\treturn sub.desktopNotificationDuration - 0;\n\t},\n\tediting(field) {\n\t\treturn Template.instance().editing.get() === field;\n\t},\n\temailVerified() {\n\t\treturn Meteor.user().emails && Meteor.user().emails[0] && Meteor.user().emails[0].verified;\n\t}\n});\n\nTemplate.pushNotificationsFlexTab.onCreated(function() {\n\tthis.editing = new ReactiveVar();\n\n\tthis.validateSetting = (field) => {\n\t\tswitch (field) {\n\t\t\tcase 'audioNotification':\n\t\t\tcase 'hideUnreadStatus':\n\t\t\tcase 'disableNotifications':\n\t\t\t\treturn true;\n\t\t\tdefault:\n\t\t\t\tconst value = this.$(`input[name=${ field }]:checked`).val();\n\t\t\t\tif (['all', 'mentions', 'nothing', 'default'].indexOf(value) === -1) {\n\t\t\t\t\ttoastr.error(t('Invalid_notification_setting_s', value || ''));\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t}\n\t};\n\n\tthis.saveSetting = () => {\n\t\tconst field = this.editing.get();\n\t\tlet value;\n\t\tswitch (field) {\n\t\t\tcase 'audioNotification':\n\t\t\t\tvalue = this.$(`select[name=${ field }]`).val();\n\t\t\t\tbreak;\n\t\t\tcase 'hideUnreadStatus':\n\t\t\tcase 'disableNotifications':\n\t\t\t\tvalue = this.$(`input[name=${ field }]:checked`).val() ? '1' : '0';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tvalue = this.$(`input[name=${ field }]:checked`).val();\n\t\t\t\tbreak;\n\t\t}\n\t\tconst duration = $('input[name=duration]').val();\n\t\tif (this.validateSetting(field)) {\n\t\t\tMeteor.call('saveNotificationSettings', Session.get('openedRoom'), field, value, (err/*, result*/) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn handleError(err);\n\t\t\t\t}\n\t\t\t\tif (duration !== undefined) {\n\t\t\t\t\tMeteor.call('saveDesktopNotificationDuration', Session.get('openedRoom'), duration, (err) => {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn handleError(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.editing.set();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.editing.set();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n});\n\nTemplate.pushNotificationsFlexTab.events({\n\t'keydown input[type=text]'(e, instance) {\n\t\tif (e.keyCode === 13) {\n\t\t\te.preventDefault();\n\t\t\tinstance.saveSetting();\n\t\t}\n\t},\n\n\t'click [data-edit]'(e, instance) {\n\t\te.preventDefault();\n\t\tinstance.editing.set($(e.currentTarget).data('edit'));\n\t\tsetTimeout(function() { instance.$('input.editing').focus().select(); }, 100);\n\t},\n\n\t'click .cancel'(e, instance) {\n\t\te.preventDefault();\n\t\tinstance.editing.set();\n\t},\n\n\t'click .save'(e, instance) {\n\t\te.preventDefault();\n\t\tinstance.saveSetting();\n\t},\n\n\t'click [data-play]'(e) {\n\t\te.preventDefault();\n\t\tlet audio = $(e.currentTarget).data('play');\n\t\tif (audio && audio !== 'none') {\n\t\t\tconst $audio = $(`audio#${ audio }`);\n\t\t\tif ($audio && $audio[0] && $audio[0].play) {\n\t\t\t\t$audio[0].play();\n\t\t\t}\n\t\t} else {\n\t\t\taudio = Meteor.user() && Meteor.user().settings && Meteor.user().settings.preferences && Meteor.user().settings.preferences.newMessageNotification || 'chime';\n\t\t\tif (audio && audio !== 'none') {\n\t\t\t\tconst $audio = $(`audio#${ audio }`);\n\t\t\t\tif ($audio && $audio[0] && $audio[0].play) {\n\t\t\t\t\t$audio[0].play();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t'change select[name=audioNotification]'(e) {\n\t\te.preventDefault();\n\t\tconst audio = $(e.currentTarget).val();\n\t\tif (audio && audio !== 'none') {\n\t\t\tconst $audio = $(`audio#${ audio }`);\n\t\t\tif ($audio && $audio[0] && $audio[0].play) {\n\t\t\t\t$audio[0].play();\n\t\t\t}\n\t\t}\n\t},\n\n\t'change input[type=checkbox]'(e, instance) {\n\t\te.preventDefault();\n\t\tinstance.editing.set($(e.currentTarget).attr('name'));\n\t\tinstance.saveSetting();\n\t}\n});\n","Meteor.startup(function() {\n\tRocketChat.TabBar.addButton({\n\t\tgroups: ['channel', 'group', 'direct'],\n\t\tid: 'push-notifications',\n\t\ti18nTitle: 'Notifications',\n\t\ticon: 'icon-bell-alt',\n\t\ttemplate: 'pushNotificationsFlexTab',\n\t\torder: 2\n\t});\n});\n"]}