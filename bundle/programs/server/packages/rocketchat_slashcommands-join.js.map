{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:slashcommands-join/server.js"],"names":["RocketChat","slashCommands","add","Join","command","params","item","Match","test","String","channel","trim","replace","user","Meteor","users","findOne","userId","room","models","Rooms","findOneByNameAndType","Notifications","notifyUser","_id","Random","id","rid","ts","Date","msg","TAPi18n","__","postProcess","sprintf","language","usernames","includes","username","Error","method","call"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;;;EAMAA,WAAWC,aAAX,CAAyBC,GAAzB,CAA6B,MAA7B;AAAqC,UAASC,IAAT,CAAcC,OAAd,EAAuBC,MAAvB,EAA+BC,IAA/B,EAAqC;AAEzE,MAAIF,YAAY,MAAZ,IAAsB,CAACG,MAAMC,IAAN,CAAWH,MAAX,EAAmBI,MAAnB,CAA3B,EAAuD;AACtD;AACA;;AACD,MAAIC,UAAUL,OAAOM,IAAP,EAAd;;AACA,MAAID,YAAY,EAAhB,EAAoB;AACnB;AACA;;AACDA,YAAUA,QAAQE,OAAR,CAAgB,GAAhB,EAAqB,EAArB,CAAV;AACA,MAAMC,OAAOC,OAAOC,KAAP,CAAaC,OAAb,CAAqBF,OAAOG,MAAP,EAArB,CAAb;AACA,MAAMC,OAAOlB,WAAWmB,MAAX,CAAkBC,KAAlB,CAAwBC,oBAAxB,CAA6CX,OAA7C,EAAsD,GAAtD,CAAb;;AACA,MAAI,CAACQ,IAAL,EAAW;AACVlB,cAAWsB,aAAX,CAAyBC,UAAzB,CAAoCT,OAAOG,MAAP,EAApC,EAAqD,SAArD,EAAgE;AAC/DO,SAAKC,OAAOC,EAAP,EAD0D;AAE/DC,SAAKrB,KAAKqB,GAFqD;AAG/DC,QAAI,IAAIC,IAAJ,EAH2D;AAI/DC,SAAKC,QAAQC,EAAR,CAAW,sBAAX,EAAmC;AACvCC,kBAAa,SAD0B;AAEvCC,cAAS,CAACxB,OAAD;AAF8B,KAAnC,EAGFG,KAAKsB,QAHH;AAJ0D,IAAhE;AASA;;AACD,MAAIjB,KAAKkB,SAAL,CAAeC,QAAf,CAAwBxB,KAAKyB,QAA7B,CAAJ,EAA4C;AAC3C,SAAM,IAAIxB,OAAOyB,KAAX,CAAiB,4BAAjB,EAA+C,gCAA/C,EAAiF;AACtFC,YAAQ;AAD8E,IAAjF,CAAN;AAGA;;AACD1B,SAAO2B,IAAP,CAAY,UAAZ,EAAwBvB,KAAKM,GAA7B;AACA;;AA7BD,QAA8CrB,IAA9C;AAAA,gG","file":"/packages/rocketchat_slashcommands-join.js","sourcesContent":["\n/*\n* Join is a named function that will replace /join commands\n* @param {Object} message - The message object\n*/\n\n\nRocketChat.slashCommands.add('join', function Join(command, params, item) {\n\n\tif (command !== 'join' || !Match.test(params, String)) {\n\t\treturn;\n\t}\n\tlet channel = params.trim();\n\tif (channel === '') {\n\t\treturn;\n\t}\n\tchannel = channel.replace('#', '');\n\tconst user = Meteor.users.findOne(Meteor.userId());\n\tconst room = RocketChat.models.Rooms.findOneByNameAndType(channel, 'c');\n\tif (!room) {\n\t\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t_id: Random.id(),\n\t\t\trid: item.rid,\n\t\t\tts: new Date,\n\t\t\tmsg: TAPi18n.__('Channel_doesnt_exist', {\n\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\tsprintf: [channel]\n\t\t\t}, user.language)\n\t\t});\n\t}\n\tif (room.usernames.includes(user.username)) {\n\t\tthrow new Meteor.Error('error-user-already-in-room', 'You are already in the channel', {\n\t\t\tmethod: 'slashCommands'\n\t\t});\n\t}\n\tMeteor.call('joinRoom', room._id);\n});\n"]}