{"version":3,"sources":["meteor://ðŸ’»app/client/lib/handleError.js","meteor://ðŸ’»app/client/lib/toastr.js","meteor://ðŸ’»app/client/helpers/log.js","meteor://ðŸ’»app/client/helpers/not.js","meteor://ðŸ’»app/client/methods/deleteMessage.js","meteor://ðŸ’»app/client/methods/hideRoom.js","meteor://ðŸ’»app/client/methods/leaveRoom.js","meteor://ðŸ’»app/client/methods/openRoom.js","meteor://ðŸ’»app/client/methods/setUserActiveStatus.js","meteor://ðŸ’»app/client/methods/toggleFavorite.js","meteor://ðŸ’»app/client/methods/updateMessage.js","meteor://ðŸ’»app/client/notifications/UsersNameChanged.js","meteor://ðŸ’»app/client/notifications/notification.js","meteor://ðŸ’»app/client/notifications/updateAvatar.js","meteor://ðŸ’»app/client/routes/adminRouter.js","meteor://ðŸ’»app/client/routes/roomRoute.js","meteor://ðŸ’»app/client/routes/router.js","meteor://ðŸ’»app/client/startup/emailVerification.js","meteor://ðŸ’»app/client/startup/roomObserve.js","meteor://ðŸ’»app/client/startup/startup.js","meteor://ðŸ’»app/client/startup/unread.js","meteor://ðŸ’»app/client/startup/userSetUtcOffset.js","meteor://ðŸ’»app/client/startup/usersObserve.js","meteor://ðŸ’»app/lib/RegExp.js","meteor://ðŸ’»app/lib/fileUpload.js","meteor://ðŸ’»app/lib/francocatena_fix.js","meteor://ðŸ’»app/lib/underscore.string.js"],"names":["toastr","module","watch","require","v","handleError","error","useToastr","_","isObject","details","key","hasOwnProperty","TAPi18n","__","errorTitle","Template","registerHelper","console","log","apply","value","moment","Meteor","methods","deleteMessage","message","userId","ChatMessage","findOne","_id","hasPermission","RocketChat","authz","hasAtLeastOnePermission","rid","deleteAllowed","settings","get","deleteOwn","u","blockDeleteInMinutes","isNumber","ts","msgTs","currentTsDiff","diff","t","Tracker","nonreactive","remove","hideRoom","ChatSubscription","update","$set","alert","open","leaveRoom","ChatRoom","$pull","usernames","user","username","openRoom","setUserActiveStatus","active","users","toggleFavorite","f","updateMessage","originalMessage","editAllowed","editOwn","me","action","blockEditInMinutes","isNaN","TimeSync","serverOffset","editedAt","Date","now","editedBy","callbacks","run","messageObject","msg","attachments","description","undefined","startup","Notifications","onLogged","name","models","Messages","multi","Subscriptions","fname","autorun","onUser","notification","openedRoomId","includes","FlowRouter","getRouteName","Session","hasFocus","readMessage","isEnable","messageIsInOpenedRoom","payload","fireGlobalEvent","fromOpenedRoom","Layout","isEmbedded","KonchatNotification","newMessage","showDesktop","data","updateAvatarOfUsername","route","BlazeLayout","render","center","goToRoomById","roomId","subscription","roomTypes","openRouteLink","current","queryParams","Blaze","path","kw","hash","setRoot","subscriptions","register","subscribe","modal","go","c","subsReady","defer","defaultRoom","room","split","stop","params","getDesktopPermission","saml_idp_credentialToken","Accounts","callLoginMethod","methodArguments","saml","credentialToken","userCallback","group","capitalize","setDefault","set","type","emails","verified","warning","find","observe","added","changed","removed","hljs","initHighlightingOnLoad","window","DISABLE_ANIMATION","options","timeOut","showDuration","hideDuration","extendedTimeOut","loggingEnabled","UserPresence","awayTime","start","lastMessageWindow","lastMessageWindowHistory","conf","i18n_files_route","_relativeToSiteRootUrl","defaultAppLanguage","lng","navigator","userLanguage","language","re","test","replace","match","parts","toUpperCase","defaultUserLanguage","availableLanguages","getLanguages","loadedLanguages","setLanguage","indexOf","push","isRtl","$","addClass","removeClass","shift","toLowerCase","call","err","localeFn","Function","locale","localStorage","getItem","setItem","status","unreadCount","unreadAlert","hideUnreadStatus","$ne","fields","unread","ls","fetch","subscriptionIsTheOpenedRoom","setTimeout","readNow","userUnreadAlert","preferences","RoomManager","openedRooms","refreshUnreadMark","menu","updateUnreadBars","favico","Favico","position","animation","siteName","badge","bgColor","document","title","statusConnection","utcOffset","pictures","phone","services","updateUserStatus","RegExp","escape","s","Cookies","UploadFS","initFileStore","cookie","isClient","_storedLoginToken","fileStore","store","GridFS","collection","Uploads","model","collectionName","filter","Filter","onCheck","FileUpload","validateFileUpload","transformWrite","readStream","writeStream","fileId","file","RocketChatFile","enabled","pipe","stream","identify","format","size","Orientation","gm","autoOrient","onRead","req","res","uid","token","headers","rawCookies","query","rc_uid","rc_token","Users","findOneByIdAndLoginToken","writeHead","setHeader","encodeURIComponent","isServer","cachedCollection","ready","i18n_status_func","mixin","obj","each","functions","prototype","exports"],"mappings":"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","file":"/app.js","sourcesContent":["import toastr from 'toastr';\nthis.handleError = function(error, useToastr = true) {\n\tif (_.isObject(error.details)) {\n\t\tfor (const key in error.details) {\n\t\t\tif (error.details.hasOwnProperty(key)) {\n\t\t\t\terror.details[key] = TAPi18n.__(error.details[key]);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (useToastr) {\n\t\treturn toastr.error(TAPi18n.__(error.error, error.details), error.details && error.details.errorTitle ? TAPi18n.__(error.details.errorTitle) : null);\n\t}\n\n\treturn TAPi18n.__(error.error, error.details);\n};\n","import 'toastr/build/toastr.min.css';\n","Template.registerHelper('log', () => {\n\tconsole.log.apply(console, arguments);\n});\n","Template.registerHelper('not', (value) => {\n\treturn !value;\n});\n","import moment from 'moment';\nimport toastr from 'toastr';\n\nMeteor.methods({\n\tdeleteMessage(message) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn false;\n\t\t}\n\n\t\t//We're now only passed in the `_id` property to lower the amount of data sent to the server\n\t\tmessage = ChatMessage.findOne({ _id: message._id });\n\n\t\tconst hasPermission = RocketChat.authz.hasAtLeastOnePermission('delete-message', message.rid);\n\t\tconst deleteAllowed = RocketChat.settings.get('Message_AllowDeleting');\n\t\tlet deleteOwn = false;\n\t\tif (message && message.u && message.u._id) {\n\t\t\tdeleteOwn = message.u._id === Meteor.userId();\n\t\t}\n\n\t\tif (!(hasPermission || (deleteAllowed && deleteOwn))) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst blockDeleteInMinutes = RocketChat.settings.get('Message_AllowDeleting_BlockDeleteInMinutes');\n\t\tif (_.isNumber(blockDeleteInMinutes) && blockDeleteInMinutes !== 0) {\n\t\t\tif (message.ts) {\n\t\t\t\tconst msgTs = moment(message.ts);\n\t\t\t\tif (msgTs) {\n\t\t\t\t\tconst currentTsDiff = moment().diff(msgTs, 'minutes');\n\t\t\t\t\tif (currentTsDiff > blockDeleteInMinutes) {\n\t\t\t\t\t\ttoastr.error(t('error-message-deleting-blocked'));\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tTracker.nonreactive(function() {\n\t\t\tChatMessage.remove({\n\t\t\t\t_id: message._id,\n\t\t\t\t'u._id': Meteor.userId()\n\t\t\t});\n\t\t});\n\t}\n});\n","Meteor.methods({\n\thideRoom(rid) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tChatSubscription.update({\n\t\t\trid,\n\t\t\t'u._id': Meteor.userId()\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\talert: false,\n\t\t\t\topen: false\n\t\t\t}\n\t\t});\n\t}\n});\n","Meteor.methods({\n\tleaveRoom(rid) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tChatSubscription.remove({\n\t\t\trid,\n\t\t\t'u._id': Meteor.userId()\n\t\t});\n\n\t\tChatRoom.update(rid, {\n\t\t\t$pull: {\n\t\t\t\tusernames: Meteor.user().username\n\t\t\t}\n\t\t});\n\t}\n});\n","Meteor.methods({\n\topenRoom(rid) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tChatSubscription.update({\n\t\t\trid,\n\t\t\t'u._id': Meteor.userId()\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\topen: true\n\t\t\t}\n\t\t});\n\t}\n});\n","Meteor.methods({\n\tsetUserActiveStatus(userId, active) {\n\t\tMeteor.users.update(userId, { $set: { active } });\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\ttoggleFavorite(rid, f) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tChatSubscription.update({\n\t\t\trid,\n\t\t\t'u._id': Meteor.userId()\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tf\n\t\t\t}\n\t\t});\n\t}\n});\n","import moment from 'moment';\nimport toastr from 'toastr';\n\nMeteor.methods({\n\tupdateMessage(message) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst originalMessage = ChatMessage.findOne(message._id);\n\n\t\tconst hasPermission = RocketChat.authz.hasAtLeastOnePermission('edit-message', message.rid);\n\t\tconst editAllowed = RocketChat.settings.get('Message_AllowEditing');\n\t\tlet editOwn = false;\n\t\tif (originalMessage && originalMessage.u && originalMessage.u._id) {\n\t\t\teditOwn = originalMessage.u._id === Meteor.userId();\n\t\t}\n\n\t\tconst me = Meteor.users.findOne(Meteor.userId());\n\n\t\tif (!(hasPermission || (editAllowed && editOwn))) {\n\t\t\ttoastr.error(t('error-action-not-allowed', { action: t('Message_editing') }));\n\t\t\treturn false;\n\t\t}\n\n\t\tconst blockEditInMinutes = RocketChat.settings.get('Message_AllowEditing_BlockEditInMinutes');\n\t\tif (_.isNumber(blockEditInMinutes) && blockEditInMinutes !== 0) {\n\t\t\tif (originalMessage.ts) {\n\t\t\t\tconst msgTs = moment(originalMessage.ts);\n\t\t\t\tif (msgTs) {\n\t\t\t\t\tconst currentTsDiff = moment().diff(msgTs, 'minutes');\n\t\t\t\t\tif (currentTsDiff > blockEditInMinutes) {\n\t\t\t\t\t\ttoastr.error(t('error-message-editing-blocked'));\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tTracker.nonreactive(function() {\n\n\t\t\tif (isNaN(TimeSync.serverOffset())) {\n\t\t\t\tmessage.editedAt = new Date();\n\t\t\t} else {\n\t\t\t\tmessage.editedAt = new Date(Date.now() + TimeSync.serverOffset());\n\t\t\t}\n\n\t\t\tmessage.editedBy = {\n\t\t\t\t_id: Meteor.userId(),\n\t\t\t\tusername: me.username\n\t\t\t};\n\n\t\t\tmessage = RocketChat.callbacks.run('beforeSaveMessage', message);\n\t\t\tconst messageObject = {'editedAt': message.editedAt, 'editedBy': message.editedBy, msg: message.msg};\n\n\t\t\tif (originalMessage.attachments) {\n\t\t\t\tif (originalMessage.attachments[0].description !== undefined) {\n\t\t\t\t\tdelete messageObject.$set.msg;\n\t\t\t\t}\n\t\t\t}\n\t\t\tChatMessage.update({\n\t\t\t\t_id: message._id,\n\t\t\t\t'u._id': Meteor.userId()\n\t\t\t}, {$set : messageObject});\n\t\t});\n\t}\n});\n","Meteor.startup(function() {\n\tRocketChat.Notifications.onLogged('Users:NameChanged', function({_id, name, username}) {\n\t\tRocketChat.models.Messages.update({\n\t\t\t'u._id': _id\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'u.name': name\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\tname: username,\n\t\t\tt: 'd'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tfname: name\n\t\t\t}\n\t\t});\n\t});\n});\n","/* globals KonchatNotification, fireGlobalEvent, readMessage */\n\n// Show notifications and play a sound for new messages.\n// We trust the server to only send notifications for interesting messages, e.g. direct messages or\n// group messages in which the user is mentioned.\n\nMeteor.startup(function() {\n\tTracker.autorun(function() {\n\t\tif (Meteor.userId()) {\n\t\t\tRocketChat.Notifications.onUser('notification', function(notification) {\n\n\t\t\t\tlet openedRoomId = undefined;\n\t\t\t\tif (['channel', 'group', 'direct'].includes(FlowRouter.getRouteName())) {\n\t\t\t\t\topenedRoomId = Session.get('openedRoom');\n\t\t\t\t}\n\n\t\t\t\t// This logic is duplicated in /client/startup/unread.coffee.\n\t\t\t\tconst hasFocus = readMessage.isEnable();\n\t\t\t\tconst messageIsInOpenedRoom = openedRoomId === notification.payload.rid;\n\n\t\t\t\tfireGlobalEvent('notification', {\n\t\t\t\t\tnotification,\n\t\t\t\t\tfromOpenedRoom: messageIsInOpenedRoom,\n\t\t\t\t\thasFocus\n\t\t\t\t});\n\n\t\t\t\tif (RocketChat.Layout.isEmbedded()) {\n\t\t\t\t\tif (!hasFocus && messageIsInOpenedRoom) {\n\t\t\t\t\t\t// Play a sound and show a notification.\n\t\t\t\t\t\tKonchatNotification.newMessage(notification.payload.rid);\n\t\t\t\t\t\tKonchatNotification.showDesktop(notification);\n\t\t\t\t\t}\n\t\t\t\t} else if (!(hasFocus && messageIsInOpenedRoom)) {\n\t\t\t\t\t// Play a sound and show a notification.\n\t\t\t\t\tKonchatNotification.newMessage(notification.payload.rid);\n\t\t\t\t\tKonchatNotification.showDesktop(notification);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n});\n","/* globals updateAvatarOfUsername */\n\nMeteor.startup(function() {\n\tRocketChat.Notifications.onLogged('updateAvatar', function(data) {\n\t\tupdateAvatarOfUsername(data.username);\n\t});\n});\n","FlowRouter.route('/admin/users', {\n\tname: 'admin-users',\n\taction() {\n\t\tBlazeLayout.render('main', {center: 'adminUsers'});\n\t}\n});\n\nFlowRouter.route('/admin/rooms', {\n\tname: 'admin-rooms',\n\taction() {\n\t\tBlazeLayout.render('main', {center: 'adminRooms'});\n\t}\n});\n\nFlowRouter.route('/admin/info', {\n\tname: 'admin-info',\n\taction() {\n\t\tBlazeLayout.render('main', {center: 'adminInfo'});\n\t}\n});\n\nFlowRouter.route('/admin/import', {\n\tname: 'admin-import',\n\taction() {\n\t\tBlazeLayout.render('main', {center: 'adminImport'});\n\t}\n});\n\nFlowRouter.route('/admin/import/prepare/:importer', {\n\tname: 'admin-import-prepare',\n\taction() {\n\t\tBlazeLayout.render('main', {center: 'adminImportPrepare'});\n\t}\n});\n\nFlowRouter.route('/admin/import/progress/:importer', {\n\tname: 'admin-import-progress',\n\taction() {\n\t\tBlazeLayout.render('main', {center: 'adminImportProgress'});\n\t}\n});\n\nFlowRouter.route('/admin/:group?', {\n\tname: 'admin',\n\taction() {\n\t\tBlazeLayout.render('main', {center: 'admin'});\n\t}\n});\n","FlowRouter.goToRoomById = (roomId) => {\n\tconst subscription = ChatSubscription.findOne({rid: roomId});\n\tif (subscription) {\n\t\tRocketChat.roomTypes.openRouteLink(subscription.t, subscription, FlowRouter.current().queryParams);\n\t}\n};\n","/* globals KonchatNotification */\n\nBlaze.registerHelper('pathFor', function (path, kw) {\n    return FlowRouter.path(path, kw.hash);\n});\n\nBlazeLayout.setRoot('body');\n\nFlowRouter.subscriptions = function () {\n    Tracker.autorun(() => {\n        if (Meteor.userId()) {\n            this.register('userData', Meteor.subscribe('userData'));\n            this.register('activeUsers', Meteor.subscribe('activeUsers'));\n        }\n    });\n};\n\n\nFlowRouter.route('/', {\n    name: 'index',\n    action() {\n        BlazeLayout.render('main', {modal: RocketChat.Layout.isEmbedded(), center: 'loading'});\n        if (!Meteor.userId()) {\n            return FlowRouter.go('home');\n        }\n\n        Tracker.autorun(function (c) {\n            if (FlowRouter.subsReady() === true) {\n                Meteor.defer(function () {\n                    if (Meteor.user() && Meteor.user().defaultRoom) {\n                        const room = Meteor.user().defaultRoom.split('/');\n                        FlowRouter.go(room[0], {name: room[1]}, FlowRouter.current().queryParams);\n                    } else {\n                        FlowRouter.go('home');\n                    }\n                });\n                c.stop();\n            }\n        });\n    }\n});\n\n\nFlowRouter.route('/login', {\n    name: 'login',\n\n    action() {\n        FlowRouter.go('home');\n    }\n});\n\nFlowRouter.route('/home', {\n    name: 'home',\n\n    action(params, queryParams) {\n        KonchatNotification.getDesktopPermission();\n        if (queryParams.saml_idp_credentialToken !== undefined) {\n            Accounts.callLoginMethod({\n                methodArguments: [{\n                    saml: true,\n                    credentialToken: queryParams.saml_idp_credentialToken\n                }],\n                userCallback() {\n                    BlazeLayout.render('main', {center: 'home'});\n                }\n            });\n        } else {\n            BlazeLayout.render('main', {center: 'home'});\n        }\n    }\n});\n\nFlowRouter.route('/changeavatar', {\n    name: 'changeAvatar',\n\n    action() {\n        BlazeLayout.render('main', {center: 'avatarPrompt'});\n    }\n});\n\nFlowRouter.route('/account/:group?', {\n    name: 'account',\n\n    action(params) {\n        if (!params.group) {\n            params.group = 'Preferences';\n        }\n        params.group = _.capitalize(params.group, true);\n        BlazeLayout.render('main', {center: `account${ params.group }`});\n    }\n});\n\nFlowRouter.route('/history/private', {\n    name: 'privateHistory',\n\n    subscriptions(/*params, queryParams*/) {\n        this.register('privateHistory', Meteor.subscribe('privateHistory'));\n    },\n\n    action() {\n        Session.setDefault('historyFilter', '');\n        BlazeLayout.render('main', {center: 'privateHistory'});\n    }\n});\n\nFlowRouter.route('/terms-of-service', {\n    name: 'terms-of-service',\n\n    action() {\n        Session.set('cmsPage', 'Layout_Terms_of_Service');\n        BlazeLayout.render('cmsPage');\n    }\n});\n\nFlowRouter.route('/privacy-policy', {\n    name: 'privacy-policy',\n\n    action() {\n        Session.set('cmsPage', 'Layout_Privacy_Policy');\n        BlazeLayout.render('cmsPage');\n    }\n});\n\nFlowRouter.route('/room-not-found/:type/:name', {\n    name: 'room-not-found',\n\n    action(params) {\n        Session.set('roomNotFound', {type: params.type, name: params.name});\n        BlazeLayout.render('main', {center: 'roomNotFound'});\n    }\n});\n\nFlowRouter.route('/fxos', {\n    name: 'firefox-os-install',\n\n    action() {\n        BlazeLayout.render('fxOsInstallPrompt');\n    }\n});\n\nFlowRouter.route('/register/:hash', {\n    name: 'register-secret-url',\n\n    action(/*params*/) {\n        BlazeLayout.render('secretURL');\n\n        // if RocketChat.settings.get('Accounts_RegistrationForm') is 'Secret URL'\n        // \tMeteor.call 'checkRegistrationSecretURL', params.hash, (err, success) ->\n        // \t\tif success\n        // \t\t\tSession.set 'loginDefaultState', 'register'\n        // \t\t\tBlazeLayout.render 'main', {center: 'home'}\n        // \t\t\tKonchatNotification.getDesktopPermission()\n        // \t\telse\n        // \t\t\tBlazeLayout.render 'logoLayout', { render: 'invalidSecretURL' }\n        // else\n        // \tBlazeLayout.render 'logoLayout', { render: 'invalidSecretURL' }\n    }\n});\n","import toastr from 'toastr';\nMeteor.startup(function() {\n\tTracker.autorun(function() {\n\t\tconst user = Meteor.user();\n\t\tif (user && user.emails && user.emails[0] && user.emails[0].verified !== true && RocketChat.settings.get('Accounts_EmailVerification') === true && !Session.get('Accounts_EmailVerification_Warning')) {\n\t\t\ttoastr.warning(TAPi18n.__('You_have_not_verified_your_email'));\n\t\t\tSession.set('Accounts_EmailVerification_Warning', true);\n\t\t}\n\t});\n});\n","Meteor.startup(function() {\n\tChatRoom.find().observe({\n\t\tadded(data) {\n\t\t\tSession.set(`roomData${ data._id }`, data);\n\t\t},\n\t\tchanged(data) {\n\t\t\tSession.set(`roomData${ data._id }`, data);\n\t\t},\n\t\tremoved(data) {\n\t\t\tSession.set(`roomData${ data._id }`, undefined);\n\t\t}\n\t});\n});\n","/* globals UserPresence, fireGlobalEvent, isRtl */\n\nimport moment from 'moment';\nimport toastr from 'toastr';\nimport hljs from 'highlight.js';\nimport 'highlight.js/styles/github.css';\n\nhljs.initHighlightingOnLoad();\n\nif (window.DISABLE_ANIMATION) {\n\ttoastr.options.timeOut = 1;\n\ttoastr.options.showDuration = 0;\n\ttoastr.options.hideDuration = 0;\n\ttoastr.options.extendedTimeOut = 0;\n}\n\nMeteor.startup(function() {\n\tTimeSync.loggingEnabled = false;\n\n\tUserPresence.awayTime = 300000;\n\tUserPresence.start();\n\tMeteor.subscribe('activeUsers');\n\n\tSession.setDefault('AvatarRandom', 0);\n\n\twindow.lastMessageWindow = {};\n\twindow.lastMessageWindowHistory = {};\n\n\tTAPi18n.conf.i18n_files_route = Meteor._relativeToSiteRootUrl('/tap-i18n');\n\n\tconst defaultAppLanguage = function() {\n\t\tlet lng = window.navigator.userLanguage || window.navigator.language || 'en';\n\t\t// Fix browsers having all-lowercase language settings eg. pt-br, en-us\n\t\tconst re = /([a-z]{2}-)([a-z]{2})/;\n\t\tif (re.test(lng)) {\n\t\t\tlng = lng.replace(re, (match, ...parts) => {\n\t\t\t\treturn parts[0] + parts[1].toUpperCase();\n\t\t\t});\n\t\t}\n\t\treturn lng;\n\t};\n\n\twindow.defaultUserLanguage = function() {\n\t\treturn RocketChat.settings.get('Language') || defaultAppLanguage();\n\t};\n\n\tconst availableLanguages = TAPi18n.getLanguages();\n\tconst loadedLanguages = [];\n\n\twindow.setLanguage = function(language) {\n\t\tif (!language) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (loadedLanguages.indexOf(language) > -1) {\n\t\t\treturn;\n\t\t}\n\n\t\tloadedLanguages.push(language);\n\n\t\tif (isRtl(language)) {\n\t\t\t$('html').addClass('rtl');\n\t\t} else {\n\t\t\t$('html').removeClass('rtl');\n\t\t}\n\n\t\tif (!availableLanguages[language]) {\n\t\t\tlanguage = language.split('-').shift();\n\t\t}\n\n\t\tTAPi18n.setLanguage(language);\n\n\t\tlanguage = language.toLowerCase();\n\t\tif (language !== 'en') {\n\t\t\tMeteor.call('loadLocale', language, (err, localeFn) => {\n\t\t\t\tFunction(localeFn).call({moment});\n\t\t\t\tmoment.locale(language);\n\t\t\t});\n\t\t}\n\t};\n\n\tMeteor.subscribe('userData', function() {\n\t\tconst userLanguage = Meteor.user() && Meteor.user().language ? Meteor.user().language : window.defaultUserLanguage();\n\n\t\tif (localStorage.getItem('userLanguage') !== userLanguage) {\n\t\t\tlocalStorage.setItem('userLanguage', userLanguage);\n\t\t}\n\n\t\twindow.setLanguage(userLanguage);\n\n\t\tlet status = undefined;\n\t\tTracker.autorun(function() {\n\t\t\tif (!Meteor.userId()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (Meteor.user() && Meteor.user().status !== status) {\n\t\t\t\tstatus = Meteor.user().status;\n\t\t\t\tfireGlobalEvent('status-changed', status);\n\t\t\t}\n\t\t});\n\t});\n});\n","/* globals fireGlobalEvent, readMessage, Favico, favico, menu */\n\nMeteor.startup(function() {\n\tTracker.autorun(function() {\n\t\tlet unreadCount = 0;\n\t\tlet unreadAlert = false;\n\n\t\tconst subscriptions = ChatSubscription.find({open: true, hideUnreadStatus: { $ne: true }}, { fields: { unread: 1, alert: 1, rid: 1, t: 1, name: 1, ls: 1, unreadAlert: 1 } });\n\n\t\tlet openedRoomId = undefined;\n\t\tTracker.nonreactive(function() {\n\t\t\tif (['channel', 'group', 'direct'].includes(FlowRouter.getRouteName())) {\n\t\t\t\topenedRoomId = Session.get('openedRoom');\n\t\t\t}\n\t\t});\n\n\t\tfor (const subscription of subscriptions.fetch()) {\n\t\t\tfireGlobalEvent('unread-changed-by-subscription', subscription);\n\n\t\t\tif (subscription.alert || subscription.unread > 0) {\n\t\t\t\t// This logic is duplicated in /client/notifications/notification.coffee.\n\t\t\t\tconst hasFocus = readMessage.isEnable();\n\t\t\t\tconst subscriptionIsTheOpenedRoom = openedRoomId === subscription.rid;\n\t\t\t\tif (hasFocus && subscriptionIsTheOpenedRoom) {\n\t\t\t\t\t// The user has probably read all messages in this room.\n\t\t\t\t\t// TODO: readNow() should return whether it has actually marked the room as read.\n\t\t\t\t\tMeteor.setTimeout(function() {\n\t\t\t\t\t\treadMessage.readNow();\n\t\t\t\t\t}, 500);\n\t\t\t\t}\n\n\t\t\t\t// Increment the total unread count.\n\t\t\t\tunreadCount += subscription.unread;\n\t\t\t\tif (subscription.alert === true && subscription.unreadAlert !== 'nothing') {\n\t\t\t\t\tconst userUnreadAlert = Meteor.user() && Meteor.user().settings && Meteor.user().settings.preferences && Meteor.user().settings.preferences.unreadAlert;\n\t\t\t\t\tif (subscription.unreadAlert === 'all' || userUnreadAlert !== false) {\n\t\t\t\t\t\tunreadAlert = 'â€¢';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (RoomManager.openedRooms[subscription.t + subscription.name]) {\n\t\t\t\treadMessage.refreshUnreadMark(subscription.rid);\n\t\t\t}\n\t\t}\n\n\t\tmenu.updateUnreadBars();\n\n\t\tif (unreadCount > 0) {\n\t\t\tif (unreadCount > 999) {\n\t\t\t\tSession.set('unread', '999+');\n\t\t\t} else {\n\t\t\t\tSession.set('unread', unreadCount);\n\t\t\t}\n\t\t} else if (unreadAlert !== false) {\n\t\t\tSession.set('unread', unreadAlert);\n\t\t} else {\n\t\t\tSession.set('unread', '');\n\t\t}\n\t});\n});\n\nMeteor.startup(function() {\n\twindow.favico = new Favico({\n\t\tposition: 'up',\n\t\tanimation: 'none'\n\t});\n\n\tTracker.autorun(function() {\n\t\tconst siteName = RocketChat.settings.get('Site_Name') || '';\n\n\t\tconst unread = Session.get('unread');\n\t\tfireGlobalEvent('unread-changed', unread);\n\n\t\tif (favico) {\n\t\t\tfavico.badge(unread, {\n\t\t\t\tbgColor: typeof unread !== 'number' ? '#3d8a3a' : '#ac1b1b'\n\t\t\t});\n\t\t}\n\n\t\tdocument.title = unread === '' ? siteName : `(${ unread }) ${ siteName }`;\n\t});\n});\n","import moment from 'moment';\n\nMeteor.startup(function() {\n\tTracker.autorun(function() {\n\t\tconst user = Meteor.user();\n\t\tif (user && user.statusConnection === 'online') {\n\t\t\tconst utcOffset = moment().utcOffset() / 60;\n\t\t\tif (user.utcOffset !== utcOffset) {\n\t\t\t\tMeteor.call('userSetUtcOffset', utcOffset);\n\t\t\t}\n\t\t}\n\t});\n});\n","Meteor.startup(function() {\n\tMeteor.users.find({}, { fields: { name: 1, username: 1, pictures: 1, status: 1, emails: 1, phone: 1, services: 1, utcOffset: 1 } }).observe({\n\t\tadded(user) {\n\t\t\tSession.set(`user_${ user.username }_status`, user.status);\n\t\t\tRoomManager.updateUserStatus(user, user.status, user.utcOffset);\n\t\t},\n\t\tchanged(user) {\n\t\t\tSession.set(`user_${ user.username }_status`, user.status);\n\t\t\tRoomManager.updateUserStatus(user, user.status, user.utcOffset);\n\t\t},\n\t\tremoved(user) {\n\t\t\tSession.set(`user_${ user.username }_status`, null);\n\t\t\tRoomManager.updateUserStatus(user, 'offline', null);\n\t\t}\n\t});\n});\n","RegExp.escape = function(s) {\n\treturn s.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n};\n","/* globals UploadFS, FileUpload */\nimport { Cookies } from 'meteor/ostrio:cookies';\n\nif (UploadFS) {\n\tconst initFileStore = function() {\n\t\tconst cookie = new Cookies();\n\t\tif (Meteor.isClient) {\n\t\t\tdocument.cookie = `rc_uid=${ escape(Meteor.userId()) }; path=/`;\n\t\t\tdocument.cookie = `rc_token=${ escape(Accounts._storedLoginToken()) }; path=/`;\n\t\t}\n\n\t\tMeteor.fileStore = new UploadFS.store.GridFS({\n\t\t\tcollection: RocketChat.models.Uploads.model,\n\t\t\tname: 'rocketchat_uploads',\n\t\t\tcollectionName: 'rocketchat_uploads',\n\t\t\tfilter: new UploadFS.Filter({\n\t\t\t\tonCheck: FileUpload.validateFileUpload\n\t\t\t}),\n\t\t\ttransformWrite(readStream, writeStream, fileId, file) {\n\t\t\t\tif (RocketChatFile.enabled === false || !/^image\\/.+/.test(file.type)) {\n\t\t\t\t\treturn readStream.pipe(writeStream);\n\t\t\t\t}\n\n\t\t\t\tlet stream = undefined;\n\n\t\t\t\tconst identify = function(err, data) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn stream.pipe(writeStream);\n\t\t\t\t\t}\n\n\t\t\t\t\tfile.identify = {\n\t\t\t\t\t\tformat: data.format,\n\t\t\t\t\t\tsize: data.size\n\t\t\t\t\t};\n\n\t\t\t\t\tif (data.Orientation && !['', 'Unknown', 'Undefined'].includes(data.Orientation)) {\n\t\t\t\t\t\tRocketChatFile.gm(stream).autoOrient().stream().pipe(writeStream);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstream.pipe(writeStream);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tstream = RocketChatFile.gm(readStream).identify(identify).stream();\n\t\t\t},\n\n\t\t\tonRead(fileId, file, req, res) {\n\t\t\t\tif (RocketChat.settings.get('FileUpload_ProtectFiles')) {\n\t\t\t\t\tlet uid;\n\t\t\t\t\tlet token;\n\n\t\t\t\t\tif (req && req.headers && req.headers.cookie) {\n\t\t\t\t\t\tconst rawCookies = req.headers.cookie;\n\n\t\t\t\t\t\tif (rawCookies) {\n\t\t\t\t\t\t\tuid = cookie.get('rc_uid', rawCookies) ;\n\t\t\t\t\t\t\ttoken = cookie.get('rc_token', rawCookies);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!uid) {\n\t\t\t\t\t\tuid = req.query.rc_uid;\n\t\t\t\t\t\ttoken = req.query.rc_token;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!uid || !token || !RocketChat.models.Users.findOneByIdAndLoginToken(uid, token)) {\n\t\t\t\t\t\tres.writeHead(403);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tres.setHeader('content-disposition', `attachment; filename=\"${ encodeURIComponent(file.name) }\"`);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t};\n\n\tMeteor.startup(function() {\n\t\tif (Meteor.isServer) {\n\t\t\tinitFileStore();\n\t\t} else {\n\t\t\tTracker.autorun(function(c) {\n\t\t\t\tif (Meteor.userId() && RocketChat.settings.cachedCollection.ready.get()) {\n\t\t\t\t\tinitFileStore();\n\t\t\t\t\tc.stop();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n}\n","this.i18n_status_func = function(key, options) {\n\treturn TAPi18n.__(key, options);\n};\n","/* globals mixin */\n\n// This will add underscore.string methods to Underscore.js\n// except for include, contains, reverse and join that are\n// dropped because they collide with the functions already\n// defined by Underscore.js.\n\nmixin = function(obj) {\n\t_.each(_.functions(obj), function(name) {\n\t\tif (!_[name] && !_.prototype[name]) {\n\t\t\t_[name] = obj[name];\n\t\t}\n\t});\n};\n\nmixin(s.exports());\n"]}