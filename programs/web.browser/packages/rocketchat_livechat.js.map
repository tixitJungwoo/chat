{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:livechat/messageTypes.js","meteor://ðŸ’»app/packages/rocketchat:livechat/roomType.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/ui.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/route.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/collections/AgentUsers.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/collections/LivechatCustomField.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/collections/LivechatDepartment.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/collections/LivechatDepartmentAgents.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/collections/LivechatIntegration.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/collections/LivechatPageVisited.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/collections/LivechatQueueUser.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/collections/LivechatTrigger.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/collections/LivechatInquiry.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/collections/livechatOfficeHour.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/methods/changeLivechatStatus.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/livechatAppearance.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/livechatCurrentChats.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/livechatCustomFields.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/livechatCustomFieldForm.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/livechatDepartmentForm.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/livechatDepartments.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/livechatInstallation.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/livechatIntegrations.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/livechatQueue.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/livechatTriggers.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/livechatTriggersForm.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/livechatUsers.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/livechatOfficeHours.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/tabbar/externalSearch.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/tabbar/visitorHistory.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/tabbar/visitorNavigation.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/tabbar/visitorEdit.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/tabbar/visitorForward.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/tabbar/visitorInfo.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/triggers/livechatTriggerAction.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/app/triggers/livechatTriggerCondition.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/sideNav/livechat.js","meteor://ðŸ’»app/packages/rocketchat:livechat/client/views/sideNav/livechatFlex.js","meteor://ðŸ’»app/packages/rocketchat:livechat/server/models/LivechatExternalMessage.js"],"names":["RocketChat","MessageTypes","registerType","id","system","message","actionLinks","register","params","instance","Meteor","isClient","tabBar","open","isServer","user","models","Messages","createWithTypeRoomIdMessageAndUser","rid","Notifications","notifyRoom","_id","language","settings","get","Livechat","closeRoom","room","Rooms","findOneById","comment","TAPi18n","__","lng","defer","setHiddenById","roomTypes","add","template","icon","route","name","path","action","openRoom","code","link","sub","findRoom","identifier","ChatRoom","findOne","parseInt","roomName","roomData","label","condition","authz","hasAllPermission","canSendMessage","roomId","fields","getUserStatus","guestName","Session","v","username","inquiry","LivechatInquiry","notSubscribedTpl","AccountBox","addItem","href","sideNav","TabBar","addButton","groups","i18nTitle","order","addGroup","data","msg","livechatManagerRoutes","FlowRouter","group","prefix","addRoute","i18nPageTitle","pageTemplate","AgentUsers","Mongo","Collection","LivechatCustomField","LivechatDepartment","LivechatDepartmentAgents","LivechatIntegration","LivechatPageVisited","LivechatQueueUser","LivechatTrigger","LivechatOfficeHour","methods","userId","newStatus","statusLivechat","users","update","$set","moment","module","watch","require","toastr","LivechatAppearance","Template","livechatAppearance","helpers","previewState","showOnline","indexOf","showOfflineForm","state","showOfflineSuccess","showOfflineUnavailable","color","title","colorOffline","titleOffline","offlineMessage","sampleOfflineMessage","replace","offlineSuccessMessage","sampleOfflineSuccessMessage","displayOfflineFormTrueChecked","displayOfflineForm","displayOfflineFormFalseChecked","offlineUnavailableMessage","sampleOfflineUnavailableMessage","emailOffline","offlineEmail","sampleColor","sampleTitle","sampleData","messages","Random","u","time","ts","format","date","body","sequential","onCreated","subscribe","ReactiveVar","autorun","setting","set","value","events","e","currentTarget","type","preventDefault","settingTitle","settingTitleColor","settingDiplayOffline","settingFormUnavailable","settingOfflineMessage","settingOfflineSuccess","settingOfflineTitle","settingOfflineTitleColor","_","trim","$","val","call","err","handleError","success","t","onRendered","setTimeout","each","index","el","jscolor","LivechatRoom","livechatCurrentChats","livechatRoom","find","sort","startedAt","lastMessage","lm","servedBy","status","agents","go","event","limit","filter","isEmpty","from","localeData","longDateFormat","toDate","to","datepicker","autoclose","todayHighlight","toLowerCase","livechatCustomFields","customFields","stopPropagation","swal","showCancelButton","confirmButtonColor","confirmButtonText","cancelButtonText","closeOnConfirm","html","error","text","timer","showConfirmButton","livechatCustomFieldForm","customField","$btn","field","scope","visibility","test","oldBtnValue","customFieldData","getParam","ready","livechatDepartmentForm","department","selectedAgents","sortBy","availableAgents","selected","pluck","$nin","showOnRegistration","undefined","enabled","description","departmentData","departmentAgents","forEach","agent","count","agentId","push","reject","clone","newSelectedAgents","departmentId","livechatDepartments","departments","livechatInstallation","script","siteUrl","s","rtrim","livechatIntegrations","webhookUrl","secretToken","disableTest","sendOnCloseChecked","sendOnOfflineChecked","webhook","webhookOnClose","webhookOnOfflineMsg","checked","livechatQueue","showOffline","options","userFilter","$ne","agentFilter","hasPermission","Users","hasRole","livechatTriggers","triggers","livechatTriggersForm","trigger","conditions","actions","ManagerUsers","startup","livechatUsers","managers","emailAddress","emails","length","address","agentAutocompleteSettings","rules","collection","subscription","userSearch","noMatchTemplate","userSearchEmpty","matchAll","exceptions","map","fetch","selector","match","term","managerAutocompleteSettings","elements","reset","livechatOfficeHours","days","startName","day","finishName","openName","start","dayVars","finish","enableOfficeHoursTrueChecked","enableOfficeHours","enableOfficeHoursFalseChecked","temp","split","newTime","isSameOrBefore","isSameOrAfter","target","d","hasOwnProperty","start_utc","utc","finish_utc","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday","subscriptionsReady","local","externalSearch","LivechatExternalMessage","findByRoomId","focus","currentData","visitorHistory","historyLoaded","loadHistory","previousChats","visitorId","visitorNavigation","loadingNavigation","pageVisited","token","pageTitle","page","accessDateTime","visitorEdit","visitor","email","visitorEmails","phone","phoneNumber","joinTags","tags","join","console","log","userData","topic","save","cancel","visitorForward","hasDepartments","agentName","transferData","result","warning","UAParser","visitorInfo","userAgent","ua","setUA","os","getOS","version","osIcon","browser","getBrowser","browserIcon","livechatData","extend","findWhere","createdAt","lastLogin","editing","forwarding","editDetails","forwardDetails","roomOpen","guestPool","showDetail","canSeeButtons","Subscriptions","inputPlaceholder","inputValue","showInputError","cancelButtonColor","livechatTriggerAction","hiddenValue","current","firstAction","addClass","removeClass","livechatTriggerCondition","firstCondition","conditionSelected","valueFor","livechat","isActive","query","f","ChatSubscription","rooms","preferences","unreadRoomsMode","alert","inquiries","inqs","inq","KonchatNotification","newRoom","available","hint","livechatAvailable","isLivechatAvailable","showQueueLink","activeLivechatQueue","watchPathChange","isConfirm","openRouteLink","livechatFlex","active","routes","SideNav","overArrow","leaveArrow","closeFlex","_initModel","_Base"],"mappings":"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","file":"/packages/rocketchat_livechat.js","sourcesContent":["RocketChat.MessageTypes.registerType({\n\tid: 'livechat_video_call',\n\tsystem: true,\n\tmessage: 'New_videocall_request'\n});\n\nRocketChat.actionLinks.register('createLivechatCall', function(message, params, instance) {\n\tif (Meteor.isClient) {\n\t\tinstance.tabBar.open('video');\n\t}\n});\n\nRocketChat.actionLinks.register('denyLivechatCall', function(message/*, params*/) {\n\tif (Meteor.isServer) {\n\t\tconst user = Meteor.user();\n\n\t\tRocketChat.models.Messages.createWithTypeRoomIdMessageAndUser('command', message.rid, 'endCall', user);\n\t\tRocketChat.Notifications.notifyRoom(message.rid, 'deleteMessage', { _id: message._id });\n\n\t\tconst language = user.language || RocketChat.settings.get('language') || 'en';\n\n\t\tRocketChat.Livechat.closeRoom({\n\t\t\tuser,\n\t\t\troom: RocketChat.models.Rooms.findOneById(message.rid),\n\t\t\tcomment: TAPi18n.__('Videocall_declined', { lng: language })\n\t\t});\n\t\tMeteor.defer(() => {\n\t\t\tRocketChat.models.Messages.setHiddenById(message._id);\n\t\t});\n\t}\n});\n","/* globals openRoom, LivechatInquiry */\n\nRocketChat.roomTypes.add('l', 5, {\n\ttemplate: 'livechat',\n\ticon: 'icon-chat-empty',\n\troute: {\n\t\tname: 'live',\n\t\tpath: '/live/:code(\\\\d+)',\n\t\taction(params/*, queryParams*/) {\n\t\t\topenRoom('l', params.code);\n\t\t},\n\t\tlink(sub) {\n\t\t\treturn {\n\t\t\t\tcode: sub.code\n\t\t\t};\n\t\t}\n\t},\n\n\tfindRoom(identifier) {\n\t\treturn ChatRoom.findOne({ code: parseInt(identifier) });\n\t},\n\n\troomName(roomData) {\n\t\tif (!roomData.name) {\n\t\t\treturn roomData.label;\n\t\t} else {\n\t\t\treturn roomData.name;\n\t\t}\n\t},\n\n\tcondition() {\n\t\treturn RocketChat.settings.get('Livechat_enabled') && RocketChat.authz.hasAllPermission('view-l-room');\n\t},\n\n\tcanSendMessage(roomId) {\n\t\tconst room = ChatRoom.findOne({ _id: roomId }, { fields: { open: 1 } });\n\t\treturn room && room.open === true;\n\t},\n\n\tgetUserStatus(roomId) {\n\t\tlet guestName;\n\t\tconst room = Session.get(`roomData${ roomId }`);\n\n\t\tif (room) {\n\t\t\tguestName = room.v && room.v.username;\n\t\t} else {\n\t\t\tconst inquiry = LivechatInquiry.findOne({ rid: roomId });\n\t\t\tguestName = inquiry && inquiry.v && inquiry.v.username;\n\t\t}\n\n\t\tif (guestName) {\n\t\t\treturn Session.get(`user_${ guestName }_status`);\n\t\t}\n\t},\n\n\tnotSubscribedTpl: {\n\t\ttemplate: 'livechatNotSubscribed'\n\t}\n});\n","AccountBox.addItem({\n\tname: 'Livechat',\n\ticon: 'icon-chat-empty',\n\thref: 'livechat-current-chats',\n\tsideNav: 'livechatFlex',\n\tcondition: () => {\n\t\treturn RocketChat.settings.get('Livechat_enabled') && RocketChat.authz.hasAllPermission('view-livechat-manager');\n\t}\n});\n\nRocketChat.TabBar.addButton({\n\tgroups: ['live'],\n\tid: 'visitor-info',\n\ti18nTitle: 'Visitor_Info',\n\ticon: 'icon-info-circled',\n\ttemplate: 'visitorInfo',\n\torder: 0\n});\n\n// RocketChat.TabBar.addButton({\n// \tgroups: ['livechat'],\n// \tid: 'visitor-navigation',\n// \ti18nTitle: 'Visitor_Navigation',\n// \ticon: 'icon-history',\n// \ttemplate: 'visitorNavigation',\n// \torder: 10\n// });\n\nRocketChat.TabBar.addButton({\n\tgroups: ['live'],\n\tid: 'visitor-history',\n\ti18nTitle: 'Past_Chats',\n\ticon: 'icon-chat',\n\ttemplate: 'visitorHistory',\n\torder: 11\n});\n\nRocketChat.TabBar.addGroup('message-search', ['live']);\nRocketChat.TabBar.addGroup('starred-messages', ['live']);\nRocketChat.TabBar.addGroup('uploaded-files-list', ['live']);\nRocketChat.TabBar.addGroup('push-notifications', ['live']);\nRocketChat.TabBar.addGroup('video', ['live']);\n\nRocketChat.TabBar.addButton({\n\tgroups: ['live'],\n\tid: 'external-search',\n\ti18nTitle: 'Knowledge_Base',\n\ticon: 'icon-lightbulb',\n\ttemplate: 'externalSearch',\n\torder: 10\n});\n\nRocketChat.MessageTypes.registerType({\n\tid: 'livechat-close',\n\tsystem: true,\n\tmessage: 'Conversation_closed',\n\tdata(message) {\n\t\treturn {\n\t\t\tcomment: message.msg\n\t\t};\n\t}\n});\n","livechatManagerRoutes = FlowRouter.group({\n\tprefix: '/livechat-manager',\n\tname: 'livechat-manager'\n});\n\nAccountBox.addRoute({\n\tname: 'livechat-dashboard',\n\tpath: '/dashboard',\n\tsideNav: 'livechatFlex',\n\ti18nPageTitle: 'Livechat_Dashboard',\n\tpageTemplate: 'livechatDashboard'\n}, livechatManagerRoutes);\n\nAccountBox.addRoute({\n\tname: 'livechat-current-chats',\n\tpath: '/current',\n\tsideNav: 'livechatFlex',\n\ti18nPageTitle: 'Current_Chats',\n\tpageTemplate: 'livechatCurrentChats'\n}, livechatManagerRoutes);\n\nAccountBox.addRoute({\n\tname: 'livechat-users',\n\tpath: '/users',\n\tsideNav: 'livechatFlex',\n\ti18nPageTitle: 'Livechat_Users',\n\tpageTemplate: 'livechatUsers'\n}, livechatManagerRoutes);\n\nAccountBox.addRoute({\n\tname: 'livechat-departments',\n\tpath: '/departments',\n\tsideNav: 'livechatFlex',\n\ti18nPageTitle: 'Departments',\n\tpageTemplate: 'livechatDepartments'\n}, livechatManagerRoutes);\n\nAccountBox.addRoute({\n\tname: 'livechat-department-edit',\n\tpath: '/departments/:_id/edit',\n\tsideNav: 'livechatFlex',\n\ti18nPageTitle: 'Edit_Department',\n\tpageTemplate: 'livechatDepartmentForm'\n}, livechatManagerRoutes);\n\nAccountBox.addRoute({\n\tname: 'livechat-department-new',\n\tpath: '/departments/new',\n\tsideNav: 'livechatFlex',\n\ti18nPageTitle: 'New_Department',\n\tpageTemplate: 'livechatDepartmentForm'\n}, livechatManagerRoutes);\n\nAccountBox.addRoute({\n\tname: 'livechat-triggers',\n\tpath: '/triggers',\n\tsideNav: 'livechatFlex',\n\ti18nPageTitle: 'Triggers',\n\tpageTemplate: 'livechatTriggers'\n}, livechatManagerRoutes);\n\nAccountBox.addRoute({\n\tname: 'livechat-trigger-edit',\n\tpath: '/triggers/:_id/edit',\n\tsideNav: 'livechatFlex',\n\ti18nPageTitle: 'Edit_Trigger',\n\tpageTemplate: 'livechatTriggersForm'\n}, livechatManagerRoutes);\n\nAccountBox.addRoute({\n\tname: 'livechat-trigger-new',\n\tpath: '/triggers/new',\n\tsideNav: 'livechatFlex',\n\ti18nPageTitle: 'New_Trigger',\n\tpageTemplate: 'livechatTriggersForm'\n}, livechatManagerRoutes);\n\nAccountBox.addRoute({\n\tname: 'livechat-installation',\n\tpath: '/installation',\n\tsideNav: 'livechatFlex',\n\ti18nPageTitle: 'Installation',\n\tpageTemplate: 'livechatInstallation'\n}, livechatManagerRoutes);\n\nAccountBox.addRoute({\n\tname: 'livechat-appearance',\n\tpath: '/appearance',\n\tsideNav: 'livechatFlex',\n\ti18nPageTitle: 'Appearance',\n\tpageTemplate: 'livechatAppearance'\n}, livechatManagerRoutes);\n\nAccountBox.addRoute({\n\tname: 'livechat-officeHours',\n\tpath: '/officeHours',\n\tsideNav: 'livechatFlex',\n\ti18nPageTitle: 'Office_Hours',\n\tpageTemplate: 'livechatOfficeHours'\n}, livechatManagerRoutes);\n\nAccountBox.addRoute({\n\tname: 'livechat-customfields',\n\tpath: '/customfields',\n\tsideNav: 'livechatFlex',\n\ti18nPageTitle: 'Custom_Fields',\n\tpageTemplate: 'livechatCustomFields'\n}, livechatManagerRoutes);\n\nAccountBox.addRoute({\n\tname: 'livechat-customfield-edit',\n\tpath: '/customfields/:_id/edit',\n\tsideNav: 'livechatFlex',\n\ti18nPageTitle: 'Edit_Custom_Field',\n\tpageTemplate: 'livechatCustomFieldForm'\n}, livechatManagerRoutes);\n\nAccountBox.addRoute({\n\tname: 'livechat-customfield-new',\n\tpath: '/customfields/new',\n\tsideNav: 'livechatFlex',\n\ti18nPageTitle: 'New_Custom_Field',\n\tpageTemplate: 'livechatCustomFieldForm'\n}, livechatManagerRoutes);\n\nAccountBox.addRoute({\n\tname: 'livechat-integrations',\n\tpath: '/integrations',\n\tsideNav: 'livechatFlex',\n\ti18nPageTitle: 'Integrations',\n\tpageTemplate: 'livechatIntegrations'\n}, livechatManagerRoutes);\n\nAccountBox.addRoute({\n\tname: 'livechat-queue',\n\tpath: '/livechat-queue',\n\ti18nPageTitle: 'Livechat_Queue',\n\tpageTemplate: 'livechatQueue'\n});\n\n\n","this.AgentUsers = new Mongo.Collection('agentUsers');\n","this.LivechatCustomField = new Mongo.Collection('rocketchat_livechat_custom_field');\n","this.LivechatDepartment = new Mongo.Collection('rocketchat_livechat_department');\n","this.LivechatDepartmentAgents = new Mongo.Collection('rocketchat_livechat_department_agents');\n","this.LivechatIntegration = new Mongo.Collection('livechatIntegration');\n","this.LivechatPageVisited = new Mongo.Collection('rocketchat_livechat_page_visited');\n","this.LivechatQueueUser = new Mongo.Collection('livechatQueueUser');\n","this.LivechatTrigger = new Mongo.Collection('rocketchat_livechat_trigger');\n","this.LivechatInquiry = new Mongo.Collection('rocketchat_livechat_inquiry');\n","this.LivechatOfficeHour = new Mongo.Collection('rocketchat_livechat_office_hour');\n","Meteor.methods({\n\t'livechat:changeLivechatStatus'() {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tconst newStatus = user.statusLivechat === 'available' ? 'not-available' : 'available';\n\n\t\tMeteor.users.update(user._id, { $set: { statusLivechat: newStatus }});\n\t}\n});\n","/*globals jscolor*/\n/*eslint new-cap: [\"error\", { \"newIsCapExceptions\": [\"jscolor\"] }]*/\nimport moment from 'moment';\nimport toastr from 'toastr';\n\nconst LivechatAppearance = new Mongo.Collection('livechatAppearance');\n\nTemplate.livechatAppearance.helpers({\n\tpreviewState() {\n\t\treturn Template.instance().previewState.get();\n\t},\n\tshowOnline() {\n\t\treturn Template.instance().previewState.get().indexOf('offline') === -1;\n\t},\n\tshowOfflineForm() {\n\t\tconst state = Template.instance().previewState.get();\n\t\treturn state === 'opened-offline' || state === 'closed-offline';\n\t},\n\tshowOfflineSuccess() {\n\t\treturn Template.instance().previewState.get() === 'offline-success';\n\t},\n\tshowOfflineUnavailable() {\n\t\treturn Template.instance().previewState.get() === 'offline-unavailable';\n\t},\n\tcolor() {\n\t\treturn Template.instance().color.get();\n\t},\n\ttitle() {\n\t\treturn Template.instance().title.get();\n\t},\n\tcolorOffline() {\n\t\treturn Template.instance().colorOffline.get();\n\t},\n\ttitleOffline() {\n\t\treturn Template.instance().titleOffline.get();\n\t},\n\tofflineMessage() {\n\t\treturn Template.instance().offlineMessage.get();\n\t},\n\tsampleOfflineMessage() {\n\t\treturn Template.instance().offlineMessage.get().replace(/([^>\\r\\n]?)(\\r\\n|\\n\\r|\\r|\\n)/g, '$1<br>$2');\n\t},\n\tofflineSuccessMessage() {\n\t\treturn Template.instance().offlineSuccessMessage.get();\n\t},\n\tsampleOfflineSuccessMessage() {\n\t\treturn Template.instance().offlineSuccessMessage.get().replace(/([^>\\r\\n]?)(\\r\\n|\\n\\r|\\r|\\n)/g, '$1<br>$2');\n\t},\n\tdisplayOfflineFormTrueChecked() {\n\t\tif (Template.instance().displayOfflineForm.get()) {\n\t\t\treturn 'checked';\n\t\t}\n\t},\n\tdisplayOfflineFormFalseChecked() {\n\t\tif (!Template.instance().displayOfflineForm.get()) {\n\t\t\treturn 'checked';\n\t\t}\n\t},\n\tofflineUnavailableMessage() {\n\t\treturn Template.instance().offlineUnavailableMessage.get();\n\t},\n\tsampleOfflineUnavailableMessage() {\n\t\treturn Template.instance().offlineUnavailableMessage.get().replace(/([^>\\r\\n]?)(\\r\\n|\\n\\r|\\r|\\n)/g, '$1<br>$2');\n\t},\n\temailOffline() {\n\t\treturn Template.instance().offlineEmail.get();\n\t},\n\tsampleColor() {\n\t\tif (Template.instance().previewState.get().indexOf('offline') !== -1) {\n\t\t\treturn Template.instance().colorOffline.get();\n\t\t} else {\n\t\t\treturn Template.instance().color.get();\n\t\t}\n\t},\n\tsampleTitle() {\n\t\tif (Template.instance().previewState.get().indexOf('offline') !== -1) {\n\t\t\treturn Template.instance().titleOffline.get();\n\t\t} else {\n\t\t\treturn Template.instance().title.get();\n\t\t}\n\t},\n\tsampleData() {\n\t\treturn {\n\t\t\tmessages: [\n\t\t\t\t{\n\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\tu: {\n\t\t\t\t\t\tusername: 'guest'\n\t\t\t\t\t},\n\t\t\t\t\ttime: moment(this.ts).format('LT'),\n\t\t\t\t\tdate: moment(this.ts).format('LL'),\n\t\t\t\t\tbody: 'Hello',\n\t\t\t\t\tsequential: null\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\tu: {\n\t\t\t\t\t\tusername: 'rocketchat-agent'\n\t\t\t\t\t},\n\t\t\t\t\ttime: moment(this.ts).format('LT'),\n\t\t\t\t\tdate: moment(this.ts).format('LL'),\n\t\t\t\t\tbody: 'Hey, what can I help you with?',\n\t\t\t\t\tsequential: null\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\tu: {\n\t\t\t\t\t\tusername: 'guest'\n\t\t\t\t\t},\n\t\t\t\t\ttime: moment(this.ts).format('LT'),\n\t\t\t\t\tdate: moment(this.ts).format('LL'),\n\t\t\t\t\tbody: 'I\\'m looking for informations about your product.',\n\t\t\t\t\tsequential: null\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\tu: {\n\t\t\t\t\t\tusername: 'rocketchat-agent'\n\t\t\t\t\t},\n\t\t\t\t\ttime: moment(this.ts).format('LT'),\n\t\t\t\t\tdate: moment(this.ts).format('LL'),\n\t\t\t\t\tbody: 'Our product is open source, you can do what you want with it! =D',\n\t\t\t\t\tsequential: null\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\tu: {\n\t\t\t\t\t\tusername: 'guest'\n\t\t\t\t\t},\n\t\t\t\t\ttime: moment(this.ts).format('LT'),\n\t\t\t\t\tdate: moment(this.ts).format('LL'),\n\t\t\t\t\tbody: 'Yay, thanks. That\\'s awesome.',\n\t\t\t\t\tsequential: null\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\tu: {\n\t\t\t\t\t\tusername: 'rocketchat-agent'\n\t\t\t\t\t},\n\t\t\t\t\ttime: moment(this.ts).format('LT'),\n\t\t\t\t\tdate: moment(this.ts).format('LL'),\n\t\t\t\t\tbody: 'You\\'re welcome.',\n\t\t\t\t\tsequential: null\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n});\n\nTemplate.livechatAppearance.onCreated(function() {\n\tthis.subscribe('livechat:appearance');\n\n\tthis.previewState = new ReactiveVar('opened');\n\n\tthis.title = new ReactiveVar(null);\n\tthis.color = new ReactiveVar(null);\n\n\tthis.displayOfflineForm = new ReactiveVar(null);\n\tthis.offlineUnavailableMessage = new ReactiveVar(null);\n\tthis.offlineMessage = new ReactiveVar(null);\n\tthis.offlineSuccessMessage = new ReactiveVar(null);\n\tthis.titleOffline = new ReactiveVar(null);\n\tthis.colorOffline = new ReactiveVar(null);\n\tthis.offlineEmail = new ReactiveVar(null);\n\n\tthis.autorun(() => {\n\t\tconst setting = LivechatAppearance.findOne('Livechat_title');\n\t\tthis.title.set(setting && setting.value);\n\t});\n\tthis.autorun(() => {\n\t\tconst setting = LivechatAppearance.findOne('Livechat_title_color');\n\t\tthis.color.set(setting && setting.value);\n\t});\n\tthis.autorun(() => {\n\t\tconst setting = LivechatAppearance.findOne('Livechat_display_offline_form');\n\t\tthis.displayOfflineForm.set(setting && setting.value);\n\t});\n\tthis.autorun(() => {\n\t\tconst setting = LivechatAppearance.findOne('Livechat_offline_form_unavailable');\n\t\tthis.offlineUnavailableMessage.set(setting && setting.value);\n\t});\n\tthis.autorun(() => {\n\t\tconst setting = LivechatAppearance.findOne('Livechat_offline_message');\n\t\tthis.offlineMessage.set(setting && setting.value);\n\t});\n\tthis.autorun(() => {\n\t\tconst setting = LivechatAppearance.findOne('Livechat_offline_success_message');\n\t\tthis.offlineSuccessMessage.set(setting && setting.value);\n\t});\n\tthis.autorun(() => {\n\t\tconst setting = LivechatAppearance.findOne('Livechat_offline_title');\n\t\tthis.titleOffline.set(setting && setting.value);\n\t});\n\tthis.autorun(() => {\n\t\tconst setting = LivechatAppearance.findOne('Livechat_offline_title_color');\n\t\tthis.colorOffline.set(setting && setting.value);\n\t});\n\tthis.autorun(() => {\n\t\tconst setting = LivechatAppearance.findOne('Livechat_offline_email');\n\t\tthis.offlineEmail.set(setting && setting.value);\n\t});\n});\n\nTemplate.livechatAppearance.events({\n\t'change .preview-mode'(e, instance) {\n\t\tinstance.previewState.set(e.currentTarget.value);\n\t},\n\t'change .preview-settings, keyup .preview-settings'(e, instance) {\n\t\tlet value = e.currentTarget.value;\n\t\tif (e.currentTarget.type === 'radio') {\n\t\t\tvalue = value === 'true';\n\t\t}\n\t\tinstance[e.currentTarget.name].set(value);\n\t},\n\t'click .reset-settings'(e, instance) {\n\t\te.preventDefault();\n\n\t\tconst settingTitle = LivechatAppearance.findOne('Livechat_title');\n\t\tinstance.title.set(settingTitle && settingTitle.value);\n\n\t\tconst settingTitleColor = LivechatAppearance.findOne('Livechat_title_color');\n\t\tinstance.color.set(settingTitleColor && settingTitleColor.value);\n\n\t\tconst settingDiplayOffline = LivechatAppearance.findOne('Livechat_display_offline_form');\n\t\tinstance.displayOfflineForm.set(settingDiplayOffline && settingDiplayOffline.value);\n\n\t\tconst settingFormUnavailable = LivechatAppearance.findOne('Livechat_offline_form_unavailable');\n\t\tinstance.offlineUnavailableMessage.set(settingFormUnavailable && settingFormUnavailable.value);\n\n\t\tconst settingOfflineMessage = LivechatAppearance.findOne('Livechat_offline_message');\n\t\tinstance.offlineMessage.set(settingOfflineMessage && settingOfflineMessage.value);\n\n\t\tconst settingOfflineSuccess = LivechatAppearance.findOne('Livechat_offline_success_message');\n\t\tinstance.offlineSuccessMessage.set(settingOfflineSuccess && settingOfflineSuccess.value);\n\n\t\tconst settingOfflineTitle = LivechatAppearance.findOne('Livechat_offline_title');\n\t\tinstance.titleOffline.set(settingOfflineTitle && settingOfflineTitle.value);\n\n\t\tconst settingOfflineTitleColor = LivechatAppearance.findOne('Livechat_offline_title_color');\n\t\tinstance.colorOffline.set(settingOfflineTitleColor && settingOfflineTitleColor.value);\n\t},\n\t'submit .rocket-form'(e, instance) {\n\t\te.preventDefault();\n\n\t\tconst settings = [\n\t\t\t{\n\t\t\t\t_id: 'Livechat_title',\n\t\t\t\tvalue: _.trim(instance.title.get())\n\t\t\t},\n\t\t\t{\n\t\t\t\t_id: 'Livechat_title_color',\n\t\t\t\tvalue: instance.color.get()\n\t\t\t},\n\t\t\t{\n\t\t\t\t_id: 'Livechat_display_offline_form',\n\t\t\t\tvalue: instance.displayOfflineForm.get()\n\t\t\t},\n\t\t\t{\n\t\t\t\t_id: 'Livechat_offline_form_unavailable',\n\t\t\t\tvalue: _.trim(instance.offlineUnavailableMessage.get())\n\t\t\t},\n\t\t\t{\n\t\t\t\t_id: 'Livechat_offline_message',\n\t\t\t\tvalue: _.trim(instance.offlineMessage.get())\n\t\t\t},\n\t\t\t{\n\t\t\t\t_id: 'Livechat_offline_success_message',\n\t\t\t\tvalue: _.trim(instance.offlineSuccessMessage.get())\n\t\t\t},\n\t\t\t{\n\t\t\t\t_id: 'Livechat_offline_title',\n\t\t\t\tvalue: _.trim(instance.titleOffline.get())\n\t\t\t},\n\t\t\t{\n\t\t\t\t_id: 'Livechat_offline_title_color',\n\t\t\t\tvalue: instance.colorOffline.get()\n\t\t\t},\n\t\t\t{\n\t\t\t\t_id: 'Livechat_offline_email',\n\t\t\t\tvalue: instance.$('#emailOffline').val()\n\t\t\t}\n\t\t];\n\n\t\tMeteor.call('livechat:saveAppearance', settings, (err/*, success*/) => {\n\t\t\tif (err) {\n\t\t\t\treturn handleError(err);\n\t\t\t}\n\t\t\ttoastr.success(t('Settings_updated'));\n\t\t});\n\t}\n});\n\nTemplate.livechatAppearance.onRendered(function() {\n\tMeteor.setTimeout(() => {\n\t\t$('.colorpicker-input').each((index, el) => {\n\t\t\tnew jscolor(el);\n\t\t});\n\t}, 500);\n});\n","import moment from 'moment';\n\nconst LivechatRoom = new Mongo.Collection('livechatRoom');\n\nTemplate.livechatCurrentChats.helpers({\n\tlivechatRoom() {\n\t\treturn LivechatRoom.find({ t: 'l' }, { sort: { ts: -1 } });\n\t},\n\tstartedAt() {\n\t\treturn moment(this.ts).format('L LTS');\n\t},\n\tlastMessage() {\n\t\treturn moment(this.lm).format('L LTS');\n\t},\n\tservedBy() {\n\t\treturn this.servedBy && this.servedBy.username;\n\t},\n\tstatus() {\n\t\treturn this.open ? t('Opened') : t('Closed');\n\t},\n\tagents() {\n\t\treturn AgentUsers.find({}, { sort: { name: 1 } });\n\t}\n});\n\nTemplate.livechatCurrentChats.events({\n\t'click .row-link'() {\n\t\tFlowRouter.go('live', { code: this.code });\n\t},\n\t'click .load-more'(event, instance) {\n\t\tinstance.limit.set(instance.limit.get() + 20);\n\t},\n\t'submit form'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tconst filter = {};\n\t\t$(':input', event.currentTarget).each(function() {\n\t\t\tif (this.name) {\n\t\t\t\tfilter[this.name] = $(this).val();\n\t\t\t}\n\t\t});\n\n\t\tif (!_.isEmpty(filter.from)) {\n\t\t\tfilter.from = moment(filter.from, moment.localeData().longDateFormat('L')).toDate();\n\t\t} else {\n\t\t\tdelete filter.from;\n\t\t}\n\n\t\tif (!_.isEmpty(filter.to)) {\n\t\t\tfilter.to = moment(filter.to, moment.localeData().longDateFormat('L')).toDate();\n\t\t} else {\n\t\t\tdelete filter.to;\n\t\t}\n\n\t\tinstance.filter.set(filter);\n\t\tinstance.limit.set(20);\n\t}\n});\n\nTemplate.livechatCurrentChats.onCreated(function() {\n\tthis.limit = new ReactiveVar(20);\n\tthis.filter = new ReactiveVar({});\n\n\tthis.subscribe('livechat:agents');\n\n\tthis.autorun(() => {\n\t\tthis.subscribe('livechat:rooms', this.filter.get(), 0, this.limit.get());\n\t});\n});\n\nTemplate.livechatCurrentChats.onRendered(function() {\n\tthis.$('.input-daterange').datepicker({\n\t\tautoclose: true,\n\t\ttodayHighlight: true,\n\t\tformat: moment.localeData().longDateFormat('L').toLowerCase()\n\t});\n});\n","Template.livechatCustomFields.helpers({\n\tcustomFields() {\n\t\treturn LivechatCustomField.find();\n\t}\n});\n\nTemplate.livechatCustomFields.events({\n\t'click .remove-custom-field'(e) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tswal({\n\t\t\ttitle: t('Are_you_sure'),\n\t\t\ttype: 'warning',\n\t\t\tshowCancelButton: true,\n\t\t\tconfirmButtonColor: '#DD6B55',\n\t\t\tconfirmButtonText: t('Yes'),\n\t\t\tcancelButtonText: t('Cancel'),\n\t\t\tcloseOnConfirm: false,\n\t\t\thtml: false\n\t\t}, () => {\n\t\t\tMeteor.call('livechat:removeCustomField', this._id, function(error/*, result*/) {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn handleError(error);\n\t\t\t\t}\n\t\t\t\tswal({\n\t\t\t\t\ttitle: t('Removed'),\n\t\t\t\t\ttext: t('Field_removed'),\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttimer: 1000,\n\t\t\t\t\tshowConfirmButton: false\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t},\n\n\t'click .custom-field-info'(e/*, instance*/) {\n\t\te.preventDefault();\n\t\tFlowRouter.go('livechat-customfield-edit', { _id: this._id });\n\t}\n});\n\nTemplate.livechatCustomFields.onCreated(function() {\n\tthis.subscribe('livechat:customFields');\n});\n","import toastr from 'toastr';\nTemplate.livechatCustomFieldForm.helpers({\n\tcustomField() {\n\t\treturn Template.instance().customField.get();\n\t}\n});\n\nTemplate.livechatCustomFieldForm.events({\n\t'submit #customField-form'(e, instance) {\n\t\te.preventDefault();\n\t\tconst $btn = instance.$('button.save');\n\n\t\tconst _id = $(e.currentTarget).data('id');\n\t\tconst field = instance.$('input[name=field]').val();\n\t\tconst label = instance.$('input[name=label]').val();\n\t\tconst scope = instance.$('select[name=scope]').val();\n\t\tconst visibility = instance.$('select[name=visibility]').val();\n\n\t\tif (!/^[0-9a-zA-Z-_]+$/.test(field)) {\n\t\t\treturn toastr.error(t('error-invalid-custom-field-name'));\n\t\t}\n\n\t\tif (label.trim() === '') {\n\t\t\treturn toastr.error(t('Please_fill_a_label'));\n\t\t}\n\n\t\tconst oldBtnValue = $btn.html();\n\t\t$btn.html(t('Saving'));\n\n\t\tconst customFieldData = {\n\t\t\tfield,\n\t\t\tlabel,\n\t\t\tscope: scope.trim(),\n\t\t\tvisibility: visibility.trim()\n\t\t};\n\n\t\tMeteor.call('livechat:saveCustomField', _id, customFieldData, function(error) {\n\t\t\t$btn.html(oldBtnValue);\n\t\t\tif (error) {\n\t\t\t\treturn handleError(error);\n\t\t\t}\n\n\t\t\ttoastr.success(t('Saved'));\n\t\t\tFlowRouter.go('livechat-customfields');\n\t\t});\n\t},\n\n\t'click button.back'(e/*, instance*/) {\n\t\te.preventDefault();\n\t\tFlowRouter.go('livechat-customfields');\n\t}\n});\n\nTemplate.livechatCustomFieldForm.onCreated(function() {\n\tthis.customField = new ReactiveVar({});\n\tthis.autorun(() => {\n\t\tconst sub = this.subscribe('livechat:customFields', FlowRouter.getParam('_id'));\n\t\tif (sub.ready()) {\n\t\t\tconst customField = LivechatCustomField.findOne({ _id: FlowRouter.getParam('_id') });\n\t\t\tif (customField) {\n\t\t\t\tthis.customField.set(customField);\n\t\t\t}\n\t\t}\n\t});\n});\n","import toastr from 'toastr';\nTemplate.livechatDepartmentForm.helpers({\n\tdepartment() {\n\t\treturn Template.instance().department.get();\n\t},\n\tagents() {\n\t\treturn Template.instance().department && !_.isEmpty(Template.instance().department.get()) ? Template.instance().department.get().agents : [];\n\t},\n\tselectedAgents() {\n\t\treturn _.sortBy(Template.instance().selectedAgents.get(), 'username');\n\t},\n\tavailableAgents() {\n\t\tconst selected = _.pluck(Template.instance().selectedAgents.get(), 'username');\n\t\treturn AgentUsers.find({ username: { $nin: selected }}, { sort: { username: 1 } });\n\t},\n\tshowOnRegistration(value) {\n\t\tconst department = Template.instance().department.get();\n\t\treturn department.showOnRegistration === value || (department.showOnRegistration === undefined && value === true);\n\t}\n});\n\nTemplate.livechatDepartmentForm.events({\n\t'submit #department-form'(e, instance) {\n\t\te.preventDefault();\n\t\tconst $btn = instance.$('button.save');\n\n\t\tconst _id = $(e.currentTarget).data('id');\n\t\tconst enabled = instance.$('input[name=enabled]:checked').val();\n\t\tconst name = instance.$('input[name=name]').val();\n\t\tconst description = instance.$('textarea[name=description]').val();\n\t\tconst showOnRegistration = instance.$('input[name=showOnRegistration]:checked').val();\n\n\t\tif (enabled !== '1' && enabled !== '0') {\n\t\t\treturn toastr.error(t('Please_select_enabled_yes_or_no'));\n\t\t}\n\n\t\tif (name.trim() === '') {\n\t\t\treturn toastr.error(t('Please_fill_a_name'));\n\t\t}\n\n\t\tconst oldBtnValue = $btn.html();\n\t\t$btn.html(t('Saving'));\n\n\t\tconst departmentData = {\n\t\t\tenabled: enabled === '1' ? true : false,\n\t\t\tname: name.trim(),\n\t\t\tdescription: description.trim(),\n\t\t\tshowOnRegistration: showOnRegistration === '1' ? true : false\n\t\t};\n\n\t\tconst departmentAgents = [];\n\n\t\tinstance.selectedAgents.get().forEach((agent) => {\n\t\t\tagent.count = instance.$(`.count-${ agent.agentId }`).val();\n\t\t\tagent.order = instance.$(`.order-${ agent.agentId }`).val();\n\n\t\t\tdepartmentAgents.push(agent);\n\t\t});\n\n\t\tMeteor.call('livechat:saveDepartment', _id, departmentData, departmentAgents, function(error/*, result*/) {\n\t\t\t$btn.html(oldBtnValue);\n\t\t\tif (error) {\n\t\t\t\treturn handleError(error);\n\t\t\t}\n\n\t\t\ttoastr.success(t('Saved'));\n\t\t\tFlowRouter.go('livechat-departments');\n\t\t});\n\t},\n\n\t'click button.back'(e/*, instance*/) {\n\t\te.preventDefault();\n\t\tFlowRouter.go('livechat-departments');\n\t},\n\n\t'click .remove-agent'(e, instance) {\n\t\te.preventDefault();\n\n\t\tlet selectedAgents = instance.selectedAgents.get();\n\t\tselectedAgents = _.reject(selectedAgents, (agent) => { return agent._id === this._id; });\n\t\tinstance.selectedAgents.set(selectedAgents);\n\t},\n\n\t'click .available-agents li'(e, instance) {\n\t\tconst selectedAgents = instance.selectedAgents.get();\n\t\tconst agent = _.clone(this);\n\t\tagent.agentId = this._id;\n\t\tdelete agent._id;\n\t\tselectedAgents.push(agent);\n\t\tinstance.selectedAgents.set(selectedAgents);\n\t}\n});\n\nTemplate.livechatDepartmentForm.onCreated(function() {\n\tthis.department = new ReactiveVar({ enabled: true });\n\tthis.selectedAgents = new ReactiveVar([]);\n\n\tthis.subscribe('livechat:agents');\n\n\tthis.autorun(() => {\n\t\tconst sub = this.subscribe('livechat:departments', FlowRouter.getParam('_id'));\n\t\tif (sub.ready()) {\n\t\t\tconst department = LivechatDepartment.findOne({ _id: FlowRouter.getParam('_id') });\n\t\t\tif (department) {\n\t\t\t\tthis.department.set(department);\n\n\t\t\t\tthis.subscribe('livechat:departmentAgents', department._id, () => {\n\t\t\t\t\tconst newSelectedAgents = [];\n\t\t\t\t\tLivechatDepartmentAgents.find({ departmentId: department._id }).forEach((agent) => {\n\t\t\t\t\t\tnewSelectedAgents.push(agent);\n\t\t\t\t\t});\n\t\t\t\t\tthis.selectedAgents.set(newSelectedAgents);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n});\n","Template.livechatDepartments.helpers({\n\tdepartments() {\n\t\treturn LivechatDepartment.find();\n\t}\n});\n\nTemplate.livechatDepartments.events({\n\t'click .remove-department'(e/*, instance*/) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tswal({\n\t\t\ttitle: t('Are_you_sure'),\n\t\t\ttype: 'warning',\n\t\t\tshowCancelButton: true,\n\t\t\tconfirmButtonColor: '#DD6B55',\n\t\t\tconfirmButtonText: t('Yes'),\n\t\t\tcancelButtonText: t('Cancel'),\n\t\t\tcloseOnConfirm: false,\n\t\t\thtml: false\n\t\t}, () => {\n\t\t\tMeteor.call('livechat:removeDepartment', this._id, function(error/*, result*/) {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn handleError(error);\n\t\t\t\t}\n\t\t\t\tswal({\n\t\t\t\t\ttitle: t('Removed'),\n\t\t\t\t\ttext: t('Department_removed'),\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttimer: 1000,\n\t\t\t\t\tshowConfirmButton: false\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t},\n\n\t'click .department-info'(e/*, instance*/) {\n\t\te.preventDefault();\n\t\tFlowRouter.go('livechat-department-edit', { _id: this._id });\n\t}\n});\n\nTemplate.livechatDepartments.onCreated(function() {\n\tthis.subscribe('livechat:departments');\n});\n","Template.livechatInstallation.helpers({\n\tscript() {\n\t\tconst siteUrl = s.rtrim(RocketChat.settings.get('Site_Url'), '/');\n\n\t\treturn `<!-- Start of Rocket.Chat Livechat Script -->\n<script type=\"text/javascript\">\n(function(w, d, s, u) {\n\tw.RocketChat = function(c) { w.RocketChat._.push(c) }; w.RocketChat._ = []; w.RocketChat.url = u;\n\tvar h = d.getElementsByTagName(s)[0], j = d.createElement(s);\n\tj.async = true; j.src = '${ siteUrl }/packages/rocketchat_livechat/assets/rocketchat-livechat.min.js?_=201702160944';\n\th.parentNode.insertBefore(j, h);\n})(window, document, 'script', '${ siteUrl }/livechat');\n</script>\n<!-- End of Rocket.Chat Livechat Script -->`;\n\t}\n});\n","import toastr from 'toastr';\n/* globals LivechatIntegration */\nTemplate.livechatIntegrations.helpers({\n\twebhookUrl() {\n\t\tconst setting = LivechatIntegration.findOne('Livechat_webhookUrl');\n\t\treturn setting && setting.value;\n\t},\n\tsecretToken() {\n\t\tconst setting = LivechatIntegration.findOne('Livechat_secret_token');\n\t\treturn setting && setting.value;\n\t},\n\tdisableTest() {\n\t\treturn Template.instance().disableTest.get();\n\t},\n\tsendOnCloseChecked() {\n\t\tconst setting = LivechatIntegration.findOne('Livechat_webhook_on_close');\n\t\treturn setting && setting.value;\n\t},\n\tsendOnOfflineChecked() {\n\t\tconst setting = LivechatIntegration.findOne('Livechat_webhook_on_offline_msg');\n\t\treturn setting && setting.value;\n\t}\n});\n\nTemplate.livechatIntegrations.onCreated(function() {\n\tthis.disableTest = new ReactiveVar(true);\n\n\tthis.autorun(() => {\n\t\tconst webhook = LivechatIntegration.findOne('Livechat_webhookUrl');\n\t\tthis.disableTest.set(!webhook || _.isEmpty(webhook.value));\n\t});\n\n\tthis.subscribe('livechat:integration');\n});\n\nTemplate.livechatIntegrations.events({\n\t'change #webhookUrl, blur #webhookUrl'(e, instance) {\n\t\tconst setting = LivechatIntegration.findOne('Livechat_webhookUrl');\n\t\tinstance.disableTest.set(!setting || e.currentTarget.value !== setting.value);\n\t},\n\t'click .test'(e, instance) {\n\t\tif (!instance.disableTest.get()) {\n\t\t\tMeteor.call('livechat:webhookTest', (err) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn handleError(err);\n\t\t\t\t}\n\t\t\t\tswal(t('It_works'), null, 'success');\n\t\t\t});\n\t\t}\n\t},\n\t'click .reset-settings'(e, instance) {\n\t\te.preventDefault();\n\n\t\tconst webhookUrl = LivechatIntegration.findOne('Livechat_webhookUrl');\n\t\tconst secretToken = LivechatIntegration.findOne('Livechat_secret_token');\n\t\tconst webhookOnClose = LivechatIntegration.findOne('Livechat_webhook_on_close');\n\t\tconst webhookOnOfflineMsg = LivechatIntegration.findOne('Livechat_webhook_on_offline_msg');\n\n\t\tinstance.$('#webhookUrl').val(webhookUrl && webhookUrl.value);\n\t\tinstance.$('#secretToken').val(secretToken && secretToken.value);\n\t\tinstance.$('#sendOnClose').get(0).checked = webhookOnClose && webhookOnClose.value;\n\t\tinstance.$('#sendOnOffline').get(0).checked = webhookOnOfflineMsg && webhookOnOfflineMsg.value;\n\n\t\tinstance.disableTest.set(!webhookUrl || _.isEmpty(webhookUrl.value));\n\t},\n\t'submit .rocket-form'(e, instance) {\n\t\te.preventDefault();\n\n\t\tconst settings = {\n\t\t\t'Livechat_webhookUrl': s.trim(instance.$('#webhookUrl').val()),\n\t\t\t'Livechat_secret_token': s.trim(instance.$('#secretToken').val()),\n\t\t\t'Livechat_webhook_on_close': instance.$('#sendOnClose').get(0).checked,\n\t\t\t'Livechat_webhook_on_offline_msg': instance.$('#sendOnOffline').get(0).checked\n\t\t};\n\t\tMeteor.call('livechat:saveIntegration', settings, (err) => {\n\t\t\tif (err) {\n\t\t\t\treturn handleError(err);\n\t\t\t}\n\t\t\ttoastr.success(t('Saved'));\n\t\t});\n\t}\n});\n","/* globals LivechatQueueUser */\n\nTemplate.livechatQueue.helpers({\n\tdepartments() {\n\t\treturn LivechatDepartment.find({\n\t\t\tenabled: true\n\t\t}, {\n\t\t\tsort: {\n\t\t\t\tname: 1\n\t\t\t}\n\t\t});\n\t},\n\n\tusers() {\n\t\tconst users = [];\n\n\t\tconst showOffline = Template.instance().showOffline.get();\n\n\t\tLivechatQueueUser.find({\n\t\t\tdepartmentId: this._id\n\t\t}, {\n\t\t\tsort: {\n\t\t\t\tcount: 1,\n\t\t\t\torder: 1,\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tconst options = { fields: { _id: 1 } };\n\t\t\tconst userFilter = { _id: user.agentId, status: { $ne: 'offline' } };\n\t\t\tconst agentFilter = { _id: user.agentId, statusLivechat: 'available' };\n\n\t\t\tif (showOffline[this._id] || (Meteor.users.findOne(userFilter, options) && AgentUsers.findOne(agentFilter, options))) {\n\t\t\t\tusers.push(user);\n\t\t\t}\n\t\t});\n\n\t\treturn users;\n\t},\n\n\thasPermission() {\n\t\tconst user = RocketChat.models.Users.findOne(Meteor.userId(), { fields: { statusLivechat: 1 } });\n\t\treturn RocketChat.authz.hasRole(Meteor.userId(), 'livechat-manager') || (user.statusLivechat === 'available' && RocketChat.settings.get('Livechat_show_queue_list_link'));\n\t}\n});\n\nTemplate.livechatQueue.events({\n\t'click .show-offline'(event, instance) {\n\t\tconst showOffline = instance.showOffline.get();\n\n\t\tshowOffline[this._id] = event.currentTarget.checked;\n\n\t\tinstance.showOffline.set(showOffline);\n\t}\n});\n\nTemplate.livechatQueue.onCreated(function() {\n\tthis.showOffline = new ReactiveVar({});\n\n\tthis.subscribe('livechat:queue');\n\tthis.subscribe('livechat:agents');\n\tthis.subscribe('livechat:departments');\n});\n","Template.livechatTriggers.helpers({\n\ttriggers() {\n\t\treturn LivechatTrigger.find();\n\t}\n});\n\nTemplate.livechatTriggers.events({\n\t'click .remove-trigger'(e/*, instance*/) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tswal({\n\t\t\ttitle: t('Are_you_sure'),\n\t\t\ttype: 'warning',\n\t\t\tshowCancelButton: true,\n\t\t\tconfirmButtonColor: '#DD6B55',\n\t\t\tconfirmButtonText: t('Yes'),\n\t\t\tcancelButtonText: t('Cancel'),\n\t\t\tcloseOnConfirm: false,\n\t\t\thtml: false\n\t\t}, () => {\n\t\t\tMeteor.call('livechat:removeTrigger', this._id, function(error/*, result*/) {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn handleError(error);\n\t\t\t\t}\n\t\t\t\tswal({\n\t\t\t\t\ttitle: t('Removed'),\n\t\t\t\t\ttext: t('Trigger_removed'),\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttimer: 1000,\n\t\t\t\t\tshowConfirmButton: false\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t},\n\n\t'click .trigger-info'(e/*, instance*/) {\n\t\te.preventDefault();\n\t\tFlowRouter.go('livechat-trigger-edit', { _id: this._id });\n\t},\n\n\t'click .delete-trigger'(e/*, instance*/) {\n\t\te.preventDefault();\n\n\t\tswal({\n\t\t\ttitle: t('Are_you_sure'),\n\t\t\ttype: 'warning',\n\t\t\tshowCancelButton: true,\n\t\t\tconfirmButtonColor: '#DD6B55',\n\t\t\tconfirmButtonText: t('Yes'),\n\t\t\tcancelButtonText: t('Cancel'),\n\t\t\tcloseOnConfirm: false,\n\t\t\thtml: false\n\t\t}, () => {\n\t\t\tMeteor.call('livechat:removeTrigger', this._id, function(error/*, result*/) {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn handleError(error);\n\t\t\t\t}\n\n\t\t\t\tswal({\n\t\t\t\t\ttitle: t('Removed'),\n\t\t\t\t\ttext: t('Trigger_removed'),\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttimer: 1000,\n\t\t\t\t\tshowConfirmButton: false\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n});\n\nTemplate.livechatTriggers.onCreated(function() {\n\tthis.subscribe('livechat:triggers');\n});\n","import toastr from 'toastr';\nTemplate.livechatTriggersForm.helpers({\n\tname() {\n\t\tconst trigger = LivechatTrigger.findOne(FlowRouter.getParam('_id'));\n\t\treturn trigger && trigger.name;\n\t},\n\tdescription() {\n\t\tconst trigger = LivechatTrigger.findOne(FlowRouter.getParam('_id'));\n\t\treturn trigger && trigger.description;\n\t},\n\tenabled() {\n\t\tconst trigger = LivechatTrigger.findOne(FlowRouter.getParam('_id'));\n\t\treturn trigger && trigger.enabled;\n\t},\n\tconditions() {\n\t\tconst trigger = LivechatTrigger.findOne(FlowRouter.getParam('_id'));\n\t\tif (!trigger) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn trigger.conditions;\n\t},\n\tactions() {\n\t\tconst trigger = LivechatTrigger.findOne(FlowRouter.getParam('_id'));\n\t\tif (!trigger) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn trigger.actions;\n\t}\n});\n\nTemplate.livechatTriggersForm.events({\n\t'submit #trigger-form'(e, instance) {\n\t\te.preventDefault();\n\t\tconst $btn = instance.$('button.save');\n\n\t\tconst oldBtnValue = $btn.html();\n\t\t$btn.html(t('Saving'));\n\n\t\tconst data = {\n\t\t\t_id: FlowRouter.getParam('_id'),\n\t\t\tname: instance.$('input[name=name]').val(),\n\t\t\tdescription: instance.$('input[name=description]').val(),\n\t\t\tenabled: instance.$('input[name=enabled]:checked').val() === '1' ? true : false,\n\t\t\tconditions: [],\n\t\t\tactions: []\n\t\t};\n\n\t\t$('.each-condition').each(function() {\n\t\t\tdata.conditions.push({\n\t\t\t\tname: $('.trigger-condition', this).val(),\n\t\t\t\tvalue: $(`.${ $('.trigger-condition', this).val() }-value`).val()\n\t\t\t});\n\t\t});\n\n\t\t$('.each-action').each(function() {\n\t\t\tif ($('.trigger-action', this).val() === 'send-message') {\n\t\t\t\tdata.actions.push({\n\t\t\t\t\tname: $('.trigger-action', this).val(),\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tname: $('[name=send-message-name]', this).val(),\n\t\t\t\t\t\tmsg: $('[name=send-message-msg]', this).val()\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tdata.actions.push({\n\t\t\t\t\tname: $('.trigger-action', this).val(),\n\t\t\t\t\tvalue: $(`.${ $('.trigger-action', this).val() }-value`).val()\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tMeteor.call('livechat:saveTrigger', data, function(error/*, result*/) {\n\t\t\t$btn.html(oldBtnValue);\n\t\t\tif (error) {\n\t\t\t\treturn handleError(error);\n\t\t\t}\n\n\t\t\tFlowRouter.go('livechat-triggers');\n\n\t\t\ttoastr.success(t('Saved'));\n\t\t});\n\t},\n\n\t'click button.back'(e/*, instance*/) {\n\t\te.preventDefault();\n\t\tFlowRouter.go('livechat-triggers');\n\t}\n});\n\nTemplate.livechatTriggersForm.onCreated(function() {\n\tthis.subscribe('livechat:triggers', FlowRouter.getParam('_id'));\n});\n","import toastr from 'toastr';\nlet ManagerUsers;\n\nMeteor.startup(function() {\n\tManagerUsers = new Mongo.Collection('managerUsers');\n});\n\nTemplate.livechatUsers.helpers({\n\tmanagers() {\n\t\treturn ManagerUsers.find({}, { sort: { name: 1 } });\n\t},\n\tagents() {\n\t\treturn AgentUsers.find({}, { sort: { name: 1 } });\n\t},\n\temailAddress() {\n\t\tif (this.emails && this.emails.length > 0) {\n\t\t\treturn this.emails[0].address;\n\t\t}\n\t},\n\tagentAutocompleteSettings() {\n\t\treturn {\n\t\t\tlimit: 10,\n\t\t\t// inputDelay: 300\n\t\t\trules: [{\n\t\t\t\t// @TODO maybe change this 'collection' and/or template\n\t\t\t\tcollection: 'UserAndRoom',\n\t\t\t\tsubscription: 'userAutocomplete',\n\t\t\t\tfield: 'username',\n\t\t\t\ttemplate: Template.userSearch,\n\t\t\t\tnoMatchTemplate: Template.userSearchEmpty,\n\t\t\t\tmatchAll: true,\n\t\t\t\tfilter: {\n\t\t\t\t\texceptions: _.map(AgentUsers.find({}, { fields: { username: 1 } }).fetch(), user => { return user.username; })\n\t\t\t\t},\n\t\t\t\tselector(match) {\n\t\t\t\t\treturn { term: match };\n\t\t\t\t},\n\t\t\t\tsort: 'username'\n\t\t\t}]\n\t\t};\n\t},\n\tmanagerAutocompleteSettings() {\n\t\treturn {\n\t\t\tlimit: 10,\n\t\t\t// inputDelay: 300\n\t\t\trules: [{\n\t\t\t\t// @TODO maybe change this 'collection' and/or template\n\t\t\t\tcollection: 'UserAndRoom',\n\t\t\t\tsubscription: 'userAutocomplete',\n\t\t\t\tfield: 'username',\n\t\t\t\ttemplate: Template.userSearch,\n\t\t\t\tnoMatchTemplate: Template.userSearchEmpty,\n\t\t\t\tmatchAll: true,\n\t\t\t\tfilter: {\n\t\t\t\t\texceptions: _.map(ManagerUsers.find({}, { fields: { username: 1 } }).fetch(), user => { return user.username; })\n\t\t\t\t},\n\t\t\t\tselector(match) {\n\t\t\t\t\treturn { term: match };\n\t\t\t\t},\n\t\t\t\tsort: 'username'\n\t\t\t}]\n\t\t};\n\t}\n});\n\nTemplate.livechatUsers.events({\n\t'click .remove-manager'(e/*, instance*/) {\n\t\te.preventDefault();\n\n\t\tswal({\n\t\t\ttitle: t('Are_you_sure'),\n\t\t\ttype: 'warning',\n\t\t\tshowCancelButton: true,\n\t\t\tconfirmButtonColor: '#DD6B55',\n\t\t\tconfirmButtonText: t('Yes'),\n\t\t\tcancelButtonText: t('Cancel'),\n\t\t\tcloseOnConfirm: false,\n\t\t\thtml: false\n\t\t}, () => {\n\t\t\tMeteor.call('livechat:removeManager', this.username, function(error/*, result*/) {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn handleError(error);\n\t\t\t\t}\n\t\t\t\tswal({\n\t\t\t\t\ttitle: t('Removed'),\n\t\t\t\t\ttext: t('Manager_removed'),\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttimer: 1000,\n\t\t\t\t\tshowConfirmButton: false\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t},\n\t'click .remove-agent'(e/*, instance*/) {\n\t\te.preventDefault();\n\n\t\tswal({\n\t\t\ttitle: t('Are_you_sure'),\n\t\t\ttype: 'warning',\n\t\t\tshowCancelButton: true,\n\t\t\tconfirmButtonColor: '#DD6B55',\n\t\t\tconfirmButtonText: t('Yes'),\n\t\t\tcancelButtonText: t('Cancel'),\n\t\t\tcloseOnConfirm: false,\n\t\t\thtml: false\n\t\t}, () => {\n\t\t\tMeteor.call('livechat:removeAgent', this.username, function(error/*, result*/) {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn handleError(error);\n\t\t\t\t}\n\t\t\t\tswal({\n\t\t\t\t\ttitle: t('Removed'),\n\t\t\t\t\ttext: t('Agent_removed'),\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttimer: 1000,\n\t\t\t\t\tshowConfirmButton: false\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t},\n\t'submit #form-manager'(e/*, instance*/) {\n\t\te.preventDefault();\n\n\t\tif (e.currentTarget.elements.username.value.trim() === '') {\n\t\t\treturn toastr.error(t('Please_fill_a_username'));\n\t\t}\n\n\t\tconst oldBtnValue = e.currentTarget.elements.add.value;\n\n\t\te.currentTarget.elements.add.value = t('Saving');\n\n\t\tMeteor.call('livechat:addManager', e.currentTarget.elements.username.value, function(error/*, result*/) {\n\t\t\te.currentTarget.elements.add.value = oldBtnValue;\n\t\t\tif (error) {\n\t\t\t\treturn handleError(error);\n\t\t\t}\n\n\t\t\ttoastr.success(t('Manager_added'));\n\t\t\te.currentTarget.reset();\n\t\t});\n\t},\n\t'submit #form-agent'(e/*, instance*/) {\n\t\te.preventDefault();\n\n\t\tif (e.currentTarget.elements.username.value.trim() === '') {\n\t\t\treturn toastr.error(t('Please_fill_a_username'));\n\t\t}\n\n\t\tconst oldBtnValue = e.currentTarget.elements.add.value;\n\n\t\te.currentTarget.elements.add.value = t('Saving');\n\n\t\tMeteor.call('livechat:addAgent', e.currentTarget.elements.username.value, function(error/*, result*/) {\n\t\t\te.currentTarget.elements.add.value = oldBtnValue;\n\t\t\tif (error) {\n\t\t\t\treturn handleError(error);\n\t\t\t}\n\n\t\t\ttoastr.success(t('Agent_added'));\n\t\t\te.currentTarget.reset();\n\t\t});\n\t}\n});\n\nTemplate.livechatUsers.onCreated(function() {\n\tthis.subscribe('livechat:agents');\n\tthis.subscribe('livechat:managers');\n});\n","import toastr from 'toastr';\n/* globals LivechatOfficeHour */\nimport moment from 'moment';\n\nTemplate.livechatOfficeHours.helpers({\n\tdays() {\n\t\treturn LivechatOfficeHour.find({}, { sort: { code: 1 } });\n\t},\n\tstartName(day) {\n\t\treturn `${ day.day }_start`;\n\t},\n\tfinishName(day) {\n\t\treturn `${ day.day }_finish`;\n\t},\n\topenName(day) {\n\t\treturn `${ day.day }_open`;\n\t},\n\tstart(day) {\n\t\treturn Template.instance().dayVars[day.day].start.get();\n\t},\n\tfinish(day) {\n\t\treturn Template.instance().dayVars[day.day].finish.get();\n\n\t},\n\tname(day) {\n\t\treturn day.day;\n\t},\n\topen(day) {\n\t\treturn Template.instance().dayVars[day.day].open.get();\n\t},\n\tenableOfficeHoursTrueChecked() {\n\t\tif (Template.instance().enableOfficeHours.get()) {\n\t\t\treturn 'checked';\n\t\t}\n\t},\n\tenableOfficeHoursFalseChecked() {\n\t\tif (!Template.instance().enableOfficeHours.get()) {\n\t\t\treturn 'checked';\n\t\t}\n\t}\n});\n\nTemplate.livechatOfficeHours.events({\n\t'change .preview-settings, keydown .preview-settings'(e, instance) {\n\t\tconst temp = e.currentTarget.name.split('_');\n\n\t\tconst newTime = moment(e.currentTarget.value, 'HH:mm');\n\n\t\t// check if start and stop do not cross\n\t\tif (temp[1] === 'start') {\n\t\t\tif (newTime.isSameOrBefore(moment(instance.dayVars[temp[0]].finish.get(), 'HH:mm'))) {\n\t\t\t\tinstance.dayVars[temp[0]].start.set(e.currentTarget.value);\n\t\t\t} else {\n\t\t\t\te.currentTarget.value = instance.dayVars[temp[0]].start.get();\n\t\t\t}\n\t\t} else if (temp[1] === 'finish') {\n\t\t\tif (newTime.isSameOrAfter(moment(instance.dayVars[temp[0]].start.get(), 'HH:mm'))) {\n\t\t\t\tinstance.dayVars[temp[0]].finish.set(e.currentTarget.value);\n\t\t\t} else {\n\t\t\t\te.currentTarget.value = instance.dayVars[temp[0]].finish.get();\n\t\t\t}\n\t\t}\n\t},\n\t'change .dayOpenCheck input'(e, instance) {\n\t\tconst temp = e.currentTarget.name.split('_');\n\t\tinstance.dayVars[temp[0]][temp[1]].set(e.target.checked);\n\t},\n\t'change .preview-settings, keyup .preview-settings'(e, instance) {\n\t\tlet value = e.currentTarget.value;\n\t\tif (e.currentTarget.type === 'radio') {\n\t\t\tvalue = value === 'true';\n\t\t\tinstance[e.currentTarget.name].set(value);\n\t\t}\n\t},\n\t'submit .rocket-form'(e, instance) {\n\t\te.preventDefault();\n\n\t\t// convert all times to utc then update them in db\n\t\tfor (const d in instance.dayVars) {\n\t\t\tif (instance.dayVars.hasOwnProperty(d)) {\n\t\t\t\tconst day = instance.dayVars[d];\n\t\t\t\tconst start_utc = moment(day.start.get(), 'HH:mm').utc().format('HH:mm');\n\t\t\t\tconst finish_utc = moment(day.finish.get(), 'HH:mm').utc().format('HH:mm');\n\n\t\t\t\tMeteor.call('livechat:saveOfficeHours', d, start_utc, finish_utc, day.open.get(), function(err /*,result*/) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn handleError(err);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.settings.set('Livechat_enable_office_hours', instance.enableOfficeHours.get(), (err/*, success*/) => {\n\t\t\tif (err) {\n\t\t\t\treturn handleError(err);\n\t\t\t}\n\t\t\ttoastr.success(t('Office_hours_updated'));\n\t\t});\n\t}\n});\n\nTemplate.livechatOfficeHours.onCreated(function() {\n\tthis.dayVars = {\n\t\tMonday: {\n\t\t\tstart: new ReactiveVar('08:00'),\n\t\t\tfinish: new ReactiveVar('20:00'),\n\t\t\topen: new ReactiveVar(true)\n\t\t},\n\t\tTuesday: {\n\t\t\tstart: new ReactiveVar('00:00'),\n\t\t\tfinish: new ReactiveVar('00:00'),\n\t\t\topen: new ReactiveVar(true)\n\t\t},\n\t\tWednesday: {\n\t\t\tstart: new ReactiveVar('00:00'),\n\t\t\tfinish: new ReactiveVar('00:00'),\n\t\t\topen: new ReactiveVar(true)\n\t\t},\n\t\tThursday: {\n\t\t\tstart: new ReactiveVar('00:00'),\n\t\t\tfinish: new ReactiveVar('00:00'),\n\t\t\topen: new ReactiveVar(true)\n\t\t},\n\t\tFriday: {\n\t\t\tstart: new ReactiveVar('00:00'),\n\t\t\tfinish: new ReactiveVar('00:00'),\n\t\t\topen: new ReactiveVar(true)\n\t\t},\n\t\tSaturday: {\n\t\t\tstart: new ReactiveVar('00:00'),\n\t\t\tfinish: new ReactiveVar('00:00'),\n\t\t\topen: new ReactiveVar(false)\n\t\t},\n\t\tSunday: {\n\t\t\tstart: new ReactiveVar('00:00'),\n\t\t\tfinish: new ReactiveVar('00:00'),\n\t\t\topen: new ReactiveVar(false)\n\t\t}\n\t};\n\n\tthis.autorun(() => {\n\t\tthis.subscribe('livechat:officeHour');\n\n\t\tif (this.subscriptionsReady()) {\n\t\t\tLivechatOfficeHour.find().forEach(function(d) {\n\t\t\t\tTemplate.instance().dayVars[d.day].start.set(moment.utc(d.start, 'HH:mm').local().format('HH:mm'));\n\t\t\t\tTemplate.instance().dayVars[d.day].finish.set(moment.utc(d.finish, 'HH:mm').local().format('HH:mm'));\n\t\t\t\tTemplate.instance().dayVars[d.day].open.set(d.open);\n\t\t\t});\n\t\t}\n\t});\n\n\tthis.enableOfficeHours = new ReactiveVar(null);\n\n\tthis.autorun(() => {\n\t\tthis.enableOfficeHours.set(RocketChat.settings.get('Livechat_enable_office_hours'));\n\t});\n});\n","Template.externalSearch.helpers({\n\tmessages() {\n\t\treturn RocketChat.models.LivechatExternalMessage.findByRoomId(this.rid, { ts: 1 });\n\t}\n});\n\nTemplate.externalSearch.events({\n\t'click button.pick-message'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\t$(`#chat-window-${ instance.roomId } .input-message`).val(this.msg).focus();\n\t}\n});\n\nTemplate.externalSearch.onCreated(function() {\n\tthis.roomId = null;\n\t// console.log('externalSearch.this ->',this);\n\tthis.autorun(() => {\n\t\tthis.roomId = Template.currentData().rid;\n\t\tthis.subscribe('livechat:externalMessages', Template.currentData().rid);\n\t});\n});\n","import moment from 'moment';\n\nTemplate.visitorHistory.helpers({\n\thistoryLoaded() {\n\t\treturn !Template.instance().loadHistory.ready();\n\t},\n\n\tpreviousChats() {\n\t\treturn ChatRoom.find({\n\t\t\t_id: { $ne: this.rid },\n\t\t\t'v._id': Template.instance().visitorId.get()\n\t\t}, {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t}\n\t\t});\n\t},\n\n\ttitle() {\n\t\tlet title = moment(this.ts).format('L LTS');\n\n\t\tif (this.label) {\n\t\t\ttitle += ` - ${ this.label }`;\n\t\t}\n\n\t\treturn title;\n\t}\n});\n\nTemplate.visitorHistory.onCreated(function() {\n\tconst currentData = Template.currentData();\n\tthis.visitorId = new ReactiveVar();\n\n\tthis.autorun(() => {\n\t\tconst room = ChatRoom.findOne({ _id: Template.currentData().rid });\n\t\tthis.visitorId.set(room.v._id);\n\t});\n\n\tif (currentData && currentData.rid) {\n\t\tthis.loadHistory = this.subscribe('livechat:visitorHistory', { rid: currentData.rid });\n\t}\n});\n","import moment from 'moment';\n\nTemplate.visitorNavigation.helpers({\n\tloadingNavigation() {\n\t\treturn !Template.instance().pageVisited.ready();\n\t},\n\n\tpageVisited() {\n\t\tconst room = ChatRoom.findOne({ _id: this.rid }, { fields: { 'v.token': 1 } });\n\n\t\tif (room && room.v && room.v.token) {\n\t\t\treturn LivechatPageVisited.find({ token: room.v.token }, { sort: { ts: -1 } });\n\t\t}\n\t},\n\n\tpageTitle() {\n\t\treturn this.page.title || t('Empty_title');\n\t},\n\n\taccessDateTime() {\n\t\treturn moment(this.ts).format('L LTS');\n\t}\n});\n\nTemplate.visitorNavigation.onCreated(function() {\n\tconst currentData = Template.currentData();\n\n\tif (currentData && currentData.rid) {\n\t\tthis.pageVisited = this.subscribe('livechat:visitorPageVisited', { rid: currentData.rid });\n\t}\n});\n","import toastr from 'toastr';\nTemplate.visitorEdit.helpers({\n\tvisitor() {\n\t\treturn Template.instance().visitor.get();\n\t},\n\n\troom() {\n\t\treturn Template.instance().room.get();\n\t},\n\n\temail() {\n\t\tconst visitor = Template.instance().visitor.get();\n\t\tif (visitor.visitorEmails && visitor.visitorEmails.length > 0) {\n\t\t\treturn visitor.visitorEmails[0].address;\n\t\t}\n\t},\n\n\tphone() {\n\t\tconst visitor = Template.instance().visitor.get();\n\t\tif (visitor.phone && visitor.phone.length > 0) {\n\t\t\treturn visitor.phone[0].phoneNumber;\n\t\t}\n\t},\n\n\tjoinTags() {\n\t\treturn this.tags && this.tags.join(', ');\n\t}\n});\n\nTemplate.visitorEdit.onCreated(function() {\n\tthis.visitor = new ReactiveVar();\n\tthis.room = new ReactiveVar();\n\n\tthis.autorun(() => {\n\t\tthis.visitor.set(Meteor.users.findOne({ _id: Template.currentData().visitorId }));\n\t});\n\n\tthis.autorun(() => {\n\t\tthis.room.set(ChatRoom.findOne({ _id: Template.currentData().roomId }));\n\t});\n});\n\nTemplate.visitorEdit.events({\n\t'submit form'(event, instance) {\n\t\tconsole.log('this ->', this);\n\t\tevent.preventDefault();\n\t\tconst userData = { _id: instance.visitor.get()._id };\n\t\tconst roomData = { _id: instance.room.get()._id };\n\n\t\tuserData.name = event.currentTarget.elements['name'].value;\n\t\tuserData.email = event.currentTarget.elements['email'].value;\n\t\tuserData.phone = event.currentTarget.elements['phone'].value;\n\n\t\troomData.topic = event.currentTarget.elements['topic'].value;\n\t\troomData.tags = event.currentTarget.elements['tags'].value;\n\n\t\tMeteor.call('livechat:saveInfo', userData, roomData, (err) => {\n\t\t\tif (err) {\n\t\t\t\ttoastr.error(t(err.error));\n\t\t\t} else {\n\t\t\t\ttoastr.success(t('Saved'));\n\t\t\t}\n\t\t});\n\t},\n\n\t'click .save'() {\n\t\tthis.save();\n\t},\n\n\t'click .cancel'() {\n\t\tthis.cancel();\n\t}\n});\n","import toastr from 'toastr';\nTemplate.visitorForward.helpers({\n\tvisitor() {\n\t\treturn Template.instance().visitor.get();\n\t},\n\thasDepartments() {\n\t\treturn LivechatDepartment.find({ enabled: true }).count() > 0;\n\t},\n\tdepartments() {\n\t\treturn LivechatDepartment.find({ enabled: true });\n\t},\n\tagents() {\n\t\treturn AgentUsers.find({ _id: { $ne: Meteor.userId() } }, { sort: { name: 1, username: 1 } });\n\t},\n\tagentName() {\n\t\treturn this.name || this.username;\n\t}\n});\n\nTemplate.visitorForward.onCreated(function() {\n\tthis.visitor = new ReactiveVar();\n\tthis.room = new ReactiveVar();\n\n\tthis.autorun(() => {\n\t\tthis.visitor.set(Meteor.users.findOne({ _id: Template.currentData().visitorId }));\n\t});\n\n\tthis.autorun(() => {\n\t\tthis.room.set(ChatRoom.findOne({ _id: Template.currentData().roomId }));\n\t});\n\n\tthis.subscribe('livechat:departments');\n\tthis.subscribe('livechat:agents');\n});\n\n\nTemplate.visitorForward.events({\n\t'submit form'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tconst transferData = {\n\t\t\troomId: instance.room.get()._id\n\t\t};\n\n\t\tif (instance.find('#forwardUser').value) {\n\t\t\ttransferData.userId = instance.find('#forwardUser').value;\n\t\t} else if (instance.find('#forwardDepartment').value) {\n\t\t\ttransferData.departmentId = instance.find('#forwardDepartment').value;\n\t\t}\n\n\t\tMeteor.call('livechat:transfer', transferData, (error, result) => {\n\t\t\tif (error) {\n\t\t\t\ttoastr.error(t(error.error));\n\t\t\t} else if (result) {\n\t\t\t\tthis.save();\n\t\t\t\ttoastr.success(t('Transferred'));\n\t\t\t\tFlowRouter.go('/');\n\t\t\t} else {\n\t\t\t\ttoastr.warning(t('No_available_agents_to_transfer'));\n\t\t\t}\n\t\t});\n\t},\n\n\t'change #forwardDepartment, blur #forwardDepartment'(event, instance) {\n\t\tif (event.currentTarget.value) {\n\t\t\tinstance.find('#forwardUser').value = '';\n\t\t}\n\t},\n\n\t'change #forwardUser, blur #forwardUser'(event, instance) {\n\t\tif (event.currentTarget.value) {\n\t\t\tinstance.find('#forwardDepartment').value = '';\n\t\t}\n\t},\n\n\t'click .cancel'(event) {\n\t\tevent.preventDefault();\n\n\t\tthis.cancel();\n\t}\n});\n","import moment from 'moment';\nimport UAParser from 'ua-parser-js';\n\nTemplate.visitorInfo.helpers({\n\tuser() {\n\t\tconst user = Template.instance().user.get();\n\t\tif (user && user.userAgent) {\n\t\t\tconst ua = new UAParser();\n\t\t\tua.setUA(user.userAgent);\n\n\t\t\tuser.os = `${ ua.getOS().name } ${ ua.getOS().version }`;\n\t\t\tif (['Mac OS', 'iOS'].indexOf(ua.getOS().name) !== -1) {\n\t\t\t\tuser.osIcon = 'icon-apple';\n\t\t\t} else {\n\t\t\t\tuser.osIcon = `icon-${ ua.getOS().name.toLowerCase() }`;\n\t\t\t}\n\t\t\tuser.browser = `${ ua.getBrowser().name } ${ ua.getBrowser().version }`;\n\t\t\tuser.browserIcon = `icon-${ ua.getBrowser().name.toLowerCase() }`;\n\t\t}\n\n\t\treturn user;\n\t},\n\n\troom() {\n\t\treturn ChatRoom.findOne({ _id: this.rid });\n\t},\n\n\tjoinTags() {\n\t\treturn this.tags && this.tags.join(', ');\n\t},\n\n\tcustomFields() {\n\t\tconst fields = [];\n\t\tlet livechatData = {};\n\t\tconst user = Template.instance().user.get();\n\t\tif (user) {\n\t\t\tlivechatData = _.extend(livechatData, user.livechatData);\n\t\t}\n\n\t\tconst data = Template.currentData();\n\t\tif (data && data.rid) {\n\t\t\tconst room = RocketChat.models.Rooms.findOne(data.rid);\n\t\t\tif (room) {\n\t\t\t\tlivechatData = _.extend(livechatData, room.livechatData);\n\t\t\t}\n\t\t}\n\n\t\tif (!_.isEmpty(livechatData)) {\n\t\t\tfor (const _id in livechatData) {\n\t\t\t\tif (livechatData.hasOwnProperty(_id)) {\n\t\t\t\t\tconst customFields = Template.instance().customFields.get();\n\t\t\t\t\tif (customFields) {\n\t\t\t\t\t\tconst field = _.findWhere(customFields, { _id });\n\t\t\t\t\t\tif (field && field.visibility !== 'hidden') {\n\t\t\t\t\t\t\tfields.push({ label: field.label, value: livechatData[_id] });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn fields;\n\t\t}\n\t},\n\n\tcreatedAt() {\n\t\tif (!this.createdAt) {\n\t\t\treturn '';\n\t\t}\n\t\treturn moment(this.createdAt).format('L LTS');\n\t},\n\n\tlastLogin() {\n\t\tif (!this.lastLogin) {\n\t\t\treturn '';\n\t\t}\n\t\treturn moment(this.lastLogin).format('L LTS');\n\t},\n\n\tediting() {\n\t\treturn Template.instance().action.get() === 'edit';\n\t},\n\n\tforwarding() {\n\t\treturn Template.instance().action.get() === 'forward';\n\t},\n\n\teditDetails() {\n\t\tconst instance = Template.instance();\n\t\tconst user = instance.user.get();\n\t\treturn {\n\t\t\tvisitorId: user ? user._id : null,\n\t\t\troomId: this.rid,\n\t\t\tsave() {\n\t\t\t\tinstance.action.set();\n\t\t\t},\n\t\t\tcancel() {\n\t\t\t\tinstance.action.set();\n\t\t\t}\n\t\t};\n\t},\n\n\tforwardDetails() {\n\t\tconst instance = Template.instance();\n\t\tconst user = instance.user.get();\n\t\treturn {\n\t\t\tvisitorId: user ? user._id : null,\n\t\t\troomId: this.rid,\n\t\t\tsave() {\n\t\t\t\tinstance.action.set();\n\t\t\t},\n\t\t\tcancel() {\n\t\t\t\tinstance.action.set();\n\t\t\t}\n\t\t};\n\t},\n\n\troomOpen() {\n\t\tconst room = ChatRoom.findOne({ _id: this.rid });\n\n\t\treturn room.open;\n\t},\n\n\tguestPool() {\n\t\treturn RocketChat.settings.get('Livechat_Routing_Method') === 'Guest_Pool';\n\t},\n\n\tshowDetail() {\n\t\tif (Template.instance().action.get()) {\n\t\t\treturn 'hidden';\n\t\t}\n\t},\n\n\tcanSeeButtons() {\n\t\tif (RocketChat.authz.hasRole(Meteor.userId(), 'livechat-manager')) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst data = Template.currentData();\n\t\tif (data && data.rid) {\n\t\t\tconst subscription = RocketChat.models.Subscriptions.findOne({ rid: data.rid });\n\t\t\treturn subscription !== undefined;\n\t\t}\n\t\treturn false;\n\t}\n});\n\nTemplate.visitorInfo.events({\n\t'click .edit-livechat'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tinstance.action.set('edit');\n\t},\n\t'click .close-livechat'(event) {\n\t\tevent.preventDefault();\n\n\t\tswal({\n\t\t\ttitle: t('Closing_chat'),\n\t\t\ttype: 'input',\n\t\t\tinputPlaceholder: t('Please_add_a_comment'),\n\t\t\tshowCancelButton: true,\n\t\t\tcloseOnConfirm: false\n\t\t}, (inputValue) => {\n\t\t\tif (!inputValue) {\n\t\t\t\tswal.showInputError(t('Please_add_a_comment_to_close_the_room'));\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (s.trim(inputValue) === '') {\n\t\t\t\tswal.showInputError(t('Please_add_a_comment_to_close_the_room'));\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tMeteor.call('livechat:closeRoom', this.rid, inputValue, function(error/*, result*/) {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn handleError(error);\n\t\t\t\t}\n\t\t\t\tswal({\n\t\t\t\t\ttitle: t('Chat_closed'),\n\t\t\t\t\ttext: t('Chat_closed_successfully'),\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttimer: 1000,\n\t\t\t\t\tshowConfirmButton: false\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t},\n\n\t'click .return-inquiry'(event) {\n\t\tevent.preventDefault();\n\n\t\tswal({\n\t\t\ttitle: t('Would_you_like_to_return_the_inquiry'),\n\t\t\ttype: 'warning',\n\t\t\tshowCancelButton: true,\n\t\t\tconfirmButtonColor: '#3085d6',\n\t\t\tcancelButtonColor: '#d33',\n\t\t\tconfirmButtonText: t('Yes')\n\t\t}, () => {\n\t\t\tMeteor.call('livechat:returnAsInquiry', this.rid, function(error/*, result*/) {\n\t\t\t\tif (error) {\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t} else {\n\t\t\t\t\tSession.set('openedRoom');\n\t\t\t\t\tFlowRouter.go('/home');\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\t'click .forward-livechat'(event, instance) {\n\t\tevent.preventDefault();\n\n\t\tinstance.action.set('forward');\n\t}\n});\n\nTemplate.visitorInfo.onCreated(function() {\n\tthis.visitorId = new ReactiveVar(null);\n\tthis.customFields = new ReactiveVar([]);\n\tthis.action = new ReactiveVar();\n\tthis.user = new ReactiveVar();\n\n\tMeteor.call('livechat:getCustomFields', (err, customFields) => {\n\t\tif (customFields) {\n\t\t\tthis.customFields.set(customFields);\n\t\t}\n\t});\n\n\tconst currentData = Template.currentData();\n\n\tif (currentData && currentData.rid) {\n\t\tthis.autorun(() => {\n\t\t\tconst room = ChatRoom.findOne(currentData.rid);\n\t\t\tif (room && room.v && room.v._id) {\n\t\t\t\tthis.visitorId.set(room.v._id);\n\t\t\t} else {\n\t\t\t\tthis.visitorId.set();\n\t\t\t}\n\t\t});\n\n\t\tthis.subscribe('livechat:visitorInfo', { rid: currentData.rid });\n\t}\n\n\tthis.autorun(() => {\n\t\tthis.user.set(Meteor.users.findOne({ '_id': this.visitorId.get() }));\n\t});\n});\n","Template.livechatTriggerAction.helpers({\n\thiddenValue(current) {\n\t\tif (this.name === undefined && Template.instance().firstAction) {\n\t\t\tTemplate.instance().firstAction = false;\n\t\t\treturn '';\n\t\t} else if (this.name !== current) {\n\t\t\treturn 'hidden';\n\t\t}\n\t}\n});\n\nTemplate.livechatTriggerAction.events({\n\t'change .trigger-action'(e, instance) {\n\t\tinstance.$('.trigger-action-value ').addClass('hidden');\n\t\tinstance.$(`.${ e.currentTarget.value }`).removeClass('hidden');\n\t}\n});\n\nTemplate.livechatTriggerAction.onCreated(function() {\n\tthis.firstAction = true;\n});\n","Template.livechatTriggerCondition.helpers({\n\thiddenValue(current) {\n\t\tif (this.name === undefined && Template.instance().firstCondition) {\n\t\t\tTemplate.instance().firstCondition = false;\n\t\t\treturn '';\n\t\t} else if (this.name !== current) {\n\t\t\treturn 'hidden';\n\t\t}\n\t},\n\tconditionSelected(current) {\n\t\tif (this.name === current) {\n\t\t\treturn 'selected';\n\t\t}\n\t},\n\tvalueFor(condition) {\n\t\tif (this.name === condition) {\n\t\t\treturn this.value;\n\t\t}\n\t}\n});\n\nTemplate.livechatTriggerCondition.events({\n\t'change .trigger-condition'(e, instance) {\n\t\tinstance.$('.trigger-condition-value ').addClass('hidden');\n\t\tinstance.$(`.${ e.currentTarget.value }`).removeClass('hidden');\n\t}\n});\n\nTemplate.livechatTriggerCondition.onCreated(function() {\n\tthis.firstCondition = true;\n});\n","/* globals LivechatInquiry, KonchatNotification */\nTemplate.livechat.helpers({\n\tisActive() {\n\t\tconst query = {\n\t\t\tt: 'l',\n\t\t\tf: { $ne: true },\n\t\t\topen: true,\n\t\t\trid: Session.get('openedRoom')\n\t\t};\n\n\t\tconst options = { fields: { _id: 1 } };\n\n\t\tif (ChatSubscription.findOne(query, options)) {\n\t\t\treturn 'active';\n\t\t}\n\t},\n\n\trooms() {\n\t\tconst query = {\n\t\t\tt: 'l',\n\t\t\topen: true\n\t\t};\n\n\t\tconst user = RocketChat.models.Users.findOne(Meteor.userId(), {\n\t\t\tfields: { 'settings.preferences.unreadRoomsMode': 1 }\n\t\t});\n\n\t\tif (user && user.settings && user.settings.preferences && user.settings.preferences.unreadRoomsMode) {\n\t\t\tquery.alert = { $ne: true };\n\t\t}\n\n\t\treturn ChatSubscription.find(query, { sort: {\n\t\t\t't': 1,\n\t\t\t'name': 1\n\t\t}});\n\t},\n\n\tinquiries() {\n\t\t// get all inquiries of the department\n\t\tconst inqs = LivechatInquiry.find({\n\t\t\tagents: Meteor.userId(),\n\t\t\tstatus: 'open'\n\t\t}, {\n\t\t\tsort: {\n\t\t\t\t'ts' : 1\n\t\t\t}\n\t\t});\n\n\t\t// for notification sound\n\t\tinqs.forEach((inq) => {\n\t\t\tKonchatNotification.newRoom(inq.rid);\n\t\t});\n\n\t\treturn inqs;\n\t},\n\n\tguestPool() {\n\t\treturn RocketChat.settings.get('Livechat_Routing_Method') === 'Guest_Pool';\n\t},\n\n\tavailable() {\n\t\tconst statusLivechat = Template.instance().statusLivechat.get();\n\n\t\treturn {\n\t\t\tstatus: statusLivechat === 'available' ? 'status-online' : 'status-offline',\n\t\t\ticon: statusLivechat === 'available' ? 'icon-toggle-on' : 'icon-toggle-off',\n\t\t\thint: statusLivechat === 'available' ? t('Available') : t('Not_Available')\n\t\t};\n\t},\n\n\tlivechatAvailable() {\n\t\treturn Template.instance().statusLivechat.get();\n\t},\n\n\tisLivechatAvailable() {\n\t\treturn Template.instance().statusLivechat.get() === 'available';\n\t},\n\n\tshowQueueLink() {\n\t\tif (RocketChat.settings.get('Livechat_Routing_Method') !== 'Least_Amount') {\n\t\t\treturn false;\n\t\t}\n\t\treturn RocketChat.authz.hasRole(Meteor.userId(), 'livechat-manager') || (Template.instance().statusLivechat.get() === 'available' && RocketChat.settings.get('Livechat_show_queue_list_link'));\n\t},\n\n\tactiveLivechatQueue() {\n\t\tFlowRouter.watchPathChange();\n\t\tif (FlowRouter.current().route.name === 'livechat-queue') {\n\t\t\treturn 'active';\n\t\t}\n\t}\n});\n\nTemplate.livechat.events({\n\t'click .livechat-status'() {\n\t\tMeteor.call('livechat:changeLivechatStatus', (err /*, results*/) => {\n\t\t\tif (err) {\n\t\t\t\treturn handleError(err);\n\t\t\t}\n\t\t});\n\t},\n\n\t'click .inquiries .open-room'(event) {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tswal({\n\t\t\ttitle: t('Livechat_Take_Confirm'),\n\t\t\ttext: `${ t('Message') }: ${ this.message }`,\n\t\t\tshowCancelButton: true,\n\t\t\tconfirmButtonColor: '#3085d6',\n\t\t\tcancelButtonColor: '#d33',\n\t\t\tconfirmButtonText: t('Take_it')\n\t\t}, (isConfirm) => {\n\t\t\tif (isConfirm) {\n\t\t\t\tMeteor.call('livechat:takeInquiry', this._id, (error, result) => {\n\t\t\t\t\tif (!error) {\n\t\t\t\t\t\tRocketChat.roomTypes.openRouteLink(result.t, result);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n\nTemplate.livechat.onCreated(function() {\n\tthis.statusLivechat = new ReactiveVar();\n\n\tthis.autorun(() => {\n\t\tif (Meteor.userId()) {\n\t\t\tconst user = RocketChat.models.Users.findOne(Meteor.userId(), { fields: { statusLivechat: 1 } });\n\t\t\tthis.statusLivechat.set(user.statusLivechat);\n\t\t} else {\n\t\t\tthis.statusLivechat.set();\n\t\t}\n\t});\n\n\tthis.subscribe('livechat:inquiry');\n});\n","Template.livechatFlex.helpers({\n\tactive(...routes) {\n\t\tFlowRouter.watchPathChange();\n\t\tif (routes.indexOf(FlowRouter.current().route.name) !== -1) {\n\t\t\treturn 'active';\n\t\t}\n\t}\n});\n\nTemplate.livechatFlex.events({\n\t'mouseenter header'() {\n\t\tSideNav.overArrow();\n\t},\n\n\t'mouseleave header'() {\n\t\tSideNav.leaveArrow();\n\t},\n\n\t'click header'() {\n\t\tSideNav.closeFlex();\n\t}\n});\n","class LivechatExternalMessage extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper('livechat_external_message');\n\n\t\tif (Meteor.isClient) {\n\t\t\tthis._initModel('livechat_external_message');\n\t\t}\n\t}\n\n\t// FIND\n\tfindByRoomId(roomId, sort = { ts: -1 }) {\n\t\tconst query = { rid: roomId };\n\n\t\treturn this.find(query, { sort });\n\t}\n}\n\nRocketChat.models.LivechatExternalMessage = new LivechatExternalMessage();\n"]}