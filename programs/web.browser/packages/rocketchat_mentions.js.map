{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:mentions/client.js"],"names":["MentionsClient","message","msg","html","trim","msgMentionRegex","RegExp","RocketChat","settings","get","me","Meteor","user","username","replace","match","mention","includes","temp","_","findWhere","mentions","msgChannelRegex","name","channels","callbacks","add","priority","MEDIUM"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;GAKA,SAASA,cAAT,CAAwBC,OAAxB,EAAiC;AAChC,KAAIC,MAAOD,WAAWA,QAAQE,IAApB,IAA6B,EAAvC;;AACA,KAAI,CAACD,IAAIE,IAAJ,EAAL,EAAiB;AAChB,SAAOH,OAAP;AACA;;AACD,KAAMI,kBAAkB,IAAIC,MAAJ,sBAA+BC,WAAWC,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAA/B,kBAAgG,GAAhG,CAAxB;AAEA,KAAIC,KAAKC,OAAOC,IAAP,EAAT;AACAF,MAAKA,KAAKA,GAAGG,QAAR,GAAmB,IAAxB;AAEAX,OAAMA,IAAIY,OAAJ,CAAYT,eAAZ,EAA6B,UAASU,KAAT,EAAgBC,OAAhB,EAAyBH,QAAzB,EAAmC;AACrE,MAAI,CAAC,KAAD,EAAQ,MAAR,EAAgBI,QAAhB,CAAyBJ,QAAzB,CAAJ,EAAwC;AACvC,UAAOE,MAAMD,OAAN,CAAcE,OAAd,6FAA+GA,OAA/G,UAAP;AACA;;AACD,MAAIf,QAAQiB,IAAR,IAAgB,IAAhB,IAAwBC,EAAEC,SAAF,CAAYnB,QAAQoB,QAApB,EAA8B;AAACR;AAAD,GAA9B,KAA6C,IAAzE,EAA+E;AAC9E,UAAOE,KAAP;AACA;;AACD,SAAOA,MAAMD,OAAN,CAAcE,OAAd,gCAAkDH,aAAaH,EAAb,GAAkB,iDAAlB,GAAoE,EAAtH,4BAA8IG,QAA9I,WAA6JG,OAA7J,UAAP;AACA,EARK,CAAN;AAUA,KAAMM,kBAAkB,IAAIhB,MAAJ,sBAA+BC,WAAWC,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAA/B,gBAA8F,GAA9F,CAAxB;AAEAP,OAAMA,IAAIY,OAAJ,CAAYQ,eAAZ,EAA6B,UAASP,KAAT,EAAgBC,OAAhB,EAAyBO,IAAzB,EAA+B;AACjE,MAAItB,QAAQiB,IAAR,IAAgB,IAAhB,IAAwBC,EAAEC,SAAF,CAAYnB,QAAQuB,QAApB,EAA8B;AAACD;AAAD,GAA9B,KAAyC,IAArE,EAA2E;AAC1E,UAAOR,KAAP;AACA;;AACD,SAAOA,MAAMD,OAAN,CAAcE,OAAd,gDAAiEO,IAAjE,WAA4EP,OAA5E,UAAP;AACA,EALK,CAAN;AAMAf,SAAQE,IAAR,GAAeD,GAAf;AACA,QAAOD,OAAP;AACA;;AAGDM,WAAWkB,SAAX,CAAqBC,GAArB,CAAyB,eAAzB,EAA0C1B,cAA1C,EAA0DO,WAAWkB,SAAX,CAAqBE,QAArB,CAA8BC,MAAxF,EAAgG,kBAAhG;AAEArB,WAAWkB,SAAX,CAAqBC,GAArB,CAAyB,gBAAzB,EAA2C1B,cAA3C,EAA2DO,WAAWkB,SAAX,CAAqBE,QAArB,CAA8BC,MAAzF,EAAiG,mBAAjG,E","file":"/packages/rocketchat_mentions.js","sourcesContent":["/*\n * Mentions is a named function that will process Mentions\n * @param {Object} message - The message object\n */\n\nfunction MentionsClient(message) {\n\tlet msg = (message && message.html) || '';\n\tif (!msg.trim()) {\n\t\treturn message;\n\t}\n\tconst msgMentionRegex = new RegExp(`(?:^|\\\\s|\\\\n)(@(${ RocketChat.settings.get('UTF8_Names_Validation') }):?)[:.,\\s]?`, 'g');\n\n\tlet me = Meteor.user();\n\tme = me ? me.username : null;\n\n\tmsg = msg.replace(msgMentionRegex, function(match, mention, username) {\n\t\tif (['all', 'here'].includes(username)) {\n\t\t\treturn match.replace(mention, `<a class=\"mention-link mention-link-me mention-link-all background-attention-color\">${ mention }</a>`);\n\t\t}\n\t\tif (message.temp == null && _.findWhere(message.mentions, {username}) == null) {\n\t\t\treturn match;\n\t\t}\n\t\treturn match.replace(mention, `<a class=\"mention-link ${ username === me ? 'mention-link-me background-primary-action-color':'' }\" data-username=\"${ username }\">${ mention }</a>`);\n\t});\n\n\tconst msgChannelRegex = new RegExp(`(?:^|\\\\s|\\\\n)(#(${ RocketChat.settings.get('UTF8_Names_Validation') }))[:.,\\s]?`, 'g');\n\n\tmsg = msg.replace(msgChannelRegex, function(match, mention, name) {\n\t\tif (message.temp == null && _.findWhere(message.channels, {name}) == null) {\n\t\t\treturn match;\n\t\t}\n\t\treturn match.replace(mention, `<a class=\"mention-link\" data-channel=\"${ name }\">${ mention }</a>`);\n\t});\n\tmessage.html = msg;\n\treturn message;\n}\n\n\nRocketChat.callbacks.add('renderMessage', MentionsClient, RocketChat.callbacks.priority.MEDIUM, 'mentions-message');\n\nRocketChat.callbacks.add('renderMentions', MentionsClient, RocketChat.callbacks.priority.MEDIUM, 'mentions-mentions');\n"]}