{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:sms/settings.js","meteor://ðŸ’»app/packages/rocketchat:sms/SMS.js","meteor://ðŸ’»app/packages/rocketchat:sms/services/twilio.js"],"names":["Meteor","startup","RocketChat","settings","addGroup","add","type","i18nLabel","values","key","section","enableQuery","_id","value","SMS","enabled","services","accountSid","authToken","fromNumber","registerService","name","service","getService","Error","get","Twilio","parse","data","from","From","to","To","body","Body","extra","toCountry","ToCountry","toState","ToState","toCity","ToCity","toZip","ToZip","fromCountry","FromCountry","fromState","FromState","fromCity","FromCity","fromZip","FromZip","send","toNumber","message","client","Npm","require","messages","create","response","headers","error","reason"],"mappings":"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","file":"/packages/rocketchat_sms.js","sourcesContent":["Meteor.startup(function() {\n\tRocketChat.settings.addGroup('SMS', function() {\n\t\tthis.add('SMS_Enabled', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Enabled'\n\t\t});\n\n\t\tthis.add('SMS_Service', 'twilio', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [{\n\t\t\t\tkey: 'twilio',\n\t\t\t\ti18nLabel: 'Twilio'\n\t\t\t}],\n\t\t\ti18nLabel: 'Service'\n\t\t});\n\n\t\tthis.section('Twilio', function() {\n\t\t\tthis.add('SMS_Twilio_Account_SID', '', {\n\t\t\t\ttype: 'string',\n\t\t\t\tenableQuery: {\n\t\t\t\t\t_id: 'SMS_Service',\n\t\t\t\t\tvalue: 'twilio'\n\t\t\t\t},\n\t\t\t\ti18nLabel: 'Account_SID'\n\t\t\t});\n\t\t\tthis.add('SMS_Twilio_authToken', '', {\n\t\t\t\ttype: 'string',\n\t\t\t\tenableQuery: {\n\t\t\t\t\t_id: 'SMS_Service',\n\t\t\t\t\tvalue: 'twilio'\n\t\t\t\t},\n\t\t\t\ti18nLabel: 'Auth_Token'\n\t\t\t});\n\t\t});\n\t});\n});\n","/* globals RocketChat */\nRocketChat.SMS = {\n\tenabled: false,\n\tservices: {},\n\taccountSid: null,\n\tauthToken: null,\n\tfromNumber: null,\n\n\tregisterService(name, service) {\n\t\tthis.services[name] = service;\n\t},\n\n\tgetService(name) {\n\t\tif (!this.services[name]) {\n\t\t\tthrow new Meteor.Error('error-sms-service-not-configured');\n\t\t}\n\t\treturn new this.services[name](this.accountSid, this.authToken, this.fromNumber);\n\t}\n};\n\nRocketChat.settings.get('SMS_Enabled', function(key, value) {\n\tRocketChat.SMS.enabled = value;\n});\n","/* globals RocketChat */\nclass Twilio {\n\tconstructor() {\n\t\tthis.accountSid = RocketChat.settings.get('SMS_Twilio_Account_SID');\n\t\tthis.authToken = RocketChat.settings.get('SMS_Twilio_authToken');\n\t}\n\tparse(data) {\n\t\treturn {\n\t\t\tfrom: data.From,\n\t\t\tto: data.To,\n\t\t\tbody: data.Body,\n\n\t\t\textra: {\n\t\t\t\ttoCountry: data.ToCountry,\n\t\t\t\ttoState: data.ToState,\n\t\t\t\ttoCity: data.ToCity,\n\t\t\t\ttoZip: data.ToZip,\n\t\t\t\tfromCountry: data.FromCountry,\n\t\t\t\tfromState: data.FromState,\n\t\t\t\tfromCity: data.FromCity,\n\t\t\t\tfromZip: data.FromZip\n\t\t\t}\n\t\t};\n\t}\n\tsend(fromNumber, toNumber, message) {\n\t\tconst client = Npm.require('twilio')(this.accountSid, this.authToken);\n\n\t\tclient.messages.create({\n\t\t\tto: toNumber,\n\t\t\tfrom: fromNumber,\n\t\t\tbody: message\n\t\t});\n\t}\n\tresponse(/* message */) {\n\t\treturn {\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'text/xml'\n\t\t\t},\n\t\t\tbody: '<Response></Response>'\n\t\t};\n\t}\n\terror(error) {\n\t\tlet message = '';\n\t\tif (error.reason) {\n\t\t\tmessage = `<Message>${ error.reason }</Message>`;\n\t\t}\n\t\treturn {\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'text/xml'\n\t\t\t},\n\t\t\tbody: `<Response>${ message }</Response>`\n\t\t};\n\t}\n}\n\nRocketChat.SMS.registerService('twilio', Twilio);\n"]}