{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:mailer/lib/Mailer.js","meteor://ðŸ’»app/packages/rocketchat:mailer/client/startup.js","meteor://ðŸ’»app/packages/rocketchat:mailer/client/router.js","meteor://ðŸ’»app/packages/rocketchat:mailer/client/views/mailer.js","meteor://ðŸ’»app/packages/rocketchat:mailer/client/views/mailerUnsubscribe.js"],"names":["Mailer","RocketChat","AdminBox","addOption","href","i18nLabel","permissionGranted","authz","hasAllPermission","FlowRouter","route","name","action","BlazeLayout","render","center","params","Meteor","call","_id","createdAt","toastr","module","watch","require","v","Template","mailer","helpers","fromEmail","settings","get","events","e","t","preventDefault","from","$","find","val","subject","body","dryrun","query","error","TAPi18n","__","indexOf","err","handleError","success","mailerUnsubscribe","onRendered","remove"],"mappings":"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","file":"/packages/rocketchat_mailer.js","sourcesContent":["Mailer = {};//eslint-disable-line\n","RocketChat.AdminBox.addOption({\n\thref: 'mailer',\n\ti18nLabel: 'Mailer',\n\tpermissionGranted() {\n\t\treturn RocketChat.authz.hasAllPermission('access-mailer');\n\t}\n});\n","FlowRouter.route('/mailer', {\n\tname: 'mailer',\n\taction() {\n\t\treturn BlazeLayout.render('main', {\n\t\t\tcenter: 'mailer'\n\t\t});\n\t}\n});\n\nFlowRouter.route('/mailer/unsubscribe/:_id/:createdAt', {\n\tname: 'mailer-unsubscribe',\n\taction(params) {\n\t\tMeteor.call('Mailer:unsubscribe', params._id, params.createdAt);\n\t\treturn BlazeLayout.render('mailerUnsubscribe');\n\t}\n});\n","import toastr from 'toastr';\nTemplate.mailer.helpers({\n\tfromEmail() {\n\t\treturn RocketChat.settings.get('From_Email');\n\t}\n});\n\nTemplate.mailer.events({\n\t'click .send'(e, t) {\n\t\te.preventDefault();\n\t\tconst from = $(t.find('[name=from]')).val();\n\t\tconst subject = $(t.find('[name=subject]')).val();\n\t\tconst body = $(t.find('[name=body]')).val();\n\t\tconst dryrun = $(t.find('[name=dryrun]:checked')).val();\n\t\tconst query = $(t.find('[name=query]')).val();\n\t\tif (!from) {\n\t\t\ttoastr.error(TAPi18n.__('error-invalid-from-address'));\n\t\t\treturn;\n\t\t}\n\t\tif (body.indexOf('[unsubscribe]') === -1) {\n\t\t\ttoastr.error(TAPi18n.__('error-missing-unsubscribe-link'));\n\t\t\treturn;\n\t\t}\n\t\treturn Meteor.call('Mailer.sendMail', from, subject, body, dryrun, query, function(err) {\n\t\t\tif (err) {\n\t\t\t\treturn handleError(err);\n\t\t\t}\n\t\t\treturn toastr.success(TAPi18n.__('The_emails_are_being_sent'));\n\t\t});\n\t}\n});\n","Template.mailerUnsubscribe.onRendered(function() {\n\treturn $('#initial-page-loading').remove();\n});\n"]}