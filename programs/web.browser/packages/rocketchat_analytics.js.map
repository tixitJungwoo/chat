{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:analytics/client/loadScript.js","meteor://ðŸ’»app/packages/rocketchat:analytics/client/trackEvents.js"],"names":["Template","body","onRendered","Tracker","autorun","c","piwikUrl","RocketChat","settings","get","piwikSiteId","googleId","stop","window","_paq","Meteor","userId","push","Number","parseInt","d","document","g","createElement","s","getElementsByTagName","type","async","defer","src","parentNode","insertBefore","i","o","r","a","m","q","arguments","l","Date","ga","trackEvent","category","action","label","FlowRouter","triggers","enter","route","http","location","protocol","slashes","concat","host","hostname","path","callbacks","add","state","priority","MEDIUM","message","room","ChatRoom","findOne","_id","rid","name","owner","oldUserId","newUserId","status","service"],"mappings":"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","file":"/packages/rocketchat_analytics.js","sourcesContent":["Template.body.onRendered(() => {\n\tTracker.autorun((c) => {\n\t\tconst piwikUrl = RocketChat.settings.get('PiwikAnalytics_enabled') && RocketChat.settings.get('PiwikAnalytics_url');\n\t\tconst piwikSiteId = piwikUrl && RocketChat.settings.get('PiwikAnalytics_siteId');\n\t\tconst googleId = RocketChat.settings.get('GoogleAnalytics_enabled') && RocketChat.settings.get('GoogleAnalytics_ID');\n\t\tif (piwikSiteId || googleId) {\n\t\t\tc.stop();\n\n\t\t\tif (piwikSiteId) {\n\t\t\t\twindow._paq = window._paq || [];\n\t\t\t\tif (Meteor.userId()) {\n\t\t\t\t\twindow._paq.push(['setUserId', Meteor.userId()]);\n\t\t\t\t}\n\n\t\t\t\twindow._paq.push(['trackPageView']);\n\t\t\t\twindow._paq.push(['enableLinkTracking']);\n\t\t\t\t(() => {\n\t\t\t\t\twindow._paq.push(['setTrackerUrl', `${ piwikUrl }piwik.php`]);\n\t\t\t\t\twindow._paq.push(['setSiteId', Number.parseInt(piwikSiteId)]);\n\t\t\t\t\tconst d = document;\n\t\t\t\t\tconst g = d.createElement('script');\n\t\t\t\t\tconst s = d.getElementsByTagName('script')[0];\n\t\t\t\t\tg.type = 'text/javascript';\n\t\t\t\t\tg.async = true;\n\t\t\t\t\tg.defer = true;\n\t\t\t\t\tg.src = `${ piwikUrl }piwik.js`;\n\t\t\t\t\ts.parentNode.insertBefore(g, s);\n\t\t\t\t})();\n\t\t\t}\n\n\t\t\tif (googleId) {\n\t\t\t\t/*eslint-disable */\n\t\t\t  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n\t\t\t  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n\t\t\t  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n\t\t\t  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\n\n\t\t\t  ga('create', googleId, 'auto');\n\t\t\t  ga('send', 'pageview');\n\t\t\t\t/*eslint-enable */\n\t\t\t}\n\t\t}\n\t});\n});\n","function trackEvent(category, action, label) {\n\tif (window._paq) {\n\t\twindow._paq.push(['trackEvent', category, action, label]);\n\t}\n\tif (window.ga) {\n\t\twindow.ga('send', 'event', category, action, label);\n\t}\n}\n\nif (!window._paq || window.ga) {\n\t//Trigger the trackPageView manually as the page views don't seem to be tracked\n\tFlowRouter.triggers.enter([(route) => {\n\t\tif (window._paq) {\n\t\t\tconst http = location.protocol;\n\t\t\tconst slashes = http.concat('//');\n\t\t\tconst host = slashes.concat(window.location.hostname);\n\t\t\twindow._paq.push(['setCustomUrl', host + route.path]);\n\t\t\twindow._paq.push(['trackPageView']);\n\t\t}\n\t\tif (window.ga) {\n\t\t\twindow.ga('send', 'pageview', route.path);\n\t\t}\n\t}]);\n\n\t//Login page has manual switches\n\tRocketChat.callbacks.add('loginPageStateChange', (state) => {\n\t\ttrackEvent('Navigation', 'Login Page State Change', state);\n\t}, RocketChat.callbacks.priority.MEDIUM, 'analytics-login-state-change');\n\n\t//Messsages\n\tRocketChat.callbacks.add('afterSaveMessage', (message) => {\n\t\tif ((window._paq || window.ga) && RocketChat.settings.get('Analytics_features_messages')) {\n\t\t\tconst room = ChatRoom.findOne({ _id: message.rid });\n\t\t\ttrackEvent('Message', 'Send', `${ room.name } (${ room._id })`);\n\t\t}\n\t}, 2000, 'trackEvents');\n\n\t//Rooms\n\tRocketChat.callbacks.add('afterCreateChannel', (owner, room) => {\n\t\tif (RocketChat.settings.get('Analytics_features_rooms')) {\n\t\t\ttrackEvent('Room', 'Create', `${ room.name } (${ room._id })`);\n\t\t}\n\t}, RocketChat.callbacks.priority.MEDIUM, 'analytics-after-create-channel');\n\n\tRocketChat.callbacks.add('roomNameChanged', (room) => {\n\t\tif (RocketChat.settings.get('Analytics_features_rooms')) {\n\t\t\ttrackEvent('Room', 'Changed Name', `${ room.name } (${ room._id })`);\n\t\t}\n\t}, RocketChat.callbacks.priority.MEDIUM, 'analytics-room-name-changed');\n\n\tRocketChat.callbacks.add('roomTopicChanged', (room) => {\n\t\tif (RocketChat.settings.get('Analytics_features_rooms')) {\n\t\t\ttrackEvent('Room', 'Changed Topic', `${ room.name } (${ room._id })`);\n\t\t}\n\t}, RocketChat.callbacks.priority.MEDIUM, 'analytics-room-topic-changed');\n\n\tRocketChat.callbacks.add('roomAnnouncementChanged', (room) => {\n\t\tif (RocketChat.settings.get('Analytics_features_rooms')) {\n\t\t\ttrackEvent('Room', 'Changed Announcement', `${ room.name } (${ room._id })`);\n\t\t}\n\t}, RocketChat.callbacks.priority.MEDIUM, 'analytics-room-announcement-changed');\n\n\tRocketChat.callbacks.add('roomTypeChanged', (room) => {\n\t\tif (RocketChat.settings.get('Analytics_features_rooms')) {\n\t\t\ttrackEvent('Room', 'Changed Room Type', `${ room.name } (${ room._id })`);\n\t\t}\n\t}, RocketChat.callbacks.priority.MEDIUM, 'analytics-room-type-changed');\n\n\tRocketChat.callbacks.add('archiveRoom', (room) => {\n\t\tif (RocketChat.settings.get('Analytics_features_rooms')) {\n\t\t\ttrackEvent('Room', 'Archived', `${ room.name } (${ room._id })`);\n\t\t}\n\t}, RocketChat.callbacks.priority.MEDIUM, 'analytics-archive-room');\n\n\tRocketChat.callbacks.add('unarchiveRoom', (room) => {\n\t\tif (RocketChat.settings.get('Analytics_features_rooms')) {\n\t\t\ttrackEvent('Room', 'Unarchived', `${ room.name } (${ room._id })`);\n\t\t}\n\t}, RocketChat.callbacks.priority.MEDIUM, 'analytics-unarchive-room');\n\n\t//Users\n\t//Track logins and associate user ids with piwik\n\t(() => {\n\t\tlet oldUserId = null;\n\n\t\tMeteor.autorun(() => {\n\t\t\tconst newUserId = Meteor.userId();\n\t\t\tif (oldUserId === null && newUserId) {\n\t\t\t\tif (window._paq && RocketChat.settings.get('Analytics_features_users')) {\n\t\t\t\t\ttrackEvent('User', 'Login', newUserId);\n\t\t\t\t\twindow._paq.push(['setUserId', newUserId]);\n\t\t\t\t}\n\t\t\t} else if (newUserId === null && oldUserId) {\n\t\t\t\tif (window._paq && RocketChat.settings.get('Analytics_features_users')) {\n\t\t\t\t\ttrackEvent('User', 'Logout', oldUserId);\n\t\t\t\t}\n\t\t\t}\n\t\t\toldUserId = Meteor.userId();\n\t\t});\n\t})();\n\n\tRocketChat.callbacks.add('userRegistered', () => {\n\t\tif (RocketChat.settings.get('Analytics_features_users')) {\n\t\t\ttrackEvent('User', 'Registered');\n\t\t}\n\t}, RocketChat.callbacks.priority.MEDIUM, 'piwik-user-resitered');\n\n\tRocketChat.callbacks.add('usernameSet', () => {\n\t\tif (RocketChat.settings.get('Analytics_features_users')) {\n\t\t\ttrackEvent('User', 'Username Set');\n\t\t}\n\t}, RocketChat.callbacks.priority.MEDIUM, 'piweik-username-set');\n\n\tRocketChat.callbacks.add('userPasswordReset', () => {\n\t\tif (RocketChat.settings.get('Analytics_features_users')) {\n\t\t\ttrackEvent('User', 'Reset Password');\n\t\t}\n\t}, RocketChat.callbacks.priority.MEDIUM, 'piwik-user-password-reset');\n\n\tRocketChat.callbacks.add('userConfirmationEmailRequested', () => {\n\t\tif (RocketChat.settings.get('Analytics_features_users')) {\n\t\t\ttrackEvent('User', 'Confirmation Email Requested');\n\t\t}\n\t}, RocketChat.callbacks.priority.MEDIUM, 'piwik-user-confirmation-email-requested');\n\n\tRocketChat.callbacks.add('userForgotPasswordEmailRequested', () => {\n\t\tif (RocketChat.settings.get('Analytics_features_users')) {\n\t\t\ttrackEvent('User', 'Forgot Password Email Requested');\n\t\t}\n\t}, RocketChat.callbacks.priority.MEDIUM, 'piwik-user-forgot-password-email-requested');\n\n\tRocketChat.callbacks.add('userStatusManuallySet', (status) => {\n\t\tif (RocketChat.settings.get('Analytics_features_users')) {\n\t\t\ttrackEvent('User', 'Status Manually Changed', status);\n\t\t}\n\t}, RocketChat.callbacks.priority.MEDIUM, 'analytics-user-status-manually-set');\n\n\tRocketChat.callbacks.add('userAvatarSet', (service) => {\n\t\tif (RocketChat.settings.get('Analytics_features_users')) {\n\t\t\ttrackEvent('User', 'Avatar Changed', service);\n\t\t}\n\t}, RocketChat.callbacks.priority.MEDIUM, 'analytics-user-avatar-set');\n}\n"]}