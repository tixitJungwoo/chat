{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:cas/cas_client.js"],"names":["openCenteredPopup","url","width","height","screenX","window","screenLeft","screenY","screenTop","outerWidth","document","body","clientWidth","outerHeight","clientHeight","left","top","features","newwindow","open","focus","Meteor","loginWithCas","options","callback","credentialToken","Random","id","login_url","RocketChat","settings","get","popup_width","popup_height","appUrl","absoluteUrl","replace","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","loginUrl","popup","isCordova","addEventListener","e","indexOf","close","Accounts","callLoginMethod","methodArguments","cas","userCallback","checkPopupOpen","setInterval","popupClosed","closed","undefined","clearInterval"],"mappings":"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","file":"/packages/rocketchat_cas.js","sourcesContent":["const openCenteredPopup = function(url, width, height) {\n\n\tconst screenX = typeof window.screenX !== 'undefined' ? window.screenX : window.screenLeft;\n\tconst screenY = typeof window.screenY !== 'undefined' ? window.screenY : window.screenTop;\n\tconst outerWidth = typeof window.outerWidth !== 'undefined' ? window.outerWidth : document.body.clientWidth;\n\tconst outerHeight = typeof window.outerHeight !== 'undefined' ? window.outerHeight : (document.body.clientHeight - 22);\n\t// XXX what is the 22?\n\n\t// Use `outerWidth - width` and `outerHeight - height` for help in\n\t// positioning the popup centered relative to the current window\n\tconst left = screenX + (outerWidth - width) / 2;\n\tconst top = screenY + (outerHeight - height) / 2;\n\tconst features = (`width=${ width },height=${ height },left=${ left },top=${ top },scrollbars=yes`);\n\n\tconst newwindow = window.open(url, 'Login', features);\n\tif (newwindow.focus) {\n\t\tnewwindow.focus();\n\t}\n\n\treturn newwindow;\n};\n\nMeteor.loginWithCas = function(options, callback) {\n\toptions = options || {};\n\n\tconst credentialToken = Random.id();\n\tconst login_url = RocketChat.settings.get('CAS_login_url');\n\tconst popup_width = RocketChat.settings.get('CAS_popup_width');\n\tconst popup_height = RocketChat.settings.get('CAS_popup_height');\n\n\tif (!login_url) {\n\t\treturn;\n\t}\n\n\tconst appUrl = Meteor.absoluteUrl().replace(/\\/$/, '') + __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n\tconst loginUrl = `${ login_url }?service=${ appUrl }/_cas/${ credentialToken }`;\n\n\tconst popup = openCenteredPopup(\n\t\tloginUrl,\n\t\tpopup_width || 800,\n\t\tpopup_height || 600\n\t);\n\n\t// Fix for #3200: monitor the popup differently if it's Cordova\n\tif (Meteor.isCordova) {\n\t\t// Check the URL when each page finishes loading, and if the URL contains \"ticket\", then close the popup because CAS has finished\n\t\tpopup.addEventListener('loadstop', function(e) {\n\t\t\tif (e.url.indexOf('?ticket=') !== -1) {\n\t\t\t\tpopup.close();\n\t\t\t}\n\t\t});\n\t\tpopup.addEventListener('exit', function() {\n\t\t\t// check auth on server.\n\t\t\tAccounts.callLoginMethod({\n\t\t\t\tmethodArguments: [{ cas: { credentialToken } }],\n\t\t\t\tuserCallback: callback\n\t\t\t});\n\t\t});\n\t} else {\n\t\tconst checkPopupOpen = setInterval(function() {\n\t\t\tlet popupClosed;\n\t\t\ttry {\n\t\t\t\t// Fix for #328 - added a second test criteria (popup.closed === undefined)\n\t\t\t\t// to humour this Android quirk:\n\t\t\t\t// http://code.google.com/p/android/issues/detail?id=21061\n\t\t\t\tpopupClosed = popup.closed || popup.closed === undefined;\n\t\t\t} catch (e) {\n\t\t\t\t// For some unknown reason, IE9 (and others?) sometimes (when\n\t\t\t\t// the popup closes too quickly?) throws \"SCRIPT16386: No such\n\t\t\t\t// interface supported\" when trying to read 'popup.closed'. Try\n\t\t\t\t// again in 100ms.\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (popupClosed) {\n\t\t\t\tclearInterval(checkPopupOpen);\n\n\t\t\t\t// check auth on server.\n\t\t\t\tAccounts.callLoginMethod({\n\t\t\t\t\tmethodArguments: [{ cas: { credentialToken } }],\n\t\t\t\t\tuserCallback: callback\n\t\t\t\t});\n\t\t\t}\n\t\t}, 100);\n\t}\n};\n"]}