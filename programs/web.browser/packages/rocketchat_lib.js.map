{"version":3,"sources":["meteor://💻app/packages/rocketchat:lib/lib/core.js","meteor://💻app/packages/rocketchat:lib/lib/getURL.js","meteor://💻app/packages/rocketchat:lib/lib/settings.js","meteor://💻app/packages/rocketchat:lib/lib/callbacks.js","meteor://💻app/packages/rocketchat:lib/lib/fileUploadRestrictions.js","meteor://💻app/packages/rocketchat:lib/lib/placeholders.js","meteor://💻app/packages/rocketchat:lib/lib/promises.js","meteor://💻app/packages/rocketchat:lib/lib/roomTypesCommon.js","meteor://💻app/packages/rocketchat:lib/lib/slashCommand.js","meteor://💻app/packages/rocketchat:lib/lib/Message.js","meteor://💻app/packages/rocketchat:lib/lib/MessageTypes.js","meteor://💻app/packages/rocketchat:lib/lib/startup/settingsOnLoadSiteUrl.js","meteor://💻app/packages/rocketchat:lib/client/Notifications.js","meteor://💻app/packages/rocketchat:lib/client/OAuthProxy.js","meteor://💻app/packages/rocketchat:lib/client/lib/TabBar.js","meteor://💻app/packages/rocketchat:lib/client/lib/RocketChatTabBar.js","meteor://💻app/packages/rocketchat:lib/client/lib/cachedCollection.js","meteor://💻app/packages/rocketchat:lib/client/lib/openRoom.js","meteor://💻app/packages/rocketchat:lib/client/lib/roomExit.js","meteor://💻app/packages/rocketchat:lib/client/lib/settings.js","meteor://💻app/packages/rocketchat:lib/client/lib/roomTypes.js","meteor://💻app/packages/rocketchat:lib/client/lib/userRoles.js","meteor://💻app/packages/rocketchat:lib/client/lib/Layout.js","meteor://💻app/packages/rocketchat:lib/client/methods/sendMessage.js","meteor://💻app/packages/rocketchat:lib/client/AdminBox.js","meteor://💻app/packages/rocketchat:lib/client/MessageAction.js","meteor://💻app/packages/rocketchat:lib/client/defaultTabBars.js","meteor://💻app/packages/rocketchat:lib/client/CustomTranslations.js","meteor://💻app/packages/rocketchat:lib/client/models/_Base.js","meteor://💻app/packages/rocketchat:lib/client/models/Uploads.js","meteor://💻app/packages/rocketchat:lib/client/views/customFieldsForm.js","meteor://💻app/packages/rocketchat:lib/startup/defaultRoomTypes.js"],"names":["RocketChat","models","getURL","path","cdn","full","cdnPrefix","_","rtrim","trim","settings","get","pathPrefix","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","basePath","finalPath","ltrim","Meteor","isCordova","absoluteUrl","callbacks","regexCallbacks","ts","Date","_id","callback","onload","Object","keys","forEach","value","key","isRegExp","test","reduce","items","push","set","call","batchSet","save","setting","editor","actions","map","reduceRight","wrap","err","success","load","initialLoad","item","cbValue","cbKey","regex","concat","k","name","source","isServer","showTime","showTotalTime","priority","HIGH","MEDIUM","LOW","add","hook","id","isNumber","Random","Error","stack","find","cb","remove","hookName","reject","run","constant","length","totalTime","result","sortBy","time","now","callbackResult","currentTime","statsTracker","timing","split","match","console","log","String","runAsync","defer","fileUploadMediaWhiteList","mediaTypeWhiteList","fileUploadIsValidContentType","type","list","contains","wildCardGlob","wildcards","filter","indexOf","replace","placeholders","str","data","strLeft","strRightBack","email","password","unsubscribe","promises","p","Promise","resolve","previousPromise","then","roomTypesCommon","roomTypes","roomTypesOrder","mainOrder","identifier","order","config","route","action","routeConfig","isClient","triggersExit","roomExit","FlowRouter","hasCustomLink","roomType","link","getRouteLink","subData","routeData","openRouteLink","queryParams","go","module","exportDefault","slashCommands","commands","command","options","params","description","clientOnly","methods","slashCommand","userId","method","cmd","msg","Message","parse","language","messageType","MessageTypes","getType","render","template","message","localStorage","getItem","TAPi18n","__","u","username","html","escapeHTML","types","registerType","t","isSystemMessage","system","isChartMessage","startup","room_name","user_by","user_added","user_removed","user_left","user","user_muted","user_unmuted","role","host","ROOT_URL","defaultOptions","rootUrl","hostname","process","env","MOBILE_ROOT_URL","MOBILE_DDP_URL","WebAppInternals","generateBoilerplate","Notifications","logged","loginCb","Tracker","autorun","debug","streamAll","Streamer","streamLogged","streamRoom","streamRoomUsers","streamUser","onAll","arguments","onUser","onLogin","notifyRoom","room","eventName","args","unshift","emit","apply","notifyUser","notifyUsersOfRoom","on","onLogged","onRoom","unAll","removeListener","unLogged","unRoom","unUser","OAuth","launchLogin","func","proxy","includes","loginService","redirect_uri","loginUrl","encodeURIComponent","TabBar","buttons","ReactiveVar","extraGroups","show","$","hide","addButton","btns","curValue","groups","union","removeButton","updateButton","extend","getButtons","toArray","getButton","findWhere","addGroup","removeGroup","difference","RocketChatTabBar","group","state","getTemplate","setTemplate","currentGroup","showGroup","setData","d","getData","getState","open","button","width","css","afterFlush","focus","scrollTop","close","localforage","watch","require","v","CachedCollectionManager","_syncEnabled","reconnectCb","_unstoreLoginToken","Accounts","clearAllCacheOnLogout","connectionWasOnline","connected","connection","status","register","cachedCollection","clearAllCache","clearCache","clearCacheOnLogout","countQueries","onReconnect","check","Boolean","CachedCollection","collection","methodName","syncMethodName","eventType","userRelated","useSync","useCache","version","maxCacheTime","Mongo","Collection","ready","updatedAt","initiated","init","_collection","queries","recomputeCollectionQueries","each","query","_recomputeResults","getToken","undefined","_storedLoginToken","loadFromCache","error","token","records","record","__cache__","upsert","omit","_updatedAt","loadFromServer","$loki","loadFromServerAndPopulate","loadedData","saveCache","sync","syncEnabled","_outstandingMethodBlocks","changes","update","sort","a","b","valueA","_deletedAt","valueB","fetch","setItem","removeItem","setupListener","trySync","interval","setInterval","clearInterval","cacheLoaded","export","openRoom","currentTracker","Session","c","BlazeLayout","RoomManager","modal","Layout","isEmbedded","center","stop","findRoom","Rooms","mainNode","document","querySelector","Array","from","children","child","removeChild","roomDom","getDomOfRoom","appendChild","classList","oldScrollTop","fireGlobalEvent","updateMentionsMarksOfRoom","setTimeout","readMessage","readNow","Device","isDesktop","window","chatMessages","sub","ChatSubscription","findOne","rid","handleError","getQueryParam","RoomHistoryManager","getSurroundingMessages","wrapper","scrollHeight","clientHeight","dict","ReactiveDict","observe","added","changed","removed","siteUrl","authz","hasRole","sandstorm","location","origin","currentUrl","swal","title","text","showCancelButton","confirmButtonText","cancelButtonText","closeOnConfirm","timer","showConfirmButton","checkCondition","condition","getTypes","getIcon","icon","getRoomName","roomData","roomName","getSecondaryRoomName","secondaryRoomName","getIdentifiers","e","except","getUserStatus","roomId","canSendMessage","count","readOnly","fields","ro","muted","ChatRoom","userOwner","RoomRoles","roles","isArray","archived","verifyCanSendMessage","verifyShowJoinLink","showJoinLink","getNotSubscribedTpl","notSubscribedTpl","results","UserRoles","scope","$setOnInsert","$addToSet","$set","ChatMessage","multi","$pull","$inc","rerender","layout","sendMessage","isNaN","TimeSync","serverOffset","temp","insert","AdminBox","addOption","option","nonreactive","actual","getOptions","permissionGranted","moment","toastr","MessageAction","getButtonById","allButtons","context","allowedButtons","compact","validation","resetButtons","getPermaLink","msgId","routePath","pathname","hideDropDown","click","event","target","closest","is","i18nLabel","instance","_arguments","input","url","endsWith","Subscriptions","currentTarget","edit","updateAutogrow","hasPermission","hasAtLeastOnePermission","isEditAllowed","editOwn","blockEditInMinutes","msgTs","currentTsDiff","diff","confirmDeleteMsg","isDeleteAllowed","deleteOwn","blockDeleteInMinutes","classes","permalink","cordova","plugins","clipboard","copy","attr","i18nTitle","applyCustomTranslations","CustomTranslations","JSON","lang","hasOwnProperty","translations","TAPi18next","addResourceBundle","_language_changed_tracker","_loaded_lang_session_key","_Base","_baseName","_initModel","model","allow","deny","ensureIndex","dropIndex","tryEnsureIndex","tryDropIndex","Uploads","Template","customFieldsForm","helpers","customFields","customFieldsArray","hideFromForm","fieldName","field","selectedField","current","formData","defaultValue","fieldValue","onCreated","currentData","Accounts_CustomFields","subscription","fname","hasAllPermission"],"mappings":"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","file":"/packages/rocketchat_lib.js","sourcesContent":["\n/*\n* Kick off the global namespace for RocketChat.\n* @namespace RocketChat\n*/\nRocketChat = {\n\tmodels: {}\n};\n","RocketChat.getURL = (path, { cdn = true, full = false } = {}) => {\n\tconst cdnPrefix = _.rtrim(_.trim(RocketChat.settings.get('CDN_PREFIX') || ''), '/');\n\tconst pathPrefix = _.rtrim(_.trim(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX || ''), '/');\n\n\tlet basePath;\n\n\tconst finalPath = _.ltrim(_.trim(path), '/');\n\n\tif (cdn && cdnPrefix !== '') {\n\t\tbasePath = cdnPrefix + pathPrefix;\n\t} else if (full || Meteor.isCordova) {\n\t\treturn Meteor.absoluteUrl(finalPath);\n\t} else {\n\t\tbasePath = pathPrefix;\n\t}\n\n\treturn `${ basePath }/${ finalPath }`;\n};\n","\n/*\n* RocketChat.settings holds all packages settings\n* @namespace RocketChat.settings\n*/\nRocketChat.settings = {\n\tcallbacks: {},\n\tregexCallbacks: {},\n\tts: new Date,\n\tget(_id, callback) {\n\t\tif (callback != null) {\n\t\t\tRocketChat.settings.onload(_id, callback);\n\t\t\tif (!Meteor.settings) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (_id === '*') {\n\t\t\t\treturn Object.keys(Meteor.settings).forEach(key => {\n\t\t\t\t\tconst value = Meteor.settings[key];\n\t\t\t\t\tcallback(key, value);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (_.isRegExp(_id) && Meteor.settings) {\n\t\t\t\treturn Object.keys(Meteor.settings).forEach(key => {\n\t\t\t\t\tif (!_id.test(key)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst value = Meteor.settings[key];\n\t\t\t\t\tcallback(key, value);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Meteor.settings[_id] != null && callback(_id, Meteor.settings[_id]);\n\t\t} else {\n\t\t\tif (!Meteor.settings) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (_.isRegExp(_id)) {\n\t\t\t\treturn Object.keys(Meteor.settings).reduce((items, key) => {\n\t\t\t\t\tconst value = Meteor.settings[key];\n\t\t\t\t\tif (_id.test(key)) {\n\t\t\t\t\t\titems.push({\n\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\tvalue\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn items;\n\t\t\t\t}, []);\n\t\t\t}\n\t\t\treturn Meteor.settings && Meteor.settings[_id];\n\t\t}\n\t},\n\tset(_id, value, callback) {\n\t\treturn Meteor.call('saveSetting', _id, value, callback);\n\t},\n\tbatchSet(settings, callback) {\n\t\t// async -> sync\n\t\t// http://daemon.co.za/2012/04/simple-async-with-only-underscore/\n\t\tconst save = function(setting) {\n\t\t\treturn function(callback) {\n\t\t\t\treturn Meteor.call('saveSetting', setting._id, setting.value, setting.editor, callback);\n\t\t\t};\n\t\t};\n\t\tconst actions = _.map(settings, (setting) => save(setting));\n\t\treturn _(actions).reduceRight(_.wrap, (err, success) => callback(err, success))();\n\t},\n\tload(key, value, initialLoad) {\n\t\t['*', key].forEach(item => {\n\t\t\tif (RocketChat.settings.callbacks[item]) {\n\t\t\t\tRocketChat.settings.callbacks[item].forEach(callback => callback(key, value, initialLoad));\n\t\t\t}\n\t\t});\n\t\tObject.keys(RocketChat.settings.regexCallbacks).forEach(cbKey => {\n\t\t\tconst cbValue = RocketChat.settings.regexCallbacks[cbKey];\n\t\t\tif (!cbValue.regex.test(key)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcbValue.callbacks.forEach(callback => callback(key, value, initialLoad));\n\t\t});\n\t},\n\tonload(key, callback) {\n\t\t// if key is '*'\n\t\t// \tfor key, value in Meteor.settings\n\t\t// \t\tcallback key, value, false\n\t\t// else if Meteor.settings?[_id]?\n\t\t// \tcallback key, Meteor.settings[_id], false\n\t\tconst keys = [].concat(key);\n\t\tkeys.forEach(k => {\n\t\t\tif (_.isRegExp(k)) {\n\t\t\t\tRocketChat.settings.regexCallbacks[name = k.source] = RocketChat.settings.regexCallbacks[name = k.source] || {\n\t\t\t\t\tregex: k,\n\t\t\t\t\tcallbacks: []\n\t\t\t\t};\n\t\t\t\tRocketChat.settings.regexCallbacks[k.source].callbacks.push(callback);\n\t\t\t} else {\n\t\t\t\tRocketChat.settings.callbacks[k] = RocketChat.settings.callbacks[k] || [];\n\t\t\t\tRocketChat.settings.callbacks[k].push(callback);\n\t\t\t}\n\t\t});\n\t}\n};\n","/*\n* Callback hooks provide an easy way to add extra steps to common operations.\n* @namespace RocketChat.callbacks\n*/\n\nRocketChat.callbacks = {};\n\nif (Meteor.isServer) {\n\tRocketChat.callbacks.showTime = true;\n\tRocketChat.callbacks.showTotalTime = true;\n} else {\n\tRocketChat.callbacks.showTime = false;\n\tRocketChat.callbacks.showTotalTime = false;\n}\n\n\n/*\n* Callback priorities\n*/\n\nRocketChat.callbacks.priority = {\n\tHIGH: -1000,\n\tMEDIUM: 0,\n\tLOW: 1000\n};\n\n\n/*\n* Add a callback function to a hook\n* @param {String} hook - The name of the hook\n* @param {Function} callback - The callback function\n*/\n\nRocketChat.callbacks.add = function(hook, callback, priority, id) {\n\tif (priority == null) {\n\t\tpriority = RocketChat.callbacks.priority.MEDIUM;\n\t}\n\tif (!_.isNumber(priority)) {\n\t\tpriority = RocketChat.callbacks.priority.MEDIUM;\n\t}\n\tcallback.priority = priority;\n\tcallback.id = id || Random.id();\n\tRocketChat.callbacks[hook] = RocketChat.callbacks[hook] || [];\n\tif (RocketChat.callbacks.showTime === true) {\n\t\tconst err = new Error;\n\t\tcallback.stack = err.stack;\n\t}\n\tif (RocketChat.callbacks[hook].find((cb) => cb.id === callback.id)) {\n\t\treturn;\n\t}\n\tRocketChat.callbacks[hook].push(callback);\n};\n\n\n/*\n* Remove a callback from a hook\n* @param {string} hook - The name of the hook\n* @param {string} id - The callback's id\n*/\n\nRocketChat.callbacks.remove = function(hookName, id) {\n\tRocketChat.callbacks[hookName] = _.reject(RocketChat.callbacks[hookName], (callback) => callback.id === id);\n};\n\n\n/*\n* Successively run all of a hook's callbacks on an item\n* @param {String} hook - The name of the hook\n* @param {Object} item - The post, comment, modifier, etc. on which to run the callbacks\n* @param {Object} [constant] - An optional constant that will be passed along to each callback\n* @returns {Object} Returns the item after it's been through all the callbacks for this hook\n*/\n\nRocketChat.callbacks.run = function(hook, item, constant) {\n\tconst callbacks = RocketChat.callbacks[hook];\n\tif (callbacks && callbacks.length) {\n\t\tlet totalTime = 0;\n\t\tconst result = _.sortBy(callbacks, function(callback) {\n\t\t\treturn callback.priority || RocketChat.callbacks.priority.MEDIUM;\n\t\t}).reduce(function(result, callback) {\n\t\t\tlet time = 0;\n\t\t\tif (RocketChat.callbacks.showTime === true || RocketChat.callbacks.showTotalTime === true) {\n\t\t\t\ttime = Date.now();\n\t\t\t}\n\t\t\tconst callbackResult = callback(result, constant);\n\t\t\tif (RocketChat.callbacks.showTime === true || RocketChat.callbacks.showTotalTime === true) {\n\t\t\t\tconst currentTime = Date.now() - time;\n\t\t\t\ttotalTime += currentTime;\n\t\t\t\tif (RocketChat.callbacks.showTime === true) {\n\t\t\t\t\tif (Meteor.isServer) {\n\t\t\t\t\t\tRocketChat.statsTracker.timing('callbacks.time', currentTime, [`hook:${ hook }`, `callback:${ callback.id }`]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet stack = callback.stack && typeof callback.stack.split === 'function' && callback.stack.split('\\n');\n\t\t\t\t\t\tstack = stack && stack[2] && (stack[2].match(/\\(.+\\)/)||[])[0];\n\t\t\t\t\t\tconsole.log(String(currentTime), hook, callback.id, stack);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn (typeof callbackResult === 'undefined') ? result : callbackResult;\n\t\t}, item);\n\t\tif (RocketChat.callbacks.showTotalTime === true) {\n\t\t\tif (Meteor.isServer) {\n\t\t\t\tRocketChat.statsTracker.timing('callbacks.totalTime', totalTime, [`hook:${ hook }`]);\n\t\t\t} else {\n\t\t\t\tconsole.log(`${ hook }:`, totalTime);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t} else {\n\t\treturn item;\n\t}\n};\n\n\n/*\n* Successively run all of a hook's callbacks on an item, in async mode (only works on server)\n* @param {String} hook - The name of the hook\n* @param {Object} item - The post, comment, modifier, etc. on which to run the callbacks\n* @param {Object} [constant] - An optional constant that will be passed along to each callback\n*/\n\nRocketChat.callbacks.runAsync = function(hook, item, constant) {\n\tconst callbacks = RocketChat.callbacks[hook];\n\tif (Meteor.isServer && callbacks && callbacks.length) {\n\t\tMeteor.defer(function() {\n\t\t\t_.sortBy(callbacks, (callback) => callback.priority || RocketChat.callbacks.priority.MEDIUM).forEach((callback) => callback(item, constant));\n\t\t});\n\t} else {\n\t\treturn item;\n\t}\n};\n","RocketChat.fileUploadMediaWhiteList = function() {\n\tconst mediaTypeWhiteList = RocketChat.settings.get('FileUpload_MediaTypeWhiteList');\n\n\tif (!mediaTypeWhiteList || mediaTypeWhiteList === '*') {\n\t\treturn;\n\t}\n\treturn _.map(mediaTypeWhiteList.split(','), function(item) {\n\t\treturn item.trim();\n\t});\n};\n\nRocketChat.fileUploadIsValidContentType = function(type) {\n\tconst list = RocketChat.fileUploadMediaWhiteList();\n\tif (!list || _.contains(list, type)) {\n\t\treturn true;\n\t} else {\n\t\tconst wildCardGlob = '/*';\n\t\tconst wildcards = _.filter(list, function(item) {\n\t\t\treturn item.indexOf(wildCardGlob) > 0;\n\t\t});\n\t\tif (_.contains(wildcards, type.replace(/(\\/.*)$/, wildCardGlob))) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n};\n","RocketChat.placeholders = {};\n\nRocketChat.placeholders.replace = function(str, data) {\n\tif (!str) {\n\t\treturn '';\n\t}\n\n\tstr = str.replace(/\\[Site_Name\\]/g, RocketChat.settings.get('Site_Name') || '');\n\tstr = str.replace(/\\[Site_URL\\]/g, RocketChat.settings.get('Site_Url') || '');\n\n\tif (data) {\n\t\tstr = str.replace(/\\[name\\]/g, data.name || '');\n\t\tstr = str.replace(/\\[fname\\]/g, _.strLeft(data.name, ' ') || '');\n\t\tstr = str.replace(/\\[lname\\]/g, _.strRightBack(data.name, ' ') || '');\n\t\tstr = str.replace(/\\[email\\]/g, data.email || '');\n\t\tstr = str.replace(/\\[password\\]/g, data.password || '');\n\n\t\tif (data.unsubscribe) {\n\t\t\tstr = str.replace(/\\[unsubscribe\\]/g, data.unsubscribe);\n\t\t}\n\t}\n\n\tstr = str.replace(/([^>\\r\\n]?)(\\r\\n|\\n\\r|\\r|\\n)/g, '$1' + '<br>' + '$2');\n\n\n\treturn str;\n};\n","\n/*\n* Callback hooks provide an easy way to add extra steps to common operations.\n* @namespace RocketChat.promises\n*/\n\nRocketChat.promises = {};\n\n\n/*\n* Callback priorities\n*/\n\nRocketChat.promises.priority = {\n\tHIGH: -1000,\n\tMEDIUM: 0,\n\tLOW: 1000\n};\n\n\n/*\n* Add a callback function to a hook\n* @param {String} hook - The name of the hook\n* @param {Function} callback - The callback function\n*/\n\nRocketChat.promises.add = function(hook, callback, p = RocketChat.promises.priority.MEDIUM, id) {\n\tconst priority = !_.isNumber(p) ? RocketChat.promises.priority.MEDIUM : p;\n\tcallback.priority = priority;\n\tcallback.id = id || Random.id();\n\tRocketChat.promises[hook] = RocketChat.promises[hook] || [];\n\tif (RocketChat.promises[hook].find(cb => cb.id === callback.id)) {\n\t\treturn;\n\t}\n\tRocketChat.promises[hook].push(callback);\n};\n\n\n/*\n* Remove a callback from a hook\n* @param {string} hook - The name of the hook\n* @param {string} id - The callback's id\n*/\n\nRocketChat.promises.remove = function(hookName, id) {\n\tRocketChat.promises[hookName] = _.reject(RocketChat.promises[hookName], (callback) => callback.id === id);\n};\n\n\n/*\n* Successively run all of a hook's callbacks on an item\n* @param {String} hook - The name of the hook\n* @param {Object} item - The post, comment, modifier, etc. on which to run the callbacks\n* @param {Object} [constant] - An optional constant that will be passed along to each callback\n* @returns {Object} Returns the item after it's been through all the callbacks for this hook\n*/\n\nRocketChat.promises.run = function(hook, item, constant) {\n\tlet callbacks = RocketChat.promises[hook];\n\tif (callbacks == null || callbacks.length === 0) {\n\t\treturn Promise.resolve(item);\n\t}\n\tcallbacks = _.sortBy(callbacks, (callback) => callback.priority || RocketChat.promises.priority.MEDIUM);\n\treturn callbacks.reduce(function(previousPromise, callback) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\treturn previousPromise.then((result) => callback(result, constant).then(resolve, reject));\n\t\t});\n\t}, Promise.resolve(item));\n};\n\n\n/*\n* Successively run all of a hook's callbacks on an item, in async mode (only works on server)\n* @param {String} hook - The name of the hook\n* @param {Object} item - The post, comment, modifier, etc. on which to run the callbacks\n* @param {Object} [constant] - An optional constant that will be passed along to each callback\n*/\n\nRocketChat.promises.runAsync = function(hook, item, constant) {\n\tconst callbacks = RocketChat.promises[hook];\n\tif (!Meteor.isServer || callbacks == null || callbacks.length === 0) {\n\t\treturn item;\n\t}\n\tMeteor.defer(() => {\n\t\t_.sortBy(callbacks, (callback) => callback.priority || RocketChat.promises.priority.MEDIUM).forEach(function(callback) {\n\t\t\tcallback(item, constant);\n\t\t});\n\t});\n};\n","/* globals roomExit*/\nthis.roomTypesCommon = class {\n\tconstructor() {\n\t\tthis.roomTypes = {};\n\t\tthis.roomTypesOrder = [];\n\t\tthis.mainOrder = 1;\n\t}\n\n\t/* Adds a room type to app\n\t@param identifier An identifier to the room type. If a real room, MUST BE the same of `db.rocketchat_room.t` field, if not, can be null\n\t@param order Order number of the type\n\t@param config\n\ttemplate: template name to render on sideNav\n\ticon: icon class\n\troute:\n\tname: route name\n\taction: route action function\n\t*/\n\n\tadd(identifier = Random.id(), order, config) {\n\t\tif (this.roomTypes[identifier] != null) {\n\t\t\treturn false;\n\t\t}\n\t\tif (order == null) {\n\t\t\torder = this.mainOrder + 10;\n\t\t\tthis.mainOrder += 10;\n\t\t}\n\t\tthis.roomTypesOrder.push({\n\t\t\tidentifier,\n\t\t\torder\n\t\t});\n\t\tthis.roomTypes[identifier] = config;\n\t\tif (config.route && config.route.path && config.route.name && config.route.action) {\n\t\t\tconst routeConfig = {\n\t\t\t\tname: config.route.name,\n\t\t\t\taction: config.route.action\n\t\t\t};\n\t\t\tif (Meteor.isClient) {\n\t\t\t\trouteConfig.triggersExit = [roomExit];\n\t\t\t}\n\t\t\treturn FlowRouter.route(config.route.path, routeConfig);\n\t\t}\n\t}\n\n\thasCustomLink(roomType) {\n\t\treturn this.roomTypes[roomType] && this.roomTypes[roomType].route && this.roomTypes[roomType].route.link != null;\n\t}\n\n\t/*\n\t@param roomType: room type (e.g.: c (for channels), d (for direct channels))\n\t@param subData: the user's subscription data\n\t*/\n\n\tgetRouteLink(roomType, subData) {\n\t\tif (this.roomTypes[roomType] == null) {\n\t\t\treturn false;\n\t\t}\n\t\tlet routeData = {};\n\t\tif (this.roomTypes[roomType] && this.roomTypes[roomType].route && this.roomTypes[roomType].route.link) {\n\t\t\trouteData = this.roomTypes[roomType].route.link(subData);\n\t\t} else if (subData && subData.name) {\n\t\t\trouteData = {\n\t\t\t\tname: subData.name\n\t\t\t};\n\t\t}\n\t\treturn FlowRouter.path(this.roomTypes[roomType].route.name, routeData);\n\t}\n\n\topenRouteLink(roomType, subData, queryParams) {\n\t\tif (this.roomTypes[roomType] == null) {\n\t\t\treturn false;\n\t\t}\n\t\tlet routeData = {};\n\t\tif (this.roomTypes[roomType] && this.roomTypes[roomType].route && this.roomTypes[roomType].route.link) {\n\t\t\trouteData = this.roomTypes[roomType].route.link(subData);\n\t\t} else if (subData && subData.name) {\n\t\t\trouteData = {\n\t\t\t\tname: subData.name\n\t\t\t};\n\t\t}\n\t\treturn FlowRouter.go(this.roomTypes[roomType].route.name, routeData, queryParams);\n\t}\n};\nexport default this.roomTypesCommon;\n","RocketChat.slashCommands = {\n\tcommands: {}\n};\n\nRocketChat.slashCommands.add = function(command, callback, options = {}, result) {\n\tRocketChat.slashCommands.commands[command] = {\n\t\tcommand,\n\t\tcallback,\n\t\tparams: options.params,\n\t\tdescription: options.description,\n\t\tclientOnly: options.clientOnly || false,\n\t\tresult\n\t};\n};\n\nRocketChat.slashCommands.run = function(command, params, item) {\n\tif (RocketChat.slashCommands.commands[command] && RocketChat.slashCommands.commands[command].callback) {\n\t\treturn RocketChat.slashCommands.commands[command].callback(command, params, item);\n\t}\n};\n\nMeteor.methods({\n\tslashCommand(command) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'slashCommand'\n\t\t\t});\n\t\t}\n\t\treturn RocketChat.slashCommands.run(command.cmd, command.params, command.msg);\n\t}\n});\n","RocketChat.Message = {\n\tparse(msg, language) {\n\t\tconst messageType = RocketChat.MessageTypes.getType(msg);\n\t\tif (messageType) {\n\t\t\tif (messageType.render) {\n\t\t\t\treturn messageType.render(msg);\n\t\t\t} else if (messageType.template) {\n\t\t\t\t// Render message\n\t\t\t\treturn;\n\t\t\t} else if (messageType.message) {\n\t\t\t\tif (!language && typeof localStorage !== 'undefined') {\n\t\t\t\t\tlanguage = localStorage.getItem('userLanguage');\n\t\t\t\t}\n\t\t\t\tconst data = (typeof messageType.data === 'function' && messageType.data(msg)) || {};\n\t\t\t\treturn TAPi18n.__(messageType.message, data, language);\n\t\t\t}\n\t\t}\n\t\tif (msg.u && msg.u.username === RocketChat.settings.get('Chatops_Username')) {\n\t\t\tmsg.html = msg.msg;\n\t\t\treturn msg.html;\n\t\t}\n\t\tmsg.html = msg.msg;\n\t\tif (_.trim(msg.html) !== '') {\n\t\t\tmsg.html = _.escapeHTML(msg.html);\n\t\t}\n\t\tmsg.html = msg.html.replace(/\\n/gm, '<br/>');\n\t\treturn msg.html;\n\t}\n};\n","RocketChat.MessageTypes = new class {\n\tconstructor() {\n\t\tthis.types = {};\n\t}\n\n\tregisterType(options) {\n\t\treturn this.types[options.id] = options;\n\t}\n\n\tgetType(message) {\n\t\treturn this.types[message && message.t];\n\t}\n\n\tisSystemMessage(message) {\n\t\tconst type = this.types[message && message.t];\n\t\treturn type && type.system;\n\t}\n\n\tisChartMessage(message) {\n\t\tconst type = this.types[message && message.t];\n        return type && type == 'chart';\n\t}\n\n};\n\nMeteor.startup(function() {\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'r',\n\t\tsystem: true,\n\t\tmessage: 'Room_name_changed',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\troom_name: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'au',\n\t\tsystem: true,\n\t\tmessage: 'User_added_by',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_added: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'ru',\n\t\tsystem: true,\n\t\tmessage: 'User_removed_by',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_removed: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'ul',\n\t\tsystem: true,\n\t\tmessage: 'User_left',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_left: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'uj',\n\t\tsystem: true,\n\t\tmessage: 'User_joined_channel',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'wm',\n\t\tsystem: true,\n\t\tmessage: 'Welcome',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'rm',\n\t\tsystem: true,\n\t\tmessage: 'Message_removed',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'rtc',\n\t\trender(message) {\n\t\t\treturn RocketChat.callbacks.run('renderRtcMessage', message);\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'user-muted',\n\t\tsystem: true,\n\t\tmessage: 'User_muted_by',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_muted: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'user-unmuted',\n\t\tsystem: true,\n\t\tmessage: 'User_unmuted_by',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_unmuted: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'subscription-role-added',\n\t\tsystem: true,\n\t\tmessage: '__username__was_set__role__by__user_by_',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tusername: message.msg,\n\t\t\t\trole: message.role,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'subscription-role-removed',\n\t\tsystem: true,\n\t\tmessage: '__username__is_no_longer__role__defined_by__user_by_',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tusername: message.msg,\n\t\t\t\trole: message.role,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'room-archived',\n\t\tsystem: true,\n\t\tmessage: 'This_room_has_been_archived_by__username_',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tusername: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'room-unarchived',\n\t\tsystem: true,\n\t\tmessage: 'This_room_has_been_unarchived_by__username_',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tusername: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\n\t//TODO : 차트파입, 공지, 아이템 타입(여러 아이템을 별로도 정의)들을 정의\n\t//메리지 컬럼 't'에 타입을 넣으면 반영됨.\n    RocketChat.MessageTypes.registerType({\n        id: 'chart',\n        system: false\n    });\n});\n","/* globals WebAppInternals */\nRocketChat.settings.get('Site_Url', function(key, value) {\n\tif (value == null || value.trim() === '') {\n\t\treturn;\n\t}\n\tlet host = value.replace(/\\/$/, '');\n\t// let prefix = '';\n\tconst match = value.match(/([^\\/]+\\/{2}[^\\/]+)(\\/.+)/);\n\tif (match != null) {\n\t\thost = match[1];\n\t\t// prefix = match[2].replace(/\\/$/, '');\n\t}\n\t__meteor_runtime_config__.ROOT_URL = host;\n\n\tif (Meteor.absoluteUrl.defaultOptions && Meteor.absoluteUrl.defaultOptions.rootUrl) {\n\t\tMeteor.absoluteUrl.defaultOptions.rootUrl = host;\n\t}\n\tif (Meteor.isServer) {\n\t\tRocketChat.hostname = host.replace(/^https?:\\/\\//, '');\n\t\tprocess.env.MOBILE_ROOT_URL = host;\n\t\tprocess.env.MOBILE_DDP_URL = host;\n\t\tif (typeof WebAppInternals !== 'undefined' && WebAppInternals.generateBoilerplate) {\n\t\t\treturn WebAppInternals.generateBoilerplate();\n\t\t}\n\t}\n});\n","RocketChat.Notifications = new class {\n\tconstructor() {\n\t\tthis.logged = Meteor.userId() !== null;\n\t\tthis.loginCb = [];\n\t\tTracker.autorun(() => {\n\t\t\tif (Meteor.userId() !== null && this.logged === false) {\n\t\t\t\tthis.loginCb.forEach(cb => cb());\n\t\t\t}\n\t\t\treturn this.logged = Meteor.userId() !== null;\n\t\t});\n\t\tthis.debug = false;\n\t\tthis.streamAll = new Meteor.Streamer('notify-all');\n\t\tthis.streamLogged = new Meteor.Streamer('notify-logged');\n\t\tthis.streamRoom = new Meteor.Streamer('notify-room');\n\t\tthis.streamRoomUsers = new Meteor.Streamer('notify-room-users');\n\t\tthis.streamUser = new Meteor.Streamer('notify-user');\n\t\tif (this.debug === true) {\n\t\t\tthis.onAll(function() {\n\t\t\t\treturn console.log('RocketChat.Notifications: onAll', arguments);\n\t\t\t});\n\t\t\tthis.onUser(function() {\n\t\t\t\treturn console.log('RocketChat.Notifications: onAll', arguments);\n\t\t\t});\n\t\t}\n\t}\n\n\tonLogin(cb) {\n\t\tthis.loginCb.push(cb);\n\t\tif (this.logged) {\n\t\t\treturn cb();\n\t\t}\n\t}\n\tnotifyRoom(room, eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('RocketChat.Notifications: notifyRoom', arguments);\n\t\t}\n\t\targs.unshift(`${ room }/${ eventName }`);\n\t\treturn this.streamRoom.emit.apply(this.streamRoom, args);\n\t}\n\tnotifyUser(userId, eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('RocketChat.Notifications: notifyUser', arguments);\n\t\t}\n\t\targs.unshift(`${ userId }/${ eventName }`);\n\t\treturn this.streamUser.emit.apply(this.streamUser, args);\n\t}\n\tnotifyUsersOfRoom(room, eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('RocketChat.Notifications: notifyUsersOfRoom', arguments);\n\t\t}\n\t\targs.unshift(`${ room }/${ eventName }`);\n\t\treturn this.streamRoomUsers.emit.apply(this.streamRoomUsers, args);\n\t}\n\tonAll(eventName, callback) {\n\t\treturn this.streamAll.on(eventName, callback);\n\t}\n\tonLogged(eventName, callback) {\n\t\treturn this.onLogin(() => {\n\t\t\treturn this.streamLogged.on(eventName, callback);\n\t\t});\n\t}\n\tonRoom(room, eventName, callback) {\n\t\tif (this.debug === true) {\n\t\t\tthis.streamRoom.on(room, function() {\n\t\t\t\treturn console.log(`RocketChat.Notifications: onRoom ${ room }`, arguments);\n\t\t\t});\n\t\t}\n\t\treturn this.streamRoom.on(`${ room }/${ eventName }`, callback);\n\t}\n\tonUser(eventName, callback) {\n\t\treturn this.streamUser.on(`${ Meteor.userId() }/${ eventName }`, callback);\n\t}\n\tunAll(callback) {\n\t\treturn this.streamAll.removeListener('notify', callback);\n\t}\n\tunLogged(callback) {\n\t\treturn this.streamLogged.removeListener('notify', callback);\n\t}\n\tunRoom(room, eventName, callback) {\n\t\treturn this.streamRoom.removeListener(`${ room }/${ eventName }`, callback);\n\t}\n\tunUser(callback) {\n\t\treturn this.streamUser.removeListener(Meteor.userId(), callback);\n\t}\n\n};\n","/* globals OAuth */\n\nOAuth.launchLogin = _.wrap(OAuth.launchLogin, function(func, options) {\n\tconst proxy = RocketChat.settings.get('Accounts_OAuth_Proxy_services').replace(/\\s/g, '').split(',');\n\tif (proxy.includes(options.loginService)) {\n\t\tconst redirect_uri = options.loginUrl.match(/(&redirect_uri=)([^&]+|$)/)[2];\n\t\toptions.loginUrl = options.loginUrl.replace(/(&redirect_uri=)([^&]+|$)/, `$1${ encodeURIComponent(RocketChat.settings.get('Accounts_OAuth_Proxy_host')) }/oauth_redirect`);\n\t\toptions.loginUrl = options.loginUrl.replace(/(&state=)([^&]+|$)/, `$1${ redirect_uri }!$2`);\n\t\toptions.loginUrl = `${ RocketChat.settings.get('Accounts_OAuth_Proxy_host') }/redirect/${ encodeURIComponent(options.loginUrl) }`;\n\t}\n\n\treturn func(options);\n});\n","RocketChat.TabBar = new (class TabBar {\n\tconstructor() {\n\t\tthis.buttons = new ReactiveVar({});\n\n\t\tthis.extraGroups = {};\n\t}\n\n\tshow() {\n\t\t$('.flex-tab-bar').show();\n\t}\n\n\thide() {\n\t\t$('.flex-tab-bar').hide();\n\t}\n\n\taddButton(config) {\n\t\tif (!config || !config.id) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst btns = this.buttons.curValue;\n\t\tbtns[config.id] = config;\n\n\t\tif (this.extraGroups[config.id]) {\n\t\t\tbtns[config.id].groups = _.union((btns[config.id].groups || []), this.extraGroups[config.id]);\n\t\t}\n\n\t\tthis.buttons.set(btns);\n\t}\n\n\tremoveButton(id) {\n\t\tconst btns = this.buttons.curValue;\n\t\tdelete btns[id];\n\t\tthis.buttons.set(btns);\n\t}\n\n\tupdateButton(id, config) {\n\t\tconst btns = this.buttons.curValue;\n\t\tif (btns[id]) {\n\t\t\tbtns[id] = _.extend(btns[id], config);\n\t\t\tthis.buttons.set(btns);\n\t\t}\n\t}\n\n\tgetButtons() {\n\t\treturn _.sortBy(_.toArray(this.buttons.get()), 'order');\n\t}\n\n\tgetButton(id) {\n\t\treturn _.findWhere(this.buttons.get(), { id });\n\t}\n\n\taddGroup(id, groups) {\n\t\tconst btns = this.buttons.curValue;\n\t\tif (btns[id]) {\n\t\t\tbtns[id].groups = _.union((btns[id].groups || []), groups);\n\t\t\tthis.buttons.set(btns);\n\t\t} else {\n\t\t\tthis.extraGroups[id] = _.union((this.extraGroups[id] || []), groups);\n\t\t}\n\t}\n\n\tremoveGroup(id, groups) {\n\t\tconst btns = this.buttons.curValue;\n\t\tif (btns[id]) {\n\t\t\tbtns[id].groups = _.difference((btns[id].groups || []), groups);\n\t\t\tthis.buttons.set(btns);\n\t\t} else {\n\t\t\tthis.extraGroups[id] = _.difference((this.extraGroups[id] || []), groups);\n\t\t}\n\t}\n});\n","/* globals RocketChatTabBar */\n/* exported RocketChatTabBar */\n\nRocketChatTabBar = class RocketChatTabBar {\n\tconstructor() {\n\t\tthis.template = new ReactiveVar();\n\t\tthis.group = new ReactiveVar();\n\t\tthis.state = new ReactiveVar();\n\t\tthis.data = new ReactiveVar();\n\t}\n\n\tgetTemplate() {\n\t\treturn this.template.get();\n\t}\n\n\tsetTemplate(template) {\n\t\tthis.template.set(template);\n\t}\n\n\tcurrentGroup() {\n\t\treturn this.group.get();\n\t}\n\n\tshowGroup(group) {\n\t\tthis.group.set(group);\n\t}\n\n\tsetData(d) {\n\t\tthis.data.set(d);\n\t}\n\n\tgetData() {\n\t\treturn this.data.get();\n\t}\n\n\tgetButtons() {\n\t\treturn RocketChat.TabBar.getButtons();\n\t}\n\n\tgetState() {\n\t\treturn this.state.get();\n\t}\n\n\topen(button) {\n\t\tthis.state.set('opened');\n\n\t\tif (button) {\n\t\t\tif (typeof button !== 'object' || !button.id) {\n\t\t\t\tbutton = RocketChat.TabBar.getButton(button);\n\t\t\t}\n\t\t\tif (button.width) {\n\t\t\t\t$('.flex-tab').css('width', `${ button.width }px`);\n\t\t\t} else {\n\t\t\t\t$('.flex-tab').css('width', '');\n\t\t\t}\n\t\t\tthis.template.set(button.template);\n\t\t}\n\n\t\tTracker.afterFlush(() => {\n\t\t\t$('.flex-tab').find('input[type=text]:first').focus();\n\t\t\t$('.flex-tab .content').scrollTop(0);\n\t\t});\n\t}\n\n\tclose() {\n\t\tthis.state.set('');\n\n\t\t$('.flex-tab').css('width', '');\n\n\t\tthis.template.set();\n\t}\n};\n","import localforage from 'localforage';\n\nclass CachedCollectionManager {\n\tconstructor() {\n\t\tthis.items = [];\n\t\tthis._syncEnabled = false;\n\t\tthis.reconnectCb = [];\n\t\tthis.loginCb = [];\n\t\tthis.logged = false;\n\n\t\tconst _unstoreLoginToken = Accounts._unstoreLoginToken;\n\t\tAccounts._unstoreLoginToken = (...args) => {\n\t\t\t_unstoreLoginToken.apply(Accounts, args);\n\t\t\tthis.clearAllCacheOnLogout();\n\t\t};\n\n\t\tlet connectionWasOnline = true;\n\t\tTracker.autorun(() => {\n\t\t\tconst connected = Meteor.connection.status().connected;\n\n\t\t\tif (connected === true && connectionWasOnline === false) {\n\t\t\t\tfor (const cb of this.reconnectCb) {\n\t\t\t\t\tcb();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconnectionWasOnline = connected;\n\t\t});\n\n\t\tTracker.autorun(() => {\n\t\t\tif (Meteor.userId() !== null) {\n\t\t\t\tif (this.logged === false) {\n\t\t\t\t\tfor (const cb of this.loginCb) {\n\t\t\t\t\t\tcb();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.logged = Meteor.userId() !== null;\n\t\t});\n\t}\n\n\tregister(cachedCollection) {\n\t\tthis.items.push(cachedCollection);\n\t}\n\n\tclearAllCache() {\n\t\tfor (const item of this.items) {\n\t\t\titem.clearCache();\n\t\t}\n\t}\n\n\tclearAllCacheOnLogout() {\n\t\tfor (const item of this.items) {\n\t\t\titem.clearCacheOnLogout();\n\t\t}\n\t}\n\n\tcountQueries() {\n\t\tfor (const item of this.items) {\n\t\t\titem.countQueries();\n\t\t}\n\t}\n\n\tset syncEnabled(value) {\n\t\tcheck(value, Boolean);\n\t\tthis._syncEnabled = value;\n\t}\n\n\tget syncEnabled() {\n\t\treturn this._syncEnabled;\n\t}\n\n\tonReconnect(cb) {\n\t\tthis.reconnectCb.push(cb);\n\t}\n\n\tonLogin(cb) {\n\t\tthis.loginCb.push(cb);\n\t\tif (this.logged) {\n\t\t\tcb();\n\t\t}\n\t}\n}\n\nRocketChat.CachedCollectionManager = new CachedCollectionManager;\n\n\nclass CachedCollection {\n\tconstructor({\n\t\tcollection,\n\t\tname,\n\t\tmethodName,\n\t\tsyncMethodName,\n\t\teventName,\n\t\teventType = 'onUser',\n\t\tuserRelated = true,\n\t\tuseSync = true,\n\t\tuseCache = true,\n\t\tdebug = true,\n\t\tversion = 6,\n\t\tmaxCacheTime = 60*60*24*30\n\t}) {\n\t\tthis.collection = collection || new Mongo.Collection(null);\n\n\t\tthis.ready = new ReactiveVar(false);\n\t\tthis.name = name;\n\t\tthis.methodName = methodName || `${ name }/get`;\n\t\tthis.syncMethodName = syncMethodName || `${ name }/get`;\n\t\tthis.eventName = eventName || `${ name }-changed`;\n\t\tthis.eventType = eventType;\n\t\tthis.useSync = useSync;\n\t\tthis.useCache = useCache;\n\t\tthis.debug = debug;\n\t\tthis.version = version;\n\t\tthis.userRelated = userRelated;\n\t\tthis.updatedAt = new Date(0);\n\t\tthis.maxCacheTime = maxCacheTime;\n\n\t\tRocketChat.CachedCollectionManager.register(this);\n\n\t\tif (userRelated === true) {\n\t\t\tRocketChat.CachedCollectionManager.onLogin(() => {\n\t\t\t\tthis.log('Init on login');\n\t\t\t\tthis.ready.set(false);\n\t\t\t\tthis.updatedAt = new Date(0);\n\t\t\t\tthis.initiated = false;\n\t\t\t\tthis.init();\n\t\t\t});\n\t\t}\n\n\t\tif (this.useCache === false) {\n\t\t\treturn this.clearCache();\n\t\t}\n\t}\n\n\tlog(...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log(`CachedCollection ${ this.name } =>`, ...args);\n\t\t}\n\t}\n\n\tcountQueries() {\n\t\tthis.log(`${ Object.keys(this.collection._collection.queries).length } queries`);\n\t}\n\n\trecomputeCollectionQueries() {\n\t\tthis.log(`recomputing ${ Object.keys(this.collection._collection.queries).length } queries`);\n\t\t_.each(this.collection._collection.queries, (query) => {\n\t\t\tthis.collection._collection._recomputeResults(query);\n\t\t});\n\t}\n\n\tgetToken() {\n\t\tif (this.userRelated === false) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn Accounts._storedLoginToken();\n\t}\n\n\tloadFromCache(callback = () => {}) {\n\t\tif (this.useCache === false) {\n\t\t\treturn callback(false);\n\t\t}\n\n\t\tlocalforage.getItem(this.name, (error, data) => {\n\t\t\tif (data && (data.version < this.version || data.token !== this.getToken() || this.getToken() === undefined)) {\n\t\t\t\tthis.clearCache();\n\t\t\t\tcallback(false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst now = new Date();\n\t\t\tif (data && now - data.updatedAt >= 1000*this.maxCacheTime) {\n\t\t\t\tthis.clearCache();\n\t\t\t\tcallback(false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (data && data.records && data.records.length > 0) {\n\t\t\t\tthis.log(`${ data.records.length } records loaded from cache`);\n\t\t\t\tdata.records.forEach((record) => {\n\t\t\t\t\trecord.__cache__ = true;\n\t\t\t\t\tthis.collection.upsert({ _id: record._id }, _.omit(record, '_id'));\n\n\t\t\t\t\tif (record._updatedAt) {\n\t\t\t\t\t\tconst _updatedAt = new Date(record._updatedAt);\n\t\t\t\t\t\tif (_updatedAt > this.updatedAt) {\n\t\t\t\t\t\t\tthis.updatedAt = _updatedAt;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tcallback(true);\n\t\t\t} else {\n\t\t\t\tcallback(false);\n\t\t\t}\n\t\t});\n\t}\n\n\tloadFromServer(callback = () => {}) {\n\t\tMeteor.call(this.methodName, (error, data) => {\n\t\t\tthis.log(`${ data.length } records loaded from server`);\n\t\t\tdata.forEach((record) => {\n\t\t\t\tdelete record.$loki;\n\t\t\t\tthis.collection.upsert({ _id: record._id }, _.omit(record, '_id'));\n\n\t\t\t\tif (record._updatedAt && record._updatedAt > this.updatedAt) {\n\t\t\t\t\tthis.updatedAt = record._updatedAt;\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.recomputeCollectionQueries();\n\n\t\t\tif (this.updatedAt < new Date) {\n\t\t\t\tthis.updatedAt = new Date;\n\t\t\t}\n\n\t\t\tcallback(data);\n\t\t});\n\t}\n\n\tloadFromServerAndPopulate() {\n\t\tthis.loadFromServer((loadedData) => {\n\t\t\tthis.ready.set(true);\n\t\t\tthis.saveCache(loadedData);\n\t\t});\n\t}\n\n\tsync() {\n\t\tif (RocketChat.CachedCollectionManager.syncEnabled === false || Meteor.connection._outstandingMethodBlocks.length !== 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.log(`syncing from ${ this.updatedAt }`);\n\n\t\tMeteor.call(this.syncMethodName, this.updatedAt, (error, data) => {\n\t\t\tlet changes = [];\n\n\t\t\tif (data.update && data.update.length > 0) {\n\t\t\t\tthis.log(`${ data.update.length } records updated in sync`);\n\t\t\t\tchanges.push(...data.update);\n\t\t\t}\n\n\t\t\tif (data.remove && data.remove.length > 0) {\n\t\t\t\tthis.log(`${ data.remove.length } records removed in sync`);\n\t\t\t\tchanges.push(...data.remove);\n\t\t\t}\n\n\t\t\tchanges = changes.sort((a, b) => {\n\t\t\t\tconst valueA = a._updatedAt || a._deletedAt;\n\t\t\t\tconst valueB = b._updatedAt || b._deletedAt;\n\n\t\t\t\tif (valueA < valueB) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\n\t\t\t\tif (valueA > valueB) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\treturn 0;\n\t\t\t});\n\n\t\t\tfor (const record of changes) {\n\t\t\t\tdelete record.$loki;\n\n\t\t\t\tif (record._deletedAt) {\n\t\t\t\t\tthis.collection.remove({ _id: record._id });\n\n\t\t\t\t\tif (record._deletedAt && record._deletedAt > this.updatedAt) {\n\t\t\t\t\t\tthis.updatedAt = record._deletedAt;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.collection.upsert({ _id: record._id }, _.omit(record, '_id'));\n\n\t\t\t\t\tif (record._updatedAt && record._updatedAt > this.updatedAt) {\n\t\t\t\t\t\tthis.updatedAt = record._updatedAt;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.saveCache();\n\t\t});\n\n\t\treturn true;\n\t}\n\n\tsaveCache(data) {\n\t\tif (this.useCache === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log('saving cache');\n\t\tif (!data) {\n\t\t\tdata = this.collection.find().fetch();\n\t\t}\n\n\t\tlocalforage.setItem(this.name, {\n\t\t\tupdatedAt: new Date,\n\t\t\tversion: this.version,\n\t\t\ttoken: this.getToken(),\n\t\t\trecords: data\n\t\t});\n\t\tthis.log('saving cache (done)');\n\t}\n\n\tclearCacheOnLogout() {\n\t\tif (this.userRelated === true) {\n\t\t\tthis.clearCache();\n\t\t}\n\t}\n\n\tclearCache() {\n\t\tthis.log('clearing cache');\n\t\tlocalforage.removeItem(this.name);\n\t\tthis.collection.remove({});\n\t}\n\n\tsetupListener(eventType, eventName) {\n\t\tRocketChat.Notifications[eventType || this.eventType](eventName || this.eventName, (t, record) => {\n\t\t\tthis.log('record received', t, record);\n\t\t\tif (t === 'removed') {\n\t\t\t\tthis.collection.remove(record._id);\n\t\t\t} else {\n\t\t\t\tdelete record.$loki;\n\t\t\t\tthis.collection.upsert({ _id: record._id }, _.omit(record, '_id'));\n\t\t\t}\n\n\t\t\tthis.saveCache();\n\t\t});\n\t}\n\n\ttrySync() {\n\t\t// Wait for an empty queue to load data again and sync\n\t\tconst interval = Meteor.setInterval(() => {\n\t\t\tif (this.sync()) {\n\t\t\t\tMeteor.clearInterval(interval);\n\t\t\t}\n\t\t}, 200);\n\t}\n\n\tinit() {\n\t\tif (this.initiated === true) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.initiated = true;\n\t\tthis.loadFromCache((cacheLoaded) => {\n\t\t\tthis.ready.set(cacheLoaded);\n\n\t\t\tif (cacheLoaded === false) {\n\t\t\t\t// If there is no cache load data immediately\n\t\t\t\tthis.loadFromServerAndPopulate();\n\t\t\t} else if (this.useSync === true) {\n\t\t\t\tthis.trySync();\n\t\t\t}\n\n\t\t\tif (this.useSync === true) {\n\t\t\t\tRocketChat.CachedCollectionManager.onReconnect(() => {\n\t\t\t\t\tthis.trySync();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.setupListener();\n\t\t});\n\t}\n}\n\nRocketChat.CachedCollection = CachedCollection;\n","/* globals fireGlobalEvent readMessage currentTracker*/\ncurrentTracker = undefined;\n\nfunction openRoom(type, name) {\n\tSession.set('openedRoom', null);\n\n\treturn Meteor.defer(() =>\n\t\tcurrentTracker = Tracker.autorun(function(c) {\n\t\t\tconst user = Meteor.user();\n\t\t\tif ((user && user.username == null) || user == null && RocketChat.settings.get('Accounts_AllowAnonymousAccess') === false) {\n\t\t\t\tBlazeLayout.render('main');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (RoomManager.open(type + name).ready() !== true) {\n\t\t\t\tBlazeLayout.render('main', { modal: RocketChat.Layout.isEmbedded(), center: 'loading' });\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (currentTracker) {\n\t\t\t\tcurrentTracker = undefined;\n\t\t\t}\n\t\t\tc.stop();\n\n\t\t\tconst room = RocketChat.roomTypes.findRoom(type, name, user);\n\t\t\tif (room == null) {\n\t\t\t\tif (type === 'd') {\n\t\t\t\t\tMeteor.call('createDirectMessage', name, function(err) {\n\t\t\t\t\t\tif (!err) {\n\t\t\t\t\t\t\tRoomManager.close(type + name);\n\t\t\t\t\t\t\treturn openRoom('d', name);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tSession.set('roomNotFound', {type, name});\n\t\t\t\t\t\t\tBlazeLayout.render('main', {center: 'roomNotFound'});\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tMeteor.call('getRoomByTypeAndName', type, name, function(err, record) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tSession.set('roomNotFound', {type, name});\n\t\t\t\t\t\t\treturn BlazeLayout.render('main', {center: 'roomNotFound'});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdelete record.$loki;\n\t\t\t\t\t\t\tRocketChat.models.Rooms.upsert({ _id: record._id }, _.omit(record, '_id'));\n\t\t\t\t\t\t\tRoomManager.close(type + name);\n\t\t\t\t\t\t\treturn openRoom(type, name);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst mainNode = document.querySelector('.main-content');\n\t\t\tif (mainNode) {\n\t\t\t\tfor (const child of Array.from(mainNode.children)) {\n\t\t\t\t\tif (child) { mainNode.removeChild(child); }\n\t\t\t\t}\n\t\t\t\tconst roomDom = RoomManager.getDomOfRoom(type + name, room._id);\n\t\t\t\tmainNode.appendChild(roomDom);\n\t\t\t\tif (roomDom.classList.contains('room-container')) {\n\t\t\t\t\troomDom.querySelector('.messages-box > .wrapper').scrollTop = roomDom.oldScrollTop;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tSession.set('openedRoom', room._id);\n\n\t\t\tfireGlobalEvent('room-opened', _.omit(room, 'usernames'));\n\n\t\t\tSession.set('editRoomTitle', false);\n\t\t\tRoomManager.updateMentionsMarksOfRoom(type + name);\n\t\t\tMeteor.setTimeout(() => readMessage.readNow(), 2000);\n\t\t\t// KonchatNotification.removeRoomNotification(params._id)\n\n\t\t\tif (Meteor.Device.isDesktop() && window.chatMessages && window.chatMessages[room._id] != null) {\n\t\t\t\tsetTimeout(() => $('.message-form .input-message').focus(), 100);\n\t\t\t}\n\n\t\t\t// update user's room subscription\n\t\t\tconst sub = ChatSubscription.findOne({rid: room._id});\n\t\t\tif (sub && sub.open === false) {\n\t\t\t\tMeteor.call('openRoom', room._id, function(err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn handleError(err);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (FlowRouter.getQueryParam('msg')) {\n\t\t\t\tconst msg = { _id: FlowRouter.getQueryParam('msg'), rid: room._id };\n\t\t\t\tRoomHistoryManager.getSurroundingMessages(msg);\n\t\t\t}\n\n\t\t\treturn RocketChat.callbacks.run('enter-room', sub);\n\t\t})\n\t);\n}\nexport { openRoom };\nthis.openRoom = openRoom;\n","/*globals currentTracker */\nthis.roomExit = function() {\n\tRocketChat.callbacks.run('roomExit');\n\tBlazeLayout.render('main', {\n\t\tcenter: 'none'\n\t});\n\n\tif (typeof currentTracker !== 'undefined') {\n\t\tcurrentTracker.stop();\n\t}\n\tconst mainNode = document.querySelector('.main-content');\n\tif (mainNode == null) {\n\t\treturn;\n\t}\n\treturn [...mainNode.children].forEach(child => {\n\t\tif (child == null) {\n\t\t\treturn;\n\t\t}\n\t\tif (child.classList.contains('room-container')) {\n\t\t\tconst wrapper = child.querySelector('.messages-box > .wrapper');\n\t\t\tif (wrapper) {\n\t\t\t\tif (wrapper.scrollTop >= wrapper.scrollHeight - wrapper.clientHeight) {\n\t\t\t\t\tchild.oldScrollTop = 10e10;\n\t\t\t\t} else {\n\t\t\t\t\tchild.oldScrollTop = wrapper.scrollTop;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tmainNode.removeChild(child);\n\t});\n};\n","\n/*\n* RocketChat.settings holds all packages settings\n* @namespace RocketChat.settings\n*/\n\n/* globals ReactiveDict*/\n\nRocketChat.settings.cachedCollection = new RocketChat.CachedCollection({\n\tname: 'public-settings',\n\teventType: 'onAll',\n\tuserRelated: false\n});\n\nRocketChat.settings.collection = RocketChat.settings.cachedCollection.collection;\n\nRocketChat.settings.cachedCollection.init();\n\nRocketChat.settings.dict = new ReactiveDict('settings');\n\nRocketChat.settings.get = function(_id) {\n\treturn RocketChat.settings.dict.get(_id);\n};\n\nRocketChat.settings.init = function() {\n\tlet initialLoad = true;\n\tRocketChat.settings.collection.find().observe({\n\t\tadded(record) {\n\t\t\tMeteor.settings[record._id] = record.value;\n\t\t\tRocketChat.settings.dict.set(record._id, record.value);\n\t\t\treturn RocketChat.settings.load(record._id, record.value, initialLoad);\n\t\t},\n\t\tchanged(record) {\n\t\t\tMeteor.settings[record._id] = record.value;\n\t\t\tRocketChat.settings.dict.set(record._id, record.value);\n\t\t\treturn RocketChat.settings.load(record._id, record.value, initialLoad);\n\t\t},\n\t\tremoved(record) {\n\t\t\tdelete Meteor.settings[record._id];\n\t\t\tRocketChat.settings.dict.set(record._id, null);\n\t\t\treturn RocketChat.settings.load(record._id, null, initialLoad);\n\t\t}\n\t});\n\treturn initialLoad = false;\n};\n\nRocketChat.settings.init();\n\nMeteor.startup(function() {\n\tif (Meteor.isCordova === true) {\n\t\treturn;\n\t}\n\tTracker.autorun(function(c) {\n\t\tconst siteUrl = RocketChat.settings.get('Site_Url');\n\t\tif (!siteUrl || (Meteor.userId() == null)) {\n\t\t\treturn;\n\t\t}\n\t\tif (RocketChat.authz.hasRole(Meteor.userId(), 'admin') === false || Meteor.settings['public'].sandstorm) {\n\t\t\treturn c.stop();\n\t\t}\n\t\tMeteor.setTimeout(function() {\n\t\t\tif (__meteor_runtime_config__.ROOT_URL !== location.origin) {\n\t\t\t\tconst currentUrl = location.origin + __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n\t\t\t\tswal({\n\t\t\t\t\ttype: 'warning',\n\t\t\t\t\ttitle: t('Warning'),\n\t\t\t\t\ttext: `${ t('The_setting_s_is_configured_to_s_and_you_are_accessing_from_s', t('Site_Url'), siteUrl, currentUrl) }<br/><br/>${ t('Do_you_want_to_change_to_s_question', currentUrl) }`,\n\t\t\t\t\tshowCancelButton: true,\n\t\t\t\t\tconfirmButtonText: t('Yes'),\n\t\t\t\t\tcancelButtonText: t('Cancel'),\n\t\t\t\t\tcloseOnConfirm: false,\n\t\t\t\t\thtml: true\n\t\t\t\t}, function() {\n\t\t\t\t\tMeteor.call('saveSetting', 'Site_Url', currentUrl, function() {\n\t\t\t\t\t\tswal({\n\t\t\t\t\t\t\ttitle: t('Saved'),\n\t\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\t\ttimer: 1000,\n\t\t\t\t\t\t\tshowConfirmButton: false\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}, 100);\n\t\treturn c.stop();\n\t});\n});\n","import roomTypesCommon from '../../lib/roomTypesCommon';\n\nRocketChat.roomTypes = new class extends roomTypesCommon {\n\tcheckCondition(roomType) {\n\t\treturn roomType.condition == null || roomType.condition();\n\t}\n\tgetTypes() {\n\t\treturn _.sortBy(this.roomTypesOrder, 'order').map((type) => this.roomTypes[type.identifier]);\n\t}\n\tgetIcon(roomType) {\n\t\treturn this.roomTypes[roomType] && this.roomTypes[roomType].icon;\n\t}\n\tgetRoomName(roomType, roomData) {\n\t\treturn this.roomTypes[roomType] && this.roomTypes[roomType].roomName && this.roomTypes[roomType].roomName(roomData);\n\t}\n\tgetSecondaryRoomName(roomType, roomData) {\n\t\treturn this.roomTypes[roomType] && typeof this.roomTypes[roomType].secondaryRoomName === 'function' && this.roomTypes[roomType].secondaryRoomName(roomData);\n\t}\n\tgetIdentifiers(e) {\n\t\tconst except = [].concat(e);\n\t\tconst list = _.reject(this.roomTypesOrder, (t) => except.indexOf(t.identifier) !== -1);\n\t\treturn _.map(list, (t) => t.identifier);\n\t}\n\tgetUserStatus(roomType, roomId) {\n\t\treturn this.roomTypes[roomType] && typeof this.roomTypes[roomType].getUserStatus === 'function' && this.roomTypes[roomType].getUserStatus(roomId);\n\t}\n\tfindRoom(roomType, identifier, user) {\n\t\treturn this.roomTypes[roomType] && this.roomTypes[roomType].findRoom(identifier, user);\n\t}\n\tcanSendMessage(roomId) {\n\t\treturn ChatSubscription.find({\n\t\t\trid: roomId\n\t\t}).count() > 0;\n\t}\n\treadOnly(roomId, user) {\n\t\tconst fields = {\n\t\t\tro: 1\n\t\t};\n\t\tif (user) {\n\t\t\tfields.muted = 1;\n\t\t}\n\t\tconst room = ChatRoom.findOne({\n\t\t\t_id: roomId\n\t\t}, {\n\t\t\tfields\n\t\t});\n\t\tif (!user) {\n\t\t\treturn room && room.ro;\n\t\t}\n\t\t/* globals RoomRoles */\n\t\tconst userOwner = RoomRoles.findOne({\n\t\t\trid: roomId,\n\t\t\t'u._id': user._id,\n\t\t\troles: 'owner'\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1\n\t\t\t}\n\t\t});\n\t\treturn room && (room.ro === true && Array.isArray(room.muted) && room.muted.indexOf(user.username) !== -1 && !userOwner);\n\t}\n\tarchived(roomId) {\n\t\tconst fields = {\n\t\t\tarchived: 1\n\t\t};\n\t\tconst room = ChatRoom.findOne({\n\t\t\t_id: roomId\n\t\t}, {\n\t\t\tfields\n\t\t});\n\t\treturn room && room.archived === true;\n\t}\n\tverifyCanSendMessage(roomId) {\n\t\tconst room = ChatRoom.findOne({\t_id: roomId }, { fields: { t: 1 }});\n\n\t\tif (!room || !room.t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst roomType = room.t;\n\t\tif (this.roomTypes[roomType] && this.roomTypes[roomType].canSendMessage) {\n\t\t\treturn this.roomTypes[roomType].canSendMessage(roomId);\n\t\t}\n\t\treturn this.canSendMessage(roomId);\n\t}\n\tverifyShowJoinLink(roomId) {\n\t\tconst room = ChatRoom.findOne({\n\t\t\t_id: roomId\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tt: 1\n\t\t\t}\n\t\t});\n\t\tif (!room || !room.t) {\n\t\t\treturn;\n\t\t}\n\t\tconst roomType = room.t;\n\t\tif (this.roomTypes[roomType] && !this.roomTypes[roomType].showJoinLink) {\n\t\t\treturn false;\n\t\t}\n\t\treturn this.roomTypes[roomType].showJoinLink(roomId);\n\t}\n\tgetNotSubscribedTpl(roomId) {\n\t\tconst room = ChatRoom.findOne({ _id: roomId }, { fields: { t: 1 }});\n\t\tif (!room || !room.t) {\n\t\t\treturn;\n\t\t}\n\t\tconst roomType = room.t;\n\t\tif (this.roomTypes[roomType] && !this.roomTypes[roomType].notSubscribedTpl) {\n\t\t\treturn false;\n\t\t}\n\t\treturn this.roomTypes[roomType].notSubscribedTpl;\n\t}\n\n};\n","/* globals UserRoles, RoomRoles */\n\nMeteor.startup(function() {\n\tTracker.autorun(function() {\n\t\tif (Meteor.userId()) {\n\t\t\tMeteor.call('getUserRoles', (error, results) => {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn handleError(error);\n\t\t\t\t}\n\n\t\t\t\tfor (const record of results) {\n\t\t\t\t\tUserRoles.upsert({ _id: record._id }, record);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.Notifications.onLogged('roles-change', function(role) {\n\t\t\t\tif (role.type === 'added') {\n\t\t\t\t\tif (role.scope) {\n\t\t\t\t\t\tRoomRoles.upsert({ rid: role.scope, 'u._id': role.u._id }, { $setOnInsert: { u: role.u }, $addToSet: { roles: role._id } });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tUserRoles.upsert({ _id: role.u._id }, { $addToSet: { roles: role._id }, $set: { username: role.u.username } });\n\t\t\t\t\t\tChatMessage.update({ 'u._id': role.u._id }, { $addToSet: { roles: role._id } }, { multi: true });\n\t\t\t\t\t}\n\t\t\t\t} else if (role.type === 'removed') {\n\t\t\t\t\tif (role.scope) {\n\t\t\t\t\t\tRoomRoles.update({ rid: role.scope, 'u._id': role.u._id }, { $pull: { roles: role._id } });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tUserRoles.update({ _id: role.u._id }, { $pull: { roles: role._id } });\n\t\t\t\t\t\tChatMessage.update({ 'u._id': role.u._id }, { $pull: { roles: role._id } }, { multi: true });\n\t\t\t\t\t}\n\t\t\t\t} else if (role.type === 'changed') {\n\t\t\t\t\tChatMessage.update({ roles: role._id }, { $inc: { rerender: 1 } }, { multi: true });\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n});\n","RocketChat.Layout = new (class RocketChatLayout {\n\tconstructor() {\n\t\tTracker.autorun(() => {\n\t\t\tthis.layout = FlowRouter.getQueryParam('layout');\n\t\t});\n\t}\n\n\tisEmbedded() {\n\t\treturn this.layout === 'embedded';\n\t}\n});\n","Meteor.methods({\n\tsendMessage(message) {\n\t\tif (!Meteor.userId() || _.trim(message.msg) === '') {\n\t\t\treturn false;\n\t\t}\n\t\tconst user = Meteor.user();\n\t\tmessage.ts = isNaN(TimeSync.serverOffset()) ? new Date() : new Date(Date.now() + TimeSync.serverOffset());\n\t\tmessage.u = {\n\t\t\t_id: Meteor.userId(),\n\t\t\tusername: user.username\n\t\t};\n\t\tif (RocketChat.settings.get('UI_Use_Real_Name')) {\n\t\t\tmessage.u.name = user.name;\n\t\t}\n\t\tmessage.temp = true;\n\t\tmessage = RocketChat.callbacks.run('beforeSaveMessage', message);\n\t\tRocketChat.promises.run('onClientMessageReceived', message).then(function(message) {\n\t\t\tChatMessage.insert(message);\n\t\t\treturn RocketChat.callbacks.run('afterSaveMessage', message);\n\t\t});\n\t}\n});\n","RocketChat.AdminBox = new class {\n\tconstructor() {\n\t\tthis.options = new ReactiveVar([]);\n\t}\n\taddOption(option) {\n\t\treturn Tracker.nonreactive(() => {\n\t\t\tconst actual = this.options.get();\n\t\t\tactual.push(option);\n\t\t\treturn this.options.set(actual);\n\t\t});\n\t}\n\tgetOptions() {\n\t\treturn _.filter(this.options.get(), function(option) {\n\t\t\tif ((option.permissionGranted == null) || option.permissionGranted()) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t}\n};\n","import moment from 'moment';\n\nimport toastr from 'toastr';\n\nRocketChat.MessageAction = new class {\n\t/*\n  \tconfig expects the following keys (only id is mandatory):\n  \t\tid (mandatory)\n  \t\ticon: string\n  \t\ti18nLabel: string\n  \t\taction: function(event, instance)\n  \t\tvalidation: function(message)\n  \t\torder: integer\n   */\n\n\tconstructor() {\n\t\tthis.buttons = new ReactiveVar({});\n\t}\n\n\taddButton(config) {\n\t\tif (!config || !config.id) {\n\t\t\treturn false;\n\t\t}\n\t\treturn Tracker.nonreactive(() => {\n\t\t\tconst btns = this.buttons.get();\n\t\t\tbtns[config.id] = config;\n\t\t\treturn this.buttons.set(btns);\n\t\t});\n\t}\n\n\tremoveButton(id) {\n\t\treturn Tracker.nonreactive(() => {\n\t\t\tconst btns = this.buttons.get();\n\t\t\tdelete btns[id];\n\t\t\treturn this.buttons.set(btns);\n\t\t});\n\t}\n\n\tupdateButton(id, config) {\n\t\treturn Tracker.nonreactive(() => {\n\t\t\tconst btns = this.buttons.get();\n\t\t\tif (btns[id]) {\n\t\t\t\tbtns[id] = _.extend(btns[id], config);\n\t\t\t\treturn this.buttons.set(btns);\n\t\t\t}\n\t\t});\n\t}\n\n\tgetButtonById(id) {\n\t\tconst allButtons = this.buttons.get();\n\t\treturn allButtons[id];\n\t}\n\n\tgetButtons(message, context) {\n\t\tconst allButtons = _.toArray(this.buttons.get());\n\t\tlet allowedButtons = allButtons;\n\t\tif (message) {\n\t\t\tallowedButtons = _.compact(_.map(allButtons, function(button) {\n\t\t\t\tif (button.context == null || button.context.includes(context)) {\n\t\t\t\t\tif (button.validation == null || button.validation(message, context)) {\n\t\t\t\t\t\treturn button;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t\treturn _.sortBy(allowedButtons, 'order');\n\t}\n\n\tresetButtons() {\n\t\treturn this.buttons.set({});\n\t}\n\n\tgetPermaLink(msgId) {\n\t\tconst roomData = ChatSubscription.findOne({\n\t\t\trid: Session.get('openedRoom')\n\t\t});\n\t\tlet routePath = document.location.pathname;\n\t\tif (roomData) {\n\t\t\troutePath = RocketChat.roomTypes.getRouteLink(roomData.t, roomData);\n\t\t}\n\t\treturn `${ Meteor.absoluteUrl().replace(/\\/$/, '') + routePath }?msg=${ msgId }`;\n\t}\n\n\thideDropDown() {\n\t\treturn $('.message-dropdown:visible').hide();\n\t}\n};\n\nMeteor.startup(function() {\n\t$(document).click((event) => {\n\t\tconst target = $(event.target);\n\t\tif (!target.closest('.message-cog-container').length && !target.is('.message-cog-container')) {\n\t\t\treturn RocketChat.MessageAction.hideDropDown();\n\t\t}\n\t});\n\n\tRocketChat.MessageAction.addButton({\n\t\tid: 'reply-message',\n\t\ticon: 'icon-reply',\n\t\ti18nLabel: 'Reply',\n\t\tcontext: ['message', 'message-mobile'],\n\t\taction(event, instance) {\n\t\t\tconst message = this._arguments[1];\n\t\t\tconst input = instance.find('.input-message');\n\t\t\tconst url = RocketChat.MessageAction.getPermaLink(message._id);\n\t\t\tconst text = `[ ](${ url }) @${ message.u.username } `;\n\t\t\tif (input.value) {\n\t\t\t\tinput.value += input.value.endsWith(' ') ? '' : ' ';\n\t\t\t}\n\t\t\tinput.value += text;\n\t\t\tinput.focus();\n\t\t\treturn RocketChat.MessageAction.hideDropDown();\n\t\t},\n\t\tvalidation(message) {\n\t\t\tif (RocketChat.models.Subscriptions.findOne({\n\t\t\t\trid: message.rid\n\t\t\t}) == null) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\torder: 1\n\t});\n\t/* globals chatMessages*/\n\tRocketChat.MessageAction.addButton({\n\t\tid: 'edit-message',\n\t\ticon: 'icon-pencil',\n\t\ti18nLabel: 'Edit',\n\t\tcontext: ['message', 'message-mobile'],\n\t\taction(e, instance) {\n\t\t\tconst message = $(e.currentTarget).closest('.message')[0];\n\t\t\tchatMessages[Session.get('openedRoom')].edit(message);\n\t\t\tRocketChat.MessageAction.hideDropDown();\n\t\t\tconst input = instance.find('.input-message');\n\t\t\tMeteor.setTimeout(() => {\n\t\t\t\tinput.focus();\n\t\t\t\tinput.updateAutogrow();\n\t\t\t}, 200);\n\t\t},\n\t\tvalidation(message) {\n\t\t\tif (RocketChat.models.Subscriptions.findOne({\n\t\t\t\trid: message.rid\n\t\t\t}) == null) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst hasPermission = RocketChat.authz.hasAtLeastOnePermission('edit-message', message.rid);\n\t\t\tconst isEditAllowed = RocketChat.settings.get('Message_AllowEditing');\n\t\t\tconst editOwn = message.u && message.u._id === Meteor.userId();\n\t\t\tif (!(hasPermission || (isEditAllowed && editOwn))) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst blockEditInMinutes = RocketChat.settings.get('Message_AllowEditing_BlockEditInMinutes');\n\t\t\tif (blockEditInMinutes) {\n\t\t\t\tlet msgTs;\n\t\t\t\tif (message.ts != null) {\n\t\t\t\t\tmsgTs = moment(message.ts);\n\t\t\t\t}\n\t\t\t\tlet currentTsDiff;\n\t\t\t\tif (msgTs != null) {\n\t\t\t\t\tcurrentTsDiff = moment().diff(msgTs, 'minutes');\n\t\t\t\t}\n\t\t\t\treturn currentTsDiff < blockEditInMinutes;\n\t\t\t} else {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\torder: 2\n\t});\n\tRocketChat.MessageAction.addButton({\n\t\tid: 'delete-message',\n\t\ticon: 'icon-trash-alt',\n\t\ti18nLabel: 'Delete',\n\t\tcontext: ['message', 'message-mobile'],\n\t\taction() {\n\t\t\tconst message = this._arguments[1];\n\t\t\tRocketChat.MessageAction.hideDropDown();\n\t\t\treturn chatMessages[Session.get('openedRoom')].confirmDeleteMsg(message);\n\t\t},\n\t\tvalidation(message) {\n\t\t\tif (RocketChat.models.Subscriptions.findOne({rid: message.rid}) == null) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst hasPermission = RocketChat.authz.hasAtLeastOnePermission('delete-message', message.rid);\n\t\t\tconst isDeleteAllowed = RocketChat.settings.get('Message_AllowDeleting');\n\t\t\tconst deleteOwn = message.u && message.u._id === Meteor.userId();\n\t\t\tif (!(hasPermission || (isDeleteAllowed && deleteOwn))) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst blockDeleteInMinutes = RocketChat.settings.get('Message_AllowDeleting_BlockDeleteInMinutes');\n\t\t\tif ((blockDeleteInMinutes != null) && blockDeleteInMinutes !== 0) {\n\t\t\t\tlet msgTs;\n\t\t\t\tif (message.ts != null) {\n\t\t\t\t\tmsgTs = moment(message.ts);\n\t\t\t\t}\n\t\t\t\tlet currentTsDiff;\n\t\t\t\tif (msgTs != null) {\n\t\t\t\t\tcurrentTsDiff = moment().diff(msgTs, 'minutes');\n\t\t\t\t}\n\t\t\t\treturn currentTsDiff < blockDeleteInMinutes;\n\t\t\t} else {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\torder: 3\n\t});\n\t/* globals cordova*/\n\tRocketChat.MessageAction.addButton({\n\t\tid: 'permalink',\n\t\ticon: 'icon-link',\n\t\ti18nLabel: 'Permalink',\n\t\tclasses: 'clipboard',\n\t\tcontext: ['message', 'message-mobile'],\n\t\taction() {\n\t\t\tconst message = this._arguments[1];\n\t\t\tconst permalink = RocketChat.MessageAction.getPermaLink(message._id);\n\t\t\tRocketChat.MessageAction.hideDropDown();\n\t\t\tif (Meteor.isCordova) {\n\t\t\t\tcordova.plugins.clipboard.copy(permalink);\n\t\t\t} else {\n\t\t\t\t$(event.currentTarget).attr('data-clipboard-text', permalink);\n\t\t\t}\n\t\t\treturn toastr.success(TAPi18n.__('Copied'));\n\t\t},\n\t\tvalidation(message) {\n\t\t\tif (RocketChat.models.Subscriptions.findOne({\n\t\t\t\trid: message.rid\n\t\t\t}) == null) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\torder: 4\n\t});\n\tRocketChat.MessageAction.addButton({\n\t\tid: 'copy',\n\t\ticon: 'icon-paste',\n\t\ti18nLabel: 'Copy',\n\t\tclasses: 'clipboard',\n\t\tcontext: ['message', 'message-mobile'],\n\t\taction() {\n\t\t\tconst message = this._arguments[1].msg;\n\t\t\tRocketChat.MessageAction.hideDropDown();\n\t\t\tif (Meteor.isCordova) {\n\t\t\t\tcordova.plugins.clipboard.copy(message);\n\t\t\t} else {\n\t\t\t\t$(event.currentTarget).attr('data-clipboard-text', message);\n\t\t\t}\n\t\t\treturn toastr.success(TAPi18n.__('Copied'));\n\t\t},\n\t\tvalidation(message) {\n\t\t\tif (RocketChat.models.Subscriptions.findOne({\n\t\t\t\trid: message.rid\n\t\t\t}) == null) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\torder: 5\n\t});\n\treturn RocketChat.MessageAction.addButton({\n\t\tid: 'quote-message',\n\t\ticon: 'icon-quote-left',\n\t\ti18nLabel: 'Quote',\n\t\tcontext: ['message', 'message-mobile'],\n\t\taction(event, instance) {\n\t\t\tconst message = this._arguments[1];\n\t\t\tconst input = instance.find('.input-message');\n\t\t\tconst url = RocketChat.MessageAction.getPermaLink(message._id);\n\t\t\tconst text = `[ ](${ url }) `;\n\t\t\tif (input.value) {\n\t\t\t\tinput.value += input.value.endsWith(' ') ? '' : ' ';\n\t\t\t}\n\t\t\tinput.value += text;\n\t\t\tinput.focus();\n\t\t\treturn RocketChat.MessageAction.hideDropDown();\n\t\t},\n\t\tvalidation(message) {\n\t\t\tif (RocketChat.models.Subscriptions.findOne({\n\t\t\t\trid: message.rid\n\t\t\t}) == null) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\torder: 6\n\t});\n});\n","RocketChat.TabBar.addButton({\n\tgroups: ['channel', 'group', 'direct'],\n\tid: 'message-search',\n\ti18nTitle: 'Search',\n\ticon: 'icon-search',\n\ttemplate: 'messageSearch',\n\torder: 1\n});\n\nRocketChat.TabBar.addButton({\n\tgroups: ['direct'],\n\tid: 'user-info',\n\ti18nTitle: 'User_Info',\n\ticon: 'icon-user',\n\ttemplate: 'membersList',\n\torder: 2\n});\n\nRocketChat.TabBar.addButton({\n\tgroups: ['channel', 'group'],\n\tid: 'members-list',\n\ti18nTitle: 'Members_List',\n\ticon: 'icon-users',\n\ttemplate: 'membersList',\n\torder: 2\n});\n\nRocketChat.TabBar.addButton({\n\tgroups: ['channel', 'group', 'direct'],\n\tid: 'uploaded-files-list',\n\ti18nTitle: 'Room_uploaded_file_list',\n\ticon: 'icon-attach',\n\ttemplate: 'uploadedFilesList',\n\torder: 3\n});\n","RocketChat.applyCustomTranslations = function applyCustomTranslations() {\n\tlet CustomTranslations = RocketChat.settings.get('Custom_Translations');\n\tif (typeof CustomTranslations === 'string' && CustomTranslations.trim() !== '') {\n\t\ttry {\n\t\t\tCustomTranslations = JSON.parse(CustomTranslations);\n\n\t\t\tfor (const lang in CustomTranslations) {\n\t\t\t\tif (CustomTranslations.hasOwnProperty(lang)) {\n\t\t\t\t\tconst translations = CustomTranslations[lang];\n\t\t\t\t\tTAPi18next.addResourceBundle(lang, 'project', translations);\n\t\t\t\t}\n\t\t\t}\n\t\t\tTAPi18n._language_changed_tracker.changed();\n\t\t} catch (e) {\n\t\t\tconsole.error('Invalid setting Custom_Translations', e);\n\t\t}\n\t}\n};\n\nMeteor.startup(function() {\n\tMeteor.autorun(function() {\n\t\t// Re apply translations if tap language was changed\n\t\tSession.get(TAPi18n._loaded_lang_session_key);\n\t\tRocketChat.applyCustomTranslations();\n\t});\n});\n","RocketChat.models._Base = class {\n\n\t_baseName() {\n\t\treturn 'rocketchat_';\n\t}\n\n\t_initModel(name) {\n\t\tcheck(name, String);\n\t\treturn this.model = new Mongo.Collection(this._baseName() + name);\n\t}\n\n\tfind() {\n\t\treturn this.model.find.apply(this.model, arguments);\n\t}\n\n\tfindOne() {\n\t\treturn this.model.findOne.apply(this.model, arguments);\n\t}\n\n\tinsert() {\n\t\treturn this.model.insert.apply(this.model, arguments);\n\t}\n\n\tupdate() {\n\t\treturn this.model.update.apply(this.model, arguments);\n\t}\n\n\tupsert() {\n\t\treturn this.model.upsert.apply(this.model, arguments);\n\t}\n\n\tremove() {\n\t\treturn this.model.remove.apply(this.model, arguments);\n\t}\n\n\tallow() {\n\t\treturn this.model.allow.apply(this.model, arguments);\n\t}\n\n\tdeny() {\n\t\treturn this.model.deny.apply(this.model, arguments);\n\t}\n\n\tensureIndex() {}\n\n\tdropIndex() {}\n\n\ttryEnsureIndex() {}\n\n\ttryDropIndex() {}\n\n};\n","\nRocketChat.models.Uploads = new class extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper();\n\t\tthis._initModel('uploads');\n\t}\n};\n","Template.customFieldsForm.helpers({\n\tcustomFields() {\n\t\tconst customFields = Template.instance().customFields.get();\n\n\t\tif (!customFields) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst customFieldsArray = [];\n\n\t\tObject.keys(customFields).forEach((key) => {\n\t\t\tconst value = customFields[key];\n\t\t\tif (value.hideFromForm === true && Template.instance().hideFromForm === true) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcustomFieldsArray.push({\n\t\t\t\tfieldName: key,\n\t\t\t\tfield: value\n\t\t\t});\n\t\t});\n\n\t\treturn customFieldsArray;\n\t},\n\tselectedField(current, field) {\n\t\tconst formData = Template.instance().formData;\n\n\t\tif (typeof formData[field.fieldName] !== 'undefined') {\n\t\t\treturn formData[field.fieldName] === current;\n\t\t} else if (typeof field.defaultValue !== 'undefined') {\n\t\t\treturn field.defaultValue === current;\n\t\t}\n\t},\n\tfieldValue() {\n\t\tconst formData = Template.instance().formData;\n\n\t\treturn formData[this.fieldName];\n\t}\n});\n\nTemplate.customFieldsForm.onCreated(function() {\n\tthis.customFields = new ReactiveVar();\n\n\tconst currentData = Template.currentData();\n\tthis.hideFromForm = currentData && currentData.hideFromForm;\n\tthis.formData = (currentData && currentData.formData) || {};\n\n\tTracker.autorun(() => {\n\t\tconst Accounts_CustomFields = RocketChat.settings.get('Accounts_CustomFields');\n\t\tif (typeof Accounts_CustomFields === 'string' && Accounts_CustomFields.trim() !== '') {\n\t\t\ttry {\n\t\t\t\tthis.customFields.set(JSON.parse(RocketChat.settings.get('Accounts_CustomFields')));\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('Invalid JSON for Accounts_CustomFields');\n\t\t\t}\n\t\t} else {\n\t\t\tthis.customFields.set(undefined);\n\t\t}\n\t});\n});\n","/* globals openRoom */\nRocketChat.roomTypes.add(null, 0, {\n\ttemplate: 'starredRooms',\n\ticon: 'icon-star'\n});\n\nRocketChat.roomTypes.add('c', 10, {\n\ttemplate: 'channels',\n\ticon: 'icon-hash',\n\troute: {\n\t\tname: 'channel',\n\t\tpath: '/channel/:name',\n\t\taction(params) {\n\t\t\treturn openRoom('c', params.name);\n\t\t}\n\t},\n\n\tfindRoom(identifier) {\n\t\tconst query = {\n\t\t\tt: 'c',\n\t\t\tname: identifier\n\t\t};\n\t\treturn ChatRoom.findOne(query);\n\t},\n\n\troomName(roomData) {\n\t\treturn roomData.name;\n\t},\n\n\tcondition() {\n\t\treturn RocketChat.authz.hasAtLeastOnePermission(['view-c-room', 'view-joined-room']) || RocketChat.settings.get('Accounts_AllowAnonymousRead') === true;\n\t},\n\n\tshowJoinLink(roomId) {\n\t\treturn !!ChatRoom.findOne({ _id: roomId, t: 'c' });\n\t}\n});\n\nRocketChat.roomTypes.add('d', 20, {\n\ttemplate: 'directMessages',\n\ticon: 'icon-at',\n\troute: {\n\t\tname: 'direct',\n\t\tpath: '/direct/:username',\n\t\taction(params) {\n\t\t\treturn openRoom('d', params.username);\n\t\t},\n\t\tlink(sub) {\n\t\t\treturn { username: sub.name };\n\t\t}\n\t},\n\n\tfindRoom(identifier) {\n\t\tconst query = {\n\t\t\tt: 'd',\n\t\t\tname: identifier\n\t\t};\n\n\t\tconst subscription = ChatSubscription.findOne(query);\n\t\tif (subscription && subscription.rid) {\n\t\t\treturn ChatRoom.findOne(subscription.rid);\n\t\t}\n\t},\n\n\troomName(roomData) {\n\t\tconst subscription = ChatSubscription.findOne({ rid: roomData._id }, { fields: { name: 1, fname: 1 } });\n\t\tif (!subscription) {\n\t\t\treturn '';\n\t\t}\n\t\tif (RocketChat.settings.get('UI_Use_Real_Name') && subscription.fname) {\n\t\t\treturn subscription.fname;\n\t\t}\n\n\t\treturn subscription.name;\n\t},\n\n\tsecondaryRoomName(roomData) {\n\t\tif (RocketChat.settings.get('UI_Use_Real_Name')) {\n\t\t\tconst subscription = ChatSubscription.findOne({ rid: roomData._id }, { fields: { name: 1 } });\n\t\t\treturn subscription && subscription.name;\n\t\t}\n\t},\n\n\tcondition() {\n\t\treturn RocketChat.authz.hasAtLeastOnePermission(['view-d-room', 'view-joined-room']);\n\t},\n\n\tgetUserStatus(roomId) {\n\t\tconst subscription = RocketChat.models.Subscriptions.findOne({rid: roomId});\n\t\tif (subscription == null) { return; }\n\n\t\treturn Session.get(`user_${ subscription.name }_status`);\n\t}\n});\n\nRocketChat.roomTypes.add('p', 30, {\n\ttemplate: 'privateGroups',\n\ticon: 'icon-lock',\n\troute: {\n\t\tname: 'group',\n\t\tpath: '/group/:name',\n\t\taction(params) {\n\t\t\treturn openRoom('p', params.name);\n\t\t}\n\t},\n\n\tfindRoom(identifier) {\n\t\tconst query = {\n\t\t\tt: 'p',\n\t\t\tname: identifier\n\t\t};\n\t\treturn ChatRoom.findOne(query);\n\t},\n\n\troomName(roomData) {\n\t\treturn roomData.name;\n\t},\n\n\tcondition() {\n\t\treturn RocketChat.authz.hasAllPermission('view-p-room');\n\t}\n});\n"]}