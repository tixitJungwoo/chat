{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:file-upload/globalFileRestrictions.js","meteor://ðŸ’»app/packages/rocketchat:file-upload/lib/FileUpload.js","meteor://ðŸ’»app/packages/rocketchat:file-upload/lib/FileUploadBase.js","meteor://ðŸ’»app/packages/rocketchat:file-upload/client/lib/FileUploadAmazonS3.js","meteor://ðŸ’»app/packages/rocketchat:file-upload/client/lib/FileUploadFileSystem.js","meteor://ðŸ’»app/packages/rocketchat:file-upload/client/lib/FileUploadGoogleStorage.js","meteor://ðŸ’»app/packages/rocketchat:file-upload/client/lib/FileUploadGridFS.js","meteor://ðŸ’»app/packages/rocketchat:file-upload/client/lib/fileUploadHandler.js"],"names":["filesize","module","watch","require","v","slingShotConfig","authorize","file","userId","Meteor","Error","RocketChat","fileUploadIsValidContentType","type","TAPi18n","__","maxFileSize","settings","get","size","maxSize","allowedFileTypes","Slingshot","fileRestrictions","FileUpload","validateFileUpload","Match","test","rid","String","user","room","models","Rooms","findOneById","directMessageAllow","fileUploadAllowed","authz","canAccessRoom","reason","language","t","parseInt","key","value","UploadFS","config","defaultStorePermissions","StorePermissions","insert","update","doc","hasPermission","remove","FileUploadBase","meta","id","Random","getProgress","getFileName","name","start","stop","AmazonS3","uploader","Upload","send","error","downloadUrl","computation","uploading","Session","Array","isArray","item","_","findWhere","isObject","percentage","push","set","pick","_id","substr","lastIndexOf","url","call","setTimeout","without","Tracker","autorun","onProgress","progress","xhr","abort","FileSystemStore","store","Local","collection","Uploads","model","filter","Filter","onCheck","FileSystem","handler","Uploader","data","onError","err","onComplete","fileData","replace","absoluteUrl","GoogleCloudStorage","GridFS","fileStore","fileUploadHandler","storageType","undefined"],"mappings":"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","file":"/packages/rocketchat_file-upload.js","sourcesContent":["/* globals Slingshot */\n\nimport filesize from 'filesize';\n\nconst slingShotConfig = {\n\tauthorize(file/*, metaContext*/) {\n\t\t//Deny uploads if user is not logged in.\n\t\tif (!this.userId) {\n\t\t\tthrow new Meteor.Error('login-required', 'Please login before posting files');\n\t\t}\n\n\t\tif (!RocketChat.fileUploadIsValidContentType(file.type)) {\n\t\t\tthrow new Meteor.Error(TAPi18n.__('error-invalid-file-type'));\n\t\t}\n\n\t\tconst maxFileSize = RocketChat.settings.get('FileUpload_MaxFileSize');\n\n\t\tif (maxFileSize && maxFileSize < file.size) {\n\t\t\tthrow new Meteor.Error(TAPi18n.__('File_exceeds_allowed_size_of_bytes', { size: filesize(maxFileSize) }));\n\t\t}\n\n\t\treturn true;\n\t},\n\tmaxSize: 0,\n\tallowedFileTypes: null\n};\n\nSlingshot.fileRestrictions('rocketchat-uploads', slingShotConfig);\nSlingshot.fileRestrictions('rocketchat-uploads-gs', slingShotConfig);\n","/* globals FileUpload:true */\n/* exported FileUpload */\n\nimport filesize from 'filesize';\n\nlet maxFileSize = 0;\n\nFileUpload = {\n\tvalidateFileUpload(file) {\n\t\tif (!Match.test(file.rid, String)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tconst room = RocketChat.models.Rooms.findOneById(file.rid);\n\t\tconst directMessageAllow = RocketChat.settings.get('FileUpload_Enabled_Direct');\n\t\tconst fileUploadAllowed = RocketChat.settings.get('FileUpload_Enabled');\n\n\t\tif (RocketChat.authz.canAccessRoom(room, user) !== true) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!fileUploadAllowed) {\n\t\t\tconst reason = TAPi18n.__('FileUpload_Disabled', user.language);\n\t\t\tthrow new Meteor.Error('error-file-upload-disabled', reason);\n\t\t}\n\n\t\tif (!directMessageAllow && room.t === 'd') {\n\t\t\tconst reason = TAPi18n.__('File_not_allowed_direct_messages', user.language);\n\t\t\tthrow new Meteor.Error('error-direct-message-file-upload-not-allowed', reason);\n\t\t}\n\n\t\tif (file.size > maxFileSize) {\n\t\t\tconst reason = TAPi18n.__('File_exceeds_allowed_size_of_bytes', {\n\t\t\t\tsize: filesize(maxFileSize)\n\t\t\t}, user.language);\n\t\t\tthrow new Meteor.Error('error-file-too-large', reason);\n\t\t}\n\n\t\tif (parseInt(maxFileSize) > 0) {\n\t\t\tif (file.size > maxFileSize) {\n\t\t\t\tconst reason = TAPi18n.__('File_exceeds_allowed_size_of_bytes', {\n\t\t\t\t\tsize: filesize(maxFileSize)\n\t\t\t\t}, user.language);\n\t\t\t\tthrow new Meteor.Error('error-file-too-large', reason);\n\t\t\t}\n\t\t}\n\n\t\tif (!RocketChat.fileUploadIsValidContentType(file.type)) {\n\t\t\tconst reason = TAPi18n.__('File_type_is_not_accepted', user.language);\n\t\t\tthrow new Meteor.Error('error-invalid-file-type', reason);\n\t\t}\n\n\t\treturn true;\n\t}\n};\n\nRocketChat.settings.get('FileUpload_MaxFileSize', function(key, value) {\n\tmaxFileSize = value;\n});\n","/* globals FileUploadBase:true, UploadFS */\n/* exported FileUploadBase */\n\nUploadFS.config.defaultStorePermissions = new UploadFS.StorePermissions({\n\tinsert(userId/*, doc*/) {\n\t\treturn userId;\n\t},\n\tupdate(userId, doc) {\n\t\treturn RocketChat.authz.hasPermission(Meteor.userId(), 'delete-message', doc.rid) || (RocketChat.settings.get('Message_AllowDeleting') && userId === doc.userId);\n\t},\n\tremove(userId, doc) {\n\t\treturn RocketChat.authz.hasPermission(Meteor.userId(), 'delete-message', doc.rid) || (RocketChat.settings.get('Message_AllowDeleting') && userId === doc.userId);\n\t}\n});\n\n\nFileUploadBase = class FileUploadBase {\n\tconstructor(meta, file) {\n\t\tthis.id = Random.id();\n\t\tthis.meta = meta;\n\t\tthis.file = file;\n\t}\n\n\tgetProgress() {\n\n\t}\n\n\tgetFileName() {\n\t\treturn this.meta.name;\n\t}\n\n\tstart() {\n\n\t}\n\n\tstop() {\n\n\t}\n};\n","/* globals FileUpload, FileUploadBase, Slingshot */\n\nFileUpload.AmazonS3 = class FileUploadAmazonS3 extends FileUploadBase {\n\tconstructor(meta, file) {\n\t\tsuper(meta, file);\n\t\tthis.uploader = new Slingshot.Upload('rocketchat-uploads', { rid: meta.rid });\n\t}\n\n\tstart() {\n\t\tthis.uploader.send(this.file, (error, downloadUrl) => {\n\t\t\tif (this.computation) {\n\t\t\t\tthis.computation.stop();\n\t\t\t}\n\n\t\t\tif (error) {\n\t\t\t\tlet uploading = Session.get('uploading');\n\t\t\t\tif (!Array.isArray(uploading)) {\n\t\t\t\t\tuploading = [];\n\t\t\t\t}\n\n\t\t\t\tconst item = _.findWhere(uploading, { id: this.id });\n\n\t\t\t\tif (_.isObject(item)) {\n\t\t\t\t\titem.error = error.error;\n\t\t\t\t\titem.percentage = 0;\n\t\t\t\t} else {\n\t\t\t\t\tuploading.push({\n\t\t\t\t\t\terror: error.error,\n\t\t\t\t\t\tpercentage: 0\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tSession.set('uploading', uploading);\n\t\t\t} else {\n\t\t\t\tconst file = _.pick(this.meta, 'type', 'size', 'name', 'identify', 'description');\n\t\t\t\tfile._id = downloadUrl.substr(downloadUrl.lastIndexOf('/') + 1);\n\t\t\t\tfile.url = downloadUrl;\n\n\t\t\t\tMeteor.call('sendFileMessage', this.meta.rid, 's3', file, () => {\n\t\t\t\t\tMeteor.setTimeout(() => {\n\t\t\t\t\t\tconst uploading = Session.get('uploading');\n\t\t\t\t\t\tif (uploading !== null) {\n\t\t\t\t\t\t\tconst item = _.findWhere(uploading, {\n\t\t\t\t\t\t\t\tid: this.id\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn Session.set('uploading', _.without(uploading, item));\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 2000);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.computation = Tracker.autorun(() => {\n\t\t\tthis.onProgress(this.uploader.progress());\n\t\t});\n\t}\n\n\tonProgress() {}\n\n\tstop() {\n\t\tif (this.uploader && this.uploader.xhr) {\n\t\t\tthis.uploader.xhr.abort();\n\t\t}\n\t}\n};\n","/* globals FileUploadBase, UploadFS, FileUpload:true, FileSystemStore:true */\n\nFileSystemStore = new UploadFS.store.Local({\n\tcollection: RocketChat.models.Uploads.model,\n\tname: 'fileSystem',\n\tfilter: new UploadFS.Filter({\n\t\tonCheck: FileUpload.validateFileUpload\n\t})\n});\n\nFileUpload.FileSystem = class FileUploadFileSystem extends FileUploadBase {\n\tconstructor(meta, file) {\n\t\tsuper(meta, file);\n\t\tthis.handler = new UploadFS.Uploader({\n\t\t\tstore: FileSystemStore,\n\t\t\tdata: file,\n\t\t\tfile: meta,\n\t\t\tonError: (err) => {\n\t\t\t\tconst uploading = Session.get('uploading');\n\t\t\t\tif (uploading != null) {\n\t\t\t\t\tconst item = _.findWhere(uploading, {\n\t\t\t\t\t\tid: this.id\n\t\t\t\t\t});\n\t\t\t\t\tif (item != null) {\n\t\t\t\t\t\titem.error = err.reason;\n\t\t\t\t\t\titem.percentage = 0;\n\t\t\t\t\t}\n\t\t\t\t\treturn Session.set('uploading', uploading);\n\t\t\t\t}\n\t\t\t},\n\t\t\tonComplete: (fileData) => {\n\t\t\t\tconst file = _.pick(fileData, '_id', 'type', 'size', 'name', 'identify', 'description');\n\n\t\t\t\tfile.url = fileData.url.replace(Meteor.absoluteUrl(), '/');\n\n\t\t\t\tMeteor.call('sendFileMessage', this.meta.rid, null, file, () => {\n\t\t\t\t\tMeteor.setTimeout(() => {\n\t\t\t\t\t\tconst uploading = Session.get('uploading');\n\t\t\t\t\t\tif (uploading != null) {\n\t\t\t\t\t\t\tconst item = _.findWhere(uploading, {\n\t\t\t\t\t\t\t\tid: this.id\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn Session.set('uploading', _.without(uploading, item));\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 2000);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.handler.onProgress = (file, progress) => {\n\t\t\tthis.onProgress(progress);\n\t\t};\n\t}\n\n\tstart() {\n\t\treturn this.handler.start();\n\t}\n\n\tonProgress() {}\n\n\tstop() {\n\t\treturn this.handler.stop();\n\t}\n};\n","/* globals FileUpload, FileUploadBase, Slingshot */\n\nFileUpload.GoogleCloudStorage = class FileUploadGoogleCloudStorage extends FileUploadBase {\n\tconstructor(meta, file) {\n\t\tsuper(meta, file);\n\t\tthis.uploader = new Slingshot.Upload('rocketchat-uploads-gs', { rid: meta.rid });\n\t}\n\n\tstart() {\n\t\tthis.uploader.send(this.file, (error, downloadUrl) => {\n\t\t\tif (this.computation) {\n\t\t\t\tthis.computation.stop();\n\t\t\t}\n\n\t\t\tif (error) {\n\t\t\t\tlet uploading = Session.get('uploading');\n\t\t\t\tif (!Array.isArray(uploading)) {\n\t\t\t\t\tuploading = [];\n\t\t\t\t}\n\n\t\t\t\tconst item = _.findWhere(uploading, { id: this.id });\n\n\t\t\t\tif (_.isObject(item)) {\n\t\t\t\t\titem.error = error.error;\n\t\t\t\t\titem.percentage = 0;\n\t\t\t\t} else {\n\t\t\t\t\tuploading.push({\n\t\t\t\t\t\terror: error.error,\n\t\t\t\t\t\tpercentage: 0\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tSession.set('uploading', uploading);\n\t\t\t} else {\n\t\t\t\tconst file = _.pick(this.meta, 'type', 'size', 'name', 'identify', 'description');\n\t\t\t\tfile._id = downloadUrl.substr(downloadUrl.lastIndexOf('/') + 1);\n\t\t\t\tfile.url = downloadUrl;\n\n\t\t\t\tMeteor.call('sendFileMessage', this.meta.rid, 'googleCloudStorage', file, () => {\n\t\t\t\t\tMeteor.setTimeout(() => {\n\t\t\t\t\t\tconst uploading = Session.get('uploading');\n\t\t\t\t\t\tif (uploading !== null) {\n\t\t\t\t\t\t\tconst item = _.findWhere(uploading, {\n\t\t\t\t\t\t\t\tid: this.id\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn Session.set('uploading', _.without(uploading, item));\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 2000);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.computation = Tracker.autorun(() => {\n\t\t\tthis.onProgress(this.uploader.progress());\n\t\t});\n\t}\n\n\tonProgress() {}\n\n\tstop() {\n\t\tif (this.uploader && this.uploader.xhr) {\n\t\t\tthis.uploader.xhr.abort();\n\t\t}\n\t}\n};\n","/* globals FileUploadBase, UploadFS, FileUpload:true */\nFileUpload.GridFS = class FileUploadGridFS extends FileUploadBase {\n\tconstructor(meta, file) {\n\t\tsuper(meta, file);\n\t\tthis.handler = new UploadFS.Uploader({\n\t\t\tstore: Meteor.fileStore,\n\t\t\tdata: file,\n\t\t\tfile: meta,\n\t\t\tonError: (err) => {\n\t\t\t\tconst uploading = Session.get('uploading');\n\t\t\t\tif (uploading != null) {\n\t\t\t\t\tconst item = _.findWhere(uploading, {\n\t\t\t\t\t\tid: this.id\n\t\t\t\t\t});\n\t\t\t\t\tif (item != null) {\n\t\t\t\t\t\titem.error = err.reason;\n\t\t\t\t\t\titem.percentage = 0;\n\t\t\t\t\t}\n\t\t\t\t\treturn Session.set('uploading', uploading);\n\t\t\t\t}\n\t\t\t},\n\t\t\tonComplete: (fileData) => {\n\t\t\t\tconst file = _.pick(fileData, '_id', 'type', 'size', 'name', 'identify', 'description');\n\n\t\t\t\tfile.url = fileData.url.replace(Meteor.absoluteUrl(), '/');\n\n\t\t\t\tMeteor.call('sendFileMessage', this.meta.rid, null, file, () => {\n\t\t\t\t\tMeteor.setTimeout(() => {\n\t\t\t\t\t\tconst uploading = Session.get('uploading');\n\t\t\t\t\t\tif (uploading != null) {\n\t\t\t\t\t\t\tconst item = _.findWhere(uploading, {\n\t\t\t\t\t\t\t\tid: this.id\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn Session.set('uploading', _.without(uploading, item));\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 2000);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.handler.onProgress = (file, progress) => {\n\t\t\tthis.onProgress(progress);\n\t\t};\n\t}\n\n\tstart() {\n\t\treturn this.handler.start();\n\t}\n\n\tonProgress() {}\n\n\tstop() {\n\t\treturn this.handler.stop();\n\t}\n};\n","/* globals FileUpload, fileUploadHandler:true */\n/* exported fileUploadHandler */\n\nfileUploadHandler = (meta, file) => {\n\tconst storageType = RocketChat.settings.get('FileUpload_Storage_Type');\n\n\tif (FileUpload[storageType] !== undefined) {\n\t\treturn new FileUpload[storageType](meta, file);\n\t}\n};\n"]}