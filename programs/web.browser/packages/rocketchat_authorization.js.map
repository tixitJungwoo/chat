{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:authorization/lib/rocketchat.js","meteor://ðŸ’»app/packages/rocketchat:authorization/client/lib/ChatPermissions.js","meteor://ðŸ’»app/packages/rocketchat:authorization/client/lib/models/Roles.js","meteor://ðŸ’»app/packages/rocketchat:authorization/client/lib/models/Users.js","meteor://ðŸ’»app/packages/rocketchat:authorization/client/lib/models/Subscriptions.js","meteor://ðŸ’»app/packages/rocketchat:authorization/client/startup.js","meteor://ðŸ’»app/packages/rocketchat:authorization/client/hasPermission.js","meteor://ðŸ’»app/packages/rocketchat:authorization/client/hasRole.js","meteor://ðŸ’»app/packages/rocketchat:authorization/client/route.js","meteor://ðŸ’»app/packages/rocketchat:authorization/client/views/permissions.js","meteor://ðŸ’»app/packages/rocketchat:authorization/client/views/permissionsRole.js"],"names":["RocketChat","authz","cachedCollection","CachedCollection","name","eventType","userRelated","init","ChatPermissions","collection","models","Roles","Mongo","Collection","Object","assign","findUsersInRole","scope","options","role","findOne","roleScope","model","findUsersInRoles","isUserInRoles","userId","roles","concat","some","roleName","isUserInRole","_","isUndefined","Users","query","_id","$in","find","Subscriptions","roomId","rid","subscriptions","fetch","users","compact","map","subscription","u","Meteor","subscribe","AdminBox","addOption","href","i18nLabel","permissionGranted","hasAllPermission","atLeastOne","permissions","permissionId","permission","all","every","hasPermission","strategy","ready","get","Template","registerHelper","hasAtLeastOnePermission","hasRole","roleNames","FlowRouter","route","action","BlazeLayout","render","center","pageTitle","t","pageTemplate","helpers","instance","sort","granted","indexOf","events","e","currentTarget","getAttribute","permissionByRole","call","onCreated","ReactiveVar","actions","added","removed","Tracker","autorun","set","observeChanges","id","fields","changed","toastr","module","watch","require","v","permissionsRole","getParam","userInRole","usersInRole","editing","emailAddress","emails","length","address","protected","editable","hasUsers","count","hasMore","limit","isLoading","searchRoom","autocompleteChannelSettings","rules","field","template","roomSearch","noMatchTemplate","roomSearchEmpty","matchAll","selector","match","autocompleteUsernameSettings","userSearch","userSearchEmpty","filter","exceptions","term","preventDefault","swal","title","type","showCancelButton","confirmButtonColor","confirmButtonText","cancelButtonText","closeOnConfirm","html","username","error","handleError","text","timer","showConfirmButton","oldBtnValue","elements","value","roleData","description","success","go","trim","reset","stopPropagation","event","doc","searchUsername"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAAA,WAAWC,KAAX,GAAmB,EAAnB,kG;;;;;;;;;;;ACAAD,WAAWC,KAAX,CAAiBC,gBAAjB,GAAoC,IAAIF,WAAWG,gBAAf,CAAgC;AACnEC,OAAM,aAD6D;AAEnEC,YAAW,UAFwD;AAGnEC,cAAa;AAHsD,CAAhC,CAApC;AAKAN,WAAWC,KAAX,CAAiBC,gBAAjB,CAAkCK,IAAlC;AAEA,KAAKC,eAAL,GAAuBR,WAAWC,KAAX,CAAiBC,gBAAjB,CAAkCO,UAAzD,oD;;;;;;;;;;;ACPAT,WAAWU,MAAX,CAAkBC,KAAlB,GAA0B,IAAIC,MAAMC,UAAV,CAAqB,kBAArB,CAA1B;AAEAC,OAAOC,MAAP,CAAcf,WAAWU,MAAX,CAAkBC,KAAhC,EAAuC;AACtCK,gBADsC,YACtBZ,IADsB,EAChBa,KADgB,EACTC,OADS,EACA;AACrC,MAAMC,OAAO,KAAKC,OAAL,CAAahB,IAAb,CAAb;AACA,MAAMiB,YAAaF,QAAQA,KAAKF,KAAd,IAAwB,OAA1C;AACA,MAAMK,QAAQtB,WAAWU,MAAX,CAAkBW,SAAlB,CAAd;AACA,SAAOC,SAASA,MAAMC,gBAAf,IAAmCD,MAAMC,gBAAN,CAAuBnB,IAAvB,EAA6Ba,KAA7B,EAAoCC,OAApC,CAA1C;AACA,EANqC;AAQtCM,cARsC,YAQxBC,MARwB,EAQhBC,KARgB,EAQTT,KARS,EAQF;AAAA;;AACnCS,UAAQ,GAAGC,MAAH,CAAUD,KAAV,CAAR;AACA,SAAOA,MAAME,IAAN,CAAW,UAACC,QAAD,EAAc;AAC/B,OAAMV,OAAO,MAAKC,OAAL,CAAaS,QAAb,CAAb;;AACA,OAAMR,YAAaF,QAAQA,KAAKF,KAAd,IAAwB,OAA1C;AACA,OAAMK,QAAQtB,WAAWU,MAAX,CAAkBW,SAAlB,CAAd;AACA,UAAOC,SAASA,MAAMQ,YAAf,IAA+BR,MAAMQ,YAAN,CAAmBL,MAAnB,EAA2BI,QAA3B,EAAqCZ,KAArC,CAAtC;AACA,GALM,CAAP;AAMA;AAhBqC,CAAvC,sH;;;;;;;;;;;ACFA,IAAIc,EAAEC,WAAF,CAAchC,WAAWU,MAAX,CAAkBuB,KAAhC,CAAJ,EAA4C;AAC3CjC,YAAWU,MAAX,CAAkBuB,KAAlB,GAA0B,EAA1B;AACA;;AAEDnB,OAAOC,MAAP,CAAcf,WAAWU,MAAX,CAAkBuB,KAAhC,EAAuC;AACtCH,aADsC,YACzBL,MADyB,EACjBI,QADiB,EACP;AAC9B,MAAMK,QAAQ;AACbC,QAAKV,MADQ;AAEbC,UAAOG;AAFM,GAAd;AAKA,SAAO,CAACE,EAAEC,WAAF,CAAc,KAAKZ,OAAL,CAAac,KAAb,CAAd,CAAR;AACA,EARqC;AAUtCX,iBAVsC,YAUrBG,KAVqB,EAUdT,KAVc,EAUPC,OAVO,EAUE;AACvCQ,UAAQ,GAAGC,MAAH,CAAUD,KAAV,CAAR;AAEA,MAAMQ,QAAQ;AACbR,UAAO;AAAEU,SAAKV;AAAP;AADM,GAAd;AAIA,SAAO,KAAKW,IAAL,CAAUH,KAAV,EAAiBhB,OAAjB,CAAP;AACA;AAlBqC,CAAvC,sH;;;;;;;;;;;ACJA,IAAIa,EAAEC,WAAF,CAAchC,WAAWU,MAAX,CAAkB4B,aAAhC,CAAJ,EAAoD;AACnDtC,YAAWU,MAAX,CAAkB4B,aAAlB,GAAkC,EAAlC;AACA;;AAEDxB,OAAOC,MAAP,CAAcf,WAAWU,MAAX,CAAkB4B,aAAhC,EAA+C;AAC9CR,aAD8C,YACjCL,MADiC,EACzBI,QADyB,EACfU,MADe,EACP;AACtC,MAAIA,UAAU,IAAd,EAAoB;AACnB,UAAO,KAAP;AACA;;AAED,MAAML,QAAQ;AACbM,QAAKD,MADQ;AAEbb,UAAOG;AAFM,GAAd;AAKA,SAAO,CAACE,EAAEC,WAAF,CAAc,KAAKZ,OAAL,CAAac,KAAb,CAAd,CAAR;AACA,EAZ6C;AAc9CX,iBAd8C,YAc7BG,KAd6B,EActBT,KAdsB,EAcfC,OAde,EAcN;AACvCQ,UAAQ,GAAGC,MAAH,CAAUD,KAAV,CAAR;AAEA,MAAMQ,QAAQ;AACbR,UAAO;AAAEU,SAAKV;AAAP;AADM,GAAd;;AAIA,MAAIT,KAAJ,EAAW;AACViB,SAAMM,GAAN,GAAYvB,KAAZ;AACA;;AAED,MAAMwB,gBAAgB,KAAKJ,IAAL,CAAUH,KAAV,EAAiBQ,KAAjB,EAAtB;;AAEA,MAAMC,QAAQZ,EAAEa,OAAF,CAAUb,EAAEc,GAAF,CAAMJ,aAAN,EAAqB,UAASK,YAAT,EAAuB;AACnE,OAAI,gBAAgB,OAAOA,aAAaC,CAApC,IAAyC,gBAAgB,OAAOD,aAAaC,CAAb,CAAeZ,GAAnF,EAAwF;AACvF,WAAOW,aAAaC,CAAb,CAAeZ,GAAtB;AACA;AACD,GAJuB,CAAV,CAAd;;AAMA,SAAOnC,WAAWU,MAAX,CAAkBuB,KAAlB,CAAwBI,IAAxB,CAA6B;AAAEF,QAAK;AAAEC,SAAKO;AAAP;AAAP,GAA7B,EAAsDzB,OAAtD,CAAP;AACA;AAlC6C,CAA/C,sH;;;;;;;;;;;ACJA8B,OAAOC,SAAP,CAAiB,OAAjB;AAEAjD,WAAWkD,QAAX,CAAoBC,SAApB,CAA8B;AAC7BC,OAAM,mBADuB;AAE7BC,YAAW,aAFkB;AAG7BC,kBAH6B,cAGT;AACnB,SAAOtD,WAAWC,KAAX,CAAiBsD,gBAAjB,CAAkC,oBAAlC,CAAP;AACA;AAL4B,CAA9B,sH;;;;;;;;;;;ACFA,6BAEA,SAASC,UAAT,GAA6C;AAAA,KAAzBC,WAAyB,uEAAX,EAAW;AAAA,KAAPxC,KAAO;AAC5C,QAAOwC,YAAY7B,IAAZ,CAAiB,UAAC8B,YAAD,EAAkB;AACzC,MAAMC,aAAanD,gBAAgBY,OAAhB,CAAwBsC,YAAxB,CAAnB;AACA,MAAMhC,QAASiC,cAAcA,WAAWjC,KAA1B,IAAoC,EAAlD;AAEA,SAAOA,MAAME,IAAN,CAAW,UAACC,QAAD,EAAc;AAC/B,OAAMV,OAAOnB,WAAWU,MAAX,CAAkBC,KAAlB,CAAwBS,OAAxB,CAAgCS,QAAhC,CAAb;AACA,OAAMR,YAAYF,QAAQA,KAAKF,KAA/B;AACA,OAAMK,QAAQtB,WAAWU,MAAX,CAAkBW,SAAlB,CAAd;AAEA,UAAOC,SAASA,MAAMQ,YAAf,IAA+BR,MAAMQ,YAAN,CAAmBkB,OAAOvB,MAAP,EAAnB,EAAoCI,QAApC,EAA8CZ,KAA9C,CAAtC;AACA,GANM,CAAP;AAOA,EAXM,CAAP;AAYA;;AAED,SAAS2C,GAAT,GAAsC;AAAA,KAAzBH,WAAyB,uEAAX,EAAW;AAAA,KAAPxC,KAAO;AACrC,QAAOwC,YAAYI,KAAZ,CAAkB,UAACH,YAAD,EAAkB;AAC1C,MAAMC,aAAanD,gBAAgBY,OAAhB,CAAwBsC,YAAxB,CAAnB;AACA,MAAMhC,QAASiC,cAAcA,WAAWjC,KAA1B,IAAoC,EAAlD;AAEA,SAAOA,MAAME,IAAN,CAAW,UAACC,QAAD,EAAc;AAC/B,OAAMV,OAAOnB,WAAWU,MAAX,CAAkBC,KAAlB,CAAwBS,OAAxB,CAAgCS,QAAhC,CAAb;AACA,OAAMR,YAAYF,QAAQA,KAAKF,KAA/B;AACA,OAAMK,QAAQtB,WAAWU,MAAX,CAAkBW,SAAlB,CAAd;AAEA,UAAOC,SAASA,MAAMQ,YAAf,IAA+BR,MAAMQ,YAAN,CAAmBkB,OAAOvB,MAAP,EAAnB,EAAoCI,QAApC,EAA8CZ,KAA9C,CAAtC;AACA,GANM,CAAP;AAOA,EAXM,CAAP;AAYA;;AAED,SAAS6C,aAAT,CAAuBL,WAAvB,EAAoCxC,KAApC,EAA2C8C,QAA3C,EAAqD;AACpD,KAAMtC,SAASuB,OAAOvB,MAAP,EAAf;;AACA,KAAI,CAACA,MAAL,EAAa;AACZ,SAAO,KAAP;AACA;;AAED,KAAI,CAACzB,WAAWC,KAAX,CAAiBC,gBAAjB,CAAkC8D,KAAlC,CAAwCC,GAAxC,EAAL,EAAoD;AACnD,SAAO,KAAP;AACA;;AAEDR,eAAc,GAAG9B,MAAH,CAAU8B,WAAV,CAAd;AACA,QAAOM,SAASN,WAAT,EAAsBxC,KAAtB,CAAP;AACA;;AAEDiD,SAASC,cAAT,CAAwB,eAAxB,EAAyC,UAASR,UAAT,EAAqB1C,KAArB,EAA4B;AACpE,QAAO6C,cAAcH,UAAd,EAA0B1C,KAA1B,EAAiCuC,UAAjC,CAAP;AACA,CAFD;;AAIAxD,WAAWC,KAAX,CAAiBsD,gBAAjB,GAAoC,UAASE,WAAT,EAAsBxC,KAAtB,EAA6B;AAChE,QAAO6C,cAAcL,WAAd,EAA2BxC,KAA3B,EAAkC2C,GAAlC,CAAP;AACA,CAFD;;AAIA5D,WAAWC,KAAX,CAAiBmE,uBAAjB,GAA2C,UAASX,WAAT,EAAsBxC,KAAtB,EAA6B;AACvE,QAAO6C,cAAcL,WAAd,EAA2BxC,KAA3B,EAAkCuC,UAAlC,CAAP;AACA,CAFD,uH;;;;;;;;;;;ACtDAxD,WAAWC,KAAX,CAAiBoE,OAAjB,GAA2B,UAAS5C,MAAT,EAAiB6C,SAAjB,EAA4BrD,KAA5B,EAAmC;AAC7DqD,aAAY,GAAG3C,MAAH,CAAU2C,SAAV,CAAZ;AACA,QAAOtE,WAAWU,MAAX,CAAkBC,KAAlB,CAAwBa,aAAxB,CAAsCC,MAAtC,EAA8C6C,SAA9C,EAAyDrD,KAAzD,CAAP;AACA,CAHD,sH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAAsD,WAAWC,KAAX,CAAiB,oBAAjB,EAAuC;AACtCpE,OAAM,mBADgC;AAEtCqE,OAFsC,cAE/B,UAAY;AAClB,SAAOC,YAAYC,MAAZ,CAAmB,MAAnB,EAA2B;AACjCC,WAAQ,eADyB;AAEjCC,cAAWC,EAAE,aAAF,CAFsB;AAGjCC,iBAAc;AAHmB,GAA3B,CAAP;AAKA;AARqC,CAAvC;AAWAR,WAAWC,KAAX,CAAiB,gCAAjB,EAAmD;AAClDpE,OAAM,wBAD4C;AAElDqE,OAFkD,cAE3C,UAAY;AAClB,SAAOC,YAAYC,MAAZ,CAAmB,MAAnB,EAA2B;AACjCC,WAAQ,eADyB;AAEjCC,cAAWC,EAAE,cAAF,CAFsB;AAGjCC,iBAAc;AAHmB,GAA3B,CAAP;AAKA;AARiD,CAAnD;AAWAR,WAAWC,KAAX,CAAiB,wBAAjB,EAA2C;AAC1CpE,OAAM,uBADoC;AAE1CqE,OAF0C,cAEnC,UAAY;AAClB,SAAOC,YAAYC,MAAZ,CAAmB,MAAnB,EAA2B;AACjCC,WAAQ,eADyB;AAEjCC,cAAWC,EAAE,cAAF,CAFsB;AAGjCC,iBAAc;AAHmB,GAA3B,CAAP;AAKA;AARyC,CAA3C,uH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtBA,6BAEAb,SAAST,WAAT,CAAqBuB,OAArB,CAA6B;AAC5B7D,KAD4B,cACrB;AACN,SAAO+C,SAASe,QAAT,GAAoBvD,KAApB,CAA0BuC,GAA1B,EAAP;AACA,EAH2B;AAK5BN,WAL4B,cAKf;AACZ,SAAOnD,gBAAgB6B,IAAhB,CAAqB,EAArB,EAAyB;AAC/B6C,SAAM;AACL/C,SAAK;AADA;AADyB,GAAzB,CAAP;AAKA,EAX2B;AAa5BgD,QAb4B,YAapBzD,KAboB,EAab;AACd,MAAIA,KAAJ,EAAW;AACV,OAAIA,MAAM0D,OAAN,CAAc,KAAKjD,GAAnB,MAA4B,CAAC,CAAjC,EAAoC;AACnC,WAAO,SAAP;AACA;AACD;AACD,EAnB2B;AAqB5B2B,cArB4B,cAqBZ;AACf,SAAO9D,WAAWC,KAAX,CAAiBsD,gBAAjB,CAAkC,oBAAlC,CAAP;AACA;AAvB2B,CAA7B;AA0BAW,SAAST,WAAT,CAAqB4B,MAArB,CAA4B;AAC3B,yBAD2B,YACFC,CADE,EACCL,QADD,EACW;AACrC,MAAMtB,aAAa2B,EAAEC,aAAF,CAAgBC,YAAhB,CAA6B,iBAA7B,CAAnB;AACA,MAAMrE,OAAOmE,EAAEC,aAAF,CAAgBC,YAAhB,CAA6B,WAA7B,CAAb;;AAEA,MAAIP,SAASQ,gBAAT,CAA0B9B,UAA1B,EAAsCyB,OAAtC,CAA8CjE,IAA9C,MAAwD,CAAC,CAA7D,EAAgE;AAC/D,UAAO6B,OAAO0C,IAAP,CAAY,mCAAZ,EAAiD/B,UAAjD,EAA6DxC,IAA7D,CAAP;AACA,GAFD,MAEO;AACN,UAAO6B,OAAO0C,IAAP,CAAY,wCAAZ,EAAsD/B,UAAtD,EAAkExC,IAAlE,CAAP;AACA;AACD;AAV0B,CAA5B;AAaA+C,SAAST,WAAT,CAAqBkC,SAArB,CAA+B,YAAW;AAAA;;AACzC,MAAKjE,KAAL,GAAa,IAAIkE,WAAJ,CAAgB,EAAhB,CAAb;AACA,MAAKH,gBAAL,GAAwB,EAAxB;AACA,MAAKI,OAAL,GAAe;AACdC,SAAO,EADO;AAEdC,WAAS;AAFK,EAAf;AAKAC,SAAQC,OAAR,CAAgB,YAAM;AACrB,QAAKvE,KAAL,CAAWwE,GAAX,CAAelG,WAAWU,MAAX,CAAkBC,KAAlB,CAAwB0B,IAAxB,GAA+BK,KAA/B,EAAf;AACA,EAFD;AAIAsD,SAAQC,OAAR,CAAgB,YAAM;AACrBzF,kBAAgB6B,IAAhB,GAAuB8D,cAAvB,CAAsC;AACrCL,UAAO,UAACM,EAAD,EAAKC,MAAL,EAAgB;AACtB,UAAKZ,gBAAL,CAAsBW,EAAtB,IAA4BC,OAAO3E,KAAnC;AACA,IAHoC;AAIrC4E,YAAS,UAACF,EAAD,EAAKC,MAAL,EAAgB;AACxB,UAAKZ,gBAAL,CAAsBW,EAAtB,IAA4BC,OAAO3E,KAAnC;AACA,IANoC;AAOrCqE,YAAS,UAACK,EAAD,EAAQ;AAChB,WAAO,MAAKX,gBAAL,CAAsBW,EAAtB,CAAP;AACA;AAToC,GAAtC;AAWA,EAZD;AAaA,CAzBD,uH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzCA,IAAIG,eAAJ;AAAWC,OAAOC,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAAA,sBAASC,CAAT,EAAW;AAACJ,WAAOI,CAAP;AAAS;AAArB,CAA/B,EAAsD,CAAtD;AAEXzC,SAAS0C,eAAT,CAAyB5B,OAAzB,CAAiC;AAChC7D,KADgC,cACzB;AACN,SAAOnB,WAAWU,MAAX,CAAkBC,KAAlB,CAAwBS,OAAxB,CAAgC;AACtCe,QAAKoC,WAAWsC,QAAX,CAAoB,MAApB;AADiC,GAAhC,KAED,EAFN;AAGA,EAL+B;AAOhCC,WAPgC,cAOnB;AACZ,SAAO5C,SAASe,QAAT,GAAoB8B,WAApB,CAAgC9C,GAAhC,EAAP;AACA,EAT+B;AAWhC+C,QAXgC,cAWtB;AACT,SAAOzC,WAAWsC,QAAX,CAAoB,MAApB,KAA+B,IAAtC;AACA,EAb+B;AAehCI,aAfgC,cAejB;AACd,MAAI,KAAKC,MAAL,IAAe,KAAKA,MAAL,CAAYC,MAAZ,GAAqB,CAAxC,EAA2C;AAC1C,UAAO,KAAKD,MAAL,CAAY,CAAZ,EAAeE,OAAtB;AACA;AACD,EAnB+B;AAqBhCtD,cArBgC,cAqBhB;AACf,SAAO9D,WAAWC,KAAX,CAAiBsD,gBAAjB,CAAkC,oBAAlC,CAAP;AACA,EAvB+B;AAAA,0BAyBpB;AACX,SAAO,KAAK8D,SAAZ;AACA,EA3B+B;AA6BhCC,SA7BgC,cA6BrB;AACV,SAAO,KAAKnF,GAAL,IAAY,CAAC,KAAKkF,SAAzB;AACA,EA/B+B;AAiChCE,SAjCgC,cAiCrB;AACV,SAAOrD,SAASe,QAAT,GAAoB8B,WAApB,CAAgC9C,GAAhC,MAAyCC,SAASe,QAAT,GAAoB8B,WAApB,CAAgC9C,GAAhC,GAAsCuD,KAAtC,KAAgD,CAAhG;AACA,EAnC+B;AAqChCC,QArCgC,cAqCtB;AACT,MAAMxC,WAAWf,SAASe,QAAT,EAAjB;AACA,SAAOA,SAASyC,KAAT,IAAkBzC,SAASyC,KAAT,CAAezD,GAAf,MAAwBgB,SAAS8B,WAAT,CAAqB9C,GAArB,GAA2BuD,KAA3B,EAAjD;AACA,EAxC+B;AA0ChCG,UA1CgC,cA0CpB;AACX,MAAM1C,WAAWf,SAASe,QAAT,EAAjB;;AACA,MAAI,CAACA,SAASjB,KAAV,IAAmB,CAACiB,SAASjB,KAAT,CAAeC,GAAf,EAAxB,EAA8C;AAC7C,UAAO,aAAP;AACA;AACD,EA/C+B;AAiDhC2D,WAjDgC,cAiDnB;AACZ,SAAO1D,SAASe,QAAT,GAAoB2C,UAApB,CAA+B3D,GAA/B,EAAP;AACA,EAnD+B;AAqDhC4D,4BArDgC,cAqDF;AAC7B,SAAO;AACNH,UAAO,EADD;AAENI,UAAO,CACN;AACCrH,gBAAY,mBADb;AAECqC,kBAAc,+BAFf;AAGCiF,WAAO,MAHR;AAICC,cAAU9D,SAAS+D,UAJpB;AAKCC,qBAAiBhE,SAASiE,eAL3B;AAMCC,cAAU,IANX;AAOClD,UAAM,MAPP;AAQCmD,YARD,YAQUC,KARV,EAQiB;AACf,YAAO;AACNlI,YAAMkI;AADA,MAAP;AAGA;AAZF,IADM;AAFD,GAAP;AAmBA,EAzE+B;AA2EhCC,6BA3EgC,cA2ED;AAC9B,MAAMtD,WAAWf,SAASe,QAAT,EAAjB;AACA,SAAO;AACNyC,UAAO,EADD;AAENI,UAAO,CACN;AACCrH,gBAAY,gBADb;AAECqC,kBAAc,kBAFf;AAGCiF,WAAO,UAHR;AAICC,cAAU9D,SAASsE,UAJpB;AAKCN,qBAAiBhE,SAASuE,eAL3B;AAMCL,cAAU,IANX;AAOCM,YAAQ;AACPC,iBAAY1D,SAAS8B,WAAT,CAAqB9C,GAArB,MAA8BgB,SAAS8B,WAAT,CAAqB9C,GAArB,GAA2BvB,KAA3B;AADnC,KAPT;AAUC2F,YAVD,YAUUC,KAVV,EAUiB;AACf,YAAO;AACNM,YAAMN;AADA,MAAP;AAGA,KAdF;AAeCpD,UAAM;AAfP,IADM;AAFD,GAAP;AAsBA;AAnG+B,CAAjC;AAsGAhB,SAAS0C,eAAT,CAAyBvB,MAAzB,CAAgC;AAC/B,qBAD+B,YACVC,CADU,EACPL,QADO,EACG;AAAA;;AACjCK,IAAEuD,cAAF;AACAC,OAAK;AACJC,UAAOjE,EAAE,cAAF,CADH;AAEJkE,SAAM,SAFF;AAGJC,qBAAkB,IAHd;AAIJC,uBAAoB,SAJhB;AAKJC,sBAAmBrE,EAAE,KAAF,CALf;AAMJsE,qBAAkBtE,EAAE,QAAF,CANd;AAOJuE,mBAAgB,KAPZ;AAQJC,SAAM;AARF,GAAL,EASG,YAAM;AACRtG,UAAO0C,IAAP,CAAY,kCAAZ,EAAgDnB,WAAWsC,QAAX,CAAoB,MAApB,CAAhD,EAA6E,MAAK0C,QAAlF,EAA4FtE,SAAS2C,UAAT,CAAoB3D,GAApB,EAA5F,EAAuH,UAASuF,KAAT,CAAc,YAAd,EAA4B;AAClJ,QAAIA,KAAJ,EAAW;AACV,YAAOC,YAAYD,KAAZ,CAAP;AACA;;AAEDV,SAAK;AACJC,YAAOjE,EAAE,SAAF,CADH;AAEJ4E,WAAM5E,EAAE,cAAF,CAFF;AAGJkE,WAAM,SAHF;AAIJW,YAAO,IAJH;AAKJC,wBAAmB;AALf,KAAL;AAOA,IAZD;AAaA,GAvBD;AAwBA,EA3B8B;AA6B/B,oBA7B+B,YA6BXtE,CA7BW,CA6BV,cA7BU,EA6BM;AAAA;;AACpCA,IAAEuD,cAAF;AACA,MAAMgB,cAAcvE,EAAEC,aAAF,CAAgBuE,QAAhB,CAAyB,MAAzB,EAAiCC,KAArD;AACAzE,IAAEC,aAAF,CAAgBuE,QAAhB,CAAyB,MAAzB,EAAiCC,KAAjC,GAAyCjF,EAAE,QAAF,CAAzC;AACA,MAAMkF,WAAW;AAChBC,gBAAa3E,EAAEC,aAAF,CAAgBuE,QAAhB,CAAyB,aAAzB,EAAwCC,KADrC;AAEhB9I,UAAOqE,EAAEC,aAAF,CAAgBuE,QAAhB,CAAyB,OAAzB,EAAkCC;AAFzB,GAAjB;;AAKA,MAAI,KAAK5H,GAAT,EAAc;AACb6H,YAAS5J,IAAT,GAAgB,KAAK+B,GAArB;AACA,GAFD,MAEO;AACN6H,YAAS5J,IAAT,GAAgBkF,EAAEC,aAAF,CAAgBuE,QAAhB,CAAyB,MAAzB,EAAiCC,KAAjD;AACA;;AAED/G,SAAO0C,IAAP,CAAY,wBAAZ,EAAsCsE,QAAtC,EAAgD,UAACR,KAAD,CAAM,YAAN,EAAuB;AACtElE,KAAEC,aAAF,CAAgBuE,QAAhB,CAAyB,MAAzB,EAAiCC,KAAjC,GAAyCF,WAAzC;;AACA,OAAIL,KAAJ,EAAW;AACV,WAAOC,YAAYD,KAAZ,CAAP;AACA;;AAEDjD,UAAO2D,OAAP,CAAepF,EAAE,OAAF,CAAf;;AAEA,OAAI,CAAC,OAAK3C,GAAV,EAAe;AACd,WAAOoC,WAAW4F,EAAX,CAAc,wBAAd,EAAwC;AAC9C/J,WAAM4J,SAAS5J;AAD+B,KAAxC,CAAP;AAGA;AACD,GAbD;AAcA,EA1D8B;AA4D/B,qBA5D+B,YA4DVkF,CA5DU,EA4DPL,QA5DO,EA4DG;AACjCK,IAAEuD,cAAF;;AACA,MAAIvD,EAAEC,aAAF,CAAgBuE,QAAhB,CAAyB,UAAzB,EAAqCC,KAArC,CAA2CK,IAA3C,OAAsD,EAA1D,EAA8D;AAC7D,UAAO7D,OAAOiD,KAAP,CAAa1E,EAAE,wBAAF,CAAb,CAAP;AACA;;AACD,MAAM+E,cAAcvE,EAAEC,aAAF,CAAgBuE,QAAhB,CAAyB,KAAzB,EAAgCC,KAApD;AACAzE,IAAEC,aAAF,CAAgBuE,QAAhB,CAAyB,KAAzB,EAAgCC,KAAhC,GAAwCjF,EAAE,QAAF,CAAxC;AAEA9B,SAAO0C,IAAP,CAAY,6BAAZ,EAA2CnB,WAAWsC,QAAX,CAAoB,MAApB,CAA3C,EAAwEvB,EAAEC,aAAF,CAAgBuE,QAAhB,CAAyB,UAAzB,EAAqCC,KAA7G,EAAoH9E,SAAS2C,UAAT,CAAoB3D,GAApB,EAApH,EAA+I,UAACuF,KAAD,CAAM,YAAN,EAAuB;AACrKlE,KAAEC,aAAF,CAAgBuE,QAAhB,CAAyB,KAAzB,EAAgCC,KAAhC,GAAwCF,WAAxC;;AACA,OAAIL,KAAJ,EAAW;AACV,WAAOC,YAAYD,KAAZ,CAAP;AACA;;AACDvE,YAAShC,SAAT,CAAmB,aAAnB,EAAkCsB,WAAWsC,QAAX,CAAoB,MAApB,CAAlC,EAA+D5B,SAAS2C,UAAT,CAAoB3D,GAApB,EAA/D;AACAsC,UAAO2D,OAAP,CAAepF,EAAE,YAAF,CAAf;AACAQ,KAAEC,aAAF,CAAgB8E,KAAhB;AACA,GARD;AASA,EA7E8B;AA+E/B,2BA/E+B,YA+EJ/E,CA/EI,EA+ED;AAC7B,SAAOA,EAAEuD,cAAF,EAAP;AACA,EAjF8B;AAmF/B,qBAnF+B,YAmFVvD,CAnFU,CAmFT,cAnFS,EAmFO;AACrCA,IAAEuD,cAAF;;AACA,MAAI,KAAKxB,SAAT,EAAoB;AACnB,UAAOd,OAAOiD,KAAP,CAAa1E,EAAE,6BAAF,CAAb,CAAP;AACA;;AAED9B,SAAO0C,IAAP,CAAY,0BAAZ,EAAwC,KAAKvD,GAA7C,EAAkD,UAASqH,KAAT,CAAc,YAAd,EAA4B;AAC7E,OAAIA,KAAJ,EAAW;AACV,WAAOC,YAAYD,KAAZ,CAAP;AACA;;AACDjD,UAAO2D,OAAP,CAAepF,EAAE,cAAF,CAAf;AACAP,cAAW4F,EAAX,CAAc,mBAAd;AACA,GAND;AAOA,EAhG8B;AAkG/B,mBAlG+B,YAkGZ7E,CAlGY,EAkGTR,CAlGS,EAkGN;AACxBQ,IAAEuD,cAAF;AACAvD,IAAEgF,eAAF;AACAxF,IAAE4C,KAAF,CAAQxB,GAAR,CAAYpB,EAAE4C,KAAF,CAAQzD,GAAR,KAAgB,EAA5B;AACA,EAtG8B;AAwG/B,sCAxG+B,YAwGOsG,KAxGP,EAwGcvC,QAxGd,EAwGwBwC,GAxGxB,EAwG6B;AAC3DxC,WAASJ,UAAT,CAAoB1B,GAApB,CAAwBsE,IAAIrI,GAA5B;AACA;AA1G8B,CAAhC;AA6GA+B,SAAS0C,eAAT,CAAyBjB,SAAzB,CAAmC,YAAW;AAAA;;AAC7C,MAAKiC,UAAL,GAAkB,IAAIhC,WAAJ,EAAlB;AACA,MAAK6E,cAAL,GAAsB,IAAI7E,WAAJ,EAAtB;AACA,MAAKmB,WAAL,GAAmB,IAAInB,WAAJ,EAAnB;AACA,MAAK8B,KAAL,GAAa,IAAI9B,WAAJ,CAAgB,EAAhB,CAAb;AACA,MAAK5B,KAAL,GAAa,IAAI4B,WAAJ,CAAgB,IAAhB,CAAb;AACA,MAAK3C,SAAL,CAAe,OAAf,EAAwBsB,WAAWsC,QAAX,CAAoB,MAApB,CAAxB;AAEA,MAAKZ,OAAL,CAAa,YAAM;AAClB,MAAI,OAAK2B,UAAL,CAAgB3D,GAAhB,EAAJ,EAA2B;AAC1B,UAAKhB,SAAL,CAAe,yBAAf,EAA0C,OAAK2E,UAAL,CAAgB3D,GAAhB,EAA1C,EAAiEM,WAAWsC,QAAX,CAAoB,MAApB,CAAjE;AACA;;AAED,MAAMa,QAAQ,OAAKA,KAAL,CAAWzD,GAAX,EAAd;;AAEA,MAAMnB,eAAe,OAAKG,SAAL,CAAe,aAAf,EAA8BsB,WAAWsC,QAAX,CAAoB,MAApB,CAA9B,EAA2D,OAAKe,UAAL,CAAgB3D,GAAhB,EAA3D,EAAkFyD,KAAlF,CAArB;;AACA,SAAK1D,KAAL,CAAWkC,GAAX,CAAepD,aAAakB,KAAb,EAAf;;AAEA,SAAK+C,WAAL,CAAiBb,GAAjB,CAAqBlG,WAAWU,MAAX,CAAkBC,KAAlB,CAAwBK,eAAxB,CAAwCuD,WAAWsC,QAAX,CAAoB,MAApB,CAAxC,EAAqE,OAAKe,UAAL,CAAgB3D,GAAhB,EAArE,EAA4F;AAChHiB,SAAM;AACLqE,cAAU;AADL;AAD0G,GAA5F,CAArB;AAKA,EAfD;AAgBA,CAxBD,wH","file":"/packages/rocketchat_authorization.js","sourcesContent":["RocketChat.authz = {};\n","RocketChat.authz.cachedCollection = new RocketChat.CachedCollection({\n\tname: 'permissions',\n\teventType: 'onLogged',\n\tuserRelated: false\n});\nRocketChat.authz.cachedCollection.init();\n\nthis.ChatPermissions = RocketChat.authz.cachedCollection.collection;\n","RocketChat.models.Roles = new Mongo.Collection('rocketchat_roles');\n\nObject.assign(RocketChat.models.Roles, {\n\tfindUsersInRole(name, scope, options) {\n\t\tconst role = this.findOne(name);\n\t\tconst roleScope = (role && role.scope) || 'Users';\n\t\tconst model = RocketChat.models[roleScope];\n\t\treturn model && model.findUsersInRoles && model.findUsersInRoles(name, scope, options);\n\t},\n\n\tisUserInRoles(userId, roles, scope) {\n\t\troles = [].concat(roles);\n\t\treturn roles.some((roleName) => {\n\t\t\tconst role = this.findOne(roleName);\n\t\t\tconst roleScope = (role && role.scope) || 'Users';\n\t\t\tconst model = RocketChat.models[roleScope];\n\t\t\treturn model && model.isUserInRole && model.isUserInRole(userId, roleName, scope);\n\t\t});\n\t}\n});\n","if (_.isUndefined(RocketChat.models.Users)) {\n\tRocketChat.models.Users = {};\n}\n\nObject.assign(RocketChat.models.Users, {\n\tisUserInRole(userId, roleName) {\n\t\tconst query = {\n\t\t\t_id: userId,\n\t\t\troles: roleName\n\t\t};\n\n\t\treturn !_.isUndefined(this.findOne(query));\n\t},\n\n\tfindUsersInRoles(roles, scope, options) {\n\t\troles = [].concat(roles);\n\n\t\tconst query = {\n\t\t\troles: { $in: roles }\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n});\n","if (_.isUndefined(RocketChat.models.Subscriptions)) {\n\tRocketChat.models.Subscriptions = {};\n}\n\nObject.assign(RocketChat.models.Subscriptions, {\n\tisUserInRole(userId, roleName, roomId) {\n\t\tif (roomId == null) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\troles: roleName\n\t\t};\n\n\t\treturn !_.isUndefined(this.findOne(query));\n\t},\n\n\tfindUsersInRoles(roles, scope, options) {\n\t\troles = [].concat(roles);\n\n\t\tconst query = {\n\t\t\troles: { $in: roles }\n\t\t};\n\n\t\tif (scope) {\n\t\t\tquery.rid = scope;\n\t\t}\n\n\t\tconst subscriptions = this.find(query).fetch();\n\n\t\tconst users = _.compact(_.map(subscriptions, function(subscription) {\n\t\t\tif ('undefined' !== typeof subscription.u && 'undefined' !== typeof subscription.u._id) {\n\t\t\t\treturn subscription.u._id;\n\t\t\t}\n\t\t}));\n\n\t\treturn RocketChat.models.Users.find({ _id: { $in: users } }, options);\n\t}\n});\n","Meteor.subscribe('roles');\n\nRocketChat.AdminBox.addOption({\n\thref: 'admin-permissions',\n\ti18nLabel: 'Permissions',\n\tpermissionGranted() {\n\t\treturn RocketChat.authz.hasAllPermission('access-permissions');\n\t}\n});\n","/* globals ChatPermissions */\n\nfunction atLeastOne(permissions = [], scope) {\n\treturn permissions.some((permissionId) => {\n\t\tconst permission = ChatPermissions.findOne(permissionId);\n\t\tconst roles = (permission && permission.roles) || [];\n\n\t\treturn roles.some((roleName) => {\n\t\t\tconst role = RocketChat.models.Roles.findOne(roleName);\n\t\t\tconst roleScope = role && role.scope;\n\t\t\tconst model = RocketChat.models[roleScope];\n\n\t\t\treturn model && model.isUserInRole && model.isUserInRole(Meteor.userId(), roleName, scope);\n\t\t});\n\t});\n}\n\nfunction all(permissions = [], scope) {\n\treturn permissions.every((permissionId) => {\n\t\tconst permission = ChatPermissions.findOne(permissionId);\n\t\tconst roles = (permission && permission.roles) || [];\n\n\t\treturn roles.some((roleName) => {\n\t\t\tconst role = RocketChat.models.Roles.findOne(roleName);\n\t\t\tconst roleScope = role && role.scope;\n\t\t\tconst model = RocketChat.models[roleScope];\n\n\t\t\treturn model && model.isUserInRole && model.isUserInRole(Meteor.userId(), roleName, scope);\n\t\t});\n\t});\n}\n\nfunction hasPermission(permissions, scope, strategy) {\n\tconst userId = Meteor.userId();\n\tif (!userId) {\n\t\treturn false;\n\t}\n\n\tif (!RocketChat.authz.cachedCollection.ready.get()) {\n\t\treturn false;\n\t}\n\n\tpermissions = [].concat(permissions);\n\treturn strategy(permissions, scope);\n}\n\nTemplate.registerHelper('hasPermission', function(permission, scope) {\n\treturn hasPermission(permission, scope, atLeastOne);\n});\n\nRocketChat.authz.hasAllPermission = function(permissions, scope) {\n\treturn hasPermission(permissions, scope, all);\n};\n\nRocketChat.authz.hasAtLeastOnePermission = function(permissions, scope) {\n\treturn hasPermission(permissions, scope, atLeastOne);\n};\n\n","RocketChat.authz.hasRole = function(userId, roleNames, scope) {\n\troleNames = [].concat(roleNames);\n\treturn RocketChat.models.Roles.isUserInRoles(userId, roleNames, scope);\n};\n","FlowRouter.route('/admin/permissions', {\n\tname: 'admin-permissions',\n\taction(/*params*/) {\n\t\treturn BlazeLayout.render('main', {\n\t\t\tcenter: 'pageContainer',\n\t\t\tpageTitle: t('Permissions'),\n\t\t\tpageTemplate: 'permissions'\n\t\t});\n\t}\n});\n\nFlowRouter.route('/admin/permissions/:name?/edit', {\n\tname: 'admin-permissions-edit',\n\taction(/*params*/) {\n\t\treturn BlazeLayout.render('main', {\n\t\t\tcenter: 'pageContainer',\n\t\t\tpageTitle: t('Role_Editing'),\n\t\t\tpageTemplate: 'permissionsRole'\n\t\t});\n\t}\n});\n\nFlowRouter.route('/admin/permissions/new', {\n\tname: 'admin-permissions-new',\n\taction(/*params*/) {\n\t\treturn BlazeLayout.render('main', {\n\t\t\tcenter: 'pageContainer',\n\t\t\tpageTitle: t('Role_Editing'),\n\t\t\tpageTemplate: 'permissionsRole'\n\t\t});\n\t}\n});\n","/* globals ChatPermissions */\n\nTemplate.permissions.helpers({\n\trole() {\n\t\treturn Template.instance().roles.get();\n\t},\n\n\tpermission() {\n\t\treturn ChatPermissions.find({}, {\n\t\t\tsort: {\n\t\t\t\t_id: 1\n\t\t\t}\n\t\t});\n\t},\n\n\tgranted(roles) {\n\t\tif (roles) {\n\t\t\tif (roles.indexOf(this._id) !== -1) {\n\t\t\t\treturn 'checked';\n\t\t\t}\n\t\t}\n\t},\n\n\thasPermission() {\n\t\treturn RocketChat.authz.hasAllPermission('access-permissions');\n\t}\n});\n\nTemplate.permissions.events({\n\t'click .role-permission'(e, instance) {\n\t\tconst permission = e.currentTarget.getAttribute('data-permission');\n\t\tconst role = e.currentTarget.getAttribute('data-role');\n\n\t\tif (instance.permissionByRole[permission].indexOf(role) === -1) {\n\t\t\treturn Meteor.call('authorization:addPermissionToRole', permission, role);\n\t\t} else {\n\t\t\treturn Meteor.call('authorization:removeRoleFromPermission', permission, role);\n\t\t}\n\t}\n});\n\nTemplate.permissions.onCreated(function() {\n\tthis.roles = new ReactiveVar([]);\n\tthis.permissionByRole = {};\n\tthis.actions = {\n\t\tadded: {},\n\t\tremoved: {}\n\t};\n\n\tTracker.autorun(() => {\n\t\tthis.roles.set(RocketChat.models.Roles.find().fetch());\n\t});\n\n\tTracker.autorun(() => {\n\t\tChatPermissions.find().observeChanges({\n\t\t\tadded: (id, fields) => {\n\t\t\t\tthis.permissionByRole[id] = fields.roles;\n\t\t\t},\n\t\t\tchanged: (id, fields) => {\n\t\t\t\tthis.permissionByRole[id] = fields.roles;\n\t\t\t},\n\t\t\tremoved: (id) => {\n\t\t\t\tdelete this.permissionByRole[id];\n\t\t\t}\n\t\t});\n\t});\n});\n","import toastr from 'toastr';\n\nTemplate.permissionsRole.helpers({\n\trole() {\n\t\treturn RocketChat.models.Roles.findOne({\n\t\t\t_id: FlowRouter.getParam('name')\n\t\t}) || {};\n\t},\n\n\tuserInRole() {\n\t\treturn Template.instance().usersInRole.get();\n\t},\n\n\tediting() {\n\t\treturn FlowRouter.getParam('name') != null;\n\t},\n\n\temailAddress() {\n\t\tif (this.emails && this.emails.length > 0) {\n\t\t\treturn this.emails[0].address;\n\t\t}\n\t},\n\n\thasPermission() {\n\t\treturn RocketChat.authz.hasAllPermission('access-permissions');\n\t},\n\n\tprotected() {\n\t\treturn this.protected;\n\t},\n\n\teditable() {\n\t\treturn this._id && !this.protected;\n\t},\n\n\thasUsers() {\n\t\treturn Template.instance().usersInRole.get() && Template.instance().usersInRole.get().count() > 0;\n\t},\n\n\thasMore() {\n\t\tconst instance = Template.instance();\n\t\treturn instance.limit && instance.limit.get() <= instance.usersInRole.get().count();\n\t},\n\n\tisLoading() {\n\t\tconst instance = Template.instance();\n\t\tif (!instance.ready || !instance.ready.get()) {\n\t\t\treturn 'btn-loading';\n\t\t}\n\t},\n\n\tsearchRoom() {\n\t\treturn Template.instance().searchRoom.get();\n\t},\n\n\tautocompleteChannelSettings() {\n\t\treturn {\n\t\t\tlimit: 10,\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\tcollection: 'CachedChannelList',\n\t\t\t\t\tsubscription: 'channelAndPrivateAutocomplete',\n\t\t\t\t\tfield: 'name',\n\t\t\t\t\ttemplate: Template.roomSearch,\n\t\t\t\t\tnoMatchTemplate: Template.roomSearchEmpty,\n\t\t\t\t\tmatchAll: true,\n\t\t\t\t\tsort: 'name',\n\t\t\t\t\tselector(match) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tname: match\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t},\n\n\tautocompleteUsernameSettings() {\n\t\tconst instance = Template.instance();\n\t\treturn {\n\t\t\tlimit: 10,\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\tcollection: 'CachedUserList',\n\t\t\t\t\tsubscription: 'userAutocomplete',\n\t\t\t\t\tfield: 'username',\n\t\t\t\t\ttemplate: Template.userSearch,\n\t\t\t\t\tnoMatchTemplate: Template.userSearchEmpty,\n\t\t\t\t\tmatchAll: true,\n\t\t\t\t\tfilter: {\n\t\t\t\t\t\texceptions: instance.usersInRole.get() && instance.usersInRole.get().fetch()\n\t\t\t\t\t},\n\t\t\t\t\tselector(match) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tterm: match\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t\tsort: 'username'\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n});\n\nTemplate.permissionsRole.events({\n\t'click .remove-user'(e, instance) {\n\t\te.preventDefault();\n\t\tswal({\n\t\t\ttitle: t('Are_you_sure'),\n\t\t\ttype: 'warning',\n\t\t\tshowCancelButton: true,\n\t\t\tconfirmButtonColor: '#DD6B55',\n\t\t\tconfirmButtonText: t('Yes'),\n\t\t\tcancelButtonText: t('Cancel'),\n\t\t\tcloseOnConfirm: false,\n\t\t\thtml: false\n\t\t}, () => {\n\t\t\tMeteor.call('authorization:removeUserFromRole', FlowRouter.getParam('name'), this.username, instance.searchRoom.get(), function(error/*, result*/) {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn handleError(error);\n\t\t\t\t}\n\n\t\t\t\tswal({\n\t\t\t\t\ttitle: t('Removed'),\n\t\t\t\t\ttext: t('User_removed'),\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttimer: 1000,\n\t\t\t\t\tshowConfirmButton: false\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t},\n\n\t'submit #form-role'(e/*, instance*/) {\n\t\te.preventDefault();\n\t\tconst oldBtnValue = e.currentTarget.elements['save'].value;\n\t\te.currentTarget.elements['save'].value = t('Saving');\n\t\tconst roleData = {\n\t\t\tdescription: e.currentTarget.elements['description'].value,\n\t\t\tscope: e.currentTarget.elements['scope'].value\n\t\t};\n\n\t\tif (this._id) {\n\t\t\troleData.name = this._id;\n\t\t} else {\n\t\t\troleData.name = e.currentTarget.elements['name'].value;\n\t\t}\n\n\t\tMeteor.call('authorization:saveRole', roleData, (error/*, result*/) => {\n\t\t\te.currentTarget.elements['save'].value = oldBtnValue;\n\t\t\tif (error) {\n\t\t\t\treturn handleError(error);\n\t\t\t}\n\n\t\t\ttoastr.success(t('Saved'));\n\n\t\t\tif (!this._id) {\n\t\t\t\treturn FlowRouter.go('admin-permissions-edit', {\n\t\t\t\t\tname: roleData.name\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\t'submit #form-users'(e, instance) {\n\t\te.preventDefault();\n\t\tif (e.currentTarget.elements['username'].value.trim() === '') {\n\t\t\treturn toastr.error(t('Please_fill_a_username'));\n\t\t}\n\t\tconst oldBtnValue = e.currentTarget.elements['add'].value;\n\t\te.currentTarget.elements['add'].value = t('Saving');\n\n\t\tMeteor.call('authorization:addUserToRole', FlowRouter.getParam('name'), e.currentTarget.elements['username'].value, instance.searchRoom.get(), (error/*, result*/) => {\n\t\t\te.currentTarget.elements['add'].value = oldBtnValue;\n\t\t\tif (error) {\n\t\t\t\treturn handleError(error);\n\t\t\t}\n\t\t\tinstance.subscribe('usersInRole', FlowRouter.getParam('name'), instance.searchRoom.get());\n\t\t\ttoastr.success(t('User_added'));\n\t\t\te.currentTarget.reset();\n\t\t});\n\t},\n\n\t'submit #form-search-room'(e) {\n\t\treturn e.preventDefault();\n\t},\n\n\t'click .delete-role'(e/*, instance*/) {\n\t\te.preventDefault();\n\t\tif (this.protected) {\n\t\t\treturn toastr.error(t('error-delete-protected-role'));\n\t\t}\n\n\t\tMeteor.call('authorization:deleteRole', this._id, function(error/*, result*/) {\n\t\t\tif (error) {\n\t\t\t\treturn handleError(error);\n\t\t\t}\n\t\t\ttoastr.success(t('Role_removed'));\n\t\t\tFlowRouter.go('admin-permissions');\n\t\t});\n\t},\n\n\t'click .load-more'(e, t) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tt.limit.set(t.limit.get() + 50);\n\t},\n\n\t'autocompleteselect input[name=room]'(event, template, doc) {\n\t\ttemplate.searchRoom.set(doc._id);\n\t}\n});\n\nTemplate.permissionsRole.onCreated(function() {\n\tthis.searchRoom = new ReactiveVar;\n\tthis.searchUsername = new ReactiveVar;\n\tthis.usersInRole = new ReactiveVar;\n\tthis.limit = new ReactiveVar(50);\n\tthis.ready = new ReactiveVar(true);\n\tthis.subscribe('roles', FlowRouter.getParam('name'));\n\n\tthis.autorun(() => {\n\t\tif (this.searchRoom.get()) {\n\t\t\tthis.subscribe('roomSubscriptionsByRole', this.searchRoom.get(), FlowRouter.getParam('name'));\n\t\t}\n\n\t\tconst limit = this.limit.get();\n\n\t\tconst subscription = this.subscribe('usersInRole', FlowRouter.getParam('name'), this.searchRoom.get(), limit);\n\t\tthis.ready.set(subscription.ready());\n\n\t\tthis.usersInRole.set(RocketChat.models.Roles.findUsersInRole(FlowRouter.getParam('name'), this.searchRoom.get(), {\n\t\t\tsort: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}));\n\t});\n});\n"]}