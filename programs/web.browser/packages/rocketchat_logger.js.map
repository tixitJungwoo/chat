{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:logger/ansispan.js","meteor://ðŸ’»app/packages/rocketchat:logger/logger.js","meteor://ðŸ’»app/packages/rocketchat:logger/client/viewLogs.js","meteor://ðŸ’»app/packages/rocketchat:logger/client/views/viewLogs.js"],"names":["ansispan","str","replace","Object","keys","foregroundColors","forEach","ansi","span","RegExp","Template","Package","templating","log","logMatch","enableLogs","wrapHelpersAndEvents","original","prefix","color","dict","template","fn1","name","fn","Function","result","apply","arguments","completeName","viewName","test","console","args","scope","_","each","call","prototype","helpers","events","wrapLifeCycle","wrap","onCreated","onRendered","onDestroyed","stdout","Mongo","Collection","Meteor","startup","RocketChat","AdminBox","addOption","href","i18nLabel","permissionGranted","authz","hasAllPermission","FlowRouter","route","action","BlazeLayout","render","center","pageTitle","t","pageTemplate","noScroll","moment","module","watch","require","v","viewLogs","subscribe","atBottom","hasPermission","logs","find","sort","ts","string","formatTS","date","format","instance","sendToBottomIfNecessary","wrapper","wrapperUl","newLogs","isAtBottom","scrollThreshold","scrollTop","scrollHeight","clientHeight","className","sendToBottom","checkIfScrollIsAtBottom","readMessage","enable","read","sendToBottomIfNecessaryDebounced","debounce","window","MutationObserver","addEventListener","observer","mutations","observe","childList","onWindowResize","defer","setTimeout"],"mappings":"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","file":"/packages/rocketchat_logger.js","sourcesContent":["/* globals ansispan:true */\n\nansispan = function(str) {\n\tstr = str.replace(/>/g, '&gt;');\n\tstr = str.replace(/</g, '&lt;');\n\n\tObject.keys(ansispan.foregroundColors).forEach(function(ansi) {\n\t\tconst span = `<span style=\"color: ${ ansispan.foregroundColors[ansi] }\">`;\n\n\t\t//\n\t\t// `\\033[Xm` == `\\033[0;Xm` sets foreground color to `X`.\n\t\t//\n\n\t\tstr = str.replace(\n\t\t\tnew RegExp(`\\0o33\\\\[${ ansi }m`, 'g'),\n\t\t\tspan\n\t\t).replace(\n\t\t\tnew RegExp(`\\0o33\\\\[0;${ ansi }m`, 'g'),\n\t\t\tspan\n\t\t);\n\t});\n\t//\n\t// `\\033[1m` enables bold font, `\\033[22m` disables it\n\t//\n\tstr = str.replace(/\\033\\[1m/g, '<b>').replace(/\\033\\[22m/g, '</b>');\n\n\t//\n\t// `\\033[3m` enables italics font, `\\033[23m` disables it\n\t//\n\tstr = str.replace(/\\033\\[3m/g, '<i>').replace(/\\033\\[23m/g, '</i>');\n\n\tstr = str.replace(/\\033\\[m/g, '</span>');\n\tstr = str.replace(/\\033\\[0m/g, '</span>');\n\treturn str.replace(/\\033\\[39m/g, '</span>');\n};\n\nansispan.foregroundColors = {\n\t'30': 'gray',\n\t'31': 'red',\n\t'32': 'lime',\n\t'33': 'yellow',\n\t'34': '#6B98FF',\n\t'35': '#FF00FF',\n\t'36': 'cyan',\n\t'37': 'white'\n};\n","const Template = Package.templating.Template;\n\nTemplate.log = false;\n\nTemplate.logMatch = /.*/;\n\nTemplate.enableLogs = function(log) {\n\tTemplate.logMatch = /.*/;\n\tif (log === false) {\n\t\treturn Template.log = false;\n\t} else {\n\t\tTemplate.log = true;\n\t\tif (log instanceof RegExp) {\n\t\t\treturn Template.logMatch = log;\n\t\t}\n\t}\n};\n\nconst wrapHelpersAndEvents = function(original, prefix, color) {\n\treturn function(dict) {\n\n\t\tconst template = this;\n\t\tconst fn1 = function(name, fn) {\n\t\t\tif (fn instanceof Function) {\n\t\t\t\treturn dict[name] = function() {\n\n\t\t\t\t\tconst result = fn.apply(this, arguments);\n\t\t\t\t\tif (Template.log === true) {\n\t\t\t\t\t\tconst completeName = `${ prefix }:${ template.viewName.replace('Template.', '') }.${ name }`;\n\t\t\t\t\t\tif (Template.logMatch.test(completeName)) {\n\t\t\t\t\t\t\tconsole.log(`%c${ completeName }`, `color: ${ color }`, {\n\t\t\t\t\t\t\t\targs: arguments,\n\t\t\t\t\t\t\t\tscope: this,\n\t\t\t\t\t\t\t\tresult\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn result;\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\t\t_.each(name, (fn, name) => {\n\t\t\tfn1(name, fn);\n\t\t});\n\t\treturn original.call(template, dict);\n\t};\n};\n\nTemplate.prototype.helpers = wrapHelpersAndEvents(Template.prototype.helpers, 'helper', 'blue');\n\nTemplate.prototype.events = wrapHelpersAndEvents(Template.prototype.events, 'event', 'green');\n\nconst wrapLifeCycle = function(original, prefix, color) {\n\treturn function(fn) {\n\t\tconst template = this;\n\t\tif (fn instanceof Function) {\n\t\t\tconst wrap = function() {\n\t\t\t\tconst result = fn.apply(this, arguments);\n\t\t\t\tif (Template.log === true) {\n\t\t\t\t\tconst completeName = `${ prefix }:${ template.viewName.replace('Template.', '') }.${ name }`;\n\t\t\t\t\tif (Template.logMatch.test(completeName)) {\n\t\t\t\t\t\tconsole.log(`%c${ completeName }`, `color: ${ color }; font-weight: bold`, {\n\t\t\t\t\t\t\targs: arguments,\n\t\t\t\t\t\t\tscope: this,\n\t\t\t\t\t\t\tresult\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t};\n\t\t\treturn original.call(template, wrap);\n\t\t} else {\n\t\t\treturn original.call(template, fn);\n\t\t}\n\t};\n};\n\nTemplate.prototype.onCreated = wrapLifeCycle(Template.prototype.onCreated, 'onCreated', 'blue');\n\nTemplate.prototype.onRendered = wrapLifeCycle(Template.prototype.onRendered, 'onRendered', 'green');\n\nTemplate.prototype.onDestroyed = wrapLifeCycle(Template.prototype.onDestroyed, 'onDestroyed', 'red');\n","\nthis.stdout = new Mongo.Collection('stdout');\n\nMeteor.startup(function() {\n\treturn RocketChat.AdminBox.addOption({\n\t\thref: 'admin-view-logs',\n\t\ti18nLabel: 'View_Logs',\n\t\tpermissionGranted() {\n\t\t\treturn RocketChat.authz.hasAllPermission('view-logs');\n\t\t}\n\t});\n});\n\nFlowRouter.route('/admin/view-logs', {\n\tname: 'admin-view-logs',\n\taction() {\n\t\treturn BlazeLayout.render('main', {\n\t\t\tcenter: 'pageSettingsContainer',\n\t\t\tpageTitle: t('View_Logs'),\n\t\t\tpageTemplate: 'viewLogs',\n\t\t\tnoScroll: true\n\t\t});\n\t}\n});\n","import moment from 'moment';\n// TODO: remove this globals\n/* globals ansispan stdout readMessage*/\n\nTemplate.viewLogs.onCreated(function() {\n\tthis.subscribe('stdout');\n\treturn this.atBottom = true;\n});\n\nTemplate.viewLogs.helpers({\n\thasPermission() {\n\t\treturn RocketChat.authz.hasAllPermission('view-logs');\n\t},\n\tlogs() {\n\t\treturn stdout.find({}, {\n\t\t\tsort: {\n\t\t\t\tts: 1\n\t\t\t}\n\t\t});\n\t},\n\tansispan(string) {\n\t\tstring = ansispan(string.replace(/\\s/g, '&nbsp;').replace(/(\\\\n|\\n)/g, '<br>'));\n\t\tstring = string.replace(/(.\\d{8}-\\d\\d:\\d\\d:\\d\\d\\.\\d\\d\\d\\(?.{0,2}\\)?)/, '<span class=\"terminal-time\">$1</span>');\n\t\treturn string;\n\t},\n\tformatTS(date) {\n\t\treturn moment(date).format('YMMDD-HH:mm:ss.SSS(ZZ)');\n\t}\n});\n\nTemplate.viewLogs.events({\n\t'click .new-logs'() {\n\t\tTemplate.instance().atBottom = true;\n\t\treturn Template.instance().sendToBottomIfNecessary();\n\t}\n});\n\nTemplate.viewLogs.onRendered(function() {\n\n\tconst wrapper = this.find('.terminal');\n\tconst wrapperUl = this.find('.terminal');\n\tconst newLogs = this.find('.new-logs');\n\tconst template = this;\n\ttemplate.isAtBottom = function(scrollThreshold) {\n\t\tif (scrollThreshold == null) {\n\t\t\tscrollThreshold = 0;\n\t\t}\n\t\tif (wrapper.scrollTop + scrollThreshold >= wrapper.scrollHeight - wrapper.clientHeight) {\n\t\t\tnewLogs.className = 'new-logs not';\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t};\n\ttemplate.sendToBottom = function() {\n\t\twrapper.scrollTop = wrapper.scrollHeight - wrapper.clientHeight;\n\t\treturn newLogs.className = 'new-logs not';\n\t};\n\ttemplate.checkIfScrollIsAtBottom = function() {\n\t\ttemplate.atBottom = template.isAtBottom(100);\n\t\treadMessage.enable();\n\t\treturn readMessage.read();\n\t};\n\ttemplate.sendToBottomIfNecessary = function() {\n\t\tif (template.atBottom === true && template.isAtBottom() !== true) {\n\t\t\treturn template.sendToBottom();\n\t\t} else if (template.atBottom === false) {\n\t\t\treturn newLogs.className = 'new-logs';\n\t\t}\n\t};\n\ttemplate.sendToBottomIfNecessaryDebounced = _.debounce(template.sendToBottomIfNecessary, 10);\n\ttemplate.sendToBottomIfNecessary();\n\tif (window.MutationObserver == null) {\n\t\twrapperUl.addEventListener('DOMSubtreeModified', function() {\n\t\t\treturn template.sendToBottomIfNecessaryDebounced();\n\t\t});\n\t} else {\n\t\tconst observer = new MutationObserver(function(mutations) {\n\t\t\treturn mutations.forEach(function() {\n\t\t\t\treturn template.sendToBottomIfNecessaryDebounced();\n\t\t\t});\n\t\t});\n\t\tobserver.observe(wrapperUl, {\n\t\t\tchildList: true\n\t\t});\n\t}\n\ttemplate.onWindowResize = function() {\n\t\treturn Meteor.defer(function() {\n\t\t\treturn template.sendToBottomIfNecessaryDebounced();\n\t\t});\n\t};\n\twindow.addEventListener('resize', template.onWindowResize);\n\twrapper.addEventListener('mousewheel', function() {\n\t\ttemplate.atBottom = false;\n\t\treturn Meteor.defer(function() {\n\t\t\treturn template.checkIfScrollIsAtBottom();\n\t\t});\n\t});\n\twrapper.addEventListener('wheel', function() {\n\t\ttemplate.atBottom = false;\n\t\treturn Meteor.defer(function() {\n\t\t\treturn template.checkIfScrollIsAtBottom();\n\t\t});\n\t});\n\twrapper.addEventListener('touchstart', function() {\n\t\treturn template.atBottom = false;\n\t});\n\twrapper.addEventListener('touchend', function() {\n\t\tMeteor.defer(function() {\n\t\t\treturn template.checkIfScrollIsAtBottom();\n\t\t});\n\t\tMeteor.setTimeout(function() {\n\t\t\treturn template.checkIfScrollIsAtBottom();\n\t\t}, 1000);\n\t\treturn Meteor.setTimeout(function() {\n\t\t\treturn template.checkIfScrollIsAtBottom();\n\t\t}, 2000);\n\t});\n\treturn wrapper.addEventListener('scroll', function() {\n\t\ttemplate.atBottom = false;\n\t\treturn Meteor.defer(function() {\n\t\t\treturn template.checkIfScrollIsAtBottom();\n\t\t});\n\t});\n});\n"]}