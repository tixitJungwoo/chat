{"version":3,"sources":["meteor://ğŸ’»app/packages/rocketchat:message-star/client/lib/StarredMessage.js","meteor://ğŸ’»app/packages/rocketchat:message-star/client/actionButton.js","meteor://ğŸ’»app/packages/rocketchat:message-star/client/starMessage.js","meteor://ğŸ’»app/packages/rocketchat:message-star/client/tabBar.js","meteor://ğŸ’»app/packages/rocketchat:message-star/client/views/starredMessages.js"],"names":["StarredMessage","Mongo","Collection","toastr","module","watch","require","v","Meteor","startup","RocketChat","MessageAction","addButton","id","icon","i18nLabel","context","action","message","_arguments","starred","userId","call","error","handleError","validation","models","Subscriptions","findOne","rid","settings","get","_","findWhere","_id","order","Boolean","hideDropDown","RoomHistoryManager","getSurroundingMessages","classes","$","event","currentTarget","attr","getPermaLink","success","TAPi18n","__","methods","starMessage","ChatMessage","update","$set","TabBar","groups","i18nTitle","template","Template","starredMessages","helpers","hasMessages","find","sort","ts","count","messages","extend","customClass","hasMore","instance","onCreated","ReactiveVar","limit","autorun","sub","subscribe","data","findStarredMessage","ready","set","events","e","t","stopPropagation","preventDefault","message_id","closest","remove","actions","getButtons","el","Blaze","toHTMLWithData","messageDropdown","append","dropDown","show","throttle","target","scrollTop","scrollHeight","clientHeight"],"mappings":"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","file":"/packages/rocketchat_message-star.js","sourcesContent":["this.StarredMessage = new Mongo.Collection('rocketchat_starred_message');\n","import toastr from 'toastr';\nMeteor.startup(function() {\n\tRocketChat.MessageAction.addButton({\n\t\tid: 'star-message',\n\t\ticon: 'icon-star-empty',\n\t\ti18nLabel: 'Star_Message',\n\t\tcontext: ['starred', 'message', 'message-mobile'],\n\t\taction() {\n\t\t\tconst message = this._arguments[1];\n\t\t\tmessage.starred = Meteor.userId();\n\t\t\treturn Meteor.call('starMessage', message, function(error) {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn handleError(error);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tvalidation(message) {\n\t\t\tif (RocketChat.models.Subscriptions.findOne({ rid: message.rid }) == null && RocketChat.settings.get('Message_AllowStarring')) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn !_.findWhere(message.starred, {_id: Meteor.userId()});\n\t\t},\n\t\torder: 10\n\t});\n\tRocketChat.MessageAction.addButton({\n\t\tid: 'unstar-message',\n\t\ticon: 'icon-star',\n\t\ti18nLabel: 'Unstar_Message',\n\t\tcontext: ['starred', 'message', 'message-mobile'],\n\t\taction() {\n\t\t\tconst message = this._arguments[1];\n\t\t\tmessage.starred = false;\n\t\t\treturn Meteor.call('starMessage', message, function(error) {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn handleError(error);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tvalidation(message) {\n\t\t\tif (RocketChat.models.Subscriptions.findOne({ rid: message.rid }) == null && RocketChat.settings.get('Message_AllowStarring')) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn Boolean(_.findWhere(message.starred, {_id: Meteor.userId()}));\n\t\t},\n\t\torder: 10\n\t});\n\tRocketChat.MessageAction.addButton({\n\t\tid: 'jump-to-star-message',\n\t\ticon: 'icon-right-hand',\n\t\ti18nLabel: 'Jump_to_message',\n\t\tcontext: ['starred'],\n\t\taction() {\n\t\t\tconst message = this._arguments[1];\n\t\t\tRocketChat.MessageAction.hideDropDown();\n\t\t\treturn RoomHistoryManager.getSurroundingMessages(message, 50);\n\t\t},\n\t\tvalidation(message) {\n\t\t\tif (RocketChat.models.Subscriptions.findOne({ rid: message.rid }) == null) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\torder: 100\n\t});\n\treturn RocketChat.MessageAction.addButton({\n\t\tid: 'permalink-star',\n\t\ticon: 'icon-link',\n\t\ti18nLabel: 'Permalink',\n\t\tclasses: 'clipboard',\n\t\tcontext: ['starred'],\n\t\taction() {\n\t\t\tconst message = this._arguments[1];\n\t\t\tRocketChat.MessageAction.hideDropDown();\n\t\t\t$(event.currentTarget).attr('data-clipboard-text', RocketChat.MessageAction.getPermaLink(message._id));\n\t\t\treturn toastr.success(TAPi18n.__('Copied'));\n\t\t},\n\t\tvalidation(message) {\n\t\t\tif (RocketChat.models.Subscriptions.findOne({ rid: message.rid }) == null) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\torder: 101\n\t});\n});\n","Meteor.methods({\n\tstarMessage(message) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn false;\n\t\t}\n\t\tif (RocketChat.models.Subscriptions.findOne({ rid: message.rid }) == null) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!RocketChat.settings.get('Message_AllowStarring')) {\n\t\t\treturn false;\n\t\t}\n\t\treturn ChatMessage.update({\n\t\t\t_id: message._id\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tstarred: !!message.starred\n\t\t\t}\n\t\t});\n\t}\n});\n","Meteor.startup(function() {\n\treturn RocketChat.TabBar.addButton({\n\t\tgroups: ['channel', 'group', 'direct'],\n\t\tid: 'starred-messages',\n\t\ti18nTitle: 'Starred_Messages',\n\t\ticon: 'icon-star',\n\t\ttemplate: 'starredMessages',\n\t\torder: 3\n\t});\n});\n","/*globals StarredMessage */\nTemplate.starredMessages.helpers({\n\thasMessages() {\n\t\treturn StarredMessage.find({\n\t\t\trid: this.rid\n\t\t}, {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t}\n\t\t}).count() > 0;\n\t},\n\tmessages() {\n\t\treturn StarredMessage.find({\n\t\t\trid: this.rid\n\t\t}, {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t}\n\t\t});\n\t},\n\tmessage() {\n\t\treturn _.extend(this, {\n\t\t\tcustomClass: 'starred'\n\t\t});\n\t},\n\thasMore() {\n\t\treturn Template.instance().hasMore.get();\n\t}\n});\n\nTemplate.starredMessages.onCreated(function() {\n\tthis.hasMore = new ReactiveVar(true);\n\tthis.limit = new ReactiveVar(50);\n\tthis.autorun(() => {\n\t\tconst sub = this.subscribe('starredMessages', this.data.rid, this.limit.get());\n\t\tconst findStarredMessage = StarredMessage.find({ rid: this.data.rid });\n\t\tif (sub.ready()) {\n\t\t\tif (findStarredMessage.count() < this.limit.get()) {\n\t\t\t\treturn this.hasMore.set(false);\n\t\t\t}\n\t\t}\n\t});\n});\n\nTemplate.starredMessages.events({\n\t'click .message-cog'(e, t) {\n\t\te.stopPropagation();\n\t\te.preventDefault();\n\t\tconst message_id = $(e.currentTarget).closest('.message').attr('id');\n\t\tRocketChat.MessageAction.hideDropDown();\n\t\tt.$(`\\#${ message_id } .message-dropdown`).remove();\n\t\tconst message = StarredMessage.findOne(message_id);\n\t\tconst actions = RocketChat.MessageAction.getButtons(message, 'starred');\n\t\tconst el = Blaze.toHTMLWithData(Template.messageDropdown, {\n\t\t\tactions\n\t\t});\n\t\tt.$(`\\#${ message_id } .message-cog-container`).append(el);\n\t\tconst dropDown = t.$(`\\#${ message_id } .message-dropdown`);\n\t\treturn dropDown.show();\n\t},\n\t'scroll .content': _.throttle(function(e, instance) {\n\t\tif (e.target.scrollTop >= e.target.scrollHeight - e.target.clientHeight) {\n\t\t\treturn instance.limit.set(instance.limit.get() + 50);\n\t\t}\n\t}, 200)\n});\n"]}