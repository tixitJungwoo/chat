{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:action-links/both/lib/actionLinks.js","meteor://ðŸ’»app/packages/rocketchat:action-links/client/lib/actionLinks.js","meteor://ðŸ’»app/packages/rocketchat:action-links/client/init.js"],"names":["RocketChat","actionLinks","actions","register","name","funct","getMessage","messageId","Meteor","userId","Error","message","models","Messages","findOne","_id","room","Rooms","rid","Array","isArray","usernames","indexOf","user","username","run","instance","actionLink","ranClient","method_id","params","call","err","handleError","Template","events","event","preventDefault","stopPropagation","data","Blaze","getData","currentTarget","Layout","isEmbedded","fireGlobalEvent","actionlink","$","value","_arguments"],"mappings":"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","file":"/packages/rocketchat_action-links.js","sourcesContent":["//Action Links namespace creation.\nRocketChat.actionLinks = {\n\tactions: {},\n\tregister(name, funct) {\n\t\tRocketChat.actionLinks.actions[name] = funct;\n\t},\n\tgetMessage(name, messageId) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { function: 'actionLinks.getMessage' });\n\t\t}\n\n\t\tconst message = RocketChat.models.Messages.findOne({ _id: messageId });\n\t\tif (!message) {\n\t\t\tthrow new Meteor.Error('error-invalid-message', 'Invalid message', { function: 'actionLinks.getMessage' });\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOne({ _id: message.rid });\n\t\tif (Array.isArray(room.usernames) && room.usernames.indexOf(Meteor.user().username) === -1) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { function: 'actionLinks.getMessage' });\n\t\t}\n\n\t\tif (!message.actionLinks || !message.actionLinks[name]) {\n\t\t\tthrow new Meteor.Error('error-invalid-actionlink', 'Invalid action link', { function: 'actionLinks.getMessage' });\n\t\t}\n\n\t\treturn message;\n\t}\n};\n","//Action Links Handler. This method will be called off the client.\n\nRocketChat.actionLinks.run = (name, messageId, instance) => {\n\tconst message = RocketChat.actionLinks.getMessage(name, messageId);\n\n\tconst actionLink = message.actionLinks[name];\n\n\tlet ranClient = false;\n\n\tif (RocketChat.actionLinks && RocketChat.actionLinks.actions && RocketChat.actionLinks.actions[actionLink.method_id]) {\n\t\t// run just on client side\n\t\tRocketChat.actionLinks.actions[actionLink.method_id](message, actionLink.params, instance);\n\n\t\tranClient = true;\n\t}\n\n\t// and run on server side\n\tMeteor.call('actionLinkHandler', name, messageId, (err) => {\n\t\tif (err && !ranClient) {\n\t\t\thandleError(err);\n\t\t}\n\t});\n};\n","/* globals fireGlobalEvent */\nTemplate.room.events({\n\t'click .action-link'(event, instance) {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tconst data = Blaze.getData(event.currentTarget);\n\n\t\tif (RocketChat.Layout.isEmbedded()) {\n\t\t\treturn fireGlobalEvent('click-action-link', {\n\t\t\t\tactionlink: $(event.currentTarget).data('actionlink'),\n\t\t\t\tvalue: data._arguments[1]._id,\n\t\t\t\tmessage: data._arguments[1]\n\t\t\t});\n\t\t}\n\n\t\tif (data && data._arguments && data._arguments[1] && data._arguments[1]._id) {\n\t\t\tRocketChat.actionLinks.run($(event.currentTarget).data('actionlink'), data._arguments[1]._id, instance, (err) => {\n\t\t\t\tif (err) {\n\t\t\t\t\thandleError(err);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n"]}