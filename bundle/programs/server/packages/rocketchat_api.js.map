{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:api/server/api.js","meteor://ðŸ’»app/packages/rocketchat:api/server/settings.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/getPaginationItems.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/getUserFromParams.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/isUserFromParams.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/parseJsonQuery.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/getLoggedInUser.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/channels.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/chat.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/groups.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/im.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/integrations.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/misc.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/settings.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/stats.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/users.js","meteor://ðŸ’»app/packages/rocketchat:api/server/default/helpers/getLoggedInUser.js","meteor://ðŸ’»app/packages/rocketchat:api/server/default/info.js","meteor://ðŸ’»app/packages/rocketchat:api/server/default/metrics.js"],"names":["API","properties","logger","Logger","version","authMethods","helperMethods","Map","defaultFieldsToExclude","joinCode","$loki","meta","_config","defaultOptionsEndpoint","request","method","headers","RocketChat","settings","get","response","writeHead","write","done","addAuthMethod","push","success","result","_","isObject","statusCode","body","failure","errorType","error","unauthorized","msg","addRoute","routes","options","endpoints","isArray","forEach","route","Object","keys","action","originalAction","debug","toUpperCase","url","apply","e","v1","message","name","helperMethod","Restivus","getUserAuth","_getUserAuth","invalidResults","undefined","token","user","bodyParams","payload","JSON","parse","i","length","arguments","includes","Accounts","_hashLoginToken","userId","useDefaultAuth","prettyJson","enableCors","auth","default","addGroup","section","add","type","enableQuery","_id","value","set","_getPaginationItems","hardUpperLimit","defaultCount","offset","queryParams","parseInt","count","_getUserFromParams","doesntExist","_doesntExist","trim","models","Users","findOneById","username","findOneByUsername","Meteor","Error","_isUserFromParams","_parseJsonQuery","sort","warn","fields","query","_getLoggedInUser","findOne","findChannelByIdOrName","roomId","roomName","checkedArchived","room","Rooms","findOneByName","t","archived","authRequired","post","findResult","runAsUser","call","activeUsersOnly","channel","getUserFromParams","latest","oldest","Date","inclusive","sub","Subscriptions","findOneByRoomIdAndUserId","open","authz","hasPermission","members","customFields","readOnly","id","rid","includeAllPublicChannels","ourQuery","$in","getPaginationItems","parseJsonQuery","assign","integrations","Integrations","find","_createdAt","skip","limit","fetch","total","latestDate","oldestDate","unreads","messages","rooms","channels","pluck","findByTypeAndUserId","totalCount","processQueryOptionsOnResult","online","findUsersNotOffline","onlineInRoom","usernames","indexOf","description","purpose","ro","topic","check","Match","ObjectIncluding","msgId","String","asUser","Maybe","Boolean","Messages","u","ts","now","messageReturn","processWebhookMessage","text","findPrivateGroupByIdOrName","roomSub","findOneByRoomNameAndUserId","group","_room","includeAllPrivateGroups","channelsToSearch","groups","findDirectMessageRoomById","msgs","ims","enabled","urls","event","triggerWords","alias","avatar","emoji","scriptEnabled","script","targetChannel","integration","history","IntegrationHistory","_updatedAt","items","target_url","integrationId","getLoggedInUser","hasRole","info","Info","pick","onlineCache","onlineCacheDate","cacheInvalid","icon","types","split","map","hideIcon","TAPi18n","__","iconSize","leftSize","rightSize","width","height","replace","hidden","$ne","public","Settings","findOneNotHiddenById","urlParams","Any","updateValueNotHiddenById","refresh","stats","statistics","Statistics","email","password","active","roles","Array","joinDefaultChannels","requirePasswordChange","sendWelcomeEmail","verified","newUserId","saveUser","saveCustomFields","getURL","cdn","full","setHeader","isUserFromParams","presence","status","connectionStatus","statusConnection","lastLogin","filter","fieldsToKeepFromRegularUsers","avatarOrigin","emails","phone","createdAt","services","requirePasswordChangeReason","statusDefault","ourFields","users","avatarUrl","setUserAvatar","Busboy","Npm","require","busboy","wrapAsync","callback","on","bindEnvironment","fieldname","file","filename","encoding","mimetype","imageData","data","Buffer","concat","pipe","userData","extend","promclient","register","metrics"],"mappings":"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","file":"/packages/rocketchat_api.js","sourcesContent":["/* global Restivus */\nclass API extends Restivus {\n\tconstructor(properties) {\n\t\tsuper(properties);\n\t\tthis.logger = new Logger(`API ${ properties.version ? properties.version : 'default' } Logger`, {});\n\t\tthis.authMethods = [];\n\t\tthis.helperMethods = new Map();\n\t\tthis.defaultFieldsToExclude = {\n\t\t\tjoinCode: 0,\n\t\t\t$loki: 0,\n\t\t\tmeta: 0\n\t\t};\n\n\t\tthis._config.defaultOptionsEndpoint = function() {\n\t\t\tif (this.request.method === 'OPTIONS' && this.request.headers['access-control-request-method']) {\n\t\t\t\tif (RocketChat.settings.get('API_Enable_CORS') === true) {\n\t\t\t\t\tthis.response.writeHead(200, {\n\t\t\t\t\t\t'Access-Control-Allow-Origin': RocketChat.settings.get('API_CORS_Origin'),\n\t\t\t\t\t\t'Access-Control-Allow-Headers': 'Origin, X-Requested-With, Content-Type, Accept, X-User-Id, X-Auth-Token'\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.response.writeHead(405);\n\t\t\t\t\tthis.response.write('CORS not enabled. Go to \"Admin > General > REST Api\" to enable it.');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.response.writeHead(404);\n\t\t\t}\n\n\t\t\tthis.done();\n\t\t};\n\t}\n\n\taddAuthMethod(method) {\n\t\tthis.authMethods.push(method);\n\t}\n\n\tsuccess(result={}) {\n\t\tif (_.isObject(result)) {\n\t\t\tresult.success = true;\n\t\t}\n\n\t\treturn {\n\t\t\tstatusCode: 200,\n\t\t\tbody: result\n\t\t};\n\t}\n\n\tfailure(result, errorType) {\n\t\tif (_.isObject(result)) {\n\t\t\tresult.success = false;\n\t\t} else {\n\t\t\tresult = {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: result\n\t\t\t};\n\n\t\t\tif (errorType) {\n\t\t\t\tresult.errorType = errorType;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tstatusCode: 400,\n\t\t\tbody: result\n\t\t};\n\t}\n\n\n\tunauthorized(msg) {\n\t\treturn {\n\t\t\tstatusCode: 403,\n\t\t\tbody: {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: msg ? msg : 'unauthorized'\n\t\t\t}\n\t\t};\n\t}\n\n\taddRoute(routes, options, endpoints) {\n\t\t//Note: required if the developer didn't provide options\n\t\tif (typeof endpoints === 'undefined') {\n\t\t\tendpoints = options;\n\t\t\toptions = {};\n\t\t}\n\n\t\t//Allow for more than one route using the same option and endpoints\n\t\tif (!_.isArray(routes)) {\n\t\t\troutes = [routes];\n\t\t}\n\n\t\troutes.forEach((route) => {\n\t\t\t//Note: This is required due to Restivus calling `addRoute` in the constructor of itself\n\t\t\tif (this.helperMethods) {\n\t\t\t\tObject.keys(endpoints).forEach((method) => {\n\t\t\t\t\tif (typeof endpoints[method] === 'function') {\n\t\t\t\t\t\tendpoints[method] = { action: endpoints[method] };\n\t\t\t\t\t}\n\n\t\t\t\t\t//Add a try/catch for each much\n\t\t\t\t\tconst originalAction = endpoints[method].action;\n\t\t\t\t\tendpoints[method].action = function() {\n\t\t\t\t\t\tthis.logger.debug(`${ this.request.method.toUpperCase() }: ${ this.request.url }`);\n\t\t\t\t\t\tlet result;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tresult = originalAction.apply(this);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthis.logger.debug(`${ method } ${ route } threw an error:`, e);\n\t\t\t\t\t\t\treturn RocketChat.API.v1.failure(e.message, e.error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn result ? result : RocketChat.API.v1.success();\n\t\t\t\t\t};\n\n\t\t\t\t\tfor (const [name, helperMethod] of this.helperMethods) {\n\t\t\t\t\t\tendpoints[method][name] = helperMethod;\n\t\t\t\t\t}\n\n\t\t\t\t\t//Allow the endpoints to make usage of the logger which respects the user's settings\n\t\t\t\t\tendpoints[method].logger = this.logger;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tsuper.addRoute(route, options, endpoints);\n\t\t});\n\t}\n}\n\nRocketChat.API = {};\n\nconst getUserAuth = function _getUserAuth() {\n\tconst invalidResults = [undefined, null, false];\n\treturn {\n\t\ttoken: 'services.resume.loginTokens.hashedToken',\n\t\tuser() {\n\t\t\tif (this.bodyParams && this.bodyParams.payload) {\n\t\t\t\tthis.bodyParams = JSON.parse(this.bodyParams.payload);\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < RocketChat.API.v1.authMethods.length; i++) {\n\t\t\t\tconst method = RocketChat.API.v1.authMethods[i];\n\n\t\t\t\tif (typeof method === 'function') {\n\t\t\t\t\tconst result = method.apply(this, arguments);\n\t\t\t\t\tif (!invalidResults.includes(result)) {\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet token;\n\t\t\tif (this.request.headers['x-auth-token']) {\n\t\t\t\ttoken = Accounts._hashLoginToken(this.request.headers['x-auth-token']);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tuserId: this.request.headers['x-user-id'],\n\t\t\t\ttoken\n\t\t\t};\n\t\t}\n\t};\n};\n\nRocketChat.API.v1 = new API({\n\tversion: 'v1',\n\tuseDefaultAuth: true,\n\tprettyJson: true,\n\tenableCors: false,\n\tauth: getUserAuth()\n});\n\nRocketChat.API.default = new API({\n\tuseDefaultAuth: true,\n\tprettyJson: true,\n\tenableCors: false,\n\tauth: getUserAuth()\n});\n","RocketChat.settings.addGroup('General', function() {\n\tthis.section('REST API', function() {\n\t\tthis.add('API_Upper_Count_Limit', 100, { type: 'int', public: false });\n\t\tthis.add('API_Default_Count', 50, { type: 'int', public: false });\n\t\tthis.add('API_Allow_Infinite_Count', true, { type: 'boolean', public: false });\n\t\tthis.add('API_Enable_Direct_Message_History_EndPoint', false, { type: 'boolean', public: false });\n\t\tthis.add('API_Enable_Shields', true, { type: 'boolean', public: false });\n\t\tthis.add('API_Shield_Types', '*', { type: 'string', public: false, enableQuery: { _id: 'API_Enable_Shields', value: true } });\n\t\tthis.add('API_Enable_CORS', false, { type: 'boolean', public: false });\n\t\tthis.add('API_CORS_Origin', '*', { type: 'string', public: false, enableQuery: { _id: 'API_Enable_CORS', value: true } });\n\t});\n});\n","// If the count query param is higher than the \"API_Upper_Count_Limit\" setting, then we limit that\n// If the count query param isn't defined, then we set it to the \"API_Default_Count\" setting\n// If the count is zero, then that means unlimited and is only allowed if the setting \"API_Allow_Infinite_Count\" is true\n\nRocketChat.API.v1.helperMethods.set('getPaginationItems', function _getPaginationItems() {\n\tconst hardUpperLimit = RocketChat.settings.get('API_Upper_Count_Limit') <= 0 ? 100 : RocketChat.settings.get('API_Upper_Count_Limit');\n\tconst defaultCount = RocketChat.settings.get('API_Default_Count') <= 0 ? 50 : RocketChat.settings.get('API_Default_Count');\n\tconst offset = this.queryParams.offset ? parseInt(this.queryParams.offset) : 0;\n\tlet count = defaultCount;\n\n\t// Ensure count is an appropiate amount\n\tif (typeof this.queryParams.count !== 'undefined') {\n\t\tcount = parseInt(this.queryParams.count);\n\t} else {\n\t\tcount = defaultCount;\n\t}\n\n\tif (count > hardUpperLimit) {\n\t\tcount = hardUpperLimit;\n\t}\n\n\tif (count === 0 && !RocketChat.settings.get('API_Allow_Infinite_Count')) {\n\t\tcount = defaultCount;\n\t}\n\n\treturn {\n\t\toffset,\n\t\tcount\n\t};\n});\n","//Convenience method, almost need to turn it into a middleware of sorts\nRocketChat.API.v1.helperMethods.set('getUserFromParams', function _getUserFromParams() {\n\tconst doesntExist = { _doesntExist: true };\n\tlet user;\n\n\tswitch (this.request.method) {\n\t\tcase 'POST':\n\t\tcase 'PUT':\n\t\t\tif (this.bodyParams.userId && this.bodyParams.userId.trim()) {\n\t\t\t\tuser = RocketChat.models.Users.findOneById(this.bodyParams.userId) || doesntExist;\n\t\t\t} else if (this.bodyParams.username && this.bodyParams.username.trim()) {\n\t\t\t\tuser = RocketChat.models.Users.findOneByUsername(this.bodyParams.username) || doesntExist;\n\t\t\t} else if (this.bodyParams.user && this.bodyParams.user.trim()) {\n\t\t\t\tuser = RocketChat.models.Users.findOneByUsername(this.bodyParams.user) || doesntExist;\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (this.queryParams.userId && this.queryParams.userId.trim()) {\n\t\t\t\tuser = RocketChat.models.Users.findOneById(this.queryParams.userId) || doesntExist;\n\t\t\t} else if (this.queryParams.username && this.queryParams.username.trim()) {\n\t\t\t\tuser = RocketChat.models.Users.findOneByUsername(this.queryParams.username) || doesntExist;\n\t\t\t} else if (this.queryParams.user && this.queryParams.user.trim()) {\n\t\t\t\tuser = RocketChat.models.Users.findOneByUsername(this.queryParams.user) || doesntExist;\n\t\t\t}\n\t\t\tbreak;\n\t}\n\n\tif (!user) {\n\t\tthrow new Meteor.Error('error-user-param-not-provided', 'The required \"userId\" or \"username\" param was not provided');\n\t} else if (user._doesntExist) {\n\t\tthrow new Meteor.Error('error-invalid-user', 'The required \"userId\" or \"username\" param provided does not match any users');\n\t}\n\n\treturn user;\n});\n","RocketChat.API.v1.helperMethods.set('isUserFromParams', function _isUserFromParams() {\n\treturn (this.queryParams.userId && this.userId === this.queryParams.userId) ||\n\t\t(this.queryParams.username && this.user.username === this.queryParams.username) ||\n\t\t(this.queryParams.user && this.user.username === this.queryParams.user);\n});\n","RocketChat.API.v1.helperMethods.set('parseJsonQuery', function _parseJsonQuery() {\n\tlet sort;\n\tif (this.queryParams.sort) {\n\t\ttry {\n\t\t\tsort = JSON.parse(this.queryParams.sort);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid sort parameter provided \"${ this.queryParams.sort }\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-sort', `Invalid sort parameter provided: \"${ this.queryParams.sort }\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\tlet fields;\n\tif (this.queryParams.fields) {\n\t\ttry {\n\t\t\tfields = JSON.parse(this.queryParams.fields);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid fields parameter provided \"${ this.queryParams.fields }\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-fields', `Invalid fields parameter provided: \"${ this.queryParams.fields }\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\tlet query;\n\tif (this.queryParams.query) {\n\t\ttry {\n\t\t\tquery = JSON.parse(this.queryParams.query);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid query parameter provided \"${ this.queryParams.query }\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-query', `Invalid query parameter provided: \"${ this.queryParams.query }\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\treturn {\n\t\tsort,\n\t\tfields,\n\t\tquery\n\t};\n});\n","RocketChat.API.v1.helperMethods.set('getLoggedInUser', function _getLoggedInUser() {\n\tlet user;\n\n\tif (this.request.headers['x-auth-token'] && this.request.headers['x-user-id']) {\n\t\tuser = RocketChat.models.Users.findOne({\n\t\t\t'_id': this.request.headers['x-user-id'],\n\t\t\t'services.resume.loginTokens.hashedToken': Accounts._hashLoginToken(this.request.headers['x-auth-token'])\n\t\t});\n\t}\n\n\treturn user;\n});\n","//Returns the channel IF found otherwise it will return the failure of why it didn't. Check the `statusCode` property\nfunction findChannelByIdOrName({ roomId, roomName, checkedArchived = true }) {\n\tif ((!roomId || !roomId.trim()) && (!roomName || !roomName.trim())) {\n\t\tthrow new Meteor.Error('error-roomid-param-not-provided', 'The parameter \"roomId\" or \"roomName\" is required');\n\t}\n\n\tlet room;\n\tif (roomId) {\n\t\troom = RocketChat.models.Rooms.findOneById(roomId, { fields: RocketChat.API.v1.defaultFieldsToExclude });\n\t} else if (roomName) {\n\t\troom = RocketChat.models.Rooms.findOneByName(roomName, { fields: RocketChat.API.v1.defaultFieldsToExclude });\n\t}\n\n\tif (!room || room.t !== 'c') {\n\t\tthrow new Meteor.Error('error-room-not-found', `No channel found by the id of: ${ roomId }`);\n\t}\n\n\tif (checkedArchived && room.archived) {\n\t\tthrow new Meteor.Error('error-room-archived', `The channel, ${ room.name }, is archived`);\n\t}\n\n\treturn room;\n}\n\nRocketChat.API.v1.addRoute('channels.addAll', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addAllUserToRoom', findResult._id, this.bodyParams.activeUsersOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.addModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomModerator', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.addOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomOwner', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.archive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('archiveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.cleanHistory', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId });\n\n\t\tif (!this.bodyParams.latest) {\n\t\t\treturn RocketChat.API.v1.failure('Body parameter \"latest\" is required.');\n\t\t}\n\n\t\tif (!this.bodyParams.oldest) {\n\t\t\treturn RocketChat.API.v1.failure('Body parameter \"oldest\" is required.');\n\t\t}\n\n\t\tconst latest = new Date(this.bodyParams.latest);\n\t\tconst oldest = new Date(this.bodyParams.oldest);\n\n\t\tlet inclusive = false;\n\t\tif (typeof this.bodyParams.inclusive !== 'undefined') {\n\t\t\tinclusive = this.bodyParams.inclusive;\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('cleanChannelHistory', { roomId: findResult._id, latest, oldest, inclusive });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.close', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId, checkedArchived: false });\n\n\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(findResult._id, this.userId);\n\n\t\tif (!sub) {\n\t\t\treturn RocketChat.API.v1.failure(`The user/callee is not in the channel \"${ findResult.name }.`);\n\t\t}\n\n\t\tif (!sub.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${ findResult.name }, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.create', { authRequired: true }, {\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'create-c')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"name\" is required');\n\t\t}\n\n\t\tif (this.bodyParams.members && !_.isArray(this.bodyParams.members)) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"members\" must be an array if provided');\n\t\t}\n\n\t\tif (this.bodyParams.customFields && !(typeof this.bodyParams.customFields === 'object')) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"customFields\" must be an object if provided');\n\t\t}\n\n\t\tlet readOnly = false;\n\t\tif (typeof this.bodyParams.readOnly !== 'undefined') {\n\t\t\treadOnly = this.bodyParams.readOnly;\n\t\t}\n\n\t\tlet id;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tid = Meteor.call('createChannel', this.bodyParams.name, this.bodyParams.members ? this.bodyParams.members : [], readOnly, this.bodyParams.customFields);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(id.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.delete', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId, checkedArchived: false });\n\n\t\t//The find method returns either with the group or the failur\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('eraseRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: findResult\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.getIntegrations', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.queryParams.roomId, checkedArchived: false });\n\n\t\tlet includeAllPublicChannels = true;\n\t\tif (typeof this.queryParams.includeAllPublicChannels !== 'undefined') {\n\t\t\tincludeAllPublicChannels = this.queryParams.includeAllPublicChannels === 'true';\n\t\t}\n\n\t\tlet ourQuery = {\n\t\t\tchannel: `#${ findResult.name }`\n\t\t};\n\n\t\tif (includeAllPublicChannels) {\n\t\t\tourQuery.channel = {\n\t\t\t\t$in: [ourQuery.channel, 'all_public_channels']\n\t\t\t};\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tourQuery = Object.assign({}, query, ourQuery);\n\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _createdAt: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\tcount: integrations.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.history', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.queryParams.roomId, checkedArchived: false });\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tlet inclusive = false;\n\t\tif (this.queryParams.inclusive) {\n\t\t\tinclusive = this.queryParams.inclusive;\n\t\t}\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tlet unreads = false;\n\t\tif (this.queryParams.unreads) {\n\t\t\tunreads = this.queryParams.unreads;\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', { rid: findResult._id, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: result && result.messages ? result.messages : []\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.info', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.queryParams.roomId, roomName: this.queryParams.roomName, checkedArchived: false });\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.invite', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addUserToRoom', { rid: findResult._id, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.join', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('joinRoom', findResult._id, this.bodyParams.joinCode);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.kick', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeUserFromRoom', { rid: findResult._id, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.leave', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('leaveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.list', { authRequired: true }, {\n\tget: {\n\t\t//This is like this only to provide an example of how we routes can be defined :X\n\t\taction() {\n\t\t\tconst { offset, count } = this.getPaginationItems();\n\t\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\t\tconst ourQuery = Object.assign({}, query, { t: 'c' });\n\n\t\t\tconst rooms = RocketChat.models.Rooms.find(ourQuery, {\n\t\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\t\tskip: offset,\n\t\t\t\tlimit: count,\n\t\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t\t}).fetch();\n\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tchannels: rooms,\n\t\t\t\tcount: rooms.length,\n\t\t\t\toffset,\n\t\t\t\ttotal: RocketChat.models.Rooms.find(ourQuery).count()\n\t\t\t});\n\t\t}\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.list.joined', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\t\tlet rooms = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('c', this.userId).fetch(), '_room');\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannels: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.online', { authRequired: true }, {\n\tget() {\n\t\tconst { query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { t: 'c' });\n\n\t\tconst room = RocketChat.models.Rooms.findOne(ourQuery);\n\n\t\tif (room == null) {\n\t\t\treturn RocketChat.API.v1.failure('Channel does not exists');\n\t\t}\n\n\t\tconst online = RocketChat.models.Users.findUsersNotOffline({\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tconst onlineInRoom = [];\n\t\tonline.forEach(user => {\n\t\t\tif (room.usernames.indexOf(user.username) !== -1) {\n\t\t\t\tonlineInRoom.push({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tonline: onlineInRoom\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.open', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId, checkedArchived: false });\n\n\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(findResult._id, this.userId);\n\n\t\tif (!sub) {\n\t\t\treturn RocketChat.API.v1.failure(`The user/callee is not in the channel \"${ findResult.name }\".`);\n\t\t}\n\n\t\tif (sub.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${ findResult.name }, is already open to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('openRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.removeModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomModerator', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.removeOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomOwner', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.rename', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.name || !this.bodyParams.name.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"name\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId });\n\n\t\tif (findResult.name === this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('The channel name is the same as what it would be renamed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomName', this.bodyParams.name);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setDescription', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.description || !this.bodyParams.description.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"description\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId });\n\n\t\tif (findResult.description === this.bodyParams.description) {\n\t\t\treturn RocketChat.API.v1.failure('The channel description is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomDescription', this.bodyParams.description);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tdescription: this.bodyParams.description\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setJoinCode', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.joinCode || !this.bodyParams.joinCode.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"joinCode\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'joinCode', this.bodyParams.joinCode);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setPurpose', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.purpose || !this.bodyParams.purpose.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"purpose\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId });\n\n\t\tif (findResult.description === this.bodyParams.purpose) {\n\t\t\treturn RocketChat.API.v1.failure('The channel purpose (description) is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomDescription', this.bodyParams.purpose);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpurpose: this.bodyParams.purpose\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setReadOnly', { authRequired: true }, {\n\tpost() {\n\t\tif (typeof this.bodyParams.readOnly === 'undefined') {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"readOnly\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId });\n\n\t\tif (findResult.ro === this.bodyParams.readOnly) {\n\t\t\treturn RocketChat.API.v1.failure('The channel read only setting is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'readOnly', this.bodyParams.readOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setTopic', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId });\n\n\t\tif (findResult.topic === this.bodyParams.topic) {\n\t\t\treturn RocketChat.API.v1.failure('The channel topic is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setType', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.type || !this.bodyParams.type.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"type\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId });\n\n\t\tif (findResult.t === this.bodyParams.type) {\n\t\t\treturn RocketChat.API.v1.failure('The channel type is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomType', this.bodyParams.type);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.unarchive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ roomId: this.bodyParams.roomId, checkedArchived: false });\n\n\t\tif (!findResult.archived) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${ findResult.name }, is not archived`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('unarchiveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n","/* global processWebhookMessage */\nRocketChat.API.v1.addRoute('chat.delete', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tmsgId: String,\n\t\t\troomId: String,\n\t\t\tasUser: Match.Maybe(Boolean)\n\t\t}));\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.msgId, { fields: { u: 1, rid: 1 }});\n\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure(`No message found with the id of \"${ this.bodyParams.msgId }\".`);\n\t\t}\n\n\t\tif (this.bodyParams.roomId !== msg.rid) {\n\t\t\treturn RocketChat.API.v1.failure('The room id provided does not match where the message is from.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.bodyParams.asUser ? msg.u._id : this.userId, () => {\n\t\t\tMeteor.call('deleteMessage', { _id: msg._id });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\t_id: msg._id,\n\t\t\tts: Date.now()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.postMessage', { authRequired: true }, {\n\tpost() {\n\t\tconst messageReturn = processWebhookMessage(this.bodyParams, this.user)[0];\n\n\t\tif (!messageReturn) {\n\t\t\treturn RocketChat.API.v1.failure('unknown-error');\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tts: Date.now(),\n\t\t\tchannel: messageReturn.channel,\n\t\t\tmessage: messageReturn.message\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.update', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\troomId: String,\n\t\t\tmsgId: String,\n\t\t\ttext: String //Using text to be consistant with chat.postMessage\n\t\t}));\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.msgId);\n\n\t\t//Ensure the message exists\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure(`No message found with the id of \"${ this.bodyParams.msgId }\".`);\n\t\t}\n\n\t\tif (this.bodyParams.roomId !== msg.rid) {\n\t\t\treturn RocketChat.API.v1.failure('The room id provided does not match where the message is from.');\n\t\t}\n\n\t\t//Permission checks are already done in the updateMessage method, so no need to duplicate them\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('updateMessage', { _id: msg._id, msg: this.bodyParams.text, rid: msg.rid });\n\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage: RocketChat.models.Messages.findOneById(msg._id)\n\t\t});\n\t}\n});\n","//Returns the private group subscription IF found otherwise it will return the failure of why it didn't. Check the `statusCode` property\nfunction findPrivateGroupByIdOrName({ roomId, roomName, userId, checkedArchived = true }) {\n\tif ((!roomId || !roomId.trim()) && (!roomName || !roomName.trim())) {\n\t\tthrow new Meteor.Error('error-roomid-param-not-provided', 'The parameter \"roomId\" or \"roomName\" is required');\n\t}\n\n\tlet roomSub;\n\tif (roomId) {\n\t\troomSub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(roomId, userId);\n\t} else if (roomName) {\n\t\troomSub = RocketChat.models.Subscriptions.findOneByRoomNameAndUserId(roomName, userId);\n\t}\n\n\tif (!roomSub || roomSub.t !== 'p') {\n\t\tthrow new Meteor.Error('error-room-not-found', `No private group by the id of: ${ roomId }`);\n\t}\n\n\tif (checkedArchived && roomSub.archived) {\n\t\tthrow new Meteor.Error('error-room-archived', `The private group, ${ roomSub.name }, is archived`);\n\t}\n\n\treturn roomSub;\n}\n\nRocketChat.API.v1.addRoute('groups.addAll', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addAllUserToRoom', findResult.rid, this.bodyParams.activeUsersOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.addModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomModerator', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.addOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomOwner', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n//Archives a private group only if it wasn't\nRocketChat.API.v1.addRoute('groups.archive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('archiveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.close', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId, checkedArchived: false });\n\n\t\tif (!findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The private group with an id \"${ this.bodyParams.roomId }\" is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n//Create Private Group\nRocketChat.API.v1.addRoute('groups.create', { authRequired: true }, {\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'create-p')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"name\" is required');\n\t\t}\n\n\t\tif (this.bodyParams.members && !_.isArray(this.bodyParams.members)) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"members\" must be an array if provided');\n\t\t}\n\n\t\tif (this.bodyParams.customFields && !(typeof this.bodyParams.customFields === 'object')) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"customFields\" must be an object if provided');\n\t\t}\n\n\t\tlet readOnly = false;\n\t\tif (typeof this.bodyParams.readOnly !== 'undefined') {\n\t\t\treadOnly = this.bodyParams.readOnly;\n\t\t}\n\n\t\tlet id;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tid = Meteor.call('createPrivateGroup', this.bodyParams.name, this.bodyParams.members ? this.bodyParams.members : [], readOnly, this.bodyParams.customFields);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(id.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.delete', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId, checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('eraseRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.processQueryOptionsOnResult([findResult._room], { fields: RocketChat.API.v1.defaultFieldsToExclude })[0]\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.getIntegrations', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.queryParams.roomId, userId: this.userId, checkedArchived: false });\n\n\t\tlet includeAllPrivateGroups = true;\n\t\tif (typeof this.queryParams.includeAllPrivateGroups !== 'undefined') {\n\t\t\tincludeAllPrivateGroups = this.queryParams.includeAllPrivateGroups === 'true';\n\t\t}\n\n\t\tconst channelsToSearch = [`#${ findResult.name }`];\n\t\tif (includeAllPrivateGroups) {\n\t\t\tchannelsToSearch.push('all_private_groups');\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { channel: { $in: channelsToSearch } });\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _createdAt: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\tcount: integrations.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.history', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.queryParams.roomId, userId: this.userId, checkedArchived: false });\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tlet inclusive = false;\n\t\tif (this.queryParams.inclusive) {\n\t\t\tinclusive = this.queryParams.inclusive;\n\t\t}\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tlet unreads = false;\n\t\tif (this.queryParams.unreads) {\n\t\t\tunreads = this.queryParams.unreads;\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', { rid: findResult.rid, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: result && result.messages ? result.messages : []\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.info', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.queryParams.roomId, roomName: this.queryParams.roomName, userId: this.userId, checkedArchived: false });\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.invite', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addUserToRoom', { rid: findResult.rid, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.kick', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeUserFromRoom', { rid: findResult.rid, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.leave', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('leaveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n//List Private Groups a user has access to\nRocketChat.API.v1.addRoute('groups.list', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\t\tlet rooms = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('p', this.userId).fetch(), '_room');\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroups: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.online', { authRequired: true }, {\n\tget() {\n\t\tconst { query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { t: 'p' });\n\n\t\tconst room = RocketChat.models.Rooms.findOne(ourQuery);\n\n\t\tif (room == null) {\n\t\t\treturn RocketChat.API.v1.failure('Group does not exists');\n\t\t}\n\n\t\tconst online = RocketChat.models.Users.findUsersNotOffline({\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tconst onlineInRoom = [];\n\t\tonline.forEach(user => {\n\t\t\tif (room.usernames.indexOf(user.username) !== -1) {\n\t\t\t\tonlineInRoom.push({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tonline: onlineInRoom\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.open', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId, checkedArchived: false });\n\n\t\tif (findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The private group, ${ this.bodyParams.name }, is already open for the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('openRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.removeModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomModerator', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.removeOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomOwner', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.rename', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.name || !this.bodyParams.name.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"name\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomName', this.bodyParams.name);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setDescription', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.description || !this.bodyParams.description.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"description\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomDescription', this.bodyParams.description);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tdescription: this.bodyParams.description\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setPurpose', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.purpose || !this.bodyParams.purpose.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"purpose\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomDescription', this.bodyParams.purpose);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpurpose: this.bodyParams.purpose\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setReadOnly', { authRequired: true }, {\n\tpost() {\n\t\tif (typeof this.bodyParams.readOnly === 'undefined') {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"readOnly\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tif (findResult.ro === this.bodyParams.readOnly) {\n\t\t\treturn RocketChat.API.v1.failure('The private group read only setting is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'readOnly', this.bodyParams.readOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setTopic', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setType', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.type || !this.bodyParams.type.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"type\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId });\n\n\t\tif (findResult.t === this.bodyParams.type) {\n\t\t\treturn RocketChat.API.v1.failure('The private group type is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomType', this.bodyParams.type);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.unarchive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ roomId: this.bodyParams.roomId, userId: this.userId, checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('unarchiveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n","function findDirectMessageRoomById(roomId, userId) {\n\tif (!roomId || !roomId.trim()) {\n\t\treturn RocketChat.API.v1.failure('Body param \"roomId\" is required');\n\t}\n\n\tconst roomSub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(roomId, userId);\n\n\tif (!roomSub || roomSub.t !== 'd') {\n\t\treturn RocketChat.API.v1.failure(`No direct message room found by the id of: ${ roomId }`);\n\t}\n\n\treturn roomSub;\n}\n\nRocketChat.API.v1.addRoute(['dm.close', 'im.close'], { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findDirectMessageRoomById(this.bodyParams.roomId, this.userId);\n\n\t\t//The find method returns either with the dm or the failure\n\t\tif (findResult.statusCode) {\n\t\t\treturn findResult;\n\t\t}\n\n\t\tif (!findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The direct message room, ${ this.bodyParams.name }, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.history', 'im.history'], { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findDirectMessageRoomById(this.queryParams.roomId, this.userId);\n\n\t\t//The find method returns either with the group or the failure\n\t\tif (findResult.statusCode) {\n\t\t\treturn findResult;\n\t\t}\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tlet inclusive = false;\n\t\tif (this.queryParams.inclusive) {\n\t\t\tinclusive = this.queryParams.inclusive;\n\t\t}\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tlet unreads = false;\n\t\tif (this.queryParams.unreads) {\n\t\t\tunreads = this.queryParams.unreads;\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', { rid: findResult.rid, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: result && result.messages ? result.messages : []\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.messages.others', 'im.messages.others'], { authRequired: true }, {\n\tget() {\n\t\tif (RocketChat.settings.get('API_Enable_Direct_Message_History_EndPoint') !== true) {\n\t\t\tthrow new Meteor.Error('error-endpoint-disabled', 'This endpoint is disabled', { route: '/api/v1/im.messages.others' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst roomId = this.queryParams.roomId;\n\t\tif (!roomId || !roomId.trim()) {\n\t\t\tthrow new Meteor.Error('error-roomid-param-not-provided', 'The parameter \"roomId\" is required');\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(roomId);\n\t\tif (!room || room.t !== 'd') {\n\t\t\tthrow new Meteor.Error('error-room-not-found', `No direct message room found by the id of: ${ roomId }`);\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { rid: room._id });\n\n\t\tconst msgs = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: msgs,\n\t\t\toffset,\n\t\t\tcount: msgs.length,\n\t\t\ttotal: RocketChat.models.Messages.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.list', 'im.list'], { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\t\tlet rooms = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('d', this.userId).fetch(), '_room');\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tims: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.list.everyone', 'im.list.everyone'], { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { t: 'd' });\n\n\t\tconst rooms = RocketChat.models.Rooms.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tims: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: RocketChat.models.Rooms.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.open', 'im.open'], { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findDirectMessageRoomById(this.bodyParams.roomId, this.userId);\n\n\t\t//The find method returns either with the group or the failure\n\t\tif (findResult.statusCode) {\n\t\t\treturn findResult;\n\t\t}\n\n\t\tif (findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The direct message room, ${ this.bodyParams.name }, is already open for the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('openRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.setTopic', 'im.setTopic'], { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findDirectMessageRoomById(this.bodyParams.roomId, this.userId);\n\n\t\t//The find method returns either with the group or the failure\n\t\tif (findResult.statusCode) {\n\t\t\treturn findResult;\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic\n\t\t});\n\t}\n});\n","RocketChat.API.v1.addRoute('integrations.create', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\ttype: String,\n\t\t\tname: String,\n\t\t\tenabled: Boolean,\n\t\t\tusername: String,\n\t\t\turls: Match.Maybe([String]),\n\t\t\tchannel: String,\n\t\t\tevent: Match.Maybe(String),\n\t\t\ttriggerWords: Match.Maybe([String]),\n\t\t\talias: Match.Maybe(String),\n\t\t\tavatar: Match.Maybe(String),\n\t\t\temoji: Match.Maybe(String),\n\t\t\ttoken: Match.Maybe(String),\n\t\t\tscriptEnabled: Boolean,\n\t\t\tscript: Match.Maybe(String),\n\t\t\ttargetChannel: Match.Maybe(String)\n\t\t}));\n\n\t\tlet integration;\n\n\t\tswitch (this.bodyParams.type) {\n\t\t\tcase 'webhook-outgoing':\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tintegration = Meteor.call('addOutgoingIntegration', this.bodyParams);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'webhook-incoming':\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tintegration = Meteor.call('addIncomingIntegration', this.bodyParams);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn RocketChat.API.v1.failure('Invalid integration type.');\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ integration });\n\t}\n});\n\nRocketChat.API.v1.addRoute('integrations.history', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.queryParams.id || this.queryParams.id.trim() === '') {\n\t\t\treturn RocketChat.API.v1.failure('Invalid integration id.');\n\t\t}\n\n\t\tconst id = this.queryParams.id;\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { 'integration._id': id });\n\t\tconst history = RocketChat.models.IntegrationHistory.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _updatedAt: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\thistory,\n\t\t\toffset,\n\t\t\titems: history.length,\n\t\t\ttotal: RocketChat.models.IntegrationHistory.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('integrations.list', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query);\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\toffset,\n\t\t\titems: integrations.length,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('integrations.remove', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\ttype: String,\n\t\t\ttarget_url: Match.Maybe(String),\n\t\t\tintegrationId: Match.Maybe(String)\n\t\t}));\n\n\t\tif (!this.bodyParams.target_url && !this.bodyParams.integrationId) {\n\t\t\treturn RocketChat.API.v1.failure('An integrationId or target_url needs to be provided.');\n\t\t}\n\n\t\tswitch (this.bodyParams.type) {\n\t\t\tcase 'webhook-outgoing':\n\t\t\t\tlet integration;\n\n\t\t\t\tif (this.bodyParams.target_url) {\n\t\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ urls: this.bodyParams.target_url });\n\t\t\t\t} else if (this.bodyParams.integrationId) {\n\t\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ _id: this.bodyParams.integrationId });\n\t\t\t\t}\n\n\t\t\t\tif (!integration) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('No integration found.');\n\t\t\t\t}\n\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tMeteor.call('deleteOutgoingIntegration', integration._id);\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\t\tintegration\n\t\t\t\t});\n\t\t\tcase 'webhook-incoming':\n\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ _id: this.bodyParams.integrationId });\n\n\t\t\t\tif (!integration) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('No integration found.');\n\t\t\t\t}\n\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tMeteor.call('deleteIncomingIntegration', integration._id);\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\t\tintegration\n\t\t\t\t});\n\t\t\tdefault:\n\t\t\t\treturn RocketChat.API.v1.failure('Invalid integration type.');\n\t\t}\n\t}\n});\n","RocketChat.API.v1.addRoute('info', { authRequired: false }, {\n\tget() {\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (user && RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tinfo: RocketChat.Info\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tinfo: {\n\t\t\t\t'version': RocketChat.Info.version\n\t\t\t}\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('me', { authRequired: true }, {\n\tget() {\n\t\treturn RocketChat.API.v1.success(_.pick(this.user, [\n\t\t\t'_id',\n\t\t\t'name',\n\t\t\t'emails',\n\t\t\t'status',\n\t\t\t'statusConnection',\n\t\t\t'username',\n\t\t\t'utcOffset',\n\t\t\t'active',\n\t\t\t'language'\n\t\t]));\n\t}\n});\n\nlet onlineCache = 0;\nlet onlineCacheDate = 0;\nconst cacheInvalid = 60000; // 1 minute\nRocketChat.API.v1.addRoute('shield.svg', { authRequired: false }, {\n\tget() {\n\t\tconst { type, channel, name, icon } = this.queryParams;\n\t\tif (!RocketChat.settings.get('API_Enable_Shields')) {\n\t\t\tthrow new Meteor.Error('error-endpoint-disabled', 'This endpoint is disabled', { route: '/api/v1/shields.svg' });\n\t\t}\n\t\tconst types = RocketChat.settings.get('API_Shield_Types');\n\t\tif (type && (types !== '*' && !types.split(',').map((t) => t.trim()).includes(type))) {\n\t\t\tthrow new Meteor.Error('error-shield-disabled', 'This shield type is disabled', { route: '/api/v1/shields.svg' });\n\t\t}\n\t\tconst hideIcon = icon === 'false';\n\t\tif (hideIcon && (!name || !name.trim())) {\n\t\t\treturn RocketChat.API.v1.failure('Name cannot be empty when icon is hidden');\n\t\t}\n\t\tlet text;\n\t\tswitch (type) {\n\t\t\tcase 'online':\n\t\t\t\tif (Date.now() - onlineCacheDate > cacheInvalid) {\n\t\t\t\t\tonlineCache = RocketChat.models.Users.findUsersNotOffline().count();\n\t\t\t\t\tonlineCacheDate = Date.now();\n\t\t\t\t}\n\t\t\t\ttext = `${ onlineCache } ${ TAPi18n.__('Online') }`;\n\t\t\t\tbreak;\n\t\t\tcase 'channel':\n\t\t\t\tif (!channel) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('Shield channel is required for type \"channel\"');\n\t\t\t\t}\n\t\t\t\ttext = `#${ channel }`;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\ttext = TAPi18n.__('Join_Chat').toUpperCase();\n\t\t}\n\t\tconst iconSize = hideIcon ? 7 : 24;\n\t\tconst leftSize = name ? name.length * 6 + 7 + iconSize : iconSize;\n\t\tconst rightSize = text.length * 6 + 20;\n\t\tconst width = leftSize + rightSize;\n\t\tconst height = 20;\n\t\treturn {\n\t\t\theaders: { 'Content-Type': 'image/svg+xml;charset=utf-8' },\n\t\t\tbody: `\n\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"${ width }\" height=\"${ height }\">\n\t\t\t\t  <linearGradient id=\"b\" x2=\"0\" y2=\"100%\">\n\t\t\t\t    <stop offset=\"0\" stop-color=\"#bbb\" stop-opacity=\".1\"/>\n\t\t\t\t    <stop offset=\"1\" stop-opacity=\".1\"/>\n\t\t\t\t  </linearGradient>\n\t\t\t\t  <mask id=\"a\">\n\t\t\t\t    <rect width=\"${ width }\" height=\"${ height }\" rx=\"3\" fill=\"#fff\"/>\n\t\t\t\t  </mask>\n\t\t\t\t  <g mask=\"url(#a)\">\n\t\t\t\t    <path fill=\"#555\" d=\"M0 0h${ leftSize }v${ height }H0z\"/>\n\t\t\t\t    <path fill=\"#4c1\" d=\"M${ leftSize } 0h${ rightSize }v${ height }H${ leftSize }z\"/>\n\t\t\t\t    <path fill=\"url(#b)\" d=\"M0 0h${ width }v${ height }H0z\"/>\n\t\t\t\t  </g>\n\t\t\t\t    ${ hideIcon ? '' : '<image x=\"5\" y=\"3\" width=\"14\" height=\"14\" xlink:href=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfNSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSI1MTJweCIgaGVpZ2h0PSI1MTJweCIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDUxMiA1MTIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxwYXRoIGZpbGw9IiNDMTI3MkQiIGQ9Ik01MDIuNTg2LDI1NS4zMjJjMC0yNS4yMzYtNy41NS00OS40MzYtMjIuNDQ1LTcxLjkzMmMtMTMuMzczLTIwLjE5NS0zMi4xMDktMzguMDcyLTU1LjY4Ny01My4xMzJDMzc4LjkzNywxMDEuMTgyLDMxOS4xMDgsODUuMTY4LDI1Niw4NS4xNjhjLTIxLjA3OSwwLTQxLjg1NSwxLjc4MS02Mi4wMDksNS4zMWMtMTIuNTA0LTExLjcwMi0yNy4xMzktMjIuMjMyLTQyLjYyNy0zMC41NkM2OC42MTgsMTkuODE4LDAsNTguOTc1LDAsNTguOTc1czYzLjc5OCw1Mi40MDksNTMuNDI0LDk4LjM1Yy0yOC41NDIsMjguMzEzLTQ0LjAxLDYyLjQ1My00NC4wMSw5Ny45OThjMCwwLjExMywwLjAwNiwwLjIyNiwwLjAwNiwwLjM0YzAsMC4xMTMtMC4wMDYsMC4yMjYtMC4wMDYsMC4zMzljMCwzNS41NDUsMTUuNDY5LDY5LjY4NSw0NC4wMSw5Ny45OTlDNjMuNzk4LDM5OS45NCwwLDQ1Mi4zNSwwLDQ1Mi4zNXM2OC42MTgsMzkuMTU2LDE1MS4zNjMtMC45NDNjMTUuNDg4LTguMzI3LDMwLjEyNC0xOC44NTcsNDIuNjI3LTMwLjU2YzIwLjE1NCwzLjUyOCw0MC45MzEsNS4zMSw2Mi4wMDksNS4zMWM2My4xMDgsMCwxMjIuOTM3LTE2LjAxNCwxNjguNDU0LTQ1LjA5MWMyMy41NzctMTUuMDYsNDIuMzEzLTMyLjkzNyw1NS42ODctNTMuMTMyYzE0Ljg5Ni0yMi40OTYsMjIuNDQ1LTQ2LjY5NSwyMi40NDUtNzEuOTMyYzAtMC4xMTMtMC4wMDYtMC4yMjYtMC4wMDYtMC4zMzlDNTAyLjU4LDI1NS41NDgsNTAyLjU4NiwyNTUuNDM2LDUwMi41ODYsMjU1LjMyMnoiLz48cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMjU2LDEyMC44NDdjMTE2Ljg1NCwwLDIxMS41ODYsNjAuNTA5LDIxMS41ODYsMTM1LjE1NGMwLDc0LjY0MS05NC43MzEsMTM1LjE1NS0yMTEuNTg2LDEzNS4xNTVjLTI2LjAxOSwwLTUwLjkzNy0zLjAwOS03My45NTktOC40OTVjLTIzLjM5NiwyOC4xNDctNzQuODY4LDY3LjI4LTEyNC44NjksNTQuNjI5YzE2LjI2NS0xNy40Nyw0MC4zNjEtNDYuOTg4LDM1LjIwMS05NS42MDNjLTI5Ljk2OC0yMy4zMjItNDcuOTU5LTUzLjE2My00Ny45NTktODUuNjg2QzQ0LjQxNCwxODEuMzU2LDEzOS4xNDUsMTIwLjg0NywyNTYsMTIwLjg0NyIvPjxnPjxnPjxjaXJjbGUgZmlsbD0iI0MxMjcyRCIgY3g9IjI1NiIgY3k9IjI2MC4zNTIiIHI9IjI4LjEwNSIvPjwvZz48Zz48Y2lyY2xlIGZpbGw9IiNDMTI3MkQiIGN4PSIzNTMuNzI4IiBjeT0iMjYwLjM1MiIgcj0iMjguMTA0Ii8+PC9nPjxnPjxjaXJjbGUgZmlsbD0iI0MxMjcyRCIgY3g9IjE1OC4yNzIiIGN5PSIyNjAuMzUyIiByPSIyOC4xMDUiLz48L2c+PC9nPjxnPjxwYXRoIGZpbGw9IiNDQ0NDQ0MiIGQ9Ik0yNTYsMzczLjM3M2MtMjYuMDE5LDAtNTAuOTM3LTIuNjA3LTczLjk1OS03LjM2MmMtMjAuNjU5LDIxLjU0LTYzLjIwOSw1MC40OTYtMTA3LjMwNyw0OS40M2MtNS44MDYsOC44MDUtMTIuMTIxLDE2LjAwNi0xNy41NjIsMjEuODVjNTAsMTIuNjUxLDEwMS40NzMtMjYuNDgxLDEyNC44NjktNTQuNjI5YzIzLjAyMyw1LjQ4Niw0Ny45NDEsOC40OTUsNzMuOTU5LDguNDk1YzExNS45MTcsMCwyMTAuMDQ4LTU5LjU1LDIxMS41NTEtMTMzLjM2NEM0NjYuMDQ4LDMyMS43NjUsMzcxLjkxNywzNzMuMzczLDI1NiwzNzMuMzczeiIvPjwvZz48L3N2Zz4=\"/>' }\n\t\t\t\t  <g fill=\"#fff\" font-family=\"DejaVu Sans,Verdana,Geneva,sans-serif\" font-size=\"11\">\n\t\t\t\t\t\t${ name ? `<text x=\"${ iconSize }\" y=\"15\" fill=\"#010101\" fill-opacity=\".3\">${ name }</text>\n\t\t\t\t    <text x=\"${ iconSize }\" y=\"14\">${ name }</text>` : '' }\n\t\t\t\t    <text x=\"${ leftSize + 7 }\" y=\"15\" fill=\"#010101\" fill-opacity=\".3\">${ text }</text>\n\t\t\t\t    <text x=\"${ leftSize + 7 }\" y=\"14\">${ text }</text>\n\t\t\t\t  </g>\n\t\t\t\t</svg>\n\t\t\t`.trim().replace(/\\>[\\s]+\\</gm, '><')\n\t\t};\n\t}\n});\n","// settings endpoints\nRocketChat.API.v1.addRoute('settings', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tlet ourQuery = {\n\t\t\thidden: { $ne: true }\n\t\t};\n\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-privileged-setting')) {\n\t\t\tourQuery.public = true;\n\t\t}\n\n\t\tourQuery = Object.assign({}, query, ourQuery);\n\n\t\tconst settings = RocketChat.models.Settings.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _id: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({ _id: 1, value: 1 }, fields)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tsettings,\n\t\t\tcount: settings.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Settings.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('settings/:_id', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-privileged-setting')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(_.pick(RocketChat.models.Settings.findOneNotHiddenById(this.urlParams._id), '_id', 'value'));\n\t},\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'edit-privileged-setting')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tcheck(this.bodyParams, {\n\t\t\tvalue: Match.Any\n\t\t});\n\n\t\tif (RocketChat.models.Settings.updateValueNotHiddenById(this.urlParams._id, this.bodyParams.value)) {\n\t\t\treturn RocketChat.API.v1.success();\n\t\t}\n\n\t\treturn RocketChat.API.v1.failure();\n\t}\n});\n","RocketChat.API.v1.addRoute('statistics', { authRequired: true }, {\n\tget() {\n\t\tlet refresh = false;\n\t\tif (typeof this.queryParams.refresh !== 'undefined' && this.queryParams.refresh === 'true') {\n\t\t\trefresh = true;\n\t\t}\n\n\t\tlet stats;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tstats = Meteor.call('getStatistics', refresh);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tstatistics: stats\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('statistics.list', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-statistics')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query);\n\n\t\tconst statistics = RocketChat.models.Statistics.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tstatistics,\n\t\t\tcount: statistics.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Statistics.find(ourQuery).count()\n\t\t});\n\t}\n});\n","RocketChat.API.v1.addRoute('users.create', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\temail: String,\n\t\t\tname: String,\n\t\t\tpassword: String,\n\t\t\tusername: String,\n\t\t\tactive: Match.Maybe(Boolean),\n\t\t\troles: Match.Maybe(Array),\n\t\t\tjoinDefaultChannels: Match.Maybe(Boolean),\n\t\t\trequirePasswordChange: Match.Maybe(Boolean),\n\t\t\tsendWelcomeEmail: Match.Maybe(Boolean),\n\t\t\tverified: Match.Maybe(Boolean),\n\t\t\tcustomFields: Match.Maybe(Object)\n\t\t});\n\n\t\t//New change made by pull request #5152\n\t\tif (typeof this.bodyParams.joinDefaultChannels === 'undefined') {\n\t\t\tthis.bodyParams.joinDefaultChannels = true;\n\t\t}\n\n\t\tconst newUserId = RocketChat.saveUser(this.userId, this.bodyParams);\n\n\t\tif (this.bodyParams.customFields) {\n\t\t\tRocketChat.saveCustomFields(newUserId, this.bodyParams.customFields);\n\t\t}\n\n\t\tif (typeof this.bodyParams.active !== 'undefined') {\n\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\tMeteor.call('setUserActiveStatus', newUserId, this.bodyParams.active);\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(newUserId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.delete', { authRequired: true }, {\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'delete-user')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('deleteUser', user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.getAvatar', { authRequired: false }, {\n\tget() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tconst url = RocketChat.getURL(`/avatar/${ user.username }`, { cdn: false, full: true });\n\t\tthis.response.setHeader('Location', url);\n\n\t\treturn {\n\t\t\tstatusCode: 307,\n\t\t\tbody: url\n\t\t};\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.getPresence', { authRequired: true }, {\n\tget() {\n\t\tif (this.isUserFromParams()) {\n\t\t\tconst user = RocketChat.models.Users.findOneById(this.userId);\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tpresence: user.status,\n\t\t\t\tconnectionStatus: user.statusConnection,\n\t\t\t\tlastLogin: user.lastLogin\n\t\t\t});\n\t\t}\n\n\t\tconst user = this.getUserFromParams();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpresence: user.status\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.info', { authRequired: true }, {\n\tget() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getFullUserData', { filter: user.username, limit: 1 });\n\t\t});\n\n\t\tif (!result || result.length !== 1) {\n\t\t\treturn RocketChat.API.v1.failure(`Failed to get the user data for the userId of \"${ user._id }\".`);\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tuser: result[0]\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.list', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tlet fieldsToKeepFromRegularUsers;\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-full-other-user-info')) {\n\t\t\tfieldsToKeepFromRegularUsers = {\n\t\t\t\tavatarOrigin: 0,\n\t\t\t\temails: 0,\n\t\t\t\tphone: 0,\n\t\t\t\tstatusConnection: 0,\n\t\t\t\tcreatedAt: 0,\n\t\t\t\tlastLogin: 0,\n\t\t\t\tservices: 0,\n\t\t\t\trequirePasswordChange: 0,\n\t\t\t\trequirePasswordChangeReason: 0,\n\t\t\t\troles: 0,\n\t\t\t\tstatusDefault: 0,\n\t\t\t\t_updatedAt: 0,\n\t\t\t\tcustomFields: 0\n\t\t\t};\n\t\t}\n\n\t\tconst ourQuery = Object.assign({}, query);\n\t\tconst ourFields = Object.assign({}, fields, fieldsToKeepFromRegularUsers, RocketChat.API.v1.defaultFieldsToExclude);\n\n\t\tconst users = RocketChat.models.Users.find(ourQuery, {\n\t\t\tsort: sort ? sort : { username: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: ourFields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tusers,\n\t\t\tcount: users.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Users.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.register', { authRequired: false }, {\n\tpost() {\n\t\tif (this.userId) {\n\t\t\treturn RocketChat.API.v1.failure('Logged in users can not register again.');\n\t\t}\n\n\t\t//We set their username here, so require it\n\t\t//The `registerUser` checks for the other requirements\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tusername: String\n\t\t}));\n\n\t\t//Register the user\n\t\tconst userId = Meteor.call('registerUser', this.bodyParams);\n\n\t\t//Now set their username\n\t\tMeteor.runAsUser(userId, () => Meteor.call('setUsername', this.bodyParams.username));\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(userId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.resetAvatar', { authRequired: true }, {\n\tpost() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tif (user._id === this.userId) {\n\t\t\tMeteor.runAsUser(this.userId, () => Meteor.call('resetAvatar'));\n\t\t} else if (RocketChat.authz.hasPermission(this.userId, 'edit-other-user-info')) {\n\t\t\tMeteor.runAsUser(user._id, () => Meteor.call('resetAvatar'));\n\t\t} else {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.setAvatar', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, { avatarUrl: Match.Maybe(String), userId: Match.Maybe(String) });\n\n\t\tlet user;\n\t\tif (this.isUserFromParams()) {\n\t\t\tuser = Meteor.users.findOne(this.userId);\n\t\t} else if (RocketChat.authz.hasPermission(this.userId, 'edit-other-user-info')) {\n\t\t\tuser = this.getUserFromParams();\n\t\t} else {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (this.bodyParams.avatarUrl) {\n\t\t\tRocketChat.setUserAvatar(user, this.bodyParams.avatarUrl, '', 'url');\n\t\t} else {\n\t\t\tconst Busboy = Npm.require('busboy');\n\t\t\tconst busboy = new Busboy({ headers: this.request.headers });\n\n\t\t\tMeteor.wrapAsync((callback) => {\n\t\t\t\tbusboy.on('file', Meteor.bindEnvironment((fieldname, file, filename, encoding, mimetype) => {\n\t\t\t\t\tif (fieldname !== 'image') {\n\t\t\t\t\t\treturn callback(new Meteor.Error('invalid-field'));\n\t\t\t\t\t}\n\n\t\t\t\t\tconst imageData = [];\n\t\t\t\t\tfile.on('data', Meteor.bindEnvironment((data) => {\n\t\t\t\t\t\timageData.push(data);\n\t\t\t\t\t}));\n\n\t\t\t\t\tfile.on('end', Meteor.bindEnvironment(() => {\n\t\t\t\t\t\tRocketChat.setUserAvatar(user, Buffer.concat(imageData), mimetype, 'rest');\n\t\t\t\t\t\tcallback();\n\t\t\t\t\t}));\n\n\t\t\t\t\tthis.request.pipe(busboy);\n\t\t\t\t}));\n\t\t\t})();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.update', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\tuserId: String,\n\t\t\tdata: Match.ObjectIncluding({\n\t\t\t\temail: Match.Maybe(String),\n\t\t\t\tname: Match.Maybe(String),\n\t\t\t\tpassword: Match.Maybe(String),\n\t\t\t\tusername: Match.Maybe(String),\n\t\t\t\tactive: Match.Maybe(Boolean),\n\t\t\t\troles: Match.Maybe(Array),\n\t\t\t\tjoinDefaultChannels: Match.Maybe(Boolean),\n\t\t\t\trequirePasswordChange: Match.Maybe(Boolean),\n\t\t\t\tsendWelcomeEmail: Match.Maybe(Boolean),\n\t\t\t\tverified: Match.Maybe(Boolean),\n\t\t\t\tcustomFields: Match.Maybe(Object)\n\t\t\t})\n\t\t});\n\n\t\tconst userData = _.extend({ _id: this.bodyParams.userId }, this.bodyParams.data);\n\n\t\tMeteor.runAsUser(this.userId, () => RocketChat.saveUser(this.userId, userData));\n\n\t\tif (this.bodyParams.data.customFields) {\n\t\t\tRocketChat.saveCustomFields(this.bodyParams.userId, this.bodyParams.data.customFields);\n\t\t}\n\n\t\tif (typeof this.bodyParams.data.active !== 'undefined') {\n\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\tMeteor.call('setUserActiveStatus', this.bodyParams.userId, this.bodyParams.data.active);\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(this.bodyParams.userId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.createToken', { authRequired: true }, {\n\tpost() {\n\t\tconst user = this.getUserFromParams();\n\t\tlet data;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tdata = Meteor.call('createToken', user._id);\n\t\t});\n\t\treturn data ? RocketChat.API.v1.success({data}) : RocketChat.API.v1.unauthorized();\n\t}\n});\n","RocketChat.API.default.helperMethods.set('getLoggedInUser', function _getLoggedInUser() {\n\tlet user;\n\n\tif (this.request.headers['x-auth-token'] && this.request.headers['x-user-id']) {\n\t\tuser = RocketChat.models.Users.findOne({\n\t\t\t'_id': this.request.headers['x-user-id'],\n\t\t\t'services.resume.loginTokens.hashedToken': Accounts._hashLoginToken(this.request.headers['x-auth-token'])\n\t\t});\n\t}\n\n\treturn user;\n});\n","RocketChat.API.default.addRoute('info', { authRequired: false }, {\n\tget() {\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (user && RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tinfo: RocketChat.Info\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tversion: RocketChat.Info.version\n\t\t});\n\t}\n});\n","RocketChat.API.default.addRoute('metrics', { authRequired: false }, {\n\tget() {\n\t\treturn {\n\t\t\theaders: { 'Content-Type': 'text/plain' },\n\t\t\tbody: RocketChat.promclient.register.metrics()\n\t\t};\n\t}\n});\n"]}