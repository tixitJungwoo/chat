{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:slashcommands-msg/server.js"],"names":["Msg","command","params","item","Match","test","String","trimmedParams","trim","separator","indexOf","user","Meteor","users","findOne","userId","RocketChat","Notifications","notifyUser","_id","Random","id","rid","ts","Date","msg","TAPi18n","__","language","message","slice","targetUsernameOrig","targetUsername","replace","targetUser","models","Users","findOneByUsername","postProcess","sprintf","call","msgObject","slashCommands","add"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;;EAIA,SAASA,GAAT,CAAaC,OAAb,EAAsBC,MAAtB,EAA8BC,IAA9B,EAAoC;AACnC,KAAIF,YAAY,KAAZ,IAAqB,CAACG,MAAMC,IAAN,CAAWH,MAAX,EAAmBI,MAAnB,CAA1B,EAAsD;AACrD;AACA;;AACD,KAAMC,gBAAgBL,OAAOM,IAAP,EAAtB;AACA,KAAMC,YAAYF,cAAcG,OAAd,CAAsB,GAAtB,CAAlB;AACA,KAAMC,OAAOC,OAAOC,KAAP,CAAaC,OAAb,CAAqBF,OAAOG,MAAP,EAArB,CAAb;;AACA,KAAIN,cAAc,CAAC,CAAnB,EAAsB;AACrB,SAAOO,WAAWC,aAAX,CAAyBC,UAAzB,CAAoCN,OAAOG,MAAP,EAApC,EAAqD,SAArD,EAAgE;AACtEI,QAAKC,OAAOC,EAAP,EADiE;AAEtEC,QAAKnB,KAAKmB,GAF4D;AAGtEC,OAAI,IAAIC,IAAJ,EAHkE;AAItEC,QAAKC,QAAQC,EAAR,CAAW,wCAAX,EAAqD,IAArD,EAA2DhB,KAAKiB,QAAhE;AAJiE,GAAhE,CAAP;AAMA;;AACD,KAAMC,UAAUtB,cAAcuB,KAAd,CAAoBrB,YAAY,CAAhC,CAAhB;AACA,KAAMsB,qBAAqBxB,cAAcuB,KAAd,CAAoB,CAApB,EAAuBrB,SAAvB,CAA3B;AACA,KAAMuB,iBAAiBD,mBAAmBE,OAAnB,CAA2B,GAA3B,EAAgC,EAAhC,CAAvB;AACA,KAAMC,aAAalB,WAAWmB,MAAX,CAAkBC,KAAlB,CAAwBC,iBAAxB,CAA0CL,cAA1C,CAAnB;;AACA,KAAIE,cAAc,IAAlB,EAAwB;AACvBlB,aAAWC,aAAX,CAAyBC,UAAzB,CAAoCN,OAAOG,MAAP,EAApC,EAAqD,SAArD,EAAgE;AAC/DI,QAAKC,OAAOC,EAAP,EAD0D;AAE/DC,QAAKnB,KAAKmB,GAFqD;AAG/DC,OAAI,IAAIC,IAAJ,EAH2D;AAI/DC,QAAKC,QAAQC,EAAR,CAAW,uBAAX,EAAoC;AACxCW,iBAAa,SAD2B;AAExCC,aAAS,CAACR,kBAAD;AAF+B,IAApC,EAGFpB,KAAKiB,QAHH;AAJ0D,GAAhE;AASA;AACA;;AA9BkC,oBA+BrBhB,OAAO4B,IAAP,CAAY,qBAAZ,EAAmCR,cAAnC,CA/BqB;AAAA,KA+B5BV,GA/B4B,gBA+B5BA,GA/B4B;;AAgCnC,KAAMmB,YAAY;AACjBtB,OAAKC,OAAOC,EAAP,EADY;AAEjBC,UAFiB;AAGjBG,OAAKI;AAHY,EAAlB;AAKAjB,QAAO4B,IAAP,CAAY,aAAZ,EAA2BC,SAA3B;AACA;;AAEDzB,WAAW0B,aAAX,CAAyBC,GAAzB,CAA6B,KAA7B,EAAoC3C,GAApC,gD","file":"/packages/rocketchat_slashcommands-msg.js","sourcesContent":["\n/*\n* Msg is a named function that will replace /msg commands\n*/\n\nfunction Msg(command, params, item) {\n\tif (command !== 'msg' || !Match.test(params, String)) {\n\t\treturn;\n\t}\n\tconst trimmedParams = params.trim();\n\tconst separator = trimmedParams.indexOf(' ');\n\tconst user = Meteor.users.findOne(Meteor.userId());\n\tif (separator === -1) {\n\t\treturn\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t_id: Random.id(),\n\t\t\trid: item.rid,\n\t\t\tts: new Date,\n\t\t\tmsg: TAPi18n.__('Username_and_message_must_not_be_empty', null, user.language)\n\t\t});\n\t}\n\tconst message = trimmedParams.slice(separator + 1);\n\tconst targetUsernameOrig = trimmedParams.slice(0, separator);\n\tconst targetUsername = targetUsernameOrig.replace('@', '');\n\tconst targetUser = RocketChat.models.Users.findOneByUsername(targetUsername);\n\tif (targetUser == null) {\n\t\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t_id: Random.id(),\n\t\t\trid: item.rid,\n\t\t\tts: new Date,\n\t\t\tmsg: TAPi18n.__('Username_doesnt_exist', {\n\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\tsprintf: [targetUsernameOrig]\n\t\t\t}, user.language)\n\t\t});\n\t\treturn;\n\t}\n\tconst {rid} = Meteor.call('createDirectMessage', targetUsername);\n\tconst msgObject = {\n\t\t_id: Random.id(),\n\t\trid,\n\t\tmsg: message\n\t};\n\tMeteor.call('sendMessage', msgObject);\n}\n\nRocketChat.slashCommands.add('msg', Msg);\n"]}