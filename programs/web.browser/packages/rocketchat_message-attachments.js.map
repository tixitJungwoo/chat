{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:message-attachments/client/messageAttachment.js"],"names":["moment","module","watch","require","v","colors","good","warning","danger","fixCordova","url","indexOf","Meteor","isCordova","absoluteUrl","replace","query","userId","_localStorage","getItem","settings","sandstorm","match","navigator","userAgent","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","Template","messageAttachment","helpers","parsedText","renderMessageBody","msg","text","loadImage","user","preferences","downloadImages","autoImageLoad","Device","isPhone","saveMobileBandwidth","getImageHeight","height","color","collapsed","collapseMediaByDefault","time","messageDate","Date","ts","today","toDateString","format","RocketChat","get","injectIndex","data","previousIndex","index"],"mappings":"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","file":"/packages/rocketchat_message-attachments.js","sourcesContent":["import moment from 'moment';\nconst colors = {\n\tgood: '#35AC19',\n\twarning: '#FCB316',\n\tdanger: '#D30230'\n};\nconst fixCordova = function(url) {\n\tif (url && url.indexOf('data:image') === 0) {\n\t\treturn url;\n\t}\n\tif (Meteor.isCordova && (url && url[0] === '/')) {\n\t\turl = Meteor.absoluteUrl().replace(/\\/$/, '') + url;\n\t\tconst query = `rc_uid=${ Meteor.userId() }&rc_token=${ Meteor._localStorage.getItem('Meteor.loginToken') }`;\n\t\tif (url.indexOf('?') === -1) {\n\t\t\turl = `${ url }?${ query }`;\n\t\t} else {\n\t\t\turl = `${ url }&${ query }`;\n\t\t}\n\t}\n\tif (Meteor.settings['public'].sandstorm || url.match(/^(https?:)?\\/\\//i)) {\n\t\treturn url;\n\t} else if (navigator.userAgent.indexOf('Electron') > -1) {\n\t\treturn __meteor_runtime_config__.ROOT_URL_PATH_PREFIX + url;\n\t} else {\n\t\treturn Meteor.absoluteUrl().replace(/\\/$/, '') + __meteor_runtime_config__.ROOT_URL_PATH_PREFIX + url;\n\t}\n};\n/*globals renderMessageBody*/\nTemplate.messageAttachment.helpers({\n\tfixCordova,\n\tparsedText() {\n\t\treturn renderMessageBody({\n\t\t\tmsg: this.text\n\t\t});\n\t},\n\tloadImage() {\n\t\tconst user = Meteor.user();\n\t\tif (user && user.settings && user.settings.preferences && this.downloadImages !== true) {\n\t\t\tif (user.settings.preferences.autoImageLoad === false) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (Meteor.Device.isPhone() && user.settings.preferences.saveMobileBandwidth !== true) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t},\n\tgetImageHeight(height = 200) {\n\t\treturn height;\n\t},\n\tcolor() {\n\t\treturn colors[this.color] || this.color;\n\t},\n\tcollapsed() {\n\t\tif (this.collapsed != null) {\n\t\t\treturn this.collapsed;\n\t\t} else {\n\t\t\tconst user = Meteor.user();\n\t\t\treturn user && user.settings && user.settings.preferences && user.settings.preferences.collapseMediaByDefault === true;\n\t\t}\n\t},\n\ttime() {\n\t\tconst messageDate = new Date(this.ts);\n\t\tconst today = new Date();\n\t\tif (messageDate.toDateString() === today.toDateString()) {\n\t\t\treturn moment(this.ts).format(RocketChat.settings.get('Message_TimeFormat'));\n\t\t} else {\n\t\t\treturn moment(this.ts).format(RocketChat.settings.get('Message_TimeAndDateFormat'));\n\t\t}\n\t},\n\tinjectIndex(data, previousIndex, index) {\n\t\tdata.index = `${ previousIndex }.attachments.${ index }`;\n\t}\n});\n"]}